angular.module("vgraph",[]),angular.module("vgraph").factory("DomHelper",[function(){"use strict";function t(t){var i=e[t];return i||(i=new RegExp("(?:^|\\s)"+t+"(?!\\S)"),e[t]=i),i}var e={};return{addClass:function(e,i){var r,n,a,o,s=t(i);for(r=0,n=e.length;n>r;r++)a=e[r].$element,o=a.getAttribute("class")||"",o.match(s)||a.setAttribute("class",o+" "+i)},removeClass:function(e,i){var r,n,a,o=t(i);for(r=0,n=e.length;n>r;r++)a=e[r].$element,a.setAttribute("class",(a.getAttribute("class")||"").replace(o,""))}}}]),angular.module("vgraph").factory("makeEventing",[function(){"use strict";return function(t){t.$on=function(t,e){var i=this;return this._$listeners||(this._$listeners={}),this._$listeners[t]||(this._$listeners[t]=[]),this._$listeners[t].push(e),function(){i._$listeners[t].splice(i._$listeners[t].indexOf(e),1)}},t.$subscribe=function(t){var e=this,i=[],r=Object.keys(t);return r.forEach(function(r){var n=t[r];i.push(e.$on(r,n))}),function(){i.forEach(function(t){t()})}},t.$trigger=function(t,e){var i,r,n;if(this._$listeners&&(i=this._$listeners[t]))for(r=0,n=i.length;n>r;r++)i[r](e)}}}]),angular.module("vgraph").factory("Hitbox",[function(){"use strict";function t(t,e,i,r,n){var a,o,s,c,l,h=[],u=[],f=[];for(this.xMin=t,this.xDiff=e-t,this.yMin=i,this.yDiff=r-i,this.count=n,a=0,o=n;o>a;a++)for(l=[],h.push(l),u.push([]),f.push([]),s=0,c=n;c>s;s++)l.push([]);this._index=h,this._xDex=u,this._yDex=f}function e(t,e,i,r){var n,a,o,s=[];for(n=0,a=t.length;a>n;n++)o=t[n],r(o)(e,i)&&s.push(o);return s}var i=0;t.prototype.$hashX=function(t){return(t-this.xMin)/this.xDiff*this.count|0},t.prototype.$hashY=function(t){return(t-this.yMin)/this.yDiff*this.count|0},t.prototype.add=function(t){var e,r,n,a,o,s,c=this._index;for(t.x1>t.x2&&(o=t.x1,t.x1=t.x2,t.x2=o),t.y1>t.y2&&(o=t.y1,t.y1=t.y2,t.y2=o),t.$uid=i++,e=this.$hashX(t.x1),r=this.$hashX(t.x2)+1,o=this.$hashY(t.y1),a=this.$hashY(t.y2)+1,n=o;a>n;n++)this._yDex[n].push(t);for(;r>e;e++)for(s=c[e],this._xDex[e].push(t),n=o;a>n;n++)s[n].push(t)};var r={intersect:function(t,e){return this.x1<=t&&this.x2>=t&&this.y1<=e&&this.y2>=e},intersectX:function(t){return this.x1<=t&&this.x2>=t},intersectY:function(t,e){return this.y1<=e&&this.y2>=e}};return t.prototype.checkHit=function(t,i){return e(this._index[this.$hashX(t)][this.$hashY(i)],t,i,function(t){return(t.intersect?t.intersect:r.intersect).bind(t)})},t.prototype.checkX=function(t){return e(this._xDex[this.$hashX(t)],t,null,function(t){return(t.intersectX?t.intersectX:r.intersectX).bind(t)})},t.prototype.checkY=function(t){return e(this._yDex[this.$hashY(t)],null,t,function(t){return(t.intersectY?t.intersectY:r.intersectY).bind(t)})},t}]),angular.module("vgraph").factory("Scheduler",[function(){"use strict";function t(){this.$scripts={},this.$master=this.schedule=[]}function e(){return+new Date}return t.prototype.startScript=function(t){t?this.$scripts[t]?(this.schedule=this.$scripts[t],this.schedule.length=0):this.schedule=this.$scripts[t]=[]:this.schedule=[]},t.prototype.endScript=function(t,e,i){this.schedule.push({$end:!0,always:t,success:e,failure:i}),this.$master.push(this.schedule),this.schedule=this.$master},t.prototype.loop=function(t,e,i){this.schedule.push({start:0,stop:t.length,data:t,op:e,ctx:i})},t.prototype.func=function(t,e){this.schedule.push({op:t,ctx:e})},t.prototype.run=function(){var t=this;this.$lock||(this.$lock=!0,setTimeout(function(){t.$eval()},5))},t.prototype.$eval=function(){function t(){a.$eval()}var i,r,n,a=this,o=!0,s=e(),c=s+500;try{for(;(n=this.schedule.shift())&&o;){if(n.length)for(;n.length;)this.schedule.unshift(n.pop());else if("start"in n)for(i=n.start,r=n.stop;r>i;i++)n.op.call(n.ctx,n.data[i],i);else n.$end?(n.success&&n.success(),n.always&&n.always()):n.op.call(n.ctx);e()>c&&(o=!1,setTimeout(t,5))}}catch(l){for(console.log(l),o=!0;(n=this.schedule.shift())&&o;)n.$end&&(n.failure&&n.failure(),n.always&&n.always(),t())}this.schedule.length||(this.$lock=!1)},t}]),angular.module("vgraph").factory("StatCalculations",[function(){"use strict";function t(t){return null===t?!1:Number.isFinite?Number.isFinite(t)&&!Number.isNaN(t):isFinite(t)&&!isNaN(t)}function e(t,e){var i=[];return t.forEach(function(t){i.push("$"+e+"$"+t.field)}),i}return{$resetCalcs:function(t){var e,i;for(e=0,i=t.length;i>e;e++)t[e].$reset()},$getFields:function(t){var e,i,r=[];for(e=0,i=t.length;i>e;e++)r.push(t[e].field);return r},$setFields:function(t,e){var i,r;for(i=0,r=t.length;r>i;i++)t[i].field=e[i]},stack:function(t){var i,r,n,a,o,s,c,l,h,u=e(t,"stack"),f=this.indexs(t);for(a=t.length,i=0,r=f.length;r>i;i++)for(s=0,c=f[i],n=0;a>n;n++)l=t[n],h=l.$getNode(c),o=l.getValue(h)||0,s+=o,h[u[n]]=s;for(n=0;a>n;n++)t[n].field=u[n];return u},limits:function(e){var i,r,n,a,o;if(angular.isArray(e))for(i=0,r=e.length;r>i;i++)n=this.limits(e[i]),void 0===a?(a=n.min,o=n.max):(n.min<a&&(a=n.min),n.max>o&&(o=n.max));else e&&e.getValue&&e.$eachNode(function(i){n=e.getValue(i),t(n)&&(void 0===a?(a=n,o=n):a>n?a=n:n>o&&(o=n))});return{min:a,max:o}},indexs:function(t){var e,i={};return 1===t.length?e=t[0].$getIndexs():(e=[],t.forEach(function(t){e=e.concat(t.$getIndexs())}),e=e.filter(function(t){return i[t]?void 0:(i[t]=!0,t)})),e}}}]),angular.module("vgraph").factory("ComponentBox",["makeEventing",function(t){"use strict";function e(t,e){var i=e.padding,n=t.padding,a=e.margin,o=t.margin;o||(t.margin=o={top:0,right:0,bottom:0,left:0}),a&&(o.top=r(a.top,o.top),o.right=r(a.right,o.right),o.bottom=r(a.bottom,o.bottom),o.left=r(a.left,o.left)),n||(t.padding=n={top:0,right:0,bottom:0,left:0}),i&&(n.top=r(i.top,n.top),n.right=r(i.right,n.right),n.bottom=r(i.bottom,n.bottom),n.left=r(i.left,n.left)),t.outerWidth=r(e.outerWidth,t.outerWidth)||0,t.outerHeight=r(e.outerHeight,t.outerHeight)||0,t.top=o.top,t.bottom=t.outerHeight-o.bottom,t.left=o.left,t.right=t.outerWidth-o.right,t.center=(t.left+t.right)/2,t.middle=(t.top+t.bottom)/2,t.width=t.right-t.left,t.height=t.bottom-t.top,t.innerTop=t.top+n.top,t.innerBottom=t.bottom-n.bottom,t.innerLeft=t.left+n.left,t.innerRight=t.right-n.right,t.innerWidth=t.innerRight-t.innerLeft,t.innerHeight=t.innerBottom-t.innerTop,t.ratio=t.outerWidth+" x "+t.outerHeight}function i(t){e(this,t||{})}function r(t,e){return void 0!==t?parseInt(t):e}return t(i.prototype),i.prototype.targetSvg=function(t){this.$element=jQuery(t),this.resize()},i.prototype.resize=function(){var t=this.$element;t.attr("width",null).attr("height",null),t[0].style.cssText=null,e(this,{outerWidth:t.outerWidth(!0),outerHeight:t.outerHeight(!0),margin:{top:t.css("margin-top"),right:t.css("margin-right"),bottom:t.css("margin-bottom"),left:t.css("margin-left")},padding:{top:t.css("padding-top"),right:t.css("padding-right"),bottom:t.css("padding-bottom"),left:t.css("padding-left")}}),t.css("margin","0").css("padding","0").attr("width",this.outerWidth).attr("height",this.outerHeight).css({width:this.outerWidth+"px",height:this.outerHeight+"px"}),this.innerWidth&&this.innerHeight&&this.$trigger("resize")},i}]),angular.module("vgraph").factory("ComponentChart",["$timeout","ComponentView","ComponentPage","ComponentBox","DataCollection","makeEventing","Scheduler","Hitbox","DomHelper",function(t,e,i,r,n,a,o,s,c){"use strict";function l(){var t=this;this.$vguid=++g,this.box=new r,this.views={},this.models=[],this.waiting={},this.references={},this.components=[],this.pristine=!1,this.loading=!0,this.message=null,this.$on("focus",function(e){e?t.highlightOn(e):t.highlightOff()})}function h(t){var e,i;t.forEach(function(t){var r=t.viewport;(void 0===e||e>r.minValue)&&(e=r.minValue),(void 0===i||i<r.maxValue)&&(i=r.maxValue)}),t.forEach(function(t){t.setViewportValues(e,i)})}function u(t){var e,i;t.forEach(function(t){var r=t.viewport;(void 0===e||e>r.minInterval)&&(e=r.minInterval),(void 0===i||i<r.maxInterval)&&(i=r.maxInterval)}),t.forEach(function(t){t.setViewportIntervals(e,i)})}function f(t){for(var e=0,i=[];t>e;)i.push([]),e++;return i}function p(t){var e,i;for(e=0,i=t.length;i>e;e++)t[e].push(null)}var d=new o,g=1;a(l.prototype),l.defaultView="default",l.prototype.configure=function(t,i){var r,n=this.addView.bind(this);i||(i={}),this.settings||(this.settings={}),this.settings.fitToPane=i.fitToPane,this.settings.adjustSettings=i.adjustSettings,this.page=t,this.normalizeY=i.normalizeY,this.normalizeX=i.normalizeX,this.settings.x=e.parseSettingsX(i.x,this.settings.x),this.settings.y=e.parseSettingsY(i.y,this.settings.y),i.x?this.settings.x.scale=i.x.scale:this.settings.x.scale=null,i.y?this.settings.y.scale=i.y.scale:this.settings.y.scale=null,r=i.views,r?angular.isFunction(r)&&(r=r()):(r={},r[l.defaultView]={}),angular.forEach(r,n)};var m=0;return l.prototype.getReference=function(t){var e,i;return i=angular.isString(t)?t:t.name,e=this.references[i],e||(e={$uid:m++,name:i,className:t.className?t.className:"node-"+i},this.references[i]=e),e},l.prototype.compileReference=function(t){var e;if("object"!=typeof t)return null;if(e=this.getReference(t),t.field?e.field=t.field:e.field=e.name,e._field=e.field,e.$reset=function(){e.field=e._field},void 0===t.getValue?e.getValue=function(t){return t?t[e.field]:void 0}:e.getValue=t.getValue,void 0===t.view?t.view=l.defaultView:t.view&&(t.view=t.view),t.view)e.view=t.view,e.$view=this.getView(t.view),e.$getNode=function(t){return this.$view.normalizer.$getNode(t)},e.$getValue=function(t){var e=this.$view.normalizer.$getNode(t);return e?this.getValue(e):void 0},e.$eachNode=function(t){this.$view.normalizer.$sort().forEach(t)},e.$getIndexs=function(){return this.$view.normalizer.$getIndexs()};else if(t.$getValue)e.$getValue=t.$getValue;else if(!e.$getValue)throw new Error("drawer reference requires view or $getValue");return t.isValid&&(e.isValid=t.isValid),t.classExtend&&(e.classExtend=t.classExtend),t.normalizerMap&&(e.normalizerMap=t.normalizerMap),t.requirements&&(e.requirements=t.requirements),t.normalizerFinalize&&(e.normalizerFinalize=t.normalizerFinalize),t.classify&&(e.classify=t.classify),t.mergeParsed&&(e.mergeParsed=t.mergeParsed),e},l.prototype.render=function(){var t,e=this,i=[],r=!1,n=0;try{angular.forEach(this.views,function(e,i){t=i,e.parse()}),angular.forEach(this.views,function(e,n){t=n,e.hasData()?(i.push(e),r=!0):e.isReady()&&(r=!0)}),this.normalizeY&&h(i),this.normalizeX&&u(i)}catch(a){console.log("---parsing error---","view:"+t),console.log(a),console.log(a.stack)}n=i.length,this.loading=!r,d.startScript(this.$vguid),this.configureHitbox(),this.loading?(e.$trigger("loading"),d.func(function(){e.loading=!0,e.pristine=!1})):n?(d.func(function(){e.message=null}),d.loop(this.components,function(t){t.build&&t.build()}),d.loop(i,function(t){t.build()}),d.loop(this.components,function(t){t.process&&t.process()}),d.loop(i,function(t){t.process()}),d.loop(this.components,function(t){t.finalize&&t.finalize()}),d.loop(i,function(t){t.finalize()}),d.func(function(){e.loading=!1,e.pristine=!0})):(e.$trigger("error"),d.func(function(){e.message="No Data Available",e.pristine=!1})),d.endScript(function(){e.$trigger("done")},function(){e.$trigger("success",i[0])},function(){e.pristine=!1,e.message="Unable to Render",e.$trigger("error")}),d.run()},l.prototype.scheduleRender=function(e){var i=this;this.nrTimeout||(this.nrTimeout=t(function(){i.render(i.waiting,e),i.waiting={},i.nrTimeout=null},30))},l.prototype.rerender=function(t){this.scheduleRender(t),this.waiting=this.views},l.prototype.needsRender=function(t,e){this.scheduleRender(e),this.waiting[t.name]||(this.waiting[t.name]=t)},l.prototype.getView=function(t){var i=this.views[t];return i||(i=new e,this.views[t]=i),i},l.prototype.addView=function(t,e){var i=this,r=this.settings,n=this.getView(e);n.configure(t,r,this.box,this.page),n.manager.register(function(){i.needsRender(n)}),n.manager.onError(function(t){i.error(t)})},l.prototype.error=function(t){t?(this.loading=!1,this.message=t):this.message=null,this.$trigger("error")},l.prototype.setPane=function(t,e){var i=this.views,r=Object.keys(this.views);this.settings.x.minPane=t,this.settings.x.maxPane=e,r.forEach(function(r){i[r].pane.setPane({start:t,stop:e})})},l.prototype.registerComponent=function(t){this.components.push(t)},l.prototype.configureHitbox=function(){var t=this.box;this.hitbox=new s(t.left,t.right,t.top,t.bottom,10)},l.prototype.registerElement=function(t,e){t.$element=e,this.hitbox.add(t)},l.prototype.highlightElements=function(t,e){var i=this.hitbox.checkX(t),r=this.hitbox.checkY(e),n=this.hitbox.checkHit(t,e);this.unlightElements(),c.addClass(i,"highlight-vertical"),c.addClass(r,"highlight-horizontal"),c.addClass(n,"highlight"),this._activeElements={vertical:i,horizontal:r,intersections:n}},l.prototype.unlightElements=function(){var t=this._activeElements;t&&(c.removeClass(t.vertical,"highlight-vertical"),c.removeClass(t.horizontal,"highlight-horizontal"),c.removeClass(t.intersections,"highlight"))},l.prototype.highlightOn=function(t){var e=0,i=0,r={};angular.forEach(this.views,function(n,a){var o;r[a]=n.getPoint(t.x),o=r[a].$x,void 0!==o&&(i++,e+=o)}),r.$pos=e/i,r.pos=t,this.$trigger("focus-point",r),this.$trigger("highlight",r),this.highlightElements(t.x,t.y)},l.prototype.highlightOff=function(){this.$trigger("highlight",null),this.unlightElements()},l.prototype["export"]=function(t){var e,i,r,n=t.map(function(t){return t.title}),a=this.getReference.bind(this);return t.forEach(function(t){var i;t.$link=a(t.reference),t.$view=t.$link.$view,i=t.$view.getBounds(),t.$bounds=i,e?(e<i.max-i.min&&(e=i.max-i.min),r>i.interval&&(r=i.interval)):(e=i.max-i.min,r=i.interval)}),i=f(Math.ceil(e/r)),t.forEach(function(t){var r,n,a,o=t.$bounds.min,s=o+e,c=t.$bounds.interval;for(a=i[0].length,p(i),r=o;s>=r;r+=c)n=t.$view.manager.data.$getNode(r),n&&(n=n[t.field?t.field:t.reference],t.format&&(n=t.format(n)),i[Math.floor((r-o)/(s-o)*e+.5)][a]=n)}),i.unshift(n),i},l}]),angular.module("vgraph").factory("ComponentElement",["StatCalculations",function(t){"use strict";function e(t){return(new DOMParser).parseFromString('<g xmlns="http://www.w3.org/2000/svg">'+t+"</g>","image/svg+xml").childNodes[0].childNodes}function i(t,e,i){var r,n=t.element;for(n.innerHTML="",r=i.length-1;-1!==r;r--)t.register(e[r],i[r]),n.appendChild(i[r])}function r(){this.children=null}return r.svgCompile=e,r.prototype.setElement=function(t){this.element=t},r.prototype.setDrawer=function(t){var e=[],i=t.getReferences();this.drawer=t,i.forEach(function(t){t&&e.push(t)}),this.references=e},r.prototype.parse=function(){return t.limits(this.references)},r.prototype.build=function(){var r=this.drawer,n=t.indexs(this.references),a=r.makeSets(n);"g"===this.element.tagName?i(this,a,e(this.make(a,r.makeElement.bind(r)).join(""))):this.element.setAttribute("d",this.make(a,r.makePath.bind(r)).join(""))},r.prototype.register=function(){},r.prototype.make=function(t,e){var i,r,n,a=[];for(i=0,r=t.length;r>i;i++)n=e(t[i]),n&&a.push(n);return a},r}]),angular.module("vgraph").factory("ComponentPage",["DataFeed","DataLoader","DataManager",function(t,e,i){"use strict";function r(){this.$$pageUid=n++,this.feeds={},this.charts={},this.managers={},this.connections={}}var n=1;return r.defaultManager="default",r.prototype.configure=function(t){var e,i,r,n;if(angular.isArray(t))for(e=0,i=t.length;i>e;e++)this.addFeed(t[e]);else{for(n=Object.keys(t.managers),e=0,i=n.length;i>e;e++)r=n[e],this.getManager(r).$fillPoints(t.managers[r]);for(e=0,i=t.feeds.length;i>e;e++)this.addFeed(t.feeds[e])}},r.prototype.addFeed=function(i){var n,a,o,s,c=i.src||[];return i.manager||(i.manager=r.defaultManager),s=i.manager,c._$feedUid?n=this.feeds[c._$feedUid]:(n=new t(c,i.explode),this.feeds[n.$$feedUid]=n,c._$feedUid=n.$$feedUid),o=this.getManager(s),this.connections[n.$$feedUid]||(this.connections[n.$$feedUid]={}),a=this.connections[n.$$feedUid][o.$$managerUid],a||(a=new e(n,o),this.connections[n.$$feedUid][o.$$managerUid]=a),a.addConfig(i),c},r.prototype.getManager=function(t){var e=t||r.defaultManager,n=this.managers[e];return n||(n=new i,this.managers[e]=n),n},r.prototype.setChart=function(t,e){this.charts[t]=e},r.prototype.getChart=function(t){return this.charts[t]},r}]),angular.module("vgraph").factory("ComponentPane",[function(){"use strict";function t(t,e,i){this.x=e,this.y=i,this.fitToPane=t||!1,this._pane={},this._bounds={},e||(e={}),i||(i={}),this.setBounds({min:e.min,max:e.max},{min:i.min,max:i.max})}return t.prototype.setBounds=function(t,e){return this._bounds.x=t,this._bounds.y=e,this},t.prototype.setPane=function(t,e){return this._pane.x=t,this._pane.y=e,this},t.prototype.filter=function(t,e){var i,r,n,a,o,s,c=this.x,l=t.data;return l.length&&(t.clean(),i=this._bounds.x.min||l.$minIndex,r=this._bounds.x.max||l.$maxIndex,c.$min=i,c.$max=r,this._pane.x&&this._pane.x.stop?(n=this._pane.x,o=i+n.start*(r-i),s=i+n.stop*(r-i)):(o=i,s=r),e.$left=o,e.left=(o-i)/(r-i),e.$right=s,e.right=(s-i)/(r-i),a=l.$slice(o,s),this.fitToPane&&l.length>1&&(o>l.$minIndex&&a.$addNode(o,t.$makePoint(o),!0),s<l.$maxIndex&&a.$addNode(t.$makePoint(s))),a.$sort()),a},t}]),angular.module("vgraph").factory("ComponentView",["ComponentPane","ComponentPage","DataNormalizer",function(t,e,i){"use strict";function r(){this.$vgvid=o++,this.components=[],this.references=[]}function n(t,e){return e||(e={}),void 0!==t.min&&(e.min=t.min),void 0!==t.max&&(e.max=t.max),t.scale?e.scale=t.scale():e.scale||(e.scale=d3.scale.linear()),t.format?e.format=t.format:e.scale||(e.format=function(t){return t}),t.padding&&(e.padding=t.padding),t.tick&&(e.tick=t.tick),e}function a(t,e){t.normalizerMap&&e.addPropertyMap(t.normalizerMap),t.requirements?t.requirements.forEach(function(t){e.addPropertyCopy(t)}):null!==t.requirements&&e.addPropertyCopy(t.field),t.normalizerFinalize&&e.addPropertyFinalize(t.normalizerFinalize)}var o=1;return r.parseSettingsX=function(t,e){return t||(t={}),e=n(t,e),void 0!==t.minPane&&(e.minPane=t.minPane),void 0!==t.maxPane&&(e.maxPane=t.maxPane),void 0!==t.interval&&(e.interval=t.interval),e},r.parseSettingsY=function(t,e){return t||(t={}),n(t,e)},r.prototype.getBounds=function(){var t,e,i,r,n,a,o=this.manager.data;if(o.$sort(),this.x.interval)a=this.x.interval;else for(n=o[1]._$index,a=n-o[0]._$index,t=2,e=o.length;e>t;t++)i=o[t]._$index,r=i-n,a>r&&(a=r),n=i;return{min:void 0!==this.x.min?this.x.min:o[0]._$index,max:void 0!==this.x.max?this.x.max:o[o.length-1]._$index,interval:a}},r.prototype.configure=function(n,o,s,c){var l,h=this.references,u=Object.keys(this.references);this.x=r.parseSettingsX(o.x,this.x),r.parseSettingsX(n.x,this.x),this.y=r.parseSettingsY(o.y,this.y),r.parseSettingsY(n.y,this.y),this.box=s,this.manager=c.getManager(n.manager||e.defaultManager),this.normalizer=l=n.normalizer||new i(function(t){return Math.round(t)}),u.forEach(function(t){a(h[t],l)}),this.adjustSettings=o.adjustSettings,this.pane=new t(o.fitToPane,this.x,this.y),this.x.max&&this.pane.setBounds({min:this.x.min,max:this.x.max}),this.x.maxPane&&this.pane.setPane({min:this.x.minPane,max:this.x.maxPane})},r.prototype.registerComponent=function(t){var e=this.normalizer,i=this.references;this.components.push(t),t.references&&t.references.forEach(function(t){i[t.name]||(i[t.name]=t,e&&a(t,e))})},r.prototype.isReady=function(){return this.manager&&this.manager.ready},r.prototype.hasData=function(){return this.isReady()&&this.manager.data.length},r.prototype._sample=function(){this.offset={},this.filtered=this.pane.filter(this.manager,this.offset)},r.prototype.isLeading=function(){return this.viewport&&this.viewport.maxInterval>this.filtered.$maxIndex},r.prototype.getLeading=function(){return this.normalizer[this.normalizer.length-1]},r.prototype.setViewportValues=function(t,e){var i,r=this.box;this.y.padding&&(i=e===t?t*this.y.padding:(e-t)*this.y.padding,e+=i,t-=i),this.viewport.minValue=t,this.viewport.maxValue=e,this.y.scale.domain([t,e]).range([r.innerBottom,r.innerTop])},r.prototype.setViewportIntervals=function(t,e){var i=this.box,r=this.x.scale;this.viewport.minInterval=t,this.viewport.maxInterval=e,r.domain([t,e]).range([i.innerLeft,i.innerRight])},r.prototype.parse=function(){var t,e,i=this.manager.data,r=this.x.scale;this._sample(),this.filtered&&(this.viewport||(this.viewport={}),this.setViewportIntervals(this.offset.$left,this.offset.$right),this.normalizer.$reindex(this.filtered,r),this.components.forEach(function(i){var r;i.parse&&(r=i.parse(),r&&(null!==r.min&&(!t&&0!==t||t>r.min)&&(t=r.min),null!==r.max&&(!e&&0!==e||e<r.max)&&(e=r.max)))}),void 0!==t&&(this.setViewportValues(t,e),this.adjustSettings&&this.adjustSettings(this.x,this.filtered.$maxIndex-this.filtered.$minIndex,e-t,i.$maxIndex-i.$minIndex)))},r.prototype.build=function(){this.components.forEach(function(t){t.build&&t.build()})},r.prototype.process=function(){this.components.forEach(function(t){t.process&&t.process()})},r.prototype.finalize=function(){this.components.forEach(function(t){t.finalize&&t.finalize()})},r.prototype.getPoint=function(t){return this.normalizer.$getClosest(t,"$x")},r}]),angular.module("vgraph").factory("DataCollection",[function(){"use strict";function t(t,e,i,r){var n,a,o=0,s=t.length-1;if(r||t.sort(function(t,e){return i(t)-i(e)}),i(t[o])>=e)return{left:o,right:o};if(i(t[s])<=e)return{left:s,right:s};if(t.length){for(;s-o>1;)n=Math.floor((s+o)/2),a=i(t[n]),a===e?(s=n,o=n):a>e?s=n:o=n;return s!==n&&i(t[s])===e?{left:s,right:s}:o!==n&&i(t[o])===e?{left:o,right:o}:{left:o,right:s}}}function e(t){return null!==t&&void 0!==t&&"object"!=typeof t}function i(){this._$index={},this.$dirty=!1}function r(t){return t||0===t}return i.prototype=[],i.isNumeric=e,i.isValid=r,i.prototype.addPropertyCopy=function(t){var e,i;this._copyProperties?(e=this._copyProperties,this._copyProperties=function(i,r){r[t]=i[t],e(i,r)},i=this._hasValue,this._hasValue=function(e){return r(e[t])?!0:i(e)}):(this._copyProperties=function(e,i){i[t]=e[t]},this._hasValue=function(e){return r(e[t])})},i.prototype.addPropertyMap=function(t){var e;this._mapProperties?(e=this._mapProperties,this._mapProperties=function(i,r){e(i,r),t(i,r)}):this._mapProperties=t},i.prototype._register=function(t,e,i){var r=+t;return this._$index[r]||(this._$index[r]=e,i?(this.length&&r>this[0]._$index&&(this.$dirty=!0),this.unshift(e)):(this.length&&r<this[this.length-1]._$index&&(this.$dirty=!0),this.push(e)),(!this._hasValue||this._hasValue(e))&&(void 0===this.$minIndex?(this.$minIndex=r,this.$maxIndex=r):this.$maxIndex<r?this.$maxIndex=r:this.$minIndex>r&&(this.$minIndex=r)),e._$index=r),e},i.prototype._makeNode=function(t){var e=+t,i=this.$getNode(t);if(isNaN(e))throw new Error("index must be a number, not: "+t+" that becomes "+e);return i||(i={},this._register(e,i)),i},i.prototype.$getIndexs=function(){return Object.keys(this._$index)},i.prototype.$getNode=function(t){return this._$index[+t]},i.prototype._setValue=function(t,e,i){var n=t._$index;t.$setValue?t.$setValue(e,i):t[e]=i,r(i)&&(void 0===this.$minIndex?(this.$minIndex=n,this.$maxIndex=n):this.$maxIndex<n?this.$maxIndex=n:this.$minIndex>n&&(this.$minIndex=n))},i.prototype.$setValue=function(t,e,i){var r=this._makeNode(t);return this._setValue(r,e,i),r},i.prototype.$addNode=function(t,e,i){var r,n=+t;return r=this.$getNode(n),r?(r.$merge&&r.$merge(e),this._mapProperties&&this._mapProperties(e,r,n),this._copyProperties&&this._copyProperties(e,r,n)):(r=this.$makeNode?this.$makeNode(e):{},this._mapProperties&&this._mapProperties(e,r,n),this._copyProperties&&this._copyProperties(e,r,n),this._register(n,r,i)),r},i.prototype.$pos=function(e,i){var r;return i||(i="_$index"),this.$sort(),r=t(this,e,function(t){return t[i]},!0),r.field=i,r},i.prototype.$getClosestPair=function(t,e){var i=this.$pos(t,e);return{left:this[i.left],right:this[i.right],field:i.field}},i.prototype.$getClosest=function(t,e){var i,r,n=this.$getClosestPair(t,e);return i=t-n.left[n.field],r=n.right[n.field]-t,r>i?n.left:n.right},i.prototype.$sort=function(){return this.$dirty&&(this.sort(function(t,e){return t._$index-e._$index}),this.$dirty=!1),this},i.prototype.$slice=function(t,e){var r,n=-1,a=new i;this.$sort();do n++,r=this[n];while(r&&r._$index<t);for(;r&&r._$index<=e;)a.push(r),a._$index[r._$index]=r,n++,r=this[n];return a.$minIndex=a[0]._$index,a.$maxIndex=a[a.length-1]._$index,a.$dirty=!1,a.$parent=this,a},i}]),angular.module("vgraph").factory("DataFeed",["makeEventing",function(t){"use strict";function e(t,e){this.explode=e,this.setSource(t),this.$$feedUid=i++}var i=1;return e.prototype.setSource=function(t){var e=this,i=t.push;this.data=t,this._readPos=0,t.push=function(){i.apply(this,arguments),e.$push()},t.$ready=function(){e.$trigger("ready")},t.$error=function(t){e.$trigger("error",t)},t.$reset=function(){e.$trigger("reset"),e._readPos=0,e.data.length=0},this.$push()},t(e.prototype),e.prototype.$push=function(){var t=this;this._$push||(this._$push=setTimeout(function(){var e=t._readNext();for(e&&t.$trigger("ready");e;)t.$trigger("data",e),e=t._readNext();t._$push=null},0))},e.prototype._readAll=function(t){for(var e=this._read(0);e;)t(e),e=this._read(e.next)},e.prototype._readNext=function(){var t=this._read(this._readPos);return t&&(this._readPos=t.next),t},e.prototype._read=function(t){var e,i=this.data,r=this.explode;return!i.length||t>=i.length?null:r?(e=i[t],{points:r(e),next:t+1,ref:e}):{points:i.slice(t),next:i.length}},e}]),angular.module("vgraph").factory("DataLoader",[function(){"use strict";function t(t,i){var r=this,n=[],a=this._process.bind(this),o=t.$on("ready",function(){r.ready=!0}),s=t.$on("data",function(t){var e,i,r,o;for(e=0,i=t.points.length;i>e;e++)for(r=0,o=n.length;o>r;r++)a(n[r],t.points[e])}),c=t.$on("error",function(t){i.setError(t)}),l=t.$on("reset",function(){i.reset(),r.ready=!1});this.$$loaderUid=e++,this.feed=t,this.confs=n,this.dataManager=i,i.$follow(this),this.$destroy=function(){i.$ignore(this),c(),l(),o(),s()}}var e=1;return t.unregister=function(){},t.prototype.addConfig=function(t){var e=Object.keys(t.readings),i=this._process.bind(this);e.forEach(function(e){var i=t.readings[e];"string"==typeof i&&(t.readings[e]=function(t){return t[i]})}),t.parseInterval||(t.parseInterval=function(e){return e[t.interval]}),this.feed._readAll(function(e){var r,n,a=e.points;for(r=0,n=a.length;n>r;r++)i(t,a[r])}),this.confs.push(t)},t.prototype.removeConf=function(){},t.prototype._process=function(t,e){var i,r=this.dataManager,n=Object.keys(t.readings);if(!t.isDefined||t.isDefined(e))try{i=t.parseInterval(e),n.forEach(function(n){r.setValue(i,n,t.readings[n](e))})}catch(a){console.log("failed to load",e,i),console.log("conf:",t),console.log(a)}},t}]),angular.module("vgraph").factory("DataManager",["DataCollection",function(t){"use strict";function e(){this.$$managerUid=r++,this.$dataProc=i(20,200,function(t){var e=t.registrations;e.forEach(function(t){t()})}),this.construct(),this.reset()}function i(t,e,i,r){function n(){var e=+new Date;e>s||e>o?(s=null,i.apply(r,a)):setTimeout(n,t)}var a,o,s;return function(){var i=+new Date;o=i+t,a=arguments,s||(s=i+e,setTimeout(n,t))}}var r=1;return e.prototype.construct=function(){var t=[];this.registrations=[],this.errorRegistrations=[],this.getLoaders=function(){return t},this.$follow=function(e){t.push(e)},this.$ignore=function(e){var i=t.indexOf(e);-1!==i&&t.splice(i,1)}},e.prototype.reset=function(){this.data=new t,this.ready=!1,this.dataReady(!0)},e.prototype.$fillPoints=function(t){var e,i,r=t.prototype;for(this.filling=t,r||(r={}),e=t.start,i=t.stop+t.interval;i>e;e+=t.interval)this.data._register(e,Object.create(r))},e.prototype.setValue=function(t,e,i){return this.filling&&(t<this.filling.min||t>this.filling.max||(t-this.filling.min)%this.filling.interval!==0)?void 0:(this.dataReady(),this.ready||!i&&0!==i||(this.ready=!0),this.data.$setValue(t,e,i))},e.prototype.dataReady=function(t){var e=this.registrations;t?e.forEach(function(t){t()}):this.$dataProc(this)},e.prototype.onError=function(t){this.errorRegistrations.push(t)},e.prototype.setError=function(t){var e,i;for(e=0,i=this.errorRegistrations.length;i>e;e++)this.errorRegistrations[e](t)},e.prototype.getNode=function(t){return this.dataReady(),this.data.$getNode(t)},e.prototype.removePlot=function(){},e.prototype.register=function(t){this.registrations.push(t)},e.prototype.clean=function(){this.data.$sort()},e.prototype.$makePoint=function(t){var e,i,r,n,a=this.data.$pos(t,"_$index");return a.right===a.left?this.data[a.right]:(e=this.data[a.right],i=this.data[a.left],r={},n=(t-i._$index)/(e._$index-i._$index),Object.keys(e).forEach(function(t){var a=i[t],o=e[t];void 0!==a&&null!==a&&void 0!==o&&null!==o&&(r[t]=a+(o-a)*n)}),r.$faux=!0,r._$index=t,r)},e}]),angular.module("vgraph").factory("DataNormalizer",["DataCollection",function(t){"use strict";function e(e){this.$modelUid=i++,this.$grouper=e,t.call(this),this._finalizeProperties=function(t){t.$x=t.$x/t.$count}}var i=1;return e.prototype=new t,e.prototype.addPropertyFinalize=function(t){var e=this._finalizeProperties;this._finalizeProperties=function(i){e(i),t(i)}},e.prototype.$latestNode=function(e){for(var i,r=this.length-1;r;){if(i=this[r],t.isValid(i[e]))return i;r--}},e.prototype.$reindex=function(t,e){var i,r,n,a,o,s,c,l=this.$grouper;for(this.length=0,this._$index={},t.$sort(),i=0,r=t.length;r>i;i++)o=t[i],s=o._$index,c=e(o._$index),a=l(c),n=this.$addNode(a,o),void 0===n.$minIndex?(n.$x=c,n.$minIndex=s,n.$xMin=c,n.$maxIndex=s,n.$xMax=c,n.$count=1):(n.$x+=c,n.$maxIndex=s,n.$xMax=c,n.$count++);for(i=0,r=this.length;r>i;i++)this._finalizeProperties(this[i]);this.$parent=t},e}]),angular.module("vgraph").factory("DrawBar",["DrawBuilder",function(t){"use strict";function e(t,e,i){this.width=i,this.top=t,e?(this.bottom=e,this.references=[t,e]):(this.bottom=t,this.references=[t])}function i(t,e,i,r,n){var a;return t>e&&(a=t,t=e,e=a),i>r&&(a=i,i=r,r=a),void 0===n.x1?(n.x1=t,n.x2=e,n.y1=i,n.y2=r):(n.x1>t&&(n.x1=t),e>n.x2&&(n.x2=e),n.y1>i&&(n.y1=i),r>n.y2&&(n.y2=r)),n}var r=t.isNumeric;return e.prototype=new t,e.prototype.makeSet=function(){return{}},e.prototype.isValidSet=function(t){return void 0!==t.x1},e.prototype.parse=function(t){var e,i,n,a,o,s,c=this.top.$getNode(t);return n=this.top.getValue(c),a=this.bottom!==this.top?this.bottom.$getValue(t):this.bottom.$view.viewport.minValue,s=this.width?parseInt(this.width,10)/2:3,r(n)&&r(a)&&n!==a&&(e=c.$x-s,i=c.$x+s,o={$classify:this.top.classify?this.top.classify(c,this.bottom.$getNode(t)):null,x1:e<c.$xMin?e:c.$xMin,x2:i>c.$xMax?c.$xMax:i,y1:n,y2:a}),o},e.prototype.mergeParsed=function(t,e){var r=t.x1,n=t.x2,a=t.y1,o=t.y2;return null!==a&&null!==o&&(a=void 0===a?e.y1:this.top.$view.y.scale(a),o=void 0===o?e.y2:this.bottom.$view.y.scale(o),i(r,n,a,o,e)),0},e.prototype.makePath=function(t){return t?"M"+(t.x1+","+t.y1)+"L"+(t.x2+","+t.y1)+"L"+(t.x2+","+t.y2)+"L"+(t.x1+","+t.y2)+"Z":void 0},e.prototype.makeElement=function(t){var e="";return t?(t.$classify&&(e=Object.keys(t.$classify).join(" ")),'<rect class="'+e+'" x="'+t.x1+'" y="'+t.y1+'" width="'+(t.x2-t.x1)+'" height="'+(t.y2-t.y1)+'"/>'):void 0},e}]),angular.module("vgraph").factory("DrawBox",["DrawBar",function(t){"use strict";function e(t){this.top=t,this.bottom=t,this.references=[t]}return e.prototype=new t,e.prototype.parse=function(t){var e,i,r=this.top.$getNode(t);return this.top.isValid(r)?(this.top.getValue?(i=this.top.getValue(r),e={x1:r.$x,x2:r.$x,y1:i,y2:i}):e={x1:r.$x,x2:r.$x,y1:this.top.$view.viewport.minValue,y2:this.top.$view.viewport.maxValue},e.$classify=this.top.classify?this.top.classify(r):null,e):void 0},e.prototype.mergeParsed=function(e,i){return!e.y1&&0!==e.y1||!e.y2&&0!==e.y2?0:(t.prototype.mergeParsed.call(this,e,i),-1)},e}]),angular.module("vgraph").factory("DrawBuilder",[function(){"use strict";function t(){this.references=[]}return t.isNumeric=function(t){return null===t?!1:Number.isFinite?Number.isFinite(t)&&!Number.isNaN(t):isFinite(t)&&!isNaN(t)},t.prototype.getReferences=function(){return this.references},t.prototype.parse=function(t){return t},t.prototype.makeSet=function(){return[]},t.prototype.mergeParsed=function(t,e){
return t?(e.push(e),!1):!0},t.prototype.isValidSet=function(t){return 0!==t.length},t.prototype.finalizeSet=function(t){return t},t.prototype.makeSets=function(t){function e(){o=s.mergeParsed(a,c),1!==o&&a.$classify&&(c.$classify||(c.$classify={}),Object.keys(a.$classify).forEach(function(t){c.$classify[t]=!0}))}var i,r,n,a,o,s=this,c=this.makeSet(),l=[];for(i=0,r=t.length;r>i;i++)n=t[i],a=this.parse(n),a?e():o=0,o>-1&&(this.isValidSet(c)&&l.push(this.finalizeSet(c)),c=this.makeSet(),o&&e());return this.isValidSet(c)&&l.push(this.finalizeSet(c)),l},t.prototype.makeElement=function(t){return console.log("makeElement",t),"<text>Element not overriden</text>"},t.prototype.makePath=function(t){return console.log("makePath",t),"M0,0Z"},t}]),angular.module("vgraph").factory("DrawDots",["DrawBuilder",function(t){"use strict";function e(t,e){this.ref=t,this.radius=e,this.references=[t]}return e.prototype=new t,e.prototype.makeSet=function(){return{}},e.prototype.parse=function(t){var e=this.ref.$getNode(t),i=this.ref.getValue(e);return i||0===i?{$classify:this.ref.classify?this.ref.classify(e):null,x:e.$x,y:i}:void 0},e.prototype.mergeParsed=function(t,e){return e.x=t.x,e.y=this.ref.$view.y.scale(t.y),0},e.prototype.makePath=function(t){var e=this.radius,i=2*e;return void 0!==t.x?"M"+t.x+" "+t.y+"m -"+e+", 0a "+e+","+e+" 0 1,1 "+i+",0a "+e+","+e+" 0 1,1 -"+i+",0":void 0},e.prototype.makeElement=function(t){var e="";return void 0!==t.x?(t.$classify&&(e=Object.keys(t.$classify).join(" ")),'<circle class="'+e+'" cx="'+t.x+'" cy="'+t.y+'" r="'+this.radius+'"/>'):void 0},e}]),angular.module("vgraph").factory("DrawFill",["DrawBuilder",function(t){"use strict";function e(t,e){this.top=t,e?(this.bottom=e,this.references=[t,e]):(this.bottom=t,this.references=[t])}var i=t.isNumeric;return e.prototype=new t,e.prototype.parse=function(t){var e,r,n=this.top.$getNode(t);return e=this.top.getValue(n),r=2===this.references.length?this.bottom.$getValue(t):this.bottom.$view.viewport.minValue,i(e)&&i(r)?{$classify:this.top.classify?this.top.classify(n,this.bottom.$getNode(t)):null,x:n.$x,y1:e,y2:r}:void 0},e.prototype.mergeParsed=function(e,i){var r=e.x,n=e.y1,a=e.y2,o=i[i.length-1];return t.isNumeric(n)&&t.isNumeric(a)?(i.push({x:r,y1:this.top.$view.y.scale(n),y2:this.bottom.$view.y.scale(a)}),-1):o&&null!==n&&null!==a?(n=void 0===n?o.y1:this.top.$view.y.scale(n),a=void 0===a&&o?o.y2:this.bottom.$view.y.scale(a),i.push({x:r,y1:n,y2:a}),-1):0},e.prototype.makePath=function(t){var e,i,r,n=[],a=[];if(t.length){for(e=0,i=t.length;i>e;e++)r=t[e],n.push(r.x+","+r.y1),a.unshift(r.x+","+r.y2);return"M"+n.join("L")+"L"+a.join("L")+"Z"}},e.prototype.makeElement=function(t){var e="";return t.length?(t.$classify&&(e=Object.keys(t.$classify).join(" ")),'<path class="'+e+'" d="'+this.makePath(t)+'"></path>'):void 0},e}]),angular.module("vgraph").factory("DrawIcon",["DrawBox",function(t){"use strict";function e(t,e,i){this.top=t,this.bottom=t,this.references=[t],this.box=e,this.template=i}return e.prototype=new t,e.prototype.makeElement=function(t){var e,i;return t?(e=(t.x1+t.x2-this.box.width)/2,i=(t.y1+t.y2-this.box.height)/2,'<g transform="translate('+e+","+i+')">'+this.template+"</g>"):void 0},e}]),angular.module("vgraph").factory("DrawLine",["DrawBuilder",function(t){"use strict";function e(t){var e=this.mergeParsed;this.ref=t,this.references=[t],t.mergeParsed&&(this.mergeParsed=function(i,r){return t.mergeParsed.call(this,i,r,e)})}function i(t,e){for(var i,r=e-1,n=t[e];t[r].$faux;)r--;for(i=(n.y-t[r].y)/(r-e),e-=1;e>r;e--)t[e].y=t[e+1].y+i;return r}var r=t.isNumeric;return e.prototype=new t,e.prototype.parse=function(t){var e=this.ref.$getNode(t);return{$classify:this.ref.classify?this.ref.classify(e):null,x:e.$x,y:this.ref.getValue(e)}},e.prototype.mergeParsed=function(t,e){var i=t.x,n=t.y,a=e[e.length-1];return r(n)?(e.push({x:i,y:this.ref.$view.y.scale(n)}),-1):a&&void 0===n?(e.push({$faux:!0,x:i,y:a.y}),-1):0},e.prototype.finalizeSet=function(t){for(var e;t[t.length-1].$faux;)t.pop();for(e=t.length-1;e>-1;e--)t[e].$faux&&(e=i(t,e+1));return t},e.prototype.makePath=function(t){var e,i,r,n=[];if(t.length){for(e=0,i=t.length;i>e;e++)r=t[e],n.push(r.x+","+r.y);return"M"+n.join("L")}},e.prototype.makeElement=function(t){var e="";return t.length?(t.$classify&&(e=Object.keys(t.$classify).join(" ")),'<path class="'+e+'" d="'+this.makePath(t)+'"></path>'):void 0},e}]),angular.module("vgraph").directive("vgraphAxis",[function(){"use strict";function t(t,e){return!(t.bottom<e.top||t.top>e.bottom||t.right<e.left||t.left>e.right)}return{scope:{orient:"=vgraphAxis",adjust:"=axisAdjust",rotation:"=tickRotation"},require:["^vgraphChart"],link:function(e,i,r,n){function a(){V.attr("visibility","hidden")}var o,s,c,l,h,u,f,p,d,g,m,v=n[0],x=v.getView(r.view||"default"),y=d3.svg.axis(),$="axis",w=v.box,b=0,k=null,_=!0,P=!1,C=parseInt(r.tickLength)||0,N=parseInt(r.tickPadding)||3,E=parseInt(r.tickMargin)||0,V=d3.select(i[0]);switch(V.attr("visibility","hidden"),u=V.append("g").attr("class","ticks"),g=V.append("g").attr("class","padding"),f=g.append("g").attr("class","tick-marks"),p=g.append("rect").attr("class","tick-margin"),m=V.append("g").attr("class","label-wrap"),r.tickRotation&&(k=parseInt(r.tickRotation,10)%360),r.labelOffset&&(b=e.$eval(r.labelOffset)),r.labelClean&&(_=e.$eval(r.labelClean)),r.labelEndpoints&&(P=e.$eval(r.labelEndpoints)),r.axisLabel&&(d=m.append("text").attr("class","axis-label label"),e.$parent.$watch(r.axisLabel,function(t){d.text(t)})),o=function(){r.tickMarks?(y.tickValues(e.$eval(r.tickMarks)),c=[]):r.tickCount?(y.ticks(e.$eval(r.tickCount)),c=[]):(y.ticks(10),c=[])},e.orient){case"top":s=function(){var t;if(V.attr("class",$+" x top").attr("transform","translate("+w.left+","+(w.top-C)+")").attr("width",w.width).attr("height",w.padding.top),d&&d.attr("text-anchor","middle").attr("x",w.width/2).attr("y",w.padding.top-b),E&&p.attr("height",E).attr("width",w.innerWidth).attr("x",0).attr("y",-E),f.attr("transform","translate(-"+w.margin.left+",0)"),c&&(y.orient("top").tickFormat(x.x.format).innerTickSize(-(w.innerHeight+C+E)).outerTickSize(0).tickPadding(N+C+E).scale(x.x.scale),x.x.tick&&y.ticks(x.x.tick.interval,x.x.tick.step),u.attr("transform","translate(-"+w.margin.left+","+w.padding.top+")").call(y),t=V.selectAll("g.axis-cap").data(x.x.scale.domain()),P&&(t.enter().append("g").attr("class",function(t,e){return"axis-cap "+(e?"axis-max":"axis-min")}).append("text"),t.exit().remove(),t.attr("transform",function(t){return"translate("+(x.x.scale(t)-w.margin.left)+",0)"}).select("text").text(function(t){var e=x.x.format(t);return(""+e).match("NaN")?"":e}).attr("dy","-0.25em").attr("y",w.padding.top).attr("text-anchor","middle")),k)){if(null===u.select(".tick text")[0][0])return;u.selectAll(".tick text").attr("transform","translate(0,"+u.select(".tick text").attr("y")+") rotate("+k+",0,0)").attr("y","0").style("text-anchor",k%360>0?"end":"start"),t.select("text").attr("transform","rotate("+k+",0,0)").style("text-anchor",e.rotation%360>0?"end":"start")}};break;case"bottom":s=function(){var t;if(V.attr("class",$+" x bottom").attr("transform","translate("+w.left+","+w.innerBottom+")").attr("width",w.width).attr("height",w.padding.bottom),d&&d.attr("text-anchor","middle").attr("x",w.width/2).attr("y",w.padding.bottom+b),E&&p.attr("height",E).attr("width",w.innerWidth).attr("x",0).attr("y",0),f.attr("transform","translate(-"+w.margin.left+",0)"),c&&(y.orient("bottom").tickFormat(x.x.format).innerTickSize(w.innerHeight+C+E).outerTickSize(0).tickPadding(N+C+E).scale(x.x.scale),x.x.tick&&y.ticks(x.x.tick.interval,x.x.tick.step),u.attr("transform","translate(-"+w.margin.left+","+-w.innerHeight+")").call(y),t=V.selectAll("g.axis-cap").data(x.x.scale.domain()),P&&(t.enter().append("g").attr("class",function(t,e){return"axis-cap "+(e?"axis-max":"axis-min")}).append("text"),t.exit().remove(),t.attr("transform",function(t){return"translate("+(x.x.scale(t)-w.margin.left)+",0)"}).select("text").text(function(t){var e=x.x.format(t);return(""+e).match("NaN")?"":e}).attr("dy","1em").attr("y",0).attr("text-anchor","middle")),k)){if(null===u.select(".tick text")[0][0])return;u.selectAll(".tick text").attr("transform",function(){return"translate(0,"+d3.select(this).attr("y")+") rotate("+k+",0,0)"}).attr("y","0").style("text-anchor",k%360>0?"start":"end"),t.select("text").attr("transform","rotate("+k+",0,0)").style("text-anchor",e.rotation%360>0?"start":"end")}};break;case"right":s=function(){var t;V.attr("class",$+" y right").attr("transform","translate("+C+","+w.top+")").attr("width",w.padding.right).attr("height",w.height),m.attr("transform","translate("+(w.right-w.padding.right)+","+w.height+") rotate( 90 )"),d&&d.attr("text-anchor","middle").attr("x",-(w.height/2)).attr("y",-b),E&&p.attr("height",w.innerHeight).attr("width",E).attr("x",-E).attr("y",0),f.attr("transform","translate(-"+w.padding.right+","+(-w.top||0)+")"),c&&(y.orient("right").tickFormat(x.y.format).innerTickSize(-(w.innerWidth+C+E)).outerTickSize(0).tickPadding(N+C+E).scale(x.y.scale),x.y.tick&&y.ticks(x.y.tick.interval,x.y.tick.step),u.attr("transform","translate("+w.innerRight+","+(-w.top||0)+")"),u.call(y),u.select(".domain").attr("transform","translate("+(C+E)+",0)"),P&&(t=V.selectAll("g.axis-cap").data(x.y.scale.domain()),t.enter().append("g").attr("class",function(t,e){return"axis-cap "+(e?"axis-max":"axis-min")}).append("text"),t.exit().remove(),t.attr("transform",function(t){return"translate(0,"+(x.y.scale(t)-w.margin.top)+")"}).select("text").text(function(t){var e=x.y.format(t);return(""+e).match("NaN")?"":e}).attr("dy",".25em").attr("x",w.padding.left-y.tickPadding()).attr("text-anchor","end")))};break;case"left":s=function(){var t;V.attr("class",$+" y left").attr("transform","translate("+w.left+","+w.top+")").attr("width",w.padding.left).attr("height",w.height),m.attr("transform","translate("+w.padding.left+","+w.height+") rotate( -90 )"),d&&d.attr("text-anchor","middle").attr("x",w.height/2).attr("y",-b),E&&p.attr("height",w.innerHeight).attr("width",E).attr("x",-E).attr("y",0),f.attr("transform","translate("+w.padding.left+","+(-w.top||0)+")"),c&&(y.orient("left").tickFormat(x.y.format).innerTickSize(-(w.innerWidth+C+E)).outerTickSize(0).tickPadding(N+C+E).scale(x.y.scale),x.y.tick&&y.ticks(x.y.tick.interval,x.y.tick.step),u.attr("transform","translate("+(w.padding.left-C-E)+","+(-w.top||0)+")").call(y),u.select(".domain").attr("transform","translate("+(C+E)+",0)"),P&&(t=V.selectAll("g.axis-cap").data(x.y.scale.domain()),t.enter().append("g").attr("class",function(t,e){return"axis-cap "+(e?"axis-max":"axis-min")}).append("text"),t.exit().remove(),t.attr("transform",function(t){return"translate(0,"+(x.y.scale(t)-w.margin.top)+")"}).select("text").text(function(t){var e=x.y.format(t);return(""+e).match("NaN")?"":e}).attr("dy",".25em").attr("x",w.padding.left-y.tickPadding()).attr("text-anchor","end")))}}e.$on("$destroy",v.$subscribe({error:a,loading:a})),v.registerComponent({build:function(){void 0===c&&o(),s()},process:function(){c.length=0,C&&(u.selectAll(".tick text").each(function(t){c.push({el:this,val:t,position:this.getBoundingClientRect()})}),c.sort(function(t,e){var i=t.position.top-e.position.top;return i?i:t.position.left-e.position.left})),_&&(l=V.select(".axis-min text").node(),l&&(l=l.getBoundingClientRect()),h=V.select(".axis-max text").node(),h&&(h=h.getBoundingClientRect()))},finalize:function(){var e,i,r,n,a,o,s=x.filtered,u={};if(!s.length)return void V.attr("visibility","hidden");for(V.attr("visibility",""),f.selectAll("line").remove(),n=0,a=c.length;a>n;n++)e=!0,i=c[n],r=i.position,_&&l&&(t(r,l)||t(r,h))?(i.el.setAttribute("class","collided"),e=!1):void 0===u.left?(u.left=r.left,u.right=r.right,u.width=r.width,u.top=r.top,u.bottom=r.bottom,u.height=r.height,i.el.setAttribute("class","")):_&&t(r,u)?(i.el.setAttribute("class","collided"),e=!1):(o=!1,r.left<u.left&&(u.left=r.left,o=!0),r.right>u.right&&(u.right=r.right,o=!0),o&&(u.width=u.right-u.left,o=!1),r.top<u.top&&(u.top=r.top,o=!0),r.bottom>u.bottom&&(u.bottom=r.bottom,o=!0),o&&(u.height=u.bottom-u.top),i.el.setAttribute("class",""))}},"axis-"+e.orient)}}}]),angular.module("vgraph").directive("vgraphBar",["DrawBar","ComponentElement",function(t,e){"use strict";return{scope:{config:"=vgraphBar",pair:"=?pair"},require:["^vgraphChart","vgraphBar"],controller:e,link:function(e,i,r,n){var a=i[0],o=n[0],s=o.compileReference(e.config),c=o.compileReference(e.pair),l=n[1],h="bar ";l.setElement(a),l.setDrawer(new t(s,c,r.width)),l.register=function(t,e){o.registerElement(t,e)},s.classExtend&&(h+=s.classExtend+" "),h+=r.className||s.className,a.setAttribute("class",h),s.$view.registerComponent(l)}}}]),angular.module("vgraph").directive("vgraphBox",["DrawBox","ComponentElement",function(t,e){"use strict";return{scope:{config:"=vgraphBox"},require:["^vgraphChart","vgraphBox"],controller:e,link:function(e,i,r,n){var a=i[0],o=n[0],s=o.compileReference(e.config),c=n[1],l="box ";c.setElement(a),c.setDrawer(new t(s)),c.register=function(t,e){o.registerElement(t,e)},s.classExtend&&(l+=s.classExtend+" "),l+=r.className||s.className,a.setAttribute("class",l),s.$view.registerComponent(c)}}}]),angular.module("vgraph").directive("vgraphChart",["ComponentChart",function(t){"use strict";function e(t){t.$mat&&t.innerWidth&&(t.$mat.attr("class","mat").attr("width",t.innerWidth).attr("height",t.innerHeight).attr("transform","translate("+t.innerLeft+","+t.innerTop+")"),t.$frame.attr("class","frame").attr("width",t.width).attr("height",t.height).attr("transform","translate("+t.left+","+t.top+")"))}return{scope:{settings:"=vgraphChart","interface":"=?interface"},controller:t,require:["vgraphChart","^vgraphPage"],link:function(t,i,r,n){var a,o=n[1],s=n[0],c=s.box;a="svg"===i[0].tagName?i[0]:i.find("svg")[0],s.$root=i[0],c.$on("resize",function(){e(c),s.rerender(function(){t.$apply()})}),c.targetSvg(a),c.$mat=d3.select(a).insert("rect",":first-child"),c.$frame=d3.select(a).insert("rect",":first-child"),e(c),t.$watch("settings",function(t){s.configure(o,t)}),t["interface"]&&(t["interface"].resize=c.resize.bind(c),t["interface"].error=s.error.bind(s)),r.name&&o.setChart(r.name,s)},restrict:"A"}}]),angular.module("vgraph").directive("vgraphCompare",["$compile","ComponentElement",function(t,e){"use strict";return{scope:{config1:"=config1",config2:"=config2"},require:["^vgraphChart"],link:function(i,r,n,a){var o,s=a[0],c=s.getReference(i.config1),l=s.getReference(i.config2),h=e.svgCompile('<g><path vgraph-line="config1" pair="config2" class-name="'+(n.className||"")+'"></path></g>')[0];r[0].appendChild(h),t(h)(i),o=s.$on("focus-point",function(t){var e=t[c.view],i=t[l.view],r=c.$view,a=l.$view,o=c.getValue(e),s=l.getValue(i);t[n.reference||"compare"]={value:Math.abs(o-s),y:(r.y.scale(o)+a.y.scale(s))/2,x:(e.$x+i.$x)/2}}),i.$on("$destroy",o)}}}]),angular.module("vgraph").directive("vgraphDots",["DrawDots","ComponentElement",function(t,e){"use strict";return{scope:{config:"=vgraphDots"},require:["^vgraphChart","vgraphDots"],controller:e,link:function(e,i,r,n){var a,o=i[0],s=n[0],c=s.compileReference(e.config),l=n[1];l.setElement(o),l.setDrawer(new t(c,r.radius?parseInt(r.Radius,10):5)),a="point ",c.classExtend&&(a+=c.classExtend+" "),a+=r.className||c.className,o.setAttribute("class",a),c.$view.registerComponent(l)}}}]),angular.module("vgraph").directive("vgraphExport",[function(){"use strict";function t(t){return t.map(function(t){return'"'+t.join('","')+'"'}).join("\n")}return{require:["^vgraphChart"],scope:{labels:"=?labels",exports:"=vgraphExport",options:"=?options",selected:"=?selected"},template:'<select ng-model="selected" ng-options="opt as (labels[opt] || opt) for opt in options"></select><a ng-click="process( exports[selected] )"><span>Export</span></a>',link:function(e,i,r,n){e.options||(e.options=Object.keys(e.exports)),e.selected||(e.selected=e.options[0]),e.process=function(e){var i=e(n[0]),r=new Blob([t(i.data)],{type:"text/csv;charset="+(i.charset||"utf-8")+";"}),a=angular.element("<a></a>");a.attr("href",window.URL.createObjectURL(r)),a.attr("download",i.name),a.attr("target","_blank"),angular.element(document.getElementsByTagName("body")[0]).append(a),setTimeout(function(){a[0].click(),a.remove()},5)}}}}]),angular.module("vgraph").directive("vgraphFocus",[function(){"use strict";return{require:["^vgraphChart"],link:function(t,e,i,r){var n=r[0],a=n.box,o=d3.select(e[0]),s=o.append("rect").attr("class","focus").attr("visibility","hidden");a.$on("resize",function(){s.attr("height",a.innerHeight).attr("y",a.innerTop)}),n.$on("drag",function(t){var e,i,r;t&&void 0!==t.xDiff&&(e=Math.abs(t.xDiff),i=t.x0-e,r=t.x0+e,s.attr("visibility","visible"),i>a.innerLeft?s.attr("x",i):(i=a.innerLeft,s.attr("x",a.innerLeft)),r>a.innerRight?s.attr("width",a.innerRight-i):s.attr("width",r-i))}),n.$on("drag-stop",function(t){var e,i,r,o,c;t&&(s.attr("visibility","hidden"),e=Math.abs(t.xDiff),e>3&&(i=t.x0-e,r=t.x0+e,i<a.innerLeft?i=0:i-=a.innerLeft,r>a.innerRight?r=a.innerWidth:r-=a.innerLeft,o=n.views[Object.keys(n.views)[0]].offset,c=a.innerWidth*o.right-a.innerWidth*o.left,n.setPane((a.innerWidth*o.left+i/a.innerWidth*c)/a.innerWidth,(a.innerWidth*o.right-(a.innerWidth-r)/a.innerWidth*c)/a.innerWidth),n.rerender()))})},scope:{follow:"=vgraphFocus",stop:"=loseFocus"}}}]),angular.module("vgraph").directive("vgraphHighlight",[function(){"use strict";return{require:["^vgraphChart"],scope:!0,link:function(t,e,i,r){r[0].$on("highlight",function(e){t[i.vgraphHighlight]=e,t.$digest()})}}}]),angular.module("vgraph").directive("vgraphIcon",["DrawIcon","ComponentElement",function(t,e){"use strict";return{scope:{config:"=vgraphIcon"},require:["^vgraphChart","vgraphIcon"],controller:e,link:function(e,i,r,n){var a=i[0],o=d3.select(a),s=o.node().getBBox(),c=n[0],l=c.compileReference(e.config),h=n[1],u=a.innerHTML,f="icon ",p=h.parse;h.parse=function(t){var e=p.call(this,t),i=s.height/2;return e.min-=i,e.max+=i,e},a.innerHTML="",h.setElement(a),h.setDrawer(new t(l,s,u)),l.classExtend&&(f+=l.classExtend+" "),f+=r.className||l.className,a.setAttribute("class",f),l.$view.registerComponent(h)}}}]),angular.module("vgraph").directive("vgraphIndicator",[function(){"use strict";return{require:["^vgraphChart"],scope:{cfg:"=?vgraphIndicator"},link:function(t,e,i,r){function n(){h.attr("visibility","hidden")}var a,o=r[0],s=o.getReference(t.cfg),c=t.$eval(i.pointRadius)||3,l=t.$eval(i.outerRadius),h=d3.select(e[0]).attr("transform","translate(1000,1000)").attr("visibility","hidden"),u=h.append("circle").attr("r",c),f=h.append("circle").attr("r",c);u.attr("class","point inner "+s.className),f.attr("class","line outer "+s.className),l&&(a=function(){f.transition().duration(1e3).attr("r",l).transition().duration(1e3).attr("r",c).ease("sine").each("end",function(){setTimeout(function(){a()},3e3)})})(),t.$on("$destroy",o.$subscribe({error:n,loading:n})),o.registerComponent({finalize:function(){var t,e,i=s.$view,r=i.getLeading(),a=s.getValue(r);a&&i.isLeading()?(t=r.$x,e=i.y.scale(a),t&&e&&(h.attr("transform","translate("+t+","+e+")"),h.attr("visibility","visible"))):n()}})}}}]),angular.module("vgraph").directive("vgraphInteract",[function(){"use strict";return{require:["^vgraphChart"],link:function(t,e,i,r){var n,a,o=r[0],s=!1,c=o.box,l=d3.select(e[0]),h=l.append("rect").style("opacity","0").attr("class","focal").on("mousemove",function(){var t=d3.mouse(this);s||(clearTimeout(a),o.$trigger("focus",{x:t[0],y:t[1]}))}).on("mouseout",function(){s||(a=setTimeout(function(){o.$trigger("focus",null)},100))});l.attr("class","interactive"),l.call(d3.behavior.drag().on("dragstart",function(){n=d3.mouse(e[0]),s=!0,o.$trigger("focus",null),o.$trigger("drag-start",{x:n[0],y:n[1]})}).on("dragend",function(){var t=d3.mouse(e[0]);s=!1,o.$trigger("drag-stop",{x0:n[0],y0:n[1],x1:t[0],x2:t[1],xDiff:t[0]-n[0],yDiff:t[1]-n[1]})}).on("drag",function(){var t=d3.mouse(e[0]);o.$trigger("drag",{x0:n[0],y0:n[1],x1:t[0],x2:t[1],xDiff:t[0]-n[0],yDiff:t[1]-n[1]})})),l.on("dblclick",function(){o.setPane({start:null,stop:null},{start:null,stop:null}),o.rerender()}),o.registerComponent({finalize:function(){h.attr({x:c.innerLeft,y:c.innerTop,width:c.innerWidth,height:c.innerHeight})}})}}}]),angular.module("vgraph").directive("vgraphLeading",[function(){"use strict";return{require:["^vgraphChart"],scope:{config:"=vgraphLeading"},link:function(t,e,i,r){function n(t){var e,i,r;if(s={},l.selectAll("line").remove(),o=[],t)for(i=0,r=t.length;r>i;i++)e=c.getReference(t[i]),o.push(e),s[e.name]=l.append("line").attr("class","line "+e.className)}function a(){l.attr("visibility","hidden")}var o,s,c=r[0],l=d3.select(e[0]);t.$watchCollection("config",n),t.$on("$destroy",c.$subscribe({error:a,loading:a})),c.registerComponent({finalize:function(){var t,e=!0,i=[];angular.forEach(o,function(t){var r=t.$view.normalizer,n=r.$latestNode(t.field),a=t.getValue(n);n&&t.$view.isLeading()?i.push({el:s[t.name],x:n.$x,y:t.$view.y.scale(a)}):(s[t.name].attr("visibility","hidden"),e=!1)}),i.sort(function(t,e){return t.y-e.y}),angular.forEach(i,function(e){t&&t.el.attr("visibility","visible").attr("x1",t.x).attr("x2",e.x).attr("y1",t.y).attr("y2",e.y),t=e}),t&&e?(l.attr("visibility","visible"),t.el.attr("visibility","visible").attr("x1",t.x).attr("x2",t.x).attr("y1",t.y).attr("y2",c.box.innerBottom)):a()}})}}}]),angular.module("vgraph").directive("vgraphLine",["DrawLine","DrawFill","ComponentElement",function(t,e,i){"use strict";return{scope:{config:"=vgraphLine",pair:"=?pair"},require:["^vgraphChart","vgraphLine"],controller:i,link:function(i,r,n,a){var o,s,c=r[0],l=a[0],h=l.compileReference(i.config),u=a[1];u.setElement(c),n.pair?(o=l.compileReference(i.pair),s="fill ",u.setDrawer(new e(h,o))):(s="line ",u.setDrawer(new t(h))),h.classExtend&&(s+=h.classExtend+" "),s+=n.className||h.className,c.setAttribute("class",s),h.$view.registerComponent(u)}}}]),angular.module("vgraph").directive("vgraphLoading",["$interval",function(t){"use strict";return{require:["^vgraphChart"],link:function(e,i,r,n){function a(){!d&&p.loading&&(v.attr("visibility","visible"),d=!0,t.cancel(l),s(),l=t(s,4005))}function o(){v.attr("visibility","hidden"),d=!1,t.cancel(l)}function s(){y.attr("x",function(){return h}).attr("width",function(){return 0}).transition().duration(1e3).attr("x",function(){return h}).attr("width",function(){return u}).ease("sine").transition().duration(1e3).attr("width",0).attr("x",function(){return f}).ease("sine").transition().duration(1e3).attr("width",function(){return u}).attr("x",function(){return h}).ease("sine").transition().duration(1e3).attr("x",function(){return h}).attr("width",0).ease("sine")}var c,l,h,u,f,p=n[0],d=!1,g=p.box,m=r.vgraphLoading||"Loading Data",v=d3.select(i[0]).attr("class","loading-view"),x=v.append("rect").attr("height",20).attr("class","outline"),y=v.append("rect").attr("width",0).attr("height",20).attr("class","filling"),$=v.append("text").text(m);g.$on("resize",function(){if(h=g.innerLeft+g.innerWidth/5,u=3*g.innerWidth/5,f=h+u,u){y.attr("x",h).attr("y",g.middle-10),x.attr("x",h).attr("y",g.middle-10).attr("width",u);try{$.attr("text-anchor","middle").attr("x",g.center).attr("y",g.middle+$.node().getBBox().height/2-2)}catch(t){$.attr("text-anchor","middle").attr("x",g.center).attr("y",g.middle)}a()}else o()}),a(),c=p.$subscribe({done:function(){o(),p.loading&&g.ratio&&a()},error:o}),e.$on("$destroy",function(){o(),c()})}}}]),angular.module("vgraph").directive("vgraphMessage",[function(){"use strict";return{require:["^vgraphChart"],link:function(t,e,i,r){var n,a=r[0],o=a.box,s=d3.select(e[0]).attr("class","error-view"),c=s.append("rect").attr("class","outline"),l=s.append("text");s.attr("visibility","hidden"),o.$on("resize",function(){if(o.innerHeight){c.attr("transform","translate("+o.innerLeft+","+o.innerTop+")").attr("width",o.innerWidth).attr("height",o.innerHeight);try{l.attr("text-anchor","middle").attr("x",o.center).attr("y",o.middle+l.node().getBBox().height/2)}catch(t){l.attr("text-anchor","middle").attr("x",o.center).attr("y",o.middle)}}}),n=a.$subscribe({error:function(){var t=a.message;t&&!a.loading&&(s.attr("visibility","visible"),l.text(t))},done:function(){s.attr("visibility","hidden")}})}}}]),angular.module("vgraph").directive("vgraphPage",["ComponentPage",function(t){"use strict";return{restrict:"A",scope:{settings:"=vgraphPage"},controller:t,require:["vgraphPage"],link:function(t,e,i,r){var n=r[0];t.$watch("settings",function(t){n.configure(t)})}}}]),angular.module("vgraph").directive("vgraphStack",["$compile","ComponentElement","StatCalculations","ComponentChart",function(t,e,i,r){"use strict";return{require:["^vgraphChart"],scope:{config:"=vgraphStack",feed:"=?feed"},link:function(n,a,o,s){function c(t){var e,i,r,n={};for(h=[],e=0,i=t.length;i>e;e++)r=g.getReference(t[e]),r.pair=n,n=r,h.push(r)}function l(i){var r,o,s,l;if(i&&(c(i),d)){for(d3.select(a[0]).selectAll("g").remove(),f&&f.$destroy(),s="",r=0,o=h.length;o>r;r++)s+="<g "+d+'="config['+r+']"></g>';for(l=e.svgCompile(s),r=0,o=l.length;o>r;r++)a[0].appendChild(l[r]);f=n.$new(),t(l)(f)}}var h,u,f,p=o.view||r.defaultView,d=o.childTag,g=s[0],m=g.getView(p);n.$watchCollection("config",l),u=n.$watchCollection("config",l),n.$on("$destroy",function(){f&&f.$destroy(),u()}),m.registerComponent({parse:function(){h&&(i.$resetCalcs(h),i.stack(h))}})}}}]),angular.module("vgraph").directive("vgraphStatus",[function(){"use strict";return{require:["^vgraphChart"],scope:!0,link:function(t,e,i,r){function n(){t[i.vgraphStatus]={message:a.message,loading:a.loading,pristine:a.pristine},t.$digest()}var a=r[0];a.$subscribe({done:n,error:n})}}}]),angular.module("vgraph").directive("vgraphTarget",[function(){"use strict";return{require:["^vgraphChart"],scope:{pointRadius:"=pointRadius",config:"=vgraphTarget"},link:function(t,e,i,r){function n(e){e?(o=e.pos.x,l.style("visibility","visible").attr("transform","translate("+o+",0)"),void 0===i.noDots&&angular.forEach(a,function(r){var n,a=r.$view,s=e[r.view],c=r.className,l=r.getValue(s);void 0!==l&&null!==l?(n=u.selectAll("circle.point."+c),n[0].length||(n=u.append("circle").attr("class","point "+c+" "+r.classExtend)),n.attr("cx",s.$x-o).attr("cy",a.y.scale(l)).attr("r",t.$eval(i.pointRadius)||3)):u.selectAll("circle.point."+c).remove()})):l.style("visibility","hidden")}var a,o,s=r[0],c=s.box,l=d3.select(e[0]).attr("class","target"),h=l.append("line").attr("class","focus").attr("x1",0).attr("x2",0),u=l.append("g");l.style("visibility","hidden"),s.$on("highlight",n),c.$on("resize",function(){h.attr("y1",c.innerTop).attr("y2",c.innerBottom)}),t.$watchCollection("config",function(t){var e,i;for(a=[],e=0,i=t.length;i>e;e++)a.push(s.getReference(t[e]))})}}}]),angular.module("vgraph").directive("vgraphTooltip",[function(){"use strict";function t(t,i,r){var n=i.config;return r.reference?{formatter:function(t){return t[r.reference].value},xParse:function(t){return t[r.reference].x},yParse:function(t){return t[r.reference].y}}:n.formatter?n:e(t,n)}function e(t,e){var i=t.getReference(e);return{formatter:function(t){return i.getValue(t[i.view])},xParse:function(t){return t[i.view].$x},yParse:function(t){return i.$view.y.scale(i.getValue(t[i.view]))}}}return{require:["^vgraphChart"],scope:{config:"=?vgraphTooltip"},link:function(e,i,r,n){var a=n[0],o=t(a,e,r),s=parseInt(r.offsetX)||0,c=parseInt(r.offsetY)||0,l=d3.select(i[0]).attr("class","tooltip"),h=l.append("polygon").attr("class","outline").attr("transform","translate(0,-15)"),u=l.append("text").style("line-height","20").style("font-size","16").attr("class","label");a.$on("highlight",function(t){var e,i,r,n;t&&(r=o.yParse(t)),void 0!==r?(e=r+c,i=o.xParse(t)+s,u.text(o.formatter(t)),n=u.node().getComputedTextLength()+5,l.style("visibility","visible"),i+n+16<a.box.innerRight?(l.attr("transform","translate("+i+","+e+")"),u.attr("transform","translate(10,5)"),h.attr("points","0,15 10,0 "+(n+10)+",0 "+(n+10)+",30 10,30 0,15")):(l.attr("transform","translate("+(i-2*s-n-10)+","+e+")"),u.attr("transform","translate(5,5)"),h.attr("points","0,0 "+n+",0 "+(n+10)+",15 "+n+",30 0,30 0,0"))):l.style("visibility","hidden")})}}}]),angular.module("vgraph").directive("vgraphZoom",[function(){"use strict";return{scope:{min:"=zoomMin",max:"=zoomMax"},require:["^vgraphChart","^vgraphPage"],link:function(t,e,i,r){function n(e){0===o&&s===d.innerWidth?(v=!1,b.attr("class","focus")):(v=!0,b.attr("class","focus zoomed")),0>o&&(o=0),s>d.innerWidth&&(s=d.innerWidth),o>s?o=s:o>s&&(s=o),y.attr("transform","translate("+o+",0)"),$.attr("transform","translate(-"+o+",0 )").attr("width",o),k.attr("transform","translate("+s+",0)"),_.attr("width",d.innerWidth-s),b.attr("transform","translate("+o+",0)").attr("width",s-o),e||t.$apply(function(){g.setPane(o/d.innerWidth,s/d.innerWidth),g.rerender()})}var a,o,s,c,l,h,u,f=r[0],p=r[1],d=f.box,g=p.getChart(i.vgraphZoom),m=!1,v=!1,x=d3.select(e[0]),y=x.append("g").attr("class","left-control min-control"),$=y.append("rect").attr("class","shade"),w=y.append("g").attr("class","control"),b=x.append("rect").attr("class","focus"),k=x.append("g").attr("class","right-control max-control"),_=k.append("rect").attr("class","shade"),P=k.append("g").attr("class","control");l=w.append("path").attr("d","M-0.5,23.33A6,6 0 0 0 -6.5,29.33V40.66A6,6 0 0 0 -0.5,46.66ZM-2.5,31.33V38.66M-4.5,31.33V38.66").attr("transform","translate(0,-9)").attr("class","nub"),c=w.append("rect").attr("width","10").attr("transform","translate(-10,0)"),u=P.append("path").attr("d","M0.5,23.33A6,6 0 0 1 6.5,29.33V40.66A6,6 0 0 1 0.5,46.66ZM2.5,31.33V38.66M4.5,31.33V38.66").attr("transform","translate(0,-9)").attr("class","nub"),h=P.append("rect").attr("width","10"),t.box=d,c.call(d3.behavior.drag().on("dragstart",function(){m=!0}).on("dragend",function(){m=!1}).on("drag",function(){o=d3.mouse(e[0])[0],n()})),h.call(d3.behavior.drag().on("dragstart",function(){m=!0}).on("dragend",function(){m=!1}).on("drag",function(){s=d3.mouse(e[0])[0],n()})),b.call(d3.behavior.drag().on("dragstart",function(){a={mouse:d3.mouse(e[0])[0],minPos:o,maxPos:s},m=!0}).on("dragend",function(){m=!1,v=!0}).on("drag",function(){var t=d3.mouse(e[0]),i=t[0]-a.mouse;v?(s=a.maxPos+i,o=a.minPos+i,n()):i>1&&(s=a.mouse+Math.abs(i),o=a.mouse-Math.abs(i),n(),v=!1)})),x.on("dblclick",function(){s=d.innerWidth,o=0,n()}),d.$on("resize",function(){x.attr("width",d.innerWidth).attr("height",d.innerHeight).attr("transform","translate("+d.innerLeft+","+d.innerTop+")"),u.attr("transform","translate(0,"+(d.innerHeight/2-30)+")"),l.attr("transform","translate(0,"+(d.innerHeight/2-30)+")"),$.attr("height",d.innerHeight),_.attr("height",d.innerHeight),c.attr("height",d.innerHeight),h.attr("height",d.innerHeight),b.attr("height",d.innerHeight)}),g.$on("success",function(t){m||(t.offset?(o=t.offset.left*d.innerWidth,s=t.offset.right*d.innerWidth):(o=0,s=d.innerWidth),n(!0))})}}}]),function(t){"use strict";var e=/\S+/g,i=/[\t\r\n\f]/g;t&&(t.fn.addClass=function(r){var n,a,o,s,c,l,h,u="string"==typeof r&&r,f=0,p=this.length;if(t.isFunction(r))return this.each(function(e){t(this).addClass(r.call(this,e,this.className))});if(u)for(n=(r||"").match(e)||[];p>f;f++)if(a=this[f],h="string"!=typeof a.className,o=1===a.nodeType&&(a.className?(" "+(h?a.getAttribute("class")||"":a.className)+" ").replace(i," "):" ")){for(c=0;s=n[c++];)o.indexOf(" "+s+" ")<0&&(o+=s+" ");l=t.trim(o),a.className!==l&&(h?a.setAttribute("class",l):a.className=l)}return this},t.fn.removeClass=function(r){var n,a,o,s,c,l,h,u=0===arguments.length||"string"==typeof r&&r,f=0,p=this.length;if(t.isFunction(r))return this.each(function(e){t(this).removeClass(r.call(this,e,this.className))});if(u)for(n=(r||"").match(e)||[];p>f;f++)if(a=this[f],h="string"!=typeof a.className,o=1===a.nodeType&&(a.className?(" "+(h?a.getAttribute("class")||"":a.className)+" ").replace(i," "):"")){for(c=0;s=n[c++];)for(;o.indexOf(" "+s+" ")>=0;)o=o.replace(" "+s+" "," ");l=r?t.trim(o):"",
a.className!==l&&(h?a.setAttribute("class",l):a.className=l)}return this})}(jQuery);
//# sourceMappingURL=vgraph.min.js.map