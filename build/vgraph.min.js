angular.module("vgraph",[]),angular.module("vgraph").factory("BoxModel",[function(){"use strict";function a(a,b){var d=b.padding,e=a.padding,f=b.margin,g=a.margin;g||(a.margin=g={top:0,right:0,bottom:0,left:0}),f&&(g.top=c(f.top,g.top),g.right=c(f.right,g.right),g.bottom=c(f.bottom,g.bottom),g.left=c(f.left,g.left)),e||(a.padding=e={top:0,right:0,bottom:0,left:0}),d&&(e.top=c(d.top,e.top),e.right=c(d.right,e.right),e.bottom=c(d.bottom,e.bottom),e.left=c(d.left,e.left)),a.outerWidth=c(b.outerWidth,a.outerWidth)||0,a.outerHeight=c(b.outerHeight,a.outerHeight)||0,a.top=g.top,a.bottom=a.outerHeight-g.bottom,a.left=g.left,a.right=a.outerWidth-g.right,a.center=(a.left+a.right)/2,a.middle=(a.top+a.bottom)/2,a.width=a.right-a.left,a.height=a.bottom-a.top,a.innerTop=a.top+e.top,a.innerBottom=a.bottom-e.bottom,a.innerLeft=a.left+e.left,a.innerRight=a.right-e.right,a.innerWidth=a.innerRight-a.innerLeft,a.innerHeight=a.innerBottom-a.innerTop,a.ratio=a.outerWidth+" x "+a.outerHeight}function b(b){this.registrations=[],a(this,b||{})}function c(a,b){return void 0!==a?parseInt(a):b}return b.prototype.register=function(a){this.ratio&&a(),this.registrations.push(a)},b.prototype.targetSvg=function(a){this.$element=a,this.resize()},b.prototype.resize=function(){var b,c,d=this.$element;if(d.attr("width",null).attr("height",null),d[0].style.cssText=null,a(this,{outerWidth:d.outerWidth(!0),outerHeight:d.outerHeight(!0),margin:{top:d.css("margin-top"),right:d.css("margin-right"),bottom:d.css("margin-bottom"),left:d.css("margin-left")},padding:{top:d.css("padding-top"),right:d.css("padding-right"),bottom:d.css("padding-bottom"),left:d.css("padding-left")}}),d.css("margin","0").css("padding","0").attr("width",this.outerWidth).attr("height",this.outerHeight).css({width:this.outerWidth+"px",height:this.outerHeight+"px"}),this.innerWidth&&this.innerHeight)for(b=0,c=this.registrations.length;c>b;b++)this.registrations[b]()},b}]),angular.module("vgraph").factory("ComponentGenerator",[function(){"use strict";function a(a,b,c){var d,e,f,g=b.name;return a[g]=b,d=angular.isFunction(b.value)?g+".value":"'"+(b.value||g)+"'",e=angular.isFunction(b.interval)?g+".interval":"'"+(b.interval||"x")+"'",angular.isString(b.data)?(f=b.data,a[b.data]=a.$parent[b.data]):f=b.data?g+".data":"data",'<path class="'+c+" "+b.className+'" vgraph-feed="'+f+'" name="'+g+'" value="'+d+'" interval="'+e+'"'+(b.filter?' filter="'+b.filter+'"':"")+"></path>"}var b={require:["^vgraphChart"],link:function(a,b,c,d){function e(){a.data&&j.valueParse&&(k!==a.data||a.data.length!==m)&&(k&&i.removePlot(l),k=a.data,m=0,f(a.data),h.model.dataReady(a))}function f(b){var c=b.length;if(c&&c!==m){for(;c>m;m++)a.loadPoint(a.data[m]);i.dataReady(a)}}var g,h=d[0],i=h.model,j={model:i},k=!1,l=c.name,m=0,n=[],o=parseInt(c.memory,10)||10;a.$watch("interval",function(a){j.intervalParse="string"==typeof a?function(b){return b[a]}:a}),a.$watch("extra",function(a){j.extraParse=a}),a.$watch("filter",function(a){j.filterParse=a}),a.$watch("value",function(a){"string"==typeof a?(g=c.alias||a,j.valueParse=function(b){return void 0!==b[a]?b[g]:void 0}):j.valueParse=a,e()}),a.$watch("data",function(){e()}),a.$watch("data.length",function(b){b&&j.valueParse&&f(a.data)}),a.loadPoint=a.loadPoint?a.loadPoint.bind(j):function(a){var b,c=this.valueParse(a);void 0!==c&&(this.filterParse?(n.length>o&&n.shift(),n.push(c),b=this.model.addPoint(l,this.intervalParse(a),this.filterParse(c,n))):b=this.model.addPoint(l,this.intervalParse(a),c),this.extraParse&&b&&this.extraParse(a,b))}.bind(j)},scope:{data:"=_undefined_",value:"=?value",interval:"=?interval",filter:"=?filter",extra:"=?extra"}};return{generate:function(a,c){function d(){}var e;return d.prototype=b,e=new d,e.scope=angular.copy(e.scope),e.scope.data="="+a,angular.forEach(c,function(a,b){var c=e[b];e[b]=c?angular.isFunction(c)?function(){c.apply(this,arguments),a.apply(this,arguments)}:angular.extend(c,a):a}),e.preLink&&(e.link={pre:e.preLink,post:e.link}),e},makeLineCalc:function(a,b){return d3.svg.line().interpolate("linear").defined(function(a){var c=a[b];return!(isNaN(c)||null===c)}).x(function(b){return a.x.scale(b.$interval)}).y(function(c){return a.y.scale(c[b])})},makeFillCalc:function(a,b,c){return d3.svg.area().defined(function(a){var c=a[b];return!(isNaN(c)||null===c)}).x(function(b){return a.x.scale(b.$interval)}).y(function(c){return a.y.scale(c[b])}).y1(function(b){return a.y.scale(b[c]?b[c]:a.model.y.minimum)})},decodeConfig:function(b,c,d){var e,f,g=[];if(angular.isArray(c))for(e=0,f=c.length;f>e;e++)g.push(a(b,c[e],d));else g.push(a(b,c,d));return g},compileConfig:function(a,b,c){var d,e,f,g;for(angular.isArray(b)||(b=[b]),f=this.decodeConfig(a,b,c),g=(new DOMParser).parseFromString('<g xmlns="http://www.w3.org/2000/svg">'+f.join("")+"</g>","image/svg+xml").childNodes[0].childNodes,d=0,e=g.length;e>d;d++)f[d]={name:b[d].name,className:b[d].className,element:g[d],$d3:d3.select(g[d])};return f},parseStackedLimits:function(a,b){var c,d,e,f,g,h,i,j,k,l;if(b&&b.length)for(c=0,d=a.length;d>c;c++){for(h=0,j=void 0,i=a[c],e=0,f=b.length;f>e&&void 0===j;e++)g=b[e].name,j=i[g],void 0!==j&&(void 0===k?(k=j,l=j):k>j&&(k=j));for(i["$"+g]=j,h=j;f>e;e++)g=b[e].name,j=i[g]||0,h+=j,i["$"+g]=h;i.$total=h,h>l&&(l=h)}return{min:k,max:l}},parseLimits:function(a,b,c){var d,e,f,g,h,i;if(angular.isString(b))if(c)for(d=0,e=a.length;e>d;d++)f=a[d],g=c(f,f[b]),void 0!==g&&(void 0===h?(h=g,i=g):h>g?h=g:g>i&&(i=g));else for(d=0,e=a.length;e>d;d++)f=a[d],g=f[b],void 0!==g&&(void 0===h?(h=g,i=g):h>g?h=g:g>i&&(i=g));else for(d=0,e=b.length;e>d;d++)g=this.parseLimits(a,b[d]),void 0===h?(h=g.min,i=g.max):(g.min<h&&(h=g.min),g.max>i&&(i=g.max));return{min:h,max:i}}}}]),angular.module("vgraph").factory("GraphModel",[function(){"use strict";function a(a,b){return a[e(a,b,1)-1]}function b(a,b){return{$x:b,$interval:a.makeInterval(b)}}function c(a){a||(a={}),a.x||(a.x={}),a.y||(a.y={}),this.queued=null,this.construct(),this.reset(a)}var d=0,e=d3.bisector(function(a){return a.$interval}).left;return c.prototype.construct=function(){var a=this;this.$modelId=d++,this.registrations=[],this.point={reset:function(a){a.$x=null,a.$y=null},isValid:function(b){var c;return void 0===a.x.start?!0:(c=b.$x,a.x.start.$x<=c&&c<=a.x.stop.$x)}}},c.prototype.reset=function(a){this.data=[],this.lookUp={},this.plots={},this.plotNames=[],this.filtered=null,this.needSort=!1,this.ratio=null,this.transitionDuration=30,this.setStatus("loading"),this.config(a||this)},c.prototype.setBounds=function(a,b){return a&&(void 0!==a.min&&(this.x.$min=a.min),void 0!==a.max&&(this.x.$max=a.max)),b&&(void 0!==b.min&&(this.y.$min=b.min),void 0!==b.max&&(this.y.$max=b.max)),this},c.prototype.setPane=function(a,b){return a&&(void 0!==a.start&&(this.x.start=a.start),void 0!==a.stop&&(this.x.stop=a.stop)),b&&(void 0!==b.start&&(this.y.start=b.start),void 0!==b.stop&&(this.y.stop=b.stop)),this},c.prototype.config=function(a){var b=this;this.x={$min:null,$max:null,massage:a.x.massage||null,padding:a.x.padding||0,scale:a.x.scale||function(){return d3.scale.linear()},disp:a.x.display||function(a){return a.$interval},simplify:a.x.simplify||function(a){return a.$x},parse:a.x.parse||function(a){return a.$interval},format:a.x.format||d3.format("03d"),tick:a.x.tick||{}},this.y={$min:null,$max:null,massage:a.y.massage||null,padding:a.y.padding||0,scale:a.y.scale||function(){return d3.scale.linear()},disp:a.y.display||function(a,c){return b.y.parse(a,c)},simplify:a.y.simplify||function(a){return b.y.parse(a)},parse:a.y.parse||function(a,b){return void 0===a||null===a?null:a[b]},format:a.y.format||d3.format(",.2f"),tick:a.y.tick||{}},this.setPane(a.x,a.y)},c.prototype.makeInterval=function(a){return a},c.prototype.getPoint=function(a){var b;return this.x.massage&&(a=this.x.massage(a)),a||0===a?(b=this.lookUp[a],b||(b={$interval:this.makeInterval(a),$x:+a}),b):void 0},c.prototype.addPoint=function(a,b,c){var d,e=this.data,f=this.getPoint(b),g=parseFloat(c);if(f)return b=f.$x,this.y.massage&&(c=this.y.massage(b)),void 0===f.$max?(isFinite(g)&&(f.$min=g,f.$max=g),this.lookUp[b]=f,e.length&&e[e.length-1].$x>b&&(this.needSort=!0),this.data.push(f)):isFinite(g)&&((void 0===f.$min||g<f.$min)&&(f.$min=g),(void 0===f.$max||g>f.$max)&&(f.$max=g)),this.x.min||(this.x.min=f,this.x.max=f),d=this.plots[a],d?d.x.max.$x<f.$x?(d.x.max=f,this.x.max.$x<f.$x&&(this.x.max=f)):d.x.min.$x>f.$x&&(d.x.min=f,f.$x<this.x.min.$x&&(this.x.min=f)):(this.plots[a]=d={x:{min:f,max:f}},this.x.max.$x<f.$x?this.x.max=f:f.$x<this.x.min.$x&&(this.x.min=f)),f[a]=c,f},c.prototype.setError=function(a){this.setStatus("error",a)},c.prototype.setStatus=function(a,b){"error"===a?(this.loaded=!1,this.loading=!1,this.error=b,this.message=null):"loaded"===a?(this.loaded=!0,this.loading=!1,this.error=null,this.message=b):"updating"===a?(this.loaded=!0,this.loading=!0,this.error=null,this.message=b):(this.loaded=!1,this.loading=!0,this.error=null,this.message=b),this.status=a},c.prototype.addPlot=function(a,b,c,d){var e,f,g;if(!this.plots[a])for(e=0,f=b.length;f>e;e++)g=b[e],this.addPoint(a,c(g),d(g))},c.prototype.removePlot=function(a){var b,c,d,e,f,g,h,i,j=this.plots[a];if(j){for(delete this.plots[a],h=Object.keys(this.plots),b=0,c=this.data.length;c>b;b++){if(i=this.data[b],i.$max===i[a]){for(f=void 0,d=0,e=h.length;e>d;d++)g=i[h[d]],"number"==typeof g&&(void 0===f||g>f)&&(f=g);i.$max=f}if(i.$min===i[a]){for(f=void 0,d=0,e=h.length;e>d;d++)g=i[h[d]],"number"==typeof g&&(void 0===f||f>g)&&(f=g);i.$min=f}i[a]=null}if(this.x.min=null,this.x.max=null,this.y.min=null,this.y.max=null,h.length&&this.plots[h[0]]&&this.plots[h[0]].x&&this.plots[h[0]].y)for(this.x.min=this.plots[h[0]].x.min,this.x.max=this.plots[h[0]].x.max,this.y.min=this.plots[h[0]].y.min,this.y.max=this.plots[h[0]].y.max,b=1,c=h.length;c>b;b++)g=h[b],i=this.plots[g],i.min&&i.min.$x<this.x.min.$x?this.x.min=i.min:i.max&&this.x.max.$x<i.max.$x&&(this.x.max=i.max),i.min&&i.min.$min<this.y.min.$min?this.y.min=i.min:i.max&&this.y.max.$max<i.max.$max&&(this.y.max=i.max)}},c.prototype.dataReady=function(a){var b=this;clearTimeout(this.queued),this.queued=setTimeout(function(){b.adjusting||b.adjust(a)},15)},c.prototype.findExtemesY=function(a){var b,c,d,e,f;for(c=0,d=a.length;d>c;c++)b=a[c],(b.$min||0===b.$min)&&(void 0===e?e=b:b.$min<e.$min&&(e=b)),(b.$max||0===b.$max)&&(void 0===f?f=b:b.$max>f.$max&&(f=b));return{min:e,max:f}},c.prototype.register=function(a){this.registrations.push(a)},c.prototype.adjust=function(c){var d,e,f,g,h,i,j=!1,k=this,l=this.data,m=this.x;l.length&&(this.nexAdjust=function(){this.adjusting=!0,this.error=!1,this.needSort&&this.data.sort(function(a,b){return a.$x-b.$x});try{if(null===m.$min&&(m.$min=m.min.$x),null===m.$max)m.$max=m.max.$x;else if("string"==typeof m.$max){if("+"!==m.$max.charAt(0))throw"Unable to handle shift as string";m.$max=parseInt(m.$max.substring(1),10)+m.$min}if("number"==typeof m.start)m.start=this.data[m.start];else{if(m.start)if("string"==typeof m.start)if(j=!0,"%"===m.start.charAt(0))i=m.$min+parseFloat(m.start.substring(1),10)*(m.$max-m.$min);else if("+"===m.start.charAt(0))i=m.$min+parseInt(m.start.substring(1),10);else{if("="!==m.start.charAt(0))throw"Start of pane not properly defined";i=parseInt(m.start.substring(1),10)}else i=m.start.$x;else j=!0,i=m.$min;m.start=i>m.min.$x&&i<m.max.$x?a(this.data,i):b(this,i)}if("number"==typeof m.stop)m.stop=this.data[m.stop];else{if(m.stop)if("string"==typeof m.stop)if(j=!0,"%"===m.stop.charAt(0))i=m.$min+parseFloat(m.stop.substring(1),10)*(m.$max-m.$min);else if("+"===m.stop.charAt(0))i=m.$min+parseInt(m.stop.substring(1),10);else{if("="!==m.stop.charAt(0))throw"End of pane not properly defined";i=parseInt(m.stop.substring(1),10)}else i=m.stop.$x;else j=!0,i=m.$max;m.stop=i>m.min.$x&&i<m.max.$x?a(this.data,i):b(this,i)}if(this.filtered=this.data.filter(function(a,b){var c=a.$x;return m.start.$x<=c&&c<=m.stop.$x?(g?h=b:g=b,a.$inPane=!0,!0):(a.$inPane=!1,!1)}),this.filtered.$first=g,this.filtered.$last=h,m.stop&&m.start&&(f=l.length+" : "+this.filtered.length,f!==this.ratio||c||j))for(this.ratio=f,d=0,e=this.registrations.length;e>d;d++)this.registrations[d](this)}catch(n){k.setError("Model Failed"),n.message?(console.debug(n.message),console.debug(n.stack)):console.debug(n)}this.adjusting=!1},this.adjustInterval||(this.adjustInterval=setTimeout(function(){k.adjustInterval=null,k.nexAdjust()},30)))},c}]),angular.module("vgraph").directive("vgraphAxis",[function(){"use strict";function a(a,b){return!(a.bottom<b.top||a.top>b.bottom||a.right<b.left||a.left>b.right)}return{require:["^vgraphChart"],link:function(b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=e[0],r=d3.svg.axis(),s="axis",t=q.box,u=q.model,v=0,w=null,x=!0,y=!1,z=parseInt(d.tickLength)||0,A=parseInt(d.tickPadding)||3,B=parseInt(d.tickMargin)||0,C=d3.select(c[0]);switch(k=C.append("g").attr("class","ticks"),o=C.append("g").attr("class","padding"),l=o.append("g").attr("class","tick-marks"),m=o.append("rect").attr("class","tick-margin"),p=C.append("g").attr("class","label-wrap"),d.tickRotation&&(w=parseInt(d.tickRotation,10)%360),d.labelOffset&&(v=b.$eval(d.labelOffset)),d.labelClean&&(x=b.$eval(d.labelClean)),d.labelEndpoints&&(y=b.$eval(d.labelEndpoints)),d.axisLabel&&(n=p.append("text").attr("class","axis-label label").text(b.$eval(d.axisLabel))),f=function(){d.tickMarks?(r.tickValues(b.$eval(d.tickMarks)),h=[]):d.tickCount?(r.ticks(b.$eval(d.tickCount)),h=[]):(r.ticks(10),h=[])},b.orient){case"top":g=function(){var a;C.attr("class",s+" x top").attr("transform","translate("+t.left+","+t.top+")").attr("width",t.width).attr("height",t.padding.top),n&&n.attr("text-anchor","middle").attr("x",t.width/2).attr("y",t.padding.top-v),B&&m.attr("height",B).attr("width",t.innerWidth).attr("x",0).attr("y",-B),l.attr("transform","translate(-"+t.margin.left+",0)"),h&&(r.orient("top").tickFormat(u.x.format).innerTickSize(-t.innerHeight+z+B).outerTickSize(0).tickPadding(A+z+B).scale(q.x.scale),u.x.tick.interval&&r.ticks(u.x.tick.interval,u.x.tick.step),k.attr("transform","translate(-"+t.margin.left+","+t.padding.top+")").call(r),a=C.selectAll("g.axis-cap").data(q.x.scale.domain()),y&&(a.enter().append("g").attr("class",function(a,b){return"axis-cap "+(b?"axis-max":"axis-min")}).append("text"),a.exit().remove(),a.attr("transform",function(a){return"translate("+(q.x.scale(a)-t.margin.left)+",0)"}).select("text").text(function(a){var b=u.x.format(a);return(""+b).match("NaN")?"":b}).attr("dy","-0.25em").attr("y",t.padding.top).attr("text-anchor","middle")),w&&(k.selectAll(".tick text").attr("transform","translate(0,"+k.select(".tick text").attr("y")+") rotate("+w+",0,0)").attr("y","0").style("text-anchor",w%360>0?"end":"start"),a.select("text").attr("transform","rotate("+w+",0,0)").style("text-anchor",b.rotation%360>0?"end":"start")))};break;case"bottom":g=function(){var a;C.attr("class",s+" x bottom").attr("transform","translate("+t.left+","+t.innerBottom+")").attr("width",t.width).attr("height",t.padding.bottom),n&&n.attr("text-anchor","middle").attr("x",t.width/2).attr("y",t.padding.bottom+v),B&&m.attr("height",B).attr("width",t.innerWidth).attr("x",0).attr("y",0),l.attr("transform","translate(-"+t.margin.left+",0)"),h&&(r.orient("bottom").tickFormat(u.x.format).innerTickSize(t.innerHeight+z+B).outerTickSize(0).tickPadding(A+z+B).scale(q.x.scale),u.x.tick.interval&&r.ticks(u.x.tick.interval,u.x.tick.step),k.attr("transform","translate(-"+t.margin.left+","+-t.innerHeight+")").call(r),a=C.selectAll("g.axis-cap").data(q.x.scale.domain()),y&&(a.enter().append("g").attr("class",function(a,b){return"axis-cap "+(b?"axis-max":"axis-min")}).append("text"),a.exit().remove(),a.attr("transform",function(a){return"translate("+(q.x.scale(a)-t.margin.left)+",0)"}).select("text").text(function(a){var b=u.x.format(a);return(""+b).match("NaN")?"":b}).attr("dy","1em").attr("y",0).attr("text-anchor","middle")),w&&(k.selectAll(".tick text").attr("transform",function(){return"translate(0,"+d3.select(this).attr("y")+") rotate("+w+",0,0)"}).attr("y","0").style("text-anchor",w%360>0?"start":"end"),a.select("text").attr("transform","rotate("+w+",0,0)").style("text-anchor",b.rotation%360>0?"start":"end")))};break;case"right":break;case"left":var D;g=function(){C.attr("class",s+" y left").attr("transform","translate("+t.left+","+t.top+")").attr("width",t.padding.left).attr("height",t.height),p.attr("transform","translate("+t.padding.left+","+t.height+") rotate( -90 )"),n&&n.attr("text-anchor","middle").attr("x",t.height/2).attr("y",-v),B&&m.attr("height",t.innerHeight).attr("width",B).attr("x",-B).attr("y",0),l.attr("transform","translate("+t.padding.left+","+-t.top+")"),h&&(r.orient("left").tickFormat(u.y.format).innerTickSize(-(t.innerWidth+z+B)).outerTickSize(0).tickPadding(A+z+B).scale(q.y.scale),u.y.tick.interval&&r.ticks(u.y.tick.interval,u.y.tick.step),k.attr("transform","translate("+(t.padding.left-z-B)+","+-t.top+")").call(r),k.select(".domain").attr("transform","translate("+(z+B)+",0)"),y&&(D=C.selectAll("g.axis-cap").data(q.y.scale.domain()),D.enter().append("g").attr("class",function(a,b){return"axis-cap "+(b?"axis-max":"axis-min")}).append("text"),D.exit().remove(),D.attr("transform",function(a){return"translate(0,"+(q.y.scale(a)-t.margin.top)+")"}).select("text").text(function(a){var b=u.y.format(a);return(""+b).match("NaN")?"":b}).attr("dy",".25em").attr("x",t.padding.left-r.tickPadding()).attr("text-anchor","end")))}}q.register({build:function(){void 0===h&&f(),g()},process:function(){h.length=0,z&&(k.selectAll(".tick text").each(function(a){h.push({el:this,val:a,position:this.getBoundingClientRect()})}),h.sort(function(a,b){var c=a.position.top-b.position.top;return c?c:a.position.left-b.position.left})),x&&(i=C.select(".axis-min text").node(),i&&(i=i.getBoundingClientRect()),j=C.select(".axis-max text").node(),j&&(j=j.getBoundingClientRect()))},finalize:function(){var b,c,d,e,f,g,k={};for(l.selectAll("line").remove(),e=0,f=h.length;f>e;e++)b=!0,c=h[e],d=c.position,x&&i&&(a(d,i)||a(d,j))?(c.el.setAttribute("class","collided"),b=!1):void 0===k.left?(k.left=d.left,k.right=d.right,k.width=d.width,k.top=d.top,k.bottom=d.bottom,k.height=d.height,c.el.setAttribute("class","")):x&&a(d,k)?(c.el.setAttribute("class","collided"),b=!1):(g=!1,d.left<k.left&&(k.left=d.left,g=!0),d.right>k.right&&(k.right=d.right,g=!0),g&&(k.width=k.right-k.left,g=!1),d.top<k.top&&(k.top=d.top,g=!0),d.bottom>k.bottom&&(k.bottom=d.bottom,g=!0),g&&(k.height=k.bottom-k.top),c.el.setAttribute("class",""))}},"axis-"+b.orient)},scope:{orient:"=vgraphAxis",adjust:"=axisAdjust",rotation:"=tickRotation"}}}]),angular.module("vgraph").directive("vgraphBar",["$compile","ComponentGenerator",function(a,b){"use strict";return{require:["^vgraphChart"],scope:{data:"=?vgraphBar",config:"=config"},link:function(c,d,e,f){function g(d){var e,f,g,h;if(d){for(d3.select(l).selectAll("path").remove(),i=b.compileConfig(c,d,"line");j.length;)j.pop().$destroy();for(f=0,g=i.length;g>f;f++)h=i[f],h.$valueField="$"+h.name,f?(l.insertBefore(h.element,i[f-1].element),h.$bottom=i[f-1].$valueField,h.calc=b.makeLineCalc(k,h.$valueField,h.$bottom)):(l.appendChild(h.element),h.calc=b.makeLineCalc(k,h.$valueField)),e=c.$new(),j.push(e),a(h.element)(e)}}function h(a,b,c){var d,e,f,g,h,j,l,p,q,r,s,t,u,v,w,x;for(h=b;c>h;h++)q=a[h],q&&(q.$els=[]);for(f=0,g=i.length;g>f;f++){for(l=i[f],x=i[f].$valueField,j=0,p=0,h=b,e=[];c>h;)q=a[h],q&&void 0!==q[x]&&(j+=q[x],p++,r=q),h++;if(j){for(t=k.y.scale(j/p),void 0===u&&(a[b]===r?(u=r._$interval-m/2,v=u+m):(u=a[b]._$interval+n,v=r._$interval-n),u<k.box.innerLeft?u=k.box.innerLeft:a[b-1]&&a[b-1]._$interval>u&&(u=a[b-1]._$interval+n),v>k.box.innerRight?v=k.box.innerRight:a[h]&&a[h]._$interval<v&&(v=a[h]._$interval-n),u>v&&(w=u,u=v,v=w),w=v-u),d=void 0===s?o.append("rect").attr("height",k.y.scale(k.model.y.minimum)-t):o.append("rect").attr("height",s-t),d.attr("class","bar "+l.className).attr("y",t).attr("x",u).attr("width",w),d=d[0][0],h=b;c>h;h++)q=a[h],q&&(q.$els.push(d),q.$bar={center:(u+v)/2,top:j/p});s=t}}}var i,j=[],k=f[0],l=d[0],m=parseInt(e.minWidth||1),n=parseInt(e.padding||1),o=d3.select(l).append("g").attr("class","mount");c.$watchCollection("config",g),k.register({parse:function(a){return b.parseStackedLimits(a,i)},build:function(a){var b,c,d=0,e=k.x.scale(k.model.x.min.$interval),f=k.x.scale(k.model.x.max.$interval),g=f-e,i=n+m,j=g/i,l=a.length/j;for(o.selectAll("rect").remove(),1>l&&(l=1),b=0,c=a.length;c>b;b=Math.floor(d))d+=l,h(a,b,d)},finalize:function(a){var b,c,d;for(b=0,c=i.length;c>b;b++)d=i[b],d.$d3.attr("d",d.calc(a))}})}}}]),angular.module("vgraph").directive("vgraphChart",[function(){"use strict";function a(a,b){b&&(a.$mat=d3.select(b).insert("rect",":first-child"),a.$frame=d3.select(b).insert("rect",":first-child")),a.$mat&&a.innerWidth&&(a.$mat.attr("class","mat").attr("width",a.innerWidth).attr("height",a.innerHeight).attr("transform","translate("+a.innerLeft+","+a.innerTop+")"),a.$frame.attr("class","frame").attr("width",a.width).attr("height",a.height).attr("transform","translate("+a.left+","+a.top+")"))}return{controller:function(b){var c=[],d=[],e=b.model,f=b.box,g=this;return this.register=function(a,b){c.push(a),d.push(b)},this.model=e,this.box=f,this.x={scale:e.x.scale(),calc:function(a){return g.x.scale(e.x.parse(a))},center:function(){return(g.x.calc(e.x.min)+g.x.calc(e.x.max))/2}},this.y={scale:e.y.scale(),calc:function(a){return g.y.scale(e.y.parse(a))},center:function(){return(g.y.calc(e.y.min)+g.y.calc(e.y.max))/2}},f.register(function(){a(f),e.adjust(!0)}),e.register(function(){var a,b,d,h,i,j,k,l;for(l=parseInt(e.filtered.length/f.innerWidth)||1,i=e.filtered.filter(function(a,c){return e.x.start===a||e.x.stop===a||c%l===0?(b=a,a.$sampled=a,!0):(a.$sampled=b,!1)}),j=0,k=c.length;k>j;j++)c[j].parse&&(a=c[j].parse(i,e.filtered),a&&((!d&&0!==d||d>a.min)&&(d=a.min),(!h&&0!==h||h<a.max)&&(h=a.max)));for(e.adjustSettings&&e.adjustSettings(e.x.stop.$interval-e.x.start.$interval,h-d,e.filtered.$last-e.filtered.$first),e.y.top=h,e.y.bottom=d,e.y.padding&&(a=(h-d)*e.y.padding,h+=a,d-=a),e.y.minimum=d,e.y.maximum=h,g.x.scale.domain([e.x.start.$interval,e.x.stop.$interval]).range([f.innerLeft,f.innerRight]),g.y.scale.domain([d,h]).range([f.innerBottom,f.innerTop]),j=0,k=i.length;k>j;j++)i[j]._$interval=g.x.scale(i[j].$interval);for(j=0,k=c.length;k>j;j++)c[j].build&&c[j].build(i,e.filtered,e.data);for(j=0,k=c.length;k>j;j++)c[j].process&&c[j].process(i,e.filtered,e.data);for(j=0,k=c.length;k>j;j++)c[j].finalize&&c[j].finalize(i,e.filtered,e.data)}),g},link:function(b,c){b.box.targetSvg(c),a(b.box,c[0]),b.$watch("model.loading",function(a){a?c.addClass("loading"):c.removeClass("loading")}),b.$watch("model.error",function(a){a?c.addClass("hasError"):c.removeClass("hasError")})},restrict:"A",scope:{box:"=vgraphChart",model:"=model"}}}]),angular.module("vgraph").directive("vgraphClassifier",["ComponentGenerator",function(a){"use strict";function b(a,b,c){var d,e;for(d=c.length-1;d>=0;d--)e=c[d],e.$els.length&&(b(e)?$(e.$els).addClass(a):$(e.$els).removeClass(a))}return a.generate("vgraphClassifier",{scope:{classes:"=classes"},preLink:function(a){a.loadPoint=function(a){var b=this.intervalParse(a),c=this.model.getPoint(b);c&&this.valueParse(a,c)}},link:function(a,c,d,e){var f=e[0];f.register({finalize:function(c){var d,e,f,g,h=a.classes,i=Object.keys(h);for(d=0,e=i.length;e>d;d++)f=i[d],g=h[f],b(f,g,c)}})}})}]),angular.module("vgraph").directive("vgraphCompare",["$compile","ComponentGenerator",function(a,b){"use strict";return{require:["^vgraphChart"],scope:{config:"=config"},link:function(c,d,e,f){function g(d){var e,f;if(d&&d.length>1){for(d3.select(m).selectAll("path").remove();k.length;)k.pop().$destroy();f=b.compileConfig(c,d,"line"),h=f[0],h.calc=b.makeLineCalc(l,d[0].name),i=f[1],i.calc=b.makeLineCalc(l,d[1].name),j={$d3:d3.select(m).append("path").attr("class","fill "+d[0].className+"-"+d[1].className),calc:b.makeFillCalc(l,d[0].name,d[1].name)},m.appendChild(h.element),m.appendChild(i.element),e=c.$new(),k.push(e),a(h.element)(e),a(i.element)(e)}}var h,i,j,k=[],l=f[0],m=d[0];c.$watchCollection("config",g),l.register({parse:function(a){var b,c,d,e,f,g,j;for(b=0,c=a.length;c>b;b++)d=a[b],e=d[h.name],f=d[i.name],d.$compare={middle:(e+f)/2,difference:Math.abs(e-f)},f>e?void 0===g?(g=e,j=f):(g>e&&(g=e),f>j&&(j=f)):void 0===g?(g=f,j=e):(g>f&&(g=f),e>j&&(j=e));return{min:g,max:j}},finalize:function(a){h.$d3.attr("d",h.calc(a)),i.$d3.attr("d",i.calc(a)),j.$d3.attr("d",j.calc(a))}})}}}]),angular.module("vgraph").directive("vgraphError",[function(){"use strict";return{require:["^vgraphChart"],link:function(a,b,c,d){var e=d[0],f=e.box,g=d3.select(b[0]).attr("class","error-view"),h=g.append("rect").attr("class","outline"),i=g.append("text");a.model=e.model,a.box=f,f.register(function(){if(f.innerHeight){h.attr("transform","translate("+f.innerLeft+","+f.innerTop+")").attr("width",f.innerWidth).attr("height",f.innerHeight);try{i.attr("text-anchor","middle").attr("x",f.center).attr("y",f.middle+i.node().getBBox().height/2)}catch(a){i.attr("text-anchor","middle").attr("x",f.center).attr("y",f.middle)}}}),a.$watch("model.error",function(a){a?(g.attr("visibility","visible"),i.text(a)):g.attr("visibility","hidden")})}}}]),angular.module("vgraph").directive("vgraphFeed",["ComponentGenerator",function(a){"use strict";return a.generate("vgraphFeed",{restrict:"A"})}]),angular.module("vgraph").directive("vgraphFill",["ComponentGenerator",function(a){"use strict";return a.generate("vgraphFill",{link:function(b,c,d,e){var f=e[0],g=d.name,h=d3.select(c[0]).append("path").attr("class","fill plot-"+g),i=d3.svg.area().defined(function(a){var b=a[g];return!(isNaN(b)||null===b)}).x(function(a){return f.x.scale(a.$interval)}).y(function(a){return f.y.scale(a[g])}).y1(function(){return f.y.scale(void 0===b.fillTo?f.model.y.bottom:"object"==typeof b.fillTo?b.fillTo.$min:b.fillTo)});f.register({parse:function(b){return a.parseLimits(b,g)},finalize:function(a){h.attr("d",i(a))}})},scope:{data:"=vgraphFill",fillTo:"=fillTo",value:"=value",interval:"=interval",filter:"=filter"}})}]),angular.module("vgraph").directive("vgraphFocus",[function(){"use strict";return{require:["^vgraphChart"],link:function(a,b,c,d){var e=d[0],f=e.box,g=d3.select(b[0]),h=g.append("rect").attr("class","focus").attr("visibility","hidden");f.register(function(){h.attr("height",f.innerHeight).attr("y",f.innerTop)}),a.$watch("follow",function(a){var b,c,d;a&&void 0!==a.xDiff&&(b=Math.abs(a.xDiff),c=a.x0-b,d=a.x0+b,h.attr("visibility","visible"),c>f.innerLeft?h.attr("x",c):(c=f.innerLeft,h.attr("x",f.innerLeft)),d>f.innerRight?h.attr("width",f.innerRight-c):h.attr("width",d-c))}),a.$watch("stop",function(b){var c,d,g,i,j,k=e.model;b&&k.filtered&&(d=k.filtered.$first,c=k.filtered.$last-d,h.attr("visibility","hidden"),g=Math.abs(b.xDiff),g>5&&(i=b.x0-g,j=b.x0+g,i<f.innerLeft?i=0:i-=f.innerLeft,j>f.innerRight?j=f.innerWidth:j-=f.innerLeft,k.setPane({start:"="+(k.x.start.$x+i/f.innerWidth*(k.x.stop.$x-k.x.start.$x)),stop:"="+(k.x.start.$x+j/f.innerWidth*(k.x.stop.$x-k.x.start.$x))},{start:null,stop:null}),k.adjust(a)))})},scope:{follow:"=vgraphFocus",stop:"=loseFocus"}}}]),angular.module("vgraph").directive("vgraphIcon",["ComponentGenerator",function(a){"use strict";return a.generate("vgraphIcon",{scope:{getValue:"=trueValue"},link:function(b,c,d,e){var f,g,h,i=e[0],j=c[0],k=d.name,l=[],m=d3.select(j),n=m.node().getBBox();for(void 0===d.value&&(b.value=k),f=0,g=j.childNodes.length;g>f;f++)1===j.childNodes[f].nodeType&&l.push(j.childNodes[f]);c.html(""),i.register({parse:function(b,c){return h=[],a.parseLimits(c,k,function(a,b){b&&h.push(a)})},build:function(){function a(){return this.appendChild(l[g].cloneNode(!0))}var e,f,g,j;c.html(""),angular.forEach(h,function(c){var h;for(e=c.$sampled._$interval,f=i.y.scale(b.getValue(c.$sampled)),h=m.append("g"),g=0,j=l.length;j>g;g++)h.select(a);d.showUnder?h.attr("transform","translate("+(e-n.width/2)+","+f+")"):h.attr("transform","translate("+(e-n.width/2)+","+(f-n.height)+")")})}})}})}]),angular.module("vgraph").directive("vgraphIndicator",[function(){"use strict";return{require:["^vgraphChart"],scope:{model:"=model"},link:function(a,b,c,d){var e,f=d[0],g=c.vgraphIndicator,h=f.model,i=a.$eval(c.pointRadius)||3,j=a.$eval(c.outerRadius),k=d3.select(b[0]).attr("transform","translate(1000,1000)"),l=k.append("circle").attr("class","point inner").attr("r",i).attr("visibility","hidden"),m=k.append("circle").attr("class","point outer").attr("r",i).attr("visibility","hidden");j&&(e=function(){m.transition().duration(1e3).attr("r",j).transition().duration(1e3).attr("r",i).ease("sine").each("end",function(){setTimeout(function(){e()},3e3)})})(),f.register({finalize:function(){var a,b,c;h.plots[g]?(a=h.plots[g].x.max,h.point.isValid(a)&&a[g]?(b=f.x.scale(a.$interval),c=f.y.scale(a["$"+g]||a[g]),l.attr("visibility","visible"),m&&m.attr("visibility","visible"),k.transition().duration(h.transitionDuration).ease("linear").attr("transform","translate("+b+","+c+")")):(l.attr("visibility","hidden"),m&&m.attr("visibility","hidden"))):(l.attr("visibility","hidden"),m&&m.attr("visibility","hidden"))}})}}}]),angular.module("vgraph").directive("vgraphInteract",[function(){"use strict";function a(a,b,c,d){var e,f,g=0,h=a.length-1;if(d||a.sort(function(a,b){return c(a)-c(b)}),c(a[g])>=b)return{left:g,right:g};if(c(a[h])<=b)return{left:h,right:h};if(a.length){for(;h-g>1;)e=Math.floor((h+g)/2),f=c(a[e]),f===b?(h=e,g=e):f>b?h=e:g=e;return h!==e&&c(a[h])===b?{left:h,right:h}:g!==e&&c(a[g])===b?{left:g,right:g}:{left:g,right:h}}}function b(b,c){var d=a(b,c,function(a){return a.$interval},!0),e=c-b[d.left].$interval,f=b[d.right].$interval-c;return f>e?d.left:d.right}return{require:["^vgraphChart"],scope:{highlight:"=vgraphInteract",dragStart:"=?dBegin",dragPos:"=?dChange",dragStop:"=?dEnd"},link:function(a,c,d,e){function f(b,c){clearTimeout(j),a.$apply(function(){var d=d3.mouse(b);a.highlight.point&&$(a.highlight.point.$els).removeClass("active"),a.highlight.point=c,a.highlight.position={x:d[0],y:d[1]},c&&$(c.$els).addClass("active")})}function g(){j=setTimeout(function(){a.$apply(function(){a.highlight.point&&$(a.highlight.point.$els).removeClass("active"),a.highlight.point=null})},100)}var h,i,j,k=e[0],l=!1,m=k.model,n=k.box,o=d3.select(c[0]),p=o.append("rect").style("opacity","0").attr("class","focal").on("mousemove",function(){var a,c;l||(a=k.x.scale.invert(d3.mouse(this)[0]),c=b(h,a),f(this,h[c]))}).on("mouseout",function(a){l||g(this,a)});o.attr("class","interactive"),o.call(d3.behavior.drag().on("dragstart",function(){i=d3.mouse(c[0]),l=!0,g(),a.dragStart={x:i[0],y:i[1]},a.$apply()}).on("dragend",function(){var b=d3.mouse(c[0]);l=!1,a.dragStop={x0:i[0],y0:i[1],x1:b[0],x2:b[1],xDiff:b[0]-i[0],yDiff:b[1]-i[1]},a.$apply()}).on("drag",function(){var b=d3.mouse(c[0]);a.dragPos={x0:i[0],y0:i[1],x1:b[0],x2:b[1],xDiff:b[0]-i[0],yDiff:b[1]-i[1]},a.$apply()})),o.on("dblclick",function(){m.setPane({start:null,stop:null},{start:null,stop:null}),m.adjust()}),k.register({build:function(){},finalize:function(a){h=a,p.attr({x:n.innerLeft,y:n.innerTop,width:n.innerWidth,height:n.innerHeight})}}),a.highlight||(a.highlight={}),a.dragStart||(a.dragStart={}),a.dragPos||(a.dragPos={}),a.dragStop||(a.dragStop={})}}}]),angular.module("vgraph").directive("vgraphLeading",[function(){"use strict";return{require:["^vgraphChart"],scope:{config:"=config"},link:function(a,b,c,d){function e(a){var b,c,d;if(f={},h.selectAll("line").remove(),a)for(c=0,d=a.length;d>c;c++)b=a[c],f[b.name]=h.append("line").attr("class",b.className)}var f,g=d[0],h=d3.select(b[0]);a.$watchCollection("config",e),g.register({finalize:function(){var a,b,c=g.model,d=[];angular.forEach(f,function(b,e){c.plots[e]&&(a=c.plots[e].x.max,c.point.isValid(a)&&a[e]&&d.push({el:b,x:g.x.scale(a.$interval),y:g.y.scale(a["$"+e]||a[e])}))}),d.sort(function(a,b){return a.y-b.y}),angular.forEach(d,function(a){b&&b.el.attr("x1",b.x).attr("x2",a.x).attr("y1",b.y).attr("y2",a.y),b=a
}),b?(h.style("visibility","visible"),b.el.attr("x1",b.x).attr("x2",b.x).attr("y1",b.y).attr("y2",g.box.innerBottom)):h.style("visibility","hidden")}})}}}]),angular.module("vgraph").directive("vgraphLine",["ComponentGenerator",function(a){"use strict";return a.generate("vgraphLine",{link:function(b,c,d,e){var f=e[0],g=d.name,h=d3.select(c[0]).append("path").attr("class","line plot-"+g),i=a.makeLineCalc(f,g);f.register({parse:function(b){return a.parseLimits(b,g)},finalize:function(a){var b;h.attr("d",i(a.filter(function(c,d){var e,f=b;return b=c[g],f!==b?!0:(e=a[d+1],!e||e[g]!==b)})))}})}})}]),angular.module("vgraph").directive("vgraphLoading",["$interval",function(a){"use strict";return{require:["^vgraphChart"],link:function(b,c,d,e){function f(){n||(n=!0,a.cancel(i),h(),i=a(h,4005))}function g(){n=!1,a.cancel(i)}function h(){s.attr("x",function(){return j}).attr("width",function(){return 0}).transition().duration(1e3).attr("x",function(){return j}).attr("width",function(){return k}).ease("sine").transition().duration(1e3).attr("width",0).attr("x",function(){return l}).ease("sine").transition().duration(1e3).attr("width",function(){return k}).attr("x",function(){return j}).ease("sine").transition().duration(1e3).attr("x",function(){return j}).attr("width",0).ease("sine")}var i,j,k,l,m=e[0],n=!1,o=m.box,p=d.vgraphLoading,q=d3.select(c[0]).attr("class","loading-view"),r=q.append("rect").attr("height",20).attr("class","outline"),s=q.append("rect").attr("width",0).attr("height",20).attr("class","filling"),t=q.append("text").text(p);b.model=m.model,o.register(function(){if(j=o.innerLeft+o.innerWidth/5,k=3*o.innerWidth/5,l=j+k,k){s.attr("x",j).attr("y",o.middle-10),r.attr("x",j).attr("y",o.middle-10).attr("width",k);try{t.attr("text-anchor","middle").attr("x",o.center).attr("y",o.middle+t.node().getBBox().height/2-2)}catch(a){t.attr("text-anchor","middle").attr("x",o.center).attr("y",o.middle)}f()}else g()}),b.$on("$destroy",function(){g()}),b.$watch("model.loading",function(a){g(),a&&b.box.ratio&&f()})}}}]),angular.module("vgraph").directive("vgraphMultiIndicator",["$compile",function(a){"use strict";return{scope:{config:"=config"},link:function(b,c,d){function e(c){var e,h,i,j,k,l,m,n,o=b.$eval(d.pointRadius)||3,p=b.$eval(d.outerRadius),q="";if(c){for(d3.select(g).selectAll("g").remove();f.length;)f.pop().$destroy();for(i=0,j=c.length;j>i;i++)n=c[i],m=n.name,k=n.className?n.className:"plot-"+m,q+='<g class="'+k+'" vgraph-indicator="'+m+'"'+(p?' outer-radius="'+p+'"':"")+' point-radius="'+o+'"></g>';for(l=(new DOMParser).parseFromString('<g xmlns="http://www.w3.org/2000/svg">'+q+"</g>","image/svg+xml").childNodes[0].childNodes;l.length;)h=l[0],g.appendChild(h),e=b.$new(),f.push(e),a(h)(e)}}var f=[],g=c[0];b.$watchCollection("config",e)}}}]),angular.module("vgraph").directive("vgraphMultiLine",["$compile","ComponentGenerator",function(a,b){"use strict";return{require:["^vgraphChart"],scope:{data:"=vgraphMultiLine",config:"=config"},link:function(c,d,e,f){function g(d){var e,f,g,m;if(i=[],d){for(d3.select(l).selectAll("path").remove();j.length;)j.pop().$destroy();for(h=b.compileConfig(c,d,"line"),f=0,g=h.length;g>f;f++)m=h[f],l.appendChild(m.element),m.calc=b.makeLineCalc(k,m.name),i.push(m.name),e=c.$new(),j.push(e),a(m.element)(e)}}var h,i,j=[],k=f[0],l=d[0];c.$watchCollection("config",g),k.register({parse:function(a){return b.parseLimits(a,i)},finalize:function(a){var b,c,d;for(b=0,c=h.length;c>b;b++)d=h[b],d.$d3.attr("d",d.calc(a))}})}}}]),angular.module("vgraph").directive("vgraphMultiTooltip",["$compile",function(a){"use strict";return{scope:{config:"=config",formatter:"=textFormatter",data:"=vgraphMultiTooltip"},link:function(b,c,d){function e(c){var e,h,i,j,k,l,m,n,o="";if(c){for(d3.select(g).selectAll("g").remove();f.length;)f.pop().$destroy();for(i=0,j=c.length;j>i;i++)n=c[i],m=n.name,k=n.className?n.className:"plot-"+m,o+='<g class="'+k+'" vgraph-tooltip="data" name="'+m+'" text-formatter="formatter"'+(d.offseX?' offset-x="'+d.offsetX+'"':"")+(d.offseY?' offset-y="'+d.offsetY+'"':"")+"></g>";for(l=(new DOMParser).parseFromString('<g xmlns="http://www.w3.org/2000/svg">'+o+"</g>","image/svg+xml").childNodes[0].childNodes;l.length;)h=l[0],g.appendChild(h),e=b.$new(),f.push(e),a(h)(e)}}var f=[],g=c[0];b.$watchCollection("config",e)}}}]),angular.module("vgraph").directive("vgraphStack",["$compile","ComponentGenerator",function(a,b){"use strict";return{require:["^vgraphChart"],scope:{config:"=config"},link:function(c,d,e,f){function g(d){var e,f,g,l;if(d){for(d3.select(k).selectAll("path").remove(),h=b.compileConfig(c,d,"fill");i.length;)i.pop().$destroy();for(f=0,g=h.length;g>f;f++)l=h[f],l.$valueField="$"+l.name,f?(k.insertBefore(l.element,h[f-1].element),l.$bottom=h[f-1].$valueField,l.calc=b.makeFillCalc(j,l.$valueField,l.$bottom)):(k.appendChild(l.element),l.calc=b.makeFillCalc(j,l.$valueField)),e=c.$new(),i.push(e),a(l.element)(e)}}var h,i=[],j=f[0],k=d[0];c.$watchCollection("config",g),j.register({parse:function(a){return b.parseStackedLimits(a,h)},finalize:function(a){var b,c,d;for(b=0,c=h.length;c>b;b++)d=h[b],d.$d3.attr("d",d.calc(a))}})}}}]),angular.module("vgraph").directive("vgraphTarget",[function(){"use strict";return{require:["^vgraphChart"],scope:{target:"=vgraphTarget",pointRadius:"=pointRadius",config:"=?config"},link:function(a,b,c,d){function e(a){var b,c;if(f={},a)for(b=0,c=a.length;c>b;b++)f[a[b].name]=a[b].className}var f,g=d[0],h=g.model,i=g.box,j=d3.select(b[0]).attr("class","target"),k=j.append("line").attr("class","focus").attr("x1",0).attr("x2",0),l=j.append("g");i.register(function(){k.attr("y1",i.innerTop).attr("y2",i.innerBottom)}),a.$watch("target.point",function(b){var d,e;if(b&&void 0===c.noDots){l.selectAll("circle.point").remove(),j.style("visibility","visible").attr("transform","translate( "+g.x.scale(b.$interval)+" , 0 )");for(d in h.plots)b[d]&&(e=f[d]||"plot-"+d,l.append("circle").attr("class","point "+e).attr("x",0).attr("cy",g.y.scale(b[d])).attr("r",a.$eval(c.pointRadius)||3))}else j.style("visibility","hidden")}),a.$watchCollection("config",e)}}}]),angular.module("vgraph").directive("vgraphTooltip",[function(){"use strict";return{require:["^vgraphChart"],scope:{formatter:"=textFormatter",data:"=vgraphTooltip",value:"=?value"},link:function(a,b,c,d){var e=d[0],f=c.name,g=e.model,h=a.formatter||function(a){return g.y.format(g.y.parse(a))},i=parseInt(c.offsetX)||0,j=parseInt(c.offsetY)||0,k=d3.select(b[0]).attr("class","tooltip"),l=k.append("polygon").attr("class","outline").attr("transform","translate(0,-15)"),m=k.append("text").style("line-height","20").style("font-size","16").attr("class","label");a.$watch("data.point",function(b){var c,d,n,o;b&&(c=a.value?a.value(b):b[f],void 0!==c&&(d=e.y.scale(c),n=e.x.scale(b.$interval)+i,m.text(h(c,b)),o=m.node().getComputedTextLength()+5,k.style("visibility","visible"),n+o+16<e.x.scale(g.x.stop.$interval)?(k.attr("transform","translate("+n+","+(d+j)+")"),m.attr("transform","translate(10,5)"),l.attr("points","0,15 10,0 "+(o+10)+",0 "+(o+10)+",30 10,30 0,15")):(k.attr("transform","translate("+(n-2*i-o-10)+","+(d+j)+")"),m.attr("transform","translate(5,5)"),l.attr("points","0,0 "+o+",0 "+(o+10)+",15 "+o+",30 0,30 0,0")))),void 0===c&&k.style("visibility","hidden")})}}}]),angular.module("vgraph").directive("vgraphZone",["ComponentGenerator",function(a){"use strict";return a.generate("vgraphZone",{link:function(a,b,c,d){var e=d[0],f=c.name,g=d3.select(b[0]).append("path").attr("class","line plot-"+f),h=d3.svg.area().defined(function(a){return a[f]===!0}).x(function(a){return e.x.scale(a.$interval)}).y(function(){return e.box.innerTop}).y1(function(){return e.box.innerBottom});e.register({finalize:function(a){g.attr("d",h(a))}})}})}]),angular.module("vgraph").directive("vgraphZoom",[function(){"use strict";return{require:["^vgraphChart"],link:function(a,b,c,d){function e(b){0===g&&h===l.innerWidth?(n=!1,s.attr("class","focus")):(n=!0,s.attr("class","focus zoomed")),0>g&&(g=0),h>l.innerWidth&&(h=l.innerWidth),g>h?g=h:g>h&&(h=g),p.attr("transform","translate("+g+",0)"),q.attr("transform","translate(-"+g+",0 )").attr("width",g),t.attr("transform","translate("+h+",0)"),u.attr("width",l.innerWidth-h),s.attr("transform","translate("+g+",0)").attr("width",h-g),b||a.$apply(function(){var b=a.model;b.setPane({start:"%"+g/l.innerWidth,stop:"%"+h/l.innerWidth},{start:null,stop:null}),b.adjust(a)})}var f,g,h,i,j,k=d[0],l=k.box,m=!1,n=!1,o=d3.select(b[0]),p=o.append("g").attr("class","left-control min-control"),q=p.append("rect").attr("class","shade"),r=p.append("g").attr("class","control"),s=o.append("rect").attr("class","focus"),t=o.append("g").attr("class","right-control max-control"),u=t.append("rect").attr("class","shade"),v=t.append("g").attr("class","control");r.append("path").attr("d","M-0.5,23.33A6,6 0 0 0 -6.5,29.33V40.66A6,6 0 0 0 -0.5,46.66ZM-2.5,31.33V38.66M-4.5,31.33V38.66").attr("transform","translate(0,-9)").attr("class","nub"),i=r.append("rect").attr("width","10").attr("transform","translate(-10,0)"),v.append("path").attr("d","M0.5,23.33A6,6 0 0 1 6.5,29.33V40.66A6,6 0 0 1 0.5,46.66ZM2.5,31.33V38.66M4.5,31.33V38.66").attr("transform","translate(0,-9)").attr("class","nub"),j=v.append("rect").attr("width","10"),a.box=l,i.call(d3.behavior.drag().on("dragstart",function(){m=!0}).on("dragend",function(){m=!1}).on("drag",function(){g=d3.mouse(b[0])[0],e()})),j.call(d3.behavior.drag().on("dragstart",function(){m=!0}).on("dragend",function(){m=!1}).on("drag",function(){h=d3.mouse(b[0])[0],e()})),s.call(d3.behavior.drag().on("dragstart",function(){f={mouse:d3.mouse(b[0])[0],minPos:g,maxPos:h,min:a.model.x.start.$x,max:a.model.x.stop.$x},m=!0}).on("dragend",function(){m=!1,n=!0}).on("drag",function(){var a=d3.mouse(b[0]),c=a[0]-f.mouse;n?(h=f.maxPos+c,g=f.minPos+c,e()):c>5&&(h=f.mouse+Math.abs(c),g=f.mouse-Math.abs(c),e(),n=!1)})),o.on("dblclick",function(){h=l.innerWidth,g=0,e()}),l.register(function(){o.attr("width",l.innerWidth).attr("height",l.innerHeight).attr("transform","translate("+l.innerLeft+","+l.innerTop+")"),q.attr("height",l.innerHeight),u.attr("height",l.innerHeight),i.attr("height",l.innerHeight),j.attr("height",l.innerHeight),s.attr("height",l.innerHeight)}),a.model.register(function(){var b,c,d,f=a.model;m||(b=f.x,c=void 0===a.min?b.$min:a.min,d=void 0===a.max?b.$max:a.max,g=(b.start.$x-c)/(d-c)*l.innerWidth,h=(b.stop.$x-c)/(d-c)*l.innerWidth,e(!0))})},scope:{model:"=vgraphZoom",min:"=zoomMin",max:"=zoomMax"}}}]),function(a){"use strict";var b=/\S+/g,c=/[\t\r\n\f]/g;a&&(a.fn.addClass=function(d){var e,f,g,h,i,j,k,l="string"==typeof d&&d,m=0,n=this.length;if(a.isFunction(d))return this.each(function(b){a(this).addClass(d.call(this,b,this.className))});if(l)for(e=(d||"").match(b)||[];n>m;m++)if(f=this[m],k="string"!=typeof f.className,g=1===f.nodeType&&(f.className?(" "+(k?f.getAttribute("class")||"":f.className)+" ").replace(c," "):" ")){for(i=0;h=e[i++];)g.indexOf(" "+h+" ")<0&&(g+=h+" ");j=a.trim(g),f.className!==j&&(k?f.setAttribute("class",j):f.className=j)}return this},a.fn.removeClass=function(d){var e,f,g,h,i,j,k,l=0===arguments.length||"string"==typeof d&&d,m=0,n=this.length;if(a.isFunction(d))return this.each(function(b){a(this).removeClass(d.call(this,b,this.className))});if(l)for(e=(d||"").match(b)||[];n>m;m++)if(f=this[m],k="string"!=typeof f.className,g=1===f.nodeType&&(f.className?(" "+(k?f.getAttribute("class")||"":f.className)+" ").replace(c," "):"")){for(i=0;h=e[i++];)for(;g.indexOf(" "+h+" ")>=0;)g=g.replace(" "+h+" "," ");j=d?a.trim(g):"",f.className!==j&&(k?f.setAttribute("class",j):f.className=j)}return this})}(jQuery);
//# sourceMappingURL=vgraph.min.js.map