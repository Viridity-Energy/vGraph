angular.module("vgraph",[]),angular.module("vgraph").factory("BoxModel",[function(){"use strict";function a(a){this.registrations=[],this.extend(a||{})}function b(a,b){return void 0!==a?parseInt(a):b}return a.prototype.register=function(a){this.ratio&&a(),this.registrations.push(a)},a.prototype.extend=function(a){var c,d,e=a.padding,f=this.padding,g=a.margin,h=this.margin;for(h||(this.margin=h={top:0,right:0,bottom:0,left:0}),g&&(h.top=b(g.top,h.top),h.right=b(g.right,h.right),h.bottom=b(g.bottom,h.bottom),h.left=b(g.left,h.left)),f||(this.padding=f={top:0,right:0,bottom:0,left:0}),e&&(f.top=b(e.top,f.top),f.right=b(e.right,f.right),f.bottom=b(e.bottom,f.bottom),f.left=b(e.left,f.left)),this.outerWidth=b(a.outerWidth,this.outerWidth)||0,this.outerHeight=b(a.outerHeight,this.outerHeight)||0,this.top=h.top,this.bottom=this.outerHeight-h.bottom,this.left=h.left,this.right=this.outerWidth-h.right,this.center=(this.left+this.right)/2,this.middle=(this.top+this.bottom)/2,this.width=this.right-this.left,this.height=this.bottom-this.top,this.innerTop=this.top+f.top,this.innerBottom=this.bottom-f.bottom,this.innerLeft=this.left+f.left,this.innerRight=this.right-f.right,this.innerWidth=this.innerRight-this.innerLeft,this.innerHeight=this.innerBottom-this.innerTop,this.ratio=this.outerWidth+" x "+this.outerHeight,c=0,d=this.registrations.length;d>c;c++)this.registrations[c]()},a}]),angular.module("vgraph").factory("GraphModel",[function(){"use strict";function a(a,b){return a[e(a,b,1)-1]}function b(a,b){return{$x:b,$interval:a.makeInterval(b)}}function c(a){a||(a={}),a.x||(a.x={}),a.y||(a.y={}),this.queued=null,this.construct(),this.reset(a)}var d=0,e=d3.bisector(function(a){return a.$interval}).left;return c.prototype.construct=function(){var a=this;this.$modelId=d++,this.registrations=[],this.point={reset:function(a){a.$x=null,a.$y=null},isValid:function(b){var c;return void 0===a.x.start?!0:(c=b.$x,a.x.start.$x<=c&&c<=a.x.stop.$x)}}},c.prototype.reset=function(a){this.data=[],this.lookUp={},this.plots={},this.plotNames=[],this.filtered=null,this.needSort=!1,this.ratio=null,this.transitionDuration=30,this.setStatus("loading"),this.config(a||this)},c.prototype.setBounds=function(a,b){return a&&(void 0!==a.min&&(this.x.$min=a.min),void 0!==a.max&&(this.x.$max=a.max)),b&&(void 0!==b.min&&(this.y.$min=b.min),void 0!==b.max&&(this.y.$max=b.max)),this},c.prototype.setPane=function(a,b){return a&&(void 0!==a.start&&(this.x.start=a.start),void 0!==a.stop&&(this.x.stop=a.stop)),b&&(void 0!==b.start&&(this.y.start=b.start),void 0!==b.stop&&(this.y.stop=b.stop)),this},c.prototype.config=function(a){var b=this;this.x={$min:null,$max:null,massage:a.x.massage||null,padding:a.x.padding||0,scale:a.x.scale||function(){return d3.scale.linear()},disp:a.x.display||function(a){return a.$interval},simplify:a.x.simplify||function(a){return a.$x},parse:a.x.parse||function(a){return a.$interval},format:a.x.format||d3.format("03d"),tick:a.x.tick||{}},this.y={$min:null,$max:null,massage:a.y.massage||null,padding:a.y.padding||0,scale:a.y.scale||function(){return d3.scale.linear()},disp:a.y.display||function(a,c){return b.y.parse(a,c)},simplify:a.y.simplify||function(a){return b.y.parse(a)},parse:a.y.parse||function(a,b){return void 0===a||null===a?null:a[b]},format:a.y.format||d3.format(",.2f"),tick:a.y.tick||{}},this.setPane(a.x,a.y)},c.prototype.makeInterval=function(a){return a},c.prototype.addPoint=function(a,b,c){var d,e,f=this.data,g=parseFloat(c);return this.x.massage&&(b=this.x.massage(b)),this.y.massage&&(c=this.y.massage(b)),b||0===b?(e=this.lookUp[b],e?isFinite(g)&&((void 0===e.$min||g<e.$min)&&(e.$min=g),(void 0===e.$max||g>e.$max)&&(e.$max=g)):(e={$interval:this.makeInterval(b),$x:+b},isFinite(g)&&(e.$min=g,e.$max=g),this.lookUp[b]=e,f.length&&f[f.length-1].$x>b&&(this.needSort=!0),this.data.push(e)),this.x.min||(this.x.min=e,this.x.max=e),!this.y.min&&isFinite(g)&&(this.y.min=e,this.y.max=e),d=this.plots[a],d?(d.x.max.$x<e.$x?(d.x.max=e,this.x.max.$x<e.$x&&(this.x.max=e)):d.x.min.$x>e.$x&&(d.x.min=e,e.$x<this.x.min.$x&&(this.x.min=e)),isFinite(g)&&(d.y.max.$max<e.$max?(d.y.max=e,this.y.max.$max<e.$max&&(this.y.max=e)):d.y.min.$min>e.$min&&(d.y.min=e,this.y.min.$min>e.$min&&(this.y.min=e)))):(this.plots[a]=d={x:{min:e,max:e},y:{min:e,max:e}},this.x.max.$x<e.$x?this.x.max=e:e.$x<this.x.min.$x&&(this.x.min=e),isFinite(g)&&(this.y.max.$max<e.$max?this.y.max=e:this.y.min.$min>e.$min&&(this.y.min=e))),e[a]=c,e):void 0},c.prototype.setError=function(a){this.setStatus("error",a)},c.prototype.setStatus=function(a,b){"error"===a?(this.loaded=!1,this.loading=!1,this.error=b,this.message=null):"loaded"===a?(this.loaded=!0,this.loading=!1,this.error=null,this.message=b):"updating"===a?(this.loaded=!0,this.loading=!0,this.error=null,this.message=b):(this.loaded=!1,this.loading=!0,this.error=null,this.message=b),this.status=a},c.prototype.addPlot=function(a,b,c,d){var e,f,g;if(!this.plots[a])for(e=0,f=b.length;f>e;e++)g=b[e],this.addPoint(a,c(g),d(g))},c.prototype.removePlot=function(a){var b,c,d,e,f,g,h,i,j=this.plots[a];if(j){for(delete this.plots[a],h=Object.keys(this.plots),b=0,c=this.data.length;c>b;b++){if(i=this.data[b],i.$max===i[a]){for(f=void 0,d=0,e=h.length;e>d;d++)g=i[h[d]],"number"==typeof g&&(void 0===f||g>f)&&(f=g);i.$max=f}if(i.$min===i[a]){for(f=void 0,d=0,e=h.length;e>d;d++)g=i[h[d]],"number"==typeof g&&(void 0===f||f>g)&&(f=g);i.$min=f}i[a]=null}if(this.x.min=null,this.x.max=null,this.y.min=null,this.y.max=null,h.length)for(this.x.min=this.plots[h[0]].x.min,this.x.max=this.plots[h[0]].x.max,this.y.min=this.plots[h[0]].y.min,this.y.max=this.plots[h[0]].y.max,b=1,c=h.length;c>b;b++)g=h[b],i=this.plots[g],i.min&&i.min.$x<this.x.min.$x?this.x.min=i.min:i.max&&this.x.max.$x<i.max.$x&&(this.x.max=i.max),i.min&&i.min.$min<this.y.min.$min?this.y.min=i.min:i.max&&this.y.max.$max<i.max.$max&&(this.y.max=i.max)}},c.prototype.dataReady=function(a){var b=this;clearTimeout(this.queued),this.queued=setTimeout(function(){b.adjusting||b.adjust(a)},15)},c.prototype.findExtemesY=function(a){var b,c,d,e,f;for(c=0,d=a.length;d>c;c++)b=a[c],(b.$min||0===b.$min)&&(void 0===e?e=b:b.$min<e.$min&&(e=b)),(b.$max||0===b.$max)&&(void 0===f?f=b:b.$max>f.$max&&(f=b));return{min:e,max:f}},c.prototype.register=function(a){this.registrations.push(a)},c.prototype.adjust=function(c){var d,e,f,g,h,i,j,k,l=!1,m=this,n=this.data,o=this.x,p=this.y;n.length&&(this.nexAdjust=function(){this.adjusting=!0,this.error=!1,this.needSort&&this.data.sort(function(a,b){return a.$x-b.$x});try{if(null===o.$min&&(o.$min=o.min.$x),null===o.$max)o.$max=o.max.$x;else if("string"==typeof o.$max){if("+"!==o.$max.charAt(0))throw"I gotz nothing";o.$max=parseInt(o.$max.substring(1),10)+o.$min}if("number"==typeof o.start)o.start=this.data[o.start];else{if(o.start)if("string"==typeof o.start)if(l=!0,"%"===o.start.charAt(0))j=o.$min+parseFloat(o.start.substring(1),10)*(o.$max-o.$min);else if("+"===o.start.charAt(0))j=o.$min+parseInt(o.start.substring(1),10);else{if("="!==o.start.charAt(0))throw"I gotz nothing";j=parseInt(o.start.substring(1),10)}else j=o.start.$x;else l=!0,j=o.$min;o.start=j>o.min.$x&&j<o.max.$x?a(this.data,j):b(this,j)}if("number"==typeof o.stop)o.stop=this.data[o.stop];else{if(o.stop)if("string"==typeof o.stop)if(l=!0,"%"===o.stop.charAt(0))j=o.$min+parseFloat(o.stop.substring(1),10)*(o.$max-o.$min);else if("+"===o.stop.charAt(0))j=o.$min+parseInt(o.stop.substring(1),10);else{if("="!==o.stop.charAt(0))throw"I gotz nothing";j=parseInt(o.stop.substring(1),10)}else j=o.stop.$x;else l=!0,j=o.$max;o.stop=j>o.min.$x&&j<o.max.$x?a(this.data,j):b(this,j)}if(this.filtered=this.data.filter(function(a,b){var c=a.$x;return o.start.$x<=c&&c<=o.stop.$x?(g?h=b:g=b,a.$inPane=!0,!0):(a.$inPane=!1,!1)}),this.filtered.$first=g,this.filtered.$last=h,this.filtered.length?p.start||(l=!0,i=this.findExtemesY(this.filtered),p.start=i.min,p.stop=i.max):(p.start=p.min,p.stop=p.max),o.stop&&o.start&&p.stop&&p.start&&(this.adjustSettings&&this.adjustSettings(o.stop.$x-o.start.$x,p.stop.$max-p.start.$min,this.filtered.$last-this.filtered.$first),this.y.padding&&(k=(this.y.stop.$max-this.y.start.$min)*this.y.padding,(void 0===this.y.start.$shifted||this.y.start.$shifted!==this.y.start.$min)&&(this.y.start={$shifted:this.y.start.$min-k,$min:this.y.start.$min-k}),(void 0===this.y.stop.$shifted||this.y.stop.$shifted!==this.y.stop.$max)&&(this.y.stop={$shifted:this.y.stop.$max+k,$max:this.y.stop.$max+k})),f=n.length+" : "+this.filtered.length,f!==this.ratio||c||l))for(this.ratio=f,d=0,e=this.registrations.length;e>d;d++)this.registrations[d](this)}catch(q){m.setError("Model Failed"),q.message?(console.debug(q.message),console.debug(q.stack)):console.debug(q)}this.adjusting=!1},this.adjustInterval||(this.adjustInterval=setTimeout(function(){m.adjustInterval=null,m.nexAdjust()},30)))},c}]),angular.module("vgraph").directive("vgraphAxis",[function(){"use strict";function a(a,b){return!(a.bottom<b.top||a.top>b.bottom||a.right<b.left||a.left>b.right)}return{require:["^vgraphChart"],link:function(b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=e[0],r=d3.svg.axis(),s="axis",t=q.box,u=q.model,v=0,w=null,x=!0,y=!1,z=parseInt(d.tickLength)||0,A=parseInt(d.tickPadding)||3,B=parseInt(d.tickMargin)||0,C=d3.select(c[0]);switch(k=C.append("g").attr("class","ticks"),o=C.append("g").attr("class","padding"),l=o.append("g").attr("class","tick-marks"),m=o.append("rect").attr("class","tick-margin"),p=C.append("g").attr("class","label-wrap"),d.tickRotation&&(w=parseInt(d.tickRotation,10)%360),d.labelOffset&&(v=b.$eval(d.labelOffset)),d.labelClean&&(x=b.$eval(d.labelClean)),d.labelEndpoints&&(y=b.$eval(d.labelEndpoints)),d.axisLabel&&(n=p.append("text").attr("class","axis-label label").text(b.$eval(d.axisLabel))),f=function(){d.tickMarks?(r.tickValues(b.$eval(d.tickMarks)),h=[]):d.tickCount?(r.ticks(b.$eval(d.tickCount)),h=[]):(r.ticks(10),h=[])},b.orient){case"top":g=function(){var a;C.attr("class",s+" x top").attr("transform","translate("+t.left+","+t.top+")").attr("width",t.width).attr("height",t.padding.top),n&&n.attr("text-anchor","middle").attr("x",t.width/2).attr("y",t.padding.top-v),B&&m.attr("height",B).attr("width",t.innerWidth).attr("x",0).attr("y",-B),l.attr("transform","translate(-"+t.margin.left+",0)"),h&&(r.orient("top").tickFormat(u.x.format).innerTickSize(-t.innerHeight+z+B).outerTickSize(0).tickPadding(A+z+B).scale(q.x.scale),u.x.tick.interval&&r.ticks(u.x.tick.interval,u.x.tick.step),k.attr("transform","translate(-"+t.margin.left+","+t.padding.top+")").call(r),a=C.selectAll("g.axis-cap").data(q.x.scale.domain()),y&&(a.enter().append("g").attr("class",function(a,b){return"axis-cap "+(b?"axis-max":"axis-min")}).append("text"),a.exit().remove(),a.attr("transform",function(a){return"translate("+(q.x.scale(a)-t.margin.left)+",0)"}).select("text").text(function(a){var b=u.x.format(a);return(""+b).match("NaN")?"":b}).attr("dy","-0.25em").attr("y",t.padding.top).attr("text-anchor","middle")),w&&(k.selectAll(".tick text").attr("transform","translate(0,"+k.select(".tick text").attr("y")+") rotate("+w+",0,0)").attr("y","0").style("text-anchor",w%360>0?"end":"start"),a.select("text").attr("transform","rotate("+w+",0,0)").style("text-anchor",b.rotation%360>0?"end":"start")))};break;case"bottom":g=function(){var a;C.attr("class",s+" x bottom").attr("transform","translate("+t.left+","+t.innerBottom+")").attr("width",t.width).attr("height",t.padding.bottom),n&&n.attr("text-anchor","middle").attr("x",t.width/2).attr("y",t.padding.bottom+v),B&&m.attr("height",B).attr("width",t.innerWidth).attr("x",0).attr("y",0),l.attr("transform","translate(-"+t.margin.left+",0)"),h&&(r.orient("bottom").tickFormat(u.x.format).innerTickSize(t.innerHeight+z+B).outerTickSize(0).tickPadding(A+z+B).scale(q.x.scale),u.x.tick.interval&&r.ticks(u.x.tick.interval,u.x.tick.step),k.attr("transform","translate(-"+t.margin.left+","+-t.innerHeight+")").call(r),a=C.selectAll("g.axis-cap").data(q.x.scale.domain()),y&&(a.enter().append("g").attr("class",function(a,b){return"axis-cap "+(b?"axis-max":"axis-min")}).append("text"),a.exit().remove(),a.attr("transform",function(a){return"translate("+(q.x.scale(a)-t.margin.left)+",0)"}).select("text").text(function(a){var b=u.x.format(a);return(""+b).match("NaN")?"":b}).attr("dy","1em").attr("y",0).attr("text-anchor","middle")),w&&(k.selectAll(".tick text").attr("transform",function(){return"translate(0,"+d3.select(this).attr("y")+") rotate("+w+",0,0)"}).attr("y","0").style("text-anchor",w%360>0?"start":"end"),a.select("text").attr("transform","rotate("+w+",0,0)").style("text-anchor",b.rotation%360>0?"start":"end")))};break;case"right":break;case"left":var D;g=function(){C.attr("class",s+" y left").attr("transform","translate("+t.left+","+t.top+")").attr("width",t.padding.left).attr("height",t.height),p.attr("transform","translate("+t.padding.left+","+t.height+") rotate( -90 )"),n&&n.attr("text-anchor","middle").attr("x",t.height/2).attr("y",-v),B&&m.attr("height",t.innerHeight).attr("width",B).attr("x",-B).attr("y",0),l.attr("transform","translate("+t.padding.left+","+-t.top+")"),h&&(r.orient("left").tickFormat(u.y.format).innerTickSize(-(t.innerWidth+z+B)).outerTickSize(0).tickPadding(A+z+B).scale(q.y.scale),u.y.tick.interval&&r.ticks(u.y.tick.interval,u.y.tick.step),k.attr("transform","translate("+(t.padding.left-z-B)+","+-t.top+")").call(r),k.select(".domain").attr("transform","translate("+(z+B)+",0)"),y&&(D=C.selectAll("g.axis-cap").data(q.y.scale.domain()),D.enter().append("g").attr("class",function(a,b){return"axis-cap "+(b?"axis-max":"axis-min")}).append("text"),D.exit().remove(),D.attr("transform",function(a){return"translate(0,"+(q.y.scale(a)-t.margin.top)+")"}).select("text").text(function(a){var b=u.y.format(a);return(""+b).match("NaN")?"":b}).attr("dy",".25em").attr("x",t.padding.left-r.tickPadding()).attr("text-anchor","end")))}}q.register({build:function(){void 0===h&&f(),g()},process:function(){h.length=0,z&&(k.selectAll(".tick text").each(function(a){h.push({el:this,val:a,position:this.getBoundingClientRect()})}),h.sort(function(a,b){var c=a.position.top-b.position.top;return c?c:a.position.left-b.position.left})),x&&(i=C.select(".axis-min text").node(),i&&(i=i.getBoundingClientRect()),j=C.select(".axis-max text").node(),j&&(j=j.getBoundingClientRect()))},finalize:function(){var b,c,d,e,f,g,k={};for(l.selectAll("line").remove(),e=0,f=h.length;f>e;e++)b=!0,c=h[e],d=c.position,x&&i&&(a(d,i)||a(d,j))?(c.el.setAttribute("class","collided"),b=!1):void 0===k.left?(k.left=d.left,k.right=d.right,k.width=d.width,k.top=d.top,k.bottom=d.bottom,k.height=d.height,c.el.setAttribute("class","")):x&&a(d,k)?(c.el.setAttribute("class","collided"),b=!1):(g=!1,d.left<k.left&&(k.left=d.left,g=!0),d.right>k.right&&(k.right=d.right,g=!0),g&&(k.width=k.right-k.left,g=!1),d.top<k.top&&(k.top=d.top,g=!0),d.bottom>k.bottom&&(k.bottom=d.bottom,g=!0),g&&(k.height=k.bottom-k.top),c.el.setAttribute("class",""))}},"axis-"+b.orient)},scope:{orient:"=vgraphAxis",adjust:"=axisAdjust",rotation:"=tickRotation"}}}]),angular.module("vgraph").directive("vgraphChart",[function(){"use strict";return{controller:function(a){var b=[],c=[],d=a.model,e=a.box,f=this;return this.register=function(a,d){b.push(a),c.push(d)},this.model=d,this.box=e,this.x={scale:d.x.scale(),calc:function(a){return f.x.scale(d.x.parse(a))},center:function(){return(f.x.calc(d.x.min)+f.x.calc(d.x.max))/2}},this.y={scale:d.y.scale(),calc:function(a){return f.y.scale(d.y.parse(a))},center:function(){return(f.y.calc(d.y.min)+f.y.calc(d.y.max))/2}},d.register(function(){var a,c,g,h;for(f.x.scale.domain([d.x.start.$interval,d.x.stop.$interval]).range([e.innerLeft,e.innerRight]),f.y.scale.domain([d.y.start.$min,d.y.stop.$max]).range([e.innerBottom,e.innerTop]),h=parseInt(d.filtered.length/e.innerWidth)||1,a=d.filtered.filter(function(a,b){return d.x.start===a||d.x.stop===a||b%h===0}),c=0,g=b.length;g>c;c++)b[c].build&&b[c].build(a,d.filtered,d.data);for(c=0,g=b.length;g>c;c++)b[c].process&&b[c].process(a,d.filtered,d.data);for(c=0,g=b.length;g>c;c++)b[c].finalize&&b[c].finalize(a,d.filtered,d.data)}),f},link:function(a,b){a.box.extend({outerWidth:b.outerWidth(!0),outerHeight:b.outerHeight(!0),margin:{top:b.css("margin-top"),right:b.css("margin-right"),bottom:b.css("margin-bottom"),left:b.css("margin-left")},padding:{top:b.css("padding-top"),right:b.css("padding-right"),bottom:b.css("padding-bottom"),left:b.css("padding-left")}}),b.css("margin","0").css("padding","0").attr("width",a.box.outerWidth).attr("height",a.box.outerHeight).css({width:a.box.outerWidth+"px",height:a.box.outerHeight+"px"}),d3.select(b[0]).insert("rect",":first-child").attr("class","mat").attr("width",a.box.innerWidth).attr("height",a.box.innerHeight).attr("transform","translate("+a.box.innerLeft+","+a.box.innerTop+")"),d3.select(b[0]).insert("rect",":first-child").attr("class","frame").attr("width",a.box.width).attr("height",a.box.height).attr("transform","translate("+a.box.left+","+a.box.top+")"),a.$watch("model.loading",function(a){a?b.addClass("loading"):b.removeClass("loading")}),a.$watch("model.error",function(a){a?b.addClass("hasError"):b.removeClass("hasError")})},restrict:"A",scope:{box:"=vgraphChart",model:"=model"}}}]),angular.module("vgraph").factory("vgraphComponent",function(){"use strict";var a={require:["^vgraphChart"],link:function(a,b,c,d){function e(){a.data&&l&&(k.removePlot(i),j=0,f(a.data),h.model.dataReady(a))}function f(b){var c,d,e=b.length;if(e&&e!==j){for(;e>j;j++)c=a.data[j],d=l(c),void 0!==d&&(n?(o.length>p&&o.shift(),o.push(d),k.addPoint(i,m(c),n(d,o))):k.addPoint(i,m(c),d));k.dataReady(a)}}var g,h=d[0],i=c.name,j=0,k=h.model,l=a.value,m=a.interval,n=a.filter,o=[],p=parseInt(c.memory,10)||10;a.$watch("interval",function(a){m="string"==typeof a?function(b){return b[a]}:a}),a.$watch("value",function(a){"string"==typeof a?(g=c.alias||a,l=function(b){return void 0!==b[a]?b[g]:void 0}):l=a,e()}),a.$watch("data",e),a.$watch("data.length",function(b){b&&l&&f(a.data)})},scope:{data:"=_undefined_",value:"=value",interval:"=interval",filter:"=filter"}};return function(b,c){function d(){}var e;return d.prototype=a,e=new d,e.scope=angular.copy(e.scope),e.scope.data="="+b,angular.forEach(c,function(a,b){var c=e[b];e[b]=c&&angular.isFunction(c)?function(){c.apply(this,arguments),a.apply(this,arguments)}:a}),e}}),angular.module("vgraph").directive("vgraphError",[function(){"use strict";return{require:["^vgraphChart"],link:function(a,b,c,d){var e=d[0],f=e.box,g=d3.select(b[0]).attr("class","error-view"),h=g.append("rect").attr("class","outline"),i=g.append("text");a.model=e.model,a.box=f,f.register(function(){h.attr("transform","translate("+f.innerLeft+","+f.innerTop+")").attr("width",f.innerWidth).attr("height",f.innerHeight),i.attr("text-anchor","middle").attr("x",f.center).attr("y",f.middle+i.node().getBBox().height/2)}),a.$watch("model.error",function(a){a?(g.attr("visibility","visible"),i.text(a)):g.attr("visibility","hidden")})}}}]),angular.module("vgraph").directive("vgraphFill",["vgraphComponent",function(a){"use strict";return a("vgraphFill",{link:function(a,b,c,d){var e=d[0],f=c.name,g=d3.select(b[0]).append("path").attr("class","fill plot-"+f),h=d3.svg.area().defined(function(a){var b=a[f];return!(isNaN(b)||null===b)}).x(function(a){return e.x.scale(a.$interval)}).y(function(a){return e.y.scale(a[f])}).y1(function(){return e.y.scale(void 0===a.fillTo?e.model.y.start.$min:"object"==typeof a.fillTo?a.fillTo.$min:a.fillTo)});e.register({finalize:function(a){g.attr("d",h(a))}})},scope:{data:"=vgraphFill",fillTo:"=fillTo",value:"=value",interval:"=interval",filter:"=filter"}})}]),angular.module("vgraph").directive("vgraphFocus",[function(){"use strict";return{require:["^vgraphChart"],link:function(a,b,c,d){var e=d[0],f=e.box,g=d3.select(b[0]),h=g.append("rect").attr("class","focus").attr("visibility","hidden");f.register(function(){h.attr("height",f.innerHeight).attr("y",f.innerTop)}),a.$watch("follow",function(a){var b,c,d;a&&void 0!==a.xDiff&&(b=Math.abs(a.xDiff),c=a.x0-b,d=a.x0+b,h.attr("visibility","visible"),c>f.innerLeft?h.attr("x",c):(c=f.innerLeft,h.attr("x",f.innerLeft)),d>f.innerRight?h.attr("width",f.innerRight-c):h.attr("width",d-c))}),a.$watch("stop",function(b){var c,d,g,i,j,k=e.model;b&&k.filtered&&(d=k.filtered.$first,c=k.filtered.$last-d,h.attr("visibility","hidden"),g=Math.abs(b.xDiff),g>5&&(i=b.x0-g,j=b.x0+g,i<f.innerLeft?i=0:i-=f.innerLeft,j>f.innerRight?j=f.innerWidth:j-=f.innerLeft,console.log({start:"="+(k.x.start.$x+i/f.innerWidth*(k.x.stop.$x-k.x.start.$x)),stop:"="+(k.x.start.$x+j/f.innerWidth*(k.x.stop.$x-k.x.start.$x))}),k.setPane({start:"="+(k.x.start.$x+i/f.innerWidth*(k.x.stop.$x-k.x.start.$x)),stop:"="+(k.x.start.$x+j/f.innerWidth*(k.x.stop.$x-k.x.start.$x))},{start:null,stop:null}),k.adjust(a)))})},scope:{follow:"=vgraphFocus",stop:"=loseFocus"}}}]),angular.module("vgraph").directive("vgraphIcon",["vgraphComponent",function(a){"use strict";return a("vgraphIcon",{link:function(a,b,c,d){var e,f,g=d[0],h=b[0],i=c.name,j=[],k=d3.select(h),l=parseInt(k.attr("width"),10),m=parseInt(k.attr("height"),10);for(h.removeAttribute("width"),h.removeAttribute("height"),e=0,f=h.childNodes.length;f>e;e++)1===h.childNodes[e].nodeType&&j.push(h.childNodes[e]);b.html(""),g.register({build:function(a,d){function h(){return this.appendChild(j[n].cloneNode())}var n,o,p,q,r,s,t=d;for(b.html(""),e=0,f=t.length;f>e;e++)if(p=t[e],p[i]){for(q=g.x.scale(p.$interval),r=g.y.scale(p[i]),s=k.append("g"),n=0,o=j.length;o>n;n++)s.select(h);c.showUnder?s.attr("transform","translate("+(q-l/2)+","+r+")"):s.attr("transform","translate("+(q-l/2)+","+(r-m)+")")}}})}})}]),angular.module("vgraph").directive("vgraphIndicator",[function(){"use strict";return{require:["^vgraphChart"],link:function(a,b,c,d){var e,f,g=d[0],h=c.vgraphIndicator,i=g.model,j=a.$eval(c.pointRadius)||3,k=a.$eval(c.outerRadius),l=d3.select(b[0]).attr("class","leading").attr("transform","translate(1000,1000)"),m=l.append("circle").attr("class","point inner").attr("r",j).attr("visibility","hidden");k&&(f=l.append("circle").attr("class","point outer").attr("r",j).attr("visibility","hidden"),(e=function(){f.transition().duration(1e3).attr("r",k).transition().duration(1e3).attr("r",j).ease("sine").each("end",e)})()),g.register({finalize:function(){var a,b,c;i.plots[h]?(a=i.plots[h].x.max,i.point.isValid(a)&&a[h]?(b=g.x.scale(a.$interval),c=g.y.scale(a[h]),m.attr("visibility","visible"),f&&f.attr("visibility","visible"),l.transition().duration(i.transitionDuration).ease("linear").attr("transform","translate("+b+","+c+")")):(m.attr("visibility","hidden"),f&&f.attr("visibility","hidden"))):(m.attr("visibility","hidden"),f&&f.attr("visibility","hidden"))}})},scope:{model:"=model"}}}]),angular.module("vgraph").directive("vgraphInteract",[function(){"use strict";return{require:["^vgraphChart"],link:function(a,b,c,d){function e(b,c){clearTimeout(h),a.$apply(function(){var d=d3.mouse(b);a.highlight.point=c,a.highlight.position={x:d[0],y:d[1]}})}function f(){h=setTimeout(function(){a.$apply(function(){a.highlight.point=null})},100)}var g,h,i=d[0],j=!1,k=i.model,l=i.box,m=d3.select(b[0]),n=m.append("rect").style("opacity","0").attr("class","focal").on("mousemove",function(){var a,b;j||(a=i.x.scale.invert(d3.mouse(this)[0]),b=o(k.data,a,1),e(this,k.data[b]))}).on("mouseout",function(a){j||f(this,a)}),o=d3.bisector(function(a){return a.$interval}).left;m.attr("class","interactive"),m.call(d3.behavior.drag().on("dragstart",function(){g=d3.mouse(b[0]),j=!0,f(),a.dragStart={x:g[0],y:g[1]},a.$apply()}).on("dragend",function(){var c=d3.mouse(b[0]);j=!1,a.dragStop={x0:g[0],y0:g[1],x1:c[0],x2:c[1],xDiff:c[0]-g[0],yDiff:c[1]-g[1]},a.$apply()}).on("drag",function(){var c=d3.mouse(b[0]);a.dragPos={x0:g[0],y0:g[1],x1:c[0],x2:c[1],xDiff:c[0]-g[0],yDiff:c[1]-g[1]},a.$apply()})),m.on("dblclick",function(){k.setPane({start:null,stop:null},{start:null,stop:null}),k.adjust()}),i.register({build:function(){},finalize:function(){n.attr({x:l.innerLeft,y:l.innerTop,width:l.innerWidth,height:l.innerHeight})}}),a.highlight||(a.highlight={}),a.dragStart||(a.dragStart={}),a.dragPos||(a.dragPos={}),a.dragStop||(a.dragStop={})},scope:{highlight:"=vgraphInteract",dragStart:"=dBegin",dragPos:"=dChange",dragStop:"=dEnd"}}}]),angular.module("vgraph").directive("vgraphLine",["vgraphComponent",function(a){"use strict";return a("vgraphLine",{link:function(a,b,c,d){var e=d[0],f=c.name,g=d3.select(b[0]).append("path").attr("class","line plot-"+f),h=d3.svg.line().interpolate("linear").defined(function(a){var b=a[f];return!(isNaN(b)||null===b)}).x(function(a){return e.x.scale(a.$interval)}).y(function(a){return e.y.scale(a[f])});e.register({finalize:function(a){var b;g.attr("d",h(a.filter(function(c,d){var e,g=b;return b=c[f],g!==b?!0:(e=a[d+1],!e||e[f]!==b)})))}})}})}]),angular.module("vgraph").directive("vgraphLoading",["$interval",function(a){"use strict";return{require:["^vgraphChart"],link:function(b,c,d,e){function f(){a.cancel(h),g(),h=a(g,4005)}function g(){m=!0,r.attr("x",function(){return i}).attr("width",function(){return 0}).transition().duration(1e3).attr("x",function(){return i}).attr("width",function(){return j}).ease("sine").transition().duration(1e3).attr("width",0).attr("x",function(){return k}).ease("sine").transition().duration(1e3).attr("width",function(){return j}).attr("x",function(){return i}).ease("sine").transition().duration(1e3).attr("x",function(){return i}).attr("width",0).ease("sine")}var h,i,j,k,l=e[0],m=!1,n=l.box,o=d.vgraphLoading,p=d3.select(c[0]).attr("class","loading-view"),q=p.append("rect").attr("height",20).attr("class","outline"),r=p.append("rect").attr("width",0).attr("height",20).attr("class","filling"),s=p.append("text").text(o);b.model=l.model,n.register(function(){i=n.innerLeft+n.innerWidth/5,j=3*n.innerWidth/5,k=i+j,r.attr("x",i).attr("y",n.middle-10),q.attr("x",i).attr("y",n.middle-10).attr("width",j),s.attr("text-anchor","middle").attr("x",n.center).attr("y",n.middle+s.node().getBBox().height/2-2),m||f()}),b.$watch("model.loading",function(c){a.cancel(h),c&&b.box.ratio&&f()})}}}]),angular.module("vgraph").directive("vgraphMultiLine",["$compile",function(a){"use strict";return{link:function(b,c){function d(){var c,d,g,h,i,j,k=b.config,l="",m="";if(k){for(d=0,g=k.length;g>d;d++)j=k[d],i=j.name,l+='<g vgraph-line="data" interval="'+i+'.x" value="'+i+'.y" name="'+i+'"></g>',m+="path.plot-"+i+" { stroke: "+j.color+"; fill: transparent; }circle.plot-"+i+" { stroke: "+j.color+"; fill: "+j.color+";}.highlight.plot-"+i+" { background-color: "+j.color+"; }",b[i]=j;for(d3.select(e).selectAll("g").remove(),f.innerHTML=m,h=(new DOMParser).parseFromString('<g xmlns="http://www.w3.org/2000/svg">'+l+"</g>","image/svg+xml").childNodes[0].childNodes;h.length;)c=h[0],e.appendChild(c),a(c)(b)}}var e=c[0],f=document.createElement("style");document.body.appendChild(f),b.$on("$destroy",function(){document.body.removeElement(f)}),b.$watch("config",d),b.$watch("config.length",d)},scope:{data:"=vgraphMultiLine",config:"=config"}}}]),angular.module("vgraph").directive("vgraphTarget",[function(){"use strict";return{require:["^vgraphChart"],link:function(a,b,c,d){var e=d[0],f=e.model,g=e.box,h=d3.select(b[0]).attr("class","target"),i=h.append("line").attr("class","focus").attr("x1",0).attr("x2",0),j=h.append("g");g.register(function(){i.attr("y1",g.innerTop).attr("y2",g.innerBottom)}),a.$watch("target.point",function(b){var d;if(b){j.selectAll("circle.point").remove(),h.style("visibility","visible").attr("transform","translate( "+e.x.scale(b.$interval)+" , 0 )");for(d in f.plots)b[d]&&j.append("circle").attr("class","point plot-"+d).attr("x",0).attr("cy",e.y.scale(b[d])).attr("r",a.$eval(c.pointRadius)||3)}else h.style("visibility","hidden")})},scope:{target:"=vgraphTarget",pointRadius:"=pointRadius"}}}]),angular.module("vgraph").directive("vgraphTooltip",[function(){"use strict";return{require:["^vgraphChart"],link:function(a,b,c,d){var e=d[0],f=c.name,g=e.model,h=a.formatter||function(a){return g.y.format(g.y.parse(a))},i=parseInt(c.offsetX)||0,j=parseInt(c.offsetY)||0,k=d3.select(b[0]).attr("class","tooltip"),l=k.append("polygon").attr("class","outline").attr("transform","translate(0,-15)"),m=k.append("text").style("line-height","20").style("font-size","16").attr("class","label");a.$watch("data.point",function(a){var b,c,d;a&&a[f]?(b=e.y.scale(a[f]),c=e.x.scale(a.$interval)+i,m.text(h(a[f],a)),d=m.node().getComputedTextLength()+5,k.style("visibility","visible"),c+d+16<e.x.scale(g.x.stop.$interval)?(k.attr("transform","translate("+c+","+(b+j)+")"),m.attr("transform","translate(10,5)"),l.attr("points","0,15 10,0 "+(d+10)+",0 "+(d+10)+",30 10,30 0,15")):(k.attr("transform","translate("+(c-2*i-d-10)+","+(b+j)+")"),m.attr("transform","translate(5,5)"),l.attr("points","0,0 "+d+",0 "+(d+10)+",15 "+d+",30 0,30 0,0"))):k.style("visibility","hidden")})},scope:{formatter:"=textFormatter",data:"=vgraphTooltip"}}}]),angular.module("vgraph").directive("vgraphZone",["vgraphComponent",function(a){"use strict";return a("vgraphZone",{link:function(a,b,c,d){var e=d[0],f=c.name,g=d3.select(b[0]).append("path").attr("class","line plot-"+f),h=d3.svg.area().defined(function(a){return a[f]===!0}).x(function(a){return e.x.scale(a.$interval)}).y(function(){return e.box.innerTop}).y1(function(){return e.box.innerBottom});e.register({finalize:function(a){g.attr("d",h(a))}})}})}]),angular.module("vgraph").directive("vgraphZoom",[function(){"use strict";return{require:["^vgraphChart"],link:function(a,b,c,d){function e(b){0===g&&h===l.innerWidth?(n=!1,s.attr("class","focus")):(n=!0,s.attr("class","focus zoomed")),0>g&&(g=0),h>l.innerWidth&&(h=l.innerWidth),g>h?g=h:g>h&&(h=g),p.attr("transform","translate("+g+",0)"),q.attr("transform","translate(-"+g+",0 )").attr("width",g),t.attr("transform","translate("+h+",0)"),u.attr("width",l.innerWidth-h),s.attr("transform","translate("+g+",0)").attr("width",h-g),b||a.$apply(function(){var b=a.model;b.setPane({start:"%"+g/l.innerWidth,stop:"%"+h/l.innerWidth},{start:null,stop:null}),b.adjust(a)})}var f,g,h,i,j,k=d[0],l=k.box,m=!1,n=!1,o=d3.select(b[0]),p=o.append("g").attr("class","left-control min-control"),q=p.append("rect").attr("class","shade"),r=p.append("g").attr("class","control"),s=o.append("rect").attr("class","focus"),t=o.append("g").attr("class","right-control max-control"),u=t.append("rect").attr("class","shade"),v=t.append("g").attr("class","control");r.append("path").attr("d","M-0.5,23.33A6,6 0 0 0 -6.5,29.33V40.66A6,6 0 0 0 -0.5,46.66ZM-2.5,31.33V38.66M-4.5,31.33V38.66").attr("transform","translate(0,-9)").attr("class","nub"),i=r.append("rect").attr("width","10").attr("transform","translate(-10,0)"),v.append("path").attr("d","M0.5,23.33A6,6 0 0 1 6.5,29.33V40.66A6,6 0 0 1 0.5,46.66ZM2.5,31.33V38.66M4.5,31.33V38.66").attr("transform","translate(0,-9)").attr("class","nub"),j=v.append("rect").attr("width","10"),a.box=l,i.call(d3.behavior.drag().on("dragstart",function(){m=!0}).on("dragend",function(){m=!1}).on("drag",function(){g=d3.mouse(b[0])[0],e()})),j.call(d3.behavior.drag().on("dragstart",function(){m=!0}).on("dragend",function(){m=!1}).on("drag",function(){h=d3.mouse(b[0])[0],e()})),s.call(d3.behavior.drag().on("dragstart",function(){f={mouse:d3.mouse(b[0])[0],minPos:g,maxPos:h,min:a.model.x.start.$x,max:a.model.x.stop.$x},m=!0}).on("dragend",function(){m=!1,n=!0}).on("drag",function(){var a=d3.mouse(b[0]),c=a[0]-f.mouse;n?(h=f.maxPos+c,g=f.minPos+c,e()):c>5&&(h=f.mouse+Math.abs(c),g=f.mouse-Math.abs(c),e(),n=!1)})),o.on("dblclick",function(){h=l.innerWidth,g=0,e()}),l.register(function(){o.attr("width",l.innerWidth).attr("height",l.innerHeight).attr("transform","translate("+l.innerLeft+","+l.innerTop+")"),q.attr("height",l.innerHeight),u.attr("height",l.innerHeight),i.attr("height",l.innerHeight),j.attr("height",l.innerHeight),s.attr("height",l.innerHeight)}),a.model.register(function(){var b,c,d,f=a.model;m||(b=f.x,c=void 0===a.min?b.$min:a.min,d=void 0===a.max?b.$max:a.max,g=(b.start.$x-c)/(d-c)*l.innerWidth,h=(b.stop.$x-c)/(d-c)*l.innerWidth,e(!0))
})},scope:{model:"=vgraphZoom",min:"=zoomMin",max:"=zoomMax"}}}]);
//# sourceMappingURL=vgraph.min.js.map