angular.module("vgraph",[]),angular.module("vgraph").factory("Scheduler",[function(){"use strict";function t(){this.$scripts={},this.$master=this.schedule=[]}function e(){return+new Date}return t.prototype.startScript=function(t){t?this.$scripts[t]?(this.schedule=this.$scripts[t],this.schedule.length=0):this.schedule=this.$scripts[t]=[]:this.schedule=[]},t.prototype.endScript=function(t,e,i){this.schedule.push({$end:!0,always:t,success:e,failure:i}),this.$master.push(this.schedule),this.schedule=this.$master},t.prototype.loop=function(t,e,i){this.schedule.push({start:0,stop:t.length,data:t,op:e,ctx:i})},t.prototype.func=function(t,e){this.schedule.push({op:t,ctx:e})},t.prototype.run=function(){var t=this;this.$lock||(this.$lock=!0,setTimeout(function(){t.$eval()},5))},t.prototype.$eval=function(){function t(){a.$eval()}var i,n,r,a=this,o=!0,s=e(),l=s+500;try{for(;(r=this.schedule.shift())&&o;){if(r.length)for(;r.length;)this.schedule.unshift(r.pop());else if("start"in r)for(i=r.start,n=r.stop;n>i;i++)r.op.call(r.ctx,r.data[i],i);else r.$end?(r.success&&r.success(),r.always&&r.always()):r.op.call(r.ctx);e()>l&&(o=!1,setTimeout(t,5))}}catch(c){for(console.log(c),o=!0;(r=this.schedule.shift())&&o;)r.$end&&(r.failure&&r.failure(),r.always&&r.always(),t())}this.schedule.length||(this.$lock=!1)},t}]),angular.module("vgraph").factory("ComponentBox",[function(){"use strict";function t(t,e){var n=e.padding,r=t.padding,a=e.margin,o=t.margin;o||(t.margin=o={top:0,right:0,bottom:0,left:0}),a&&(o.top=i(a.top,o.top),o.right=i(a.right,o.right),o.bottom=i(a.bottom,o.bottom),o.left=i(a.left,o.left)),r||(t.padding=r={top:0,right:0,bottom:0,left:0}),n&&(r.top=i(n.top,r.top),r.right=i(n.right,r.right),r.bottom=i(n.bottom,r.bottom),r.left=i(n.left,r.left)),t.outerWidth=i(e.outerWidth,t.outerWidth)||0,t.outerHeight=i(e.outerHeight,t.outerHeight)||0,t.top=o.top,t.bottom=t.outerHeight-o.bottom,t.left=o.left,t.right=t.outerWidth-o.right,t.center=(t.left+t.right)/2,t.middle=(t.top+t.bottom)/2,t.width=t.right-t.left,t.height=t.bottom-t.top,t.innerTop=t.top+r.top,t.innerBottom=t.bottom-r.bottom,t.innerLeft=t.left+r.left,t.innerRight=t.right-r.right,t.innerWidth=t.innerRight-t.innerLeft,t.innerHeight=t.innerBottom-t.innerTop,t.ratio=t.outerWidth+" x "+t.outerHeight}function e(e){this.registrations=[],t(this,e||{})}function i(t,e){return void 0!==t?parseInt(t):e}return e.prototype.register=function(t){this.registrations.push(t)},e.prototype.targetSvg=function(t){this.$element=jQuery(t),this.resize()},e.prototype.resize=function(){var e,i,n=this.$element;if(n.attr("width",null).attr("height",null),n[0].style.cssText=null,t(this,{outerWidth:n.outerWidth(!0),outerHeight:n.outerHeight(!0),margin:{top:n.css("margin-top"),right:n.css("margin-right"),bottom:n.css("margin-bottom"),left:n.css("margin-left")},padding:{top:n.css("padding-top"),right:n.css("padding-right"),bottom:n.css("padding-bottom"),left:n.css("padding-left")}}),n.css("margin","0").css("padding","0").attr("width",this.outerWidth).attr("height",this.outerHeight).css({width:this.outerWidth+"px",height:this.outerHeight+"px"}),this.innerWidth&&this.innerHeight)for(e=0,i=this.registrations.length;i>e;e++)this.registrations[e]()},e}]),angular.module("vgraph").factory("ComponentChart",["$timeout","ComponentView","ComponentBox","DataCollection","LinearSamplerModel","makeEventing","Scheduler",function(t,e,i,n,r,a,o){"use strict";function s(){var t=this.$trigger.bind(this),e={};this.$vguid=++h,this.box=new i,this.views=e,this.models=[],this.waiting={},this.references={},this.loading=!0,this.message=null,this.$on("focus",function(i){var n=0,r=0,a={};i?(angular.forEach(e,function(t,e){var o;a[e]=t.getPoint(i.x),o=a[e].$pos,void 0!==o&&(r++,n+=o)}),a.$pos=n/r,a.pos=i,t("focus-point",a),t("highlight",a)):t("highlight",null)})}function l(t){var e,i;t.forEach(function(t){var n=t.viewport;(void 0===e||e>n.minValue)&&(e=n.minValue),(void 0===i||i<n.maxValue)&&(i=n.maxValue)}),t.forEach(function(t){t.setViewportValues(e,i)})}function c(t){var e,i;t.forEach(function(t){var n=t.viewport;(void 0===e||e>n.minInterval)&&(e=n.minInterval),(void 0===i||i<n.maxInterval)&&(i=n.maxInterval)}),t.forEach(function(t){t.setViewportIntervals(e,i)})}var u=new o,h=1;return a(s.prototype),s.defaultView="default",s.defaultModel="linear",s.prototype.setPage=function(t){this.page=t},s.prototype.configure=function(t,e){var i,n,a=this.addView.bind(this);e||(e={}),e.x||(e.x={}),e.y||(e.y={}),this.page=t,this.settings=e,this.normalizeY=e.normalizeY,this.normalizeX=e.normalizeX,n=e.views,n?angular.isFunction(n)&&(n=n()):(i={},i[s.defaultModel]=new r(function(t){return Math.round(t._$interval)}),n={},n[s.defaultView]={models:i}),angular.forEach(n,a)},s.prototype.setInputReference=function(t,e){this.references[t]=e},s.prototype.render=function(){var t,e=this,i=[],n=!1,r=0;try{angular.forEach(this.views,function(e,i){t=i,e.parse()}),t=null,angular.forEach(this.views,function(e,r){t=r,e.hasData()?(i.push(e),n=!0):e.isReady()&&(n=!0)}),t=null,this.normalizeY&&l(i),this.normalizeX&&c(i)}catch(a){console.log("parsing error",t,a.stack)}r=i.length,this.loading=!n,u.startScript(this.$vguid),this.loading?(e.$trigger("loading"),u.func(function(){e.loading=!0,e.pristine=!1})):r?(u.func(function(){e.message=null}),u.loop(i,function(t){t.build()}),u.loop(i,function(t){t.process()}),u.loop(i,function(t){t.finalize()}),u.func(function(){e.loading=!1,e.pristine=!0})):(e.$trigger("error"),u.func(function(){e.message="No Data Available",e.pristine=!1})),u.endScript(function(){e.$trigger("done")},function(){e.$trigger("success",i[0])},function(){e.pristine=!1,e.message="Unable to Render",e.$trigger("error")}),u.run()},s.prototype.scheduleRender=function(e){var i=this;this.nrTimeout||(this.nrTimeout=t(function(){i.render(i.waiting,e),i.waiting={},i.nrTimeout=null},30))},s.prototype.rerender=function(t){this.scheduleRender(t),this.waiting=this.views},s.prototype.needsRender=function(t,e){this.scheduleRender(e),this.waiting[t.name]||(this.waiting[t.name]=t)},s.prototype.getView=function(t){var i=this.views[t];return i||(i=new e,this.views[t]=i),i},s.prototype.addView=function(t,e){var i=this,n=this.settings,r=this.getView(e);r.configure(t,n,this.box),r.setPage(this.page),void 0!==n.x.min&&(r.pane.setBounds({min:n.x.min,max:n.x.max}),n.x.interval&&n.x.max&&n.datumFactory&&r.manager.data.$fillPoints(n.x.min,n.x.max,n.x.interval,n.datumFactory)),void 0!==this.settings.x.minPane&&r.pane.setPane(this.settings.x.minPane,this.settings.x.maxPane),r.manager.register(function(){i.needsRender(r)}),r.manager.onError(function(t){i.error(t)})},s.prototype.error=function(t){t?(this.loading=!1,this.message=t):this.message=null,this.$trigger("error")},s.prototype.setPane=function(t,e){var i=this.views,n=Object.keys(this.views);this.settings.x.minPane=t,this.settings.x.maxPane=e,n.forEach(function(n){i[n].pane.setPane({start:t,stop:e})})},s}]),angular.module("vgraph").factory("ComponentElement",["StatCalculations",function(t){"use strict";function e(t){return(new DOMParser).parseFromString('<g xmlns="http://www.w3.org/2000/svg">'+t+"</g>","image/svg+xml").childNodes[0].childNodes}function i(t,e){var i;for(t.innerHTML="",i=e.length-1;-1!==i;i--)t.appendChild(e[i])}function n(){this.children=null}return n.svgCompile=e,n.prototype.setElement=function(t){this.element=t},n.prototype.setDrawer=function(t){this.factory=t},n.prototype.setReferences=function(t){angular.isArray(t)||(t=[t]),this.references=t},n.prototype.parse=function(e){var i=0,n={},r=[];return this.references.forEach(function(t){var a;t&&(a=e[t.model],n[a.$modelUid]||(i++,n[a.$modelUid]=!0,r=r.concat(a.$getIndexs())),t.$model=a,t.$getNode=function(t){return this.$model.$getNode(t)},t.$getValue=function(t){var e=this.$getNode(t);return e?this.getValue(e):void 0})}),i>1&&(n={},r=r.filter(function(t){return n[t]?void 0:(n[t]=!0,t)})),this.keys=r,t.limits(r,this.references)},n.prototype.build=function(){var t=this.factory(),n=t.convert(this.keys);"g"===this.element.tagName?i(this.element,e(this.make(n,t.makeElement.bind(t)).join(""))):this.element.setAttribute("d",this.make(n,t.makePath.bind(t)).join(""))},n.prototype.make=function(t,e){var i,n,r,a=[];for(i=0,n=t.length;n>i;i++)r=e(t[i]),r&&a.push(r);return a},n}]),angular.module("vgraph").factory("ComponentGenerator",["$timeout","DrawBuilder","DrawLine","DrawFill","DrawBox","DrawIcon","ComponentChart",function(t,e,i,n,r,a,o){"use strict";function s(t){var e,i;return"object"!=typeof t?null:(e=t.value,i=t.interval,void 0===t.$uid&&(t.$uid=l++),t.field=t.name,t.view||(t.view=o.defaultView),t.model||(t.model=o.defaultModel),t.className||(t.className="node-"+t.name),void 0===t.getValue&&(t.getValue=function(e){return e[t.field]}),t)}var l=0,c=e.isNumeric;return{isNumeric:c,normalizeConfig:s,makeLineCalc:function(t,e){var n=new i;return n.preparse=function(t){var i=e.$getNode(t);return{x:i._$interval,y:e.getValue(i)}},function(){var i=t.views[e.view];return n.scale=function(t){return i.y.scale(t)},n}},makeBoxCalc:function(t,e,i){var n,a,o,s,l=new r(i);return l.preparse=function(t){var i=e.$getNode(t);return o(i)?s?(a=s(i),{x1:i._$interval,x2:i._$interval,y1:a,y2:a}):{x1:i._$interval,x2:i._$interval,y1:n.viewport.minValue,y2:n.viewport.maxValue}:void 0},function(){return n=t.getView(e.view),o=e.isValid,s=e.getValue,l.scale1=l.scale2=function(t){return n.y.scale(t)},l}},makeIconCalc:function(t,e,i,n){var r,o,s,l,c=new a(i,n);return c.preparse=function(t){var i=e.$getNode(t);return s(i)?l?(o=l(i),{x1:i._$interval,x2:i._$interval,y1:o,y2:o}):{x1:i._$interval,x2:i._$interval,y1:r.viewport.minValue,y2:r.viewport.maxValue}:void 0},function(){return r=t.getView(e.view),s=e.isValid,l=e.getValue,c.scale1=c.scale2=function(t){return r.y.scale(t)},c}},makeBarCalc:function(t,e,i,n){var a,o,s=new r,l=s.mergeSet;return s.preparse=function(t){var r,a,s,l,u,h,d=e.$getNode(t);return s=e.getValue(d),l=i?i.$getValue(t):o.viewport.minValue,h=n?parseInt(n,10)/2:3,c(s)&&c(l)&&s!==l&&(r=d._$interval-h,a=d._$interval+h,u={x1:r>d._$minInterval?r:d._$minInterval,x2:a>d._$maxInterval?d._$maxInterval:a,y1:s,y2:l}),u},s.mergeSet=function(t,e){return l.call(this,t,e),!0},function(){return a=t.views[e.view],o=i?t.views[i.view]:a,s.scale1=function(t){return a.y.scale(t)},s.scale2=function(t){return o.y.scale(t)},s}},makeFillCalc:function(t,e,i){var r,a,o=new n;return o.preparse=function(t){var n,o,s=e.$getNode(t);return n=e.getValue(s),o=a?i.$getValue(t):r.viewport.minValue,c(n)&&c(o)?{x:s._$interval,y1:n,y2:o}:void 0},function(){return r=t.views[e.view],o.scale1=function(t){return r.y.scale(t)},i?(a=t.views[i.view],o.scale2=function(t){return a.y.scale(t)}):o.scale2=o.scale1,o}}}}]),angular.module("vgraph").factory("ComponentPage",["DataFeed","DataLoader","DataManager",function(t,e,i){"use strict";function n(){this.$$pageUid=r++,this.feeds={},this.charts={},this.managers={},this.connections={}}var r=1;return n.defaultManager="default",n.prototype.configure=function(t){var e,i;if(angular.isArray(t))for(e=0,i=t.length;i>e;e++)this.addFeed(t[e]);else this.addFeed(t)},n.prototype.addFeed=function(i){var r,a,o,s,l=i.src||[];return i.manager||(i.manager=n.defaultManager),s=i.manager,l._$feedUid?r=this.feeds[l._$feedUid]:(r=new t(l,i.explode),this.feeds[r.$$feedUid]=r,l._$feedUid=r.$$feedUid),o=this.getManager(s),this.connections[r.$$feedUid]||(this.connections[r.$$feedUid]={}),a=this.connections[r.$$feedUid][o.$$managerUid],a||(a=new e(r,o),this.connections[r.$$feedUid][o.$$managerUid]=a),a.addConfig(i),l},n.prototype.getManager=function(t){var e=t||n.defaultManager,r=this.managers[e];return r||(r=new i,this.managers[e]=r),r},n.prototype.setChart=function(t,e){this.charts[t]=e},n.prototype.getChart=function(t){return this.charts[t]},n}]),angular.module("vgraph").factory("ComponentPane",[function(){"use strict";function t(t,e,i){this.x=e,this.y=i,this.fitToPane=!1,this._pane={},this._bounds={},e||(e={}),i||(i={}),this.setBounds({min:e.min,max:e.max},{min:i.min,max:i.max})}return t.prototype.setBounds=function(t,e){return this._bounds.x=t,this._bounds.y=e,this},t.prototype.setPane=function(t,e){return this._pane.x=t,this._pane.y=e,this},t.prototype.isValid=function(t){var e;return this.filtered?(e=t._$index,this.filtered.$minIndex<=e&&e<=this.filtered.$maxIndex):!1},t.prototype.filter=function(t,e){var i,n,r,a,o,s,l=this.x,c=t.data;return c.length&&(t.clean(),i=this._bounds.x.min||c.$minIndex,n=this._bounds.x.max||c.$maxIndex,l.$min=i,l.$max=n,this._pane.x&&this._pane.x.stop?(r=this._pane.x,o=i+r.start*(n-i),s=i+r.stop*(n-i)):(o=i,s=n),e.$left=o,e.left=(o-i)/(n-i),e.$right=s,e.right=(s-i)/(n-i),a=c.$filter(o,s),this.fitToPane&&(a.$addNode(o,t.$makePoint(o),!0),a.$addNode(t.$makePoint(s))),a.$sort()),a},t}]),angular.module("vgraph").factory("ComponentView",["ComponentPane",function(t){"use strict";function e(){this.$vgvid=i++,this.models={},this.components=[]}var i=1;return e.prototype.addModel=function(t,e){return this.models[t]=e,this},e.prototype.configure=function(e,i,n){var r,a,o,s=this.addModel.bind(this);e||(e={}),r={min:e.x?e.x.min:void 0,max:e.x?e.x.max:void 0},a={min:e.y?e.y.min:void 0,max:e.y?e.y.max:void 0},this.x=r,this.y=a,this.box=n,this.pane=new t(this.x,this.y),this.managerName=e.manager,this.datumFactory=e.datumFactory,this.makeInterval=i.makeInterval,this.adjustSettings=i.adjustSettings,this.pane.fitToPane=i.fitToPane,r.tick=i.x.tick||{},r.scale=i.x.scale?i.x.scale():d3.scale.linear(),r.padding=i.x.padding,r.massage=i.x.massage,r.format=i.x.format||function(t){return t},a.tick=i.y.tick||{},a.scale=i.y.scale?i.y.scale():d3.scale.linear(),a.padding=i.y.padding,a.massage=i.y.massage,a.format=i.y.format||function(t){return t},e.models&&(o=angular.isFunction(e.models)?e.models():e.models,Object.keys(o).forEach(function(t){s(t,o[t])}))},e.prototype.setPage=function(t){var e=this.x;this.manager=t.getManager(this.managerName),e&&(e.min||0===e.min)&&e.max&&e.interval&&this.datumFactory&&this.manager.data.$fillPoints(e.min,e.max,e.interval,this.datumFactory)},e.prototype.register=function(t){this.components.push(t)},e.prototype.isReady=function(){return this.manager&&this.manager.ready},e.prototype.hasData=function(){return this.isReady()&&this.manager.data.length},e.prototype.sample=function(){var t,e,i,n=this,r=this.box,a=this.pane,o=this.models;this.offset={},this.filtered=a.filter(this.manager,this.offset),i=this.filtered,e=this.offset,i&&(this.x.scale.domain([e.$left,e.$right]).range([r.innerLeft,r.innerRight]),i.forEach(function(t){t._$interval=n.x.scale(t._$index)}),t=Object.keys(o),t.forEach(function(t){o[t].$follow(i,r)}))},e.prototype.setViewportValues=function(t,e){var i,n=this.box;this.y.padding&&(i=e===t?t*this.y.padding:(e-t)*this.y.padding,e+=i,t-=i),this.viewport.minValue=t,this.viewport.maxValue=e,this.y.scale.domain([t,e]).range([n.innerBottom,n.innerTop])},e.prototype.setViewportIntervals=function(t,e){var i=this.box;this.viewport.minInterval=t,this.viewport.maxInterval=e,this.x.scale.domain([t,e]).range([i.innerLeft,i.innerRight])},e.prototype.parse=function(){var t,e,i,n=this.manager.data;this.sample(),i=this.models,this.filtered&&(this.components.forEach(function(n){var r;n.parse&&(r=n.parse(i),r&&(null!==r.min&&(!t&&0!==t||t>r.min)&&(t=r.min),null!==r.max&&(!e&&0!==e||e<r.max)&&(e=r.max)))}),this.viewport||(this.viewport={}),this.setViewportValues(t,e),this.setViewportIntervals(this.offset.$left,this.offset.$right),this.adjustSettings&&this.adjustSettings(this.filtered.$maxIndex-this.filtered.$minIndex,e-t,n.$maxIndex-n.$minIndex))},e.prototype.build=function(){var t=this.models;this.components.forEach(function(e){e.build&&e.build(t)})},e.prototype.process=function(){var t=this.models;this.components.forEach(function(e){e.process&&e.process(t)})},e.prototype.finalize=function(){var t=this.models;this.components.forEach(function(e){e.finalize&&e.finalize(t)})},e.prototype.getPoint=function(t){var e=0,i=0,n=this.models,r={};return Object.keys(n).forEach(function(a){var o;r[a]=n[a].$getClosest(t,"_$interval"),o=r[a]._$interval,o&&(i++,e+=o)}),r.$pos=e/i,r},e}]),angular.module("vgraph").factory("DataCollection",[function(){"use strict";function t(t,e,i,n){var r,a,o=0,s=t.length-1;if(n||t.sort(function(t,e){return i(t)-i(e)}),i(t[o])>=e)return{left:o,right:o};if(i(t[s])<=e)return{left:s,right:s};if(t.length){for(;s-o>1;)r=Math.floor((s+o)/2),a=i(t[r]),a===e?(s=r,o=r):a>e?s=r:o=r;return s!==r&&i(t[s])===e?{left:s,right:s}:o!==r&&i(t[o])===e?{left:o,right:o}:{left:o,right:s}}}function e(t){return null!==t&&void 0!==t&&"object"!=typeof t}function i(){this._$index={},this.$dirty=!1}return i.prototype=[],i.isNumeric=e,i.prototype.$fillPoints=function(t,e,i,n){var r,a,o;for(r=t,a=e+i;a>r;r+=i)o=n(),o._$index=r,this._$index[r]=o,this.push(o)},i.prototype._register=function(t,e,i){var n,r=+t;return this._$index[r]||(this._$index[r]=e,i?(this.length&&r>this[0]._$index&&(this.$dirty=!0),this.unshift(e)):(this.length&&r<this[this.length-1]._$index&&(this.$dirty=!0),this.push(e)),Object.keys(e).forEach(function(t){var i=e[t];(i||0===i)&&(n=!0)}),n&&(void 0===this.$minIndex?(this.$minIndex=r,this.$maxIndex=r):this.$maxIndex<r?this.$maxIndex=r:this.$minIndex>r&&(this.$minIndex=r)),e._$index=r),e},i.prototype._makeNode=function(t){var e=+t,i=this.$getNode(t);if(isNaN(e))throw new Error("index must be a number, not: "+t+" that becomes "+e);return i||(i={},this._register(e,i)),i},i.prototype.$getIndexs=function(){return Object.keys(this._$index)},i.prototype.$getNode=function(t){var e=+t;return this._$index[e]},i.prototype._setValue=function(t,e,i){var n=t._$index;t.$setValue?t.$setValue(e,i):t[e]=i,(i||0===i)&&(void 0===this.$minIndex?(this.$minIndex=n,this.$maxIndex=n):this.$maxIndex<n?this.$maxIndex=n:this.$minIndex>n&&(this.$minIndex=n))},i.prototype.$setValue=function(t,e,i){var n=this._makeNode(t);return this._setValue(n,e,i),n},i.prototype.$addNode=function(t,e,i){var n,r,a;if(e?r=+t:(e=t,r=e._$index),a=this.$getNode(r))a.$merge?a.$merge(e):(n=this._setValue.bind(this),Object.keys(e).forEach(function(t){"_$index"!==t&&n(a,t,e[t])}));else{if(this.$makeNode)a=this.$makeNode(e);else{if(e._$index&&e._$index!==r)throw new Error("something wrong with index -> ",e._$index,r);a=e}this._register(r,a,i)}return a},i.prototype.$pos=function(e,i){var n;return i||(i="_$index"),this.$sort(),n=t(this,e,function(t){return t[i]},!0),n.field=i,n},i.prototype.$getClosestPair=function(t,e){var i=this.$pos(t,e);return{left:this[i.left],right:this[i.right],field:i.field}},i.prototype.$getClosest=function(t,e){var i,n,r=this.$getClosestPair(t,e);return i=t-r.left[r.field],n=r.right[r.field]-t,n>i?r.left:r.right},i.prototype.$sort=function(){this.$dirty&&(this.sort(function(t,e){return t._$index-e._$index}),this.$dirty=!1)},i.prototype.$filter=function(t,e){var n,r=-1,a=new i;this.$sort();do r++,n=this[r];while(n&&n._$index<t);for(;n&&n._$index<=e;)a.$addNode(n),r++,n=this[r];return a.$parent=this,a},i}]),angular.module("vgraph").factory("DataFeed",["makeEventing",function(t){"use strict";function e(t,e){this.explode=e,this.setSource(t),this.$$feedUid=i++}var i=1;return e.prototype.setSource=function(t){var e=this,i=t.push;this.data=t,this._readPos=0,t.push=function(){i.apply(this,arguments),e.$push()},t.$ready=function(){e.$trigger("ready")},t.$error=function(t){e.$trigger("error",t)},t.$reset=function(){e.$trigger("reset"),e._readPos=0,e.data.length=0},this.$push()},t(e.prototype),e.prototype.$push=function(){var t=this;this._$push||(this._$push=setTimeout(function(){var e=t._readNext();for(e&&t.$trigger("ready");e;)t.$trigger("data",e),e=t._readNext();t._$push=null},0))},e.prototype._readAll=function(t){for(var e=this._read(0);e;)t(e),e=this._read(e.next)},e.prototype._readNext=function(){var t=this._read(this._readPos);return t&&(this._readPos=t.next),t},e.prototype._read=function(t){var e,i=this.data,n=this.explode;return!i.length||t>=i.length?null:n?(e=i[t],{points:n(e),next:t+1,ref:e}):{points:i.slice(t),next:i.length}},e}]),angular.module("vgraph").factory("DataLoader",[function(){"use strict";function t(t,i){var n=this,r=[],a=this._process.bind(this),o=t.$on("ready",function(){n.ready=!0}),s=t.$on("data",function(t){var e,i,n,o;for(e=0,i=t.points.length;i>e;e++)for(n=0,o=r.length;o>n;n++)a(r[n],t.points[e])}),l=t.$on("error",function(t){i.setError(t)}),c=t.$on("reset",function(){i.reset(),n.ready=!1});this.$$loaderUid=e++,this.feed=t,this.confs=r,this.dataManager=i,i.$follow(this),this.$destroy=function(){i.$ignore(this),l(),c(),o(),s()}}var e=1;return t.unregister=function(){},t.prototype.addConfig=function(t){var e=Object.keys(t.readings),i=this._process.bind(this);e.forEach(function(e){var i=t.readings[e];"string"==typeof i&&(t.readings[e]=function(t){return t[i]})}),t.parseInterval||(t.parseInterval=function(e){return e[t.interval]}),this.feed._readAll(function(e){var n,r,a=e.points;for(n=0,r=a.length;r>n;n++)i(t,a[n])}),this.confs.push(t)},t.prototype.removeConf=function(){},t.prototype._process=function(t,e){var i,n=this.dataManager,r=Object.keys(t.readings);if(!t.isDefined||t.isDefined(e))try{i=t.parseInterval(e),r.forEach(function(r){n.setValue(i,r,t.readings[r](e))})}catch(a){console.log("failed to load",e,i),console.log("conf:",t),console.log(a)}},t}]),angular.module("vgraph").factory("DataManager",["DataCollection",function(t){"use strict";function e(){this.$$managerUid=n++,this.$dataProc=i(20,200,function(t){var e=t.registrations;e.forEach(function(t){t()})}),this.construct(),this.reset()}function i(t,e,i,n){function r(){var e=+new Date;e>s||e>o?(s=null,i.apply(n,a)):setTimeout(r,t)}var a,o,s;return function(){var i=+new Date;o=i+t,a=arguments,s||(s=i+e,setTimeout(r,t))}}var n=1;return e.prototype.construct=function(){var t=[];this.registrations=[],this.errorRegistrations=[],this.getLoaders=function(){return t},this.$follow=function(e){t.push(e)},this.$ignore=function(e){var i=t.indexOf(e);-1!==i&&t.splice(i,1)}},e.prototype.reset=function(){this.data=new t,this.ready=!1,this.dataReady(!0)},e.prototype.onError=function(t){this.errorRegistrations.push(t)},e.prototype.setError=function(t){var e,i;for(e=0,i=this.errorRegistrations.length;i>e;e++)this.errorRegistrations[e](t)},e.prototype.getNode=function(t){return this.dataReady(),this.data.$getNode(t)},e.prototype.setValue=function(t,e,i){return this.dataReady(),this.ready||!i&&0!==i||(this.ready=!0),this.data.$setValue(t,e,i)},e.prototype.removePlot=function(){},e.prototype.dataReady=function(t){var e=this.registrations;t?e.forEach(function(t){t()}):this.$dataProc(this)},e.prototype.register=function(t){this.registrations.push(t)},e.prototype.clean=function(){this.data.$sort()},e.prototype.$makePoint=function(t){var e,i,n,r,a=this.data.$pos(t,"_$index");return a.right===a.left?this.data[a.right]:(e=this.data[a.right],i=this.data[a.left],n={},r=(t-i._$index)/(e._$index-i._$index),Object.keys(e).forEach(function(t){var a=i[t],o=e[t];void 0!==a&&null!==a&&void 0!==o&&null!==o&&(n[t]=a+(o-a)*r)}),n.$faux=!0,n._$index=t,n)},e}]),angular.module("vgraph").factory("DrawBox",["DrawBuilder",function(t){"use strict";function e(t){this.elemental=t}function i(t,e,i,n,r){var a;return t>e&&(a=t,t=e,e=a),i>n&&(a=i,i=n,n=a),void 0===r.x1?(r.x1=t,r.x2=e,r.y1=i,r.y2=n):(r.x1>t&&(r.x1=t),e>r.x2&&(r.x2=e),r.y1>i&&(r.y1=i),n>r.y2&&(r.y2=n)),r}return e.prototype=new t,e.prototype.makeSet=function(){return{}},e.prototype.isValidSet=function(t){return void 0!==t.x1},e.prototype.mergeSet=function(t,e){var n=t.x1,r=t.x2,a=t.y1,o=t.y2;return null===a||null===o?!0:(a=void 0===a?e.y1:this.scale1(a),o=void 0===o?e.y2:this.scale2(o),i(n,r,a,o,e),void 0)},e.prototype.makePath=function(t){return t?"M"+(t.x1+","+t.y1)+"L"+(t.x2+","+t.y1)+"L"+(t.x2+","+t.y2)+"L"+(t.x1+","+t.y2)+"Z":void 0},e.prototype.makeElement=function(t){return t?'<rect x="'+t.x1+'" y="'+t.y1+'" width="'+(t.x2-t.x1)+'" height="'+(t.y2-t.y1)+'"/>':void 0},e}]),angular.module("vgraph").factory("DrawBuilder",[function(){"use strict";function t(){}return t.isNumeric=function(t){return null===t?!1:Number.isFinite?Number.isFinite(t)&&!Number.isNaN(t):isFinite(t)&&!isNaN(t)},t.prototype.preparse=function(t){return t},t.prototype.makeSet=function(){return[]},t.prototype.mergeSet=function(t,e){return t?(e.push(t),!1):!0},t.prototype.isValidSet=function(t){return 0!==t.length},t.prototype.convert=function(t){return this.parse(t)},t.prototype.parse=function(t){var e,i,n,r,a=this.makeSet(),o=[],s=this.mergeSet.bind(this);for(e=0,i=t.length;i>e;e++)n=this.preparse(t[e]),r=n?s(n,a):!0,r&&this.isValidSet(a)&&(o.push(a),a=this.makeSet());return this.isValidSet(a)&&o.push(a),o},t.prototype.makeElement=function(t){return console.log("makeElement",t),"<text>Element not overriden</text>"},t.prototype.makePath=function(t){return console.log("makePath",t),"M0,0Z"},t}]),angular.module("vgraph").factory("DrawFill",["DrawBuilder",function(t){"use strict";function e(){}return e.prototype=new t,e.prototype.mergeSet=function(e,i){var n=e.x,r=e.y1,a=e.y2,o=i[i.length-1];if(t.isNumeric(r)&&t.isNumeric(a))i.push({x:n,y1:this.scale1(r),y2:this.scale2(a)});else{if(!o||null===r||null===a)return!0;r=void 0===r?o.y1:this.scale1(r),a=void 0===a&&o?o.y2:this.scale2(a),i.push({x:n,y1:r,y2:a})}},e.prototype.makePath=function(t){var e,i,n,r=[],a=[];if(t.length){for(e=0,i=t.length;i>e;e++)n=t[e],r.push(n.x+","+n.y1),a.unshift(n.x+","+n.y2);return"M"+r.join("L")+"L"+a.join("L")+"Z"}},e.prototype.makeElement=function(t){return'<path d="'+this.makePath(t)+'"></path>'},e}]),angular.module("vgraph").factory("DrawIcon",["DrawBox",function(t){"use strict";function e(t,e){this.box=t,this.template=e,this.elemental=!0}return e.prototype=new t,e.prototype.makeElement=function(t){var e,i;return t?(e=(t.x1+t.x2-this.box.width)/2,i=(t.y1+t.y2-this.box.height)/2,'<g transform="translate('+e+","+i+')">'+this.template+"</g>"):void 0},e}]),angular.module("vgraph").factory("DrawLine",["DrawBuilder",function(t){"use strict";function e(){}return e.prototype=new t,e.prototype.mergeSet=function(e,i){var n=e.x,r=e.y,a=i[i.length-1];if(t.isNumeric(r))i.push({x:n,y:this.scale(r)});else{if(!a||void 0!==r)return!0;i.push({x:n,y:a.y})}},e.prototype.makePath=function(t){var e,i,n,r=[];if(t.length){for(e=0,i=t.length;i>e;e++)n=t[e],r.push(n.x+","+n.y);return"M"+r.join("L")}},e.prototype.makeElement=function(t){return t.length?'<path d="'+this.makePath(t)+'"></path>':void 0},e}]),angular.module("vgraph").factory("makeEventing",[function(){"use strict";return function(t){t.$on=function(t,e){var i=this;return this._$listeners||(this._$listeners={}),this._$listeners[t]||(this._$listeners[t]=[]),this._$listeners[t].push(e),function(){i._$listeners[t].splice(i._$listeners[t].indexOf(e),1)}},t.$subscribe=function(t){var e=this,i=[],n=Object.keys(t);return n.forEach(function(n){var r=t[n];i.push(e.$on(n,r))}),function(){i.forEach(function(t){t()})}},t.$trigger=function(t,e){var i,n,r;if(this._$listeners&&(i=this._$listeners[t]))for(n=0,r=i.length;r>n;n++)i[n](e)}}}]),angular.module("vgraph").factory("StatCalculations",[function(){"use strict";function t(t){return null===t?!1:Number.isFinite?Number.isFinite(t)&&!Number.isNaN(t):isFinite(t)&&!isNaN(t)}function e(t,e){var i=[];return t.forEach(function(t){i.push("$"+e+"$"+t.field)}),i}return{$resetCalcs:function(t){var e,i;for(e=0,i=t.length;i>e;e++)t[e].field=t[e].name},$getFields:function(t){var e,i,n=[];for(e=0,i=t.length;i>e;e++)n.push(t[e].field);return n},$setFields:function(t,e){var i,n;for(i=0,n=t.length;n>i;i++)t[i].field=e[i]},sum:function(t,i){var n=e(t,"sum");return t.forEach(function(t,e){var r=t.field,a=n[e],o=0;i.forEach(function(t){var e=t[r];e&&(o+=e)}),i[a]=o,t.field=a}),n},average:function(t,i){var n=e(t,"average");return t.forEach(function(t,e){var r=t.field,a=n[e],o=0,s=0;i.forEach(function(t){var e=t[r];e?(o+=e,s++):0===e&&s++}),i[a]=o/s,t.field=a}),n},stack:function(t,i){var n=e(t,"stack"),r=this.$getFields(t);return i.forEach(function(t){var e=0;r.forEach(function(i,r){var a=t[i]||0;e+=a,t[n[r]]=e})}),t.forEach(function(t,e){t.field=n[e]}),n},limits:function(e,i){var n,r,a,o,s;if(angular.isArray(i))for(n=0,r=i.length;r>n;n++)a=this.limits(e,i[n]),void 0===o?(o=a.min,s=a.max):(a.min<o&&(o=a.min),a.max>s&&(s=a.max));else if(i&&i.getValue)for(n=0,r=e.length;r>n;n++)a=i.$getValue(e[n]),t(a)&&(void 0===o?(o=a,s=a):o>a?o=a:a>s&&(s=a));return{min:o,max:s}}}}]),angular.module("vgraph").factory("LinearSamplerNode",[function(){"use strict";function t(t){var e=[];this._$minInterval=t._$interval,this._$count=0,this._$interval=0,Object.keys(t).forEach(function(t){var i=t.charAt(0);"_"!==i&&e.push(t)}),this._$keys=e,this.$merge(t)}return t.prototype.$merge=function(t){var e=this;this._$maxInterval=t._$interval,this._$interval+=t._$interval,this._$count++,this._$keys.forEach(function(i){e[i]||0===e[i]?e[i]+=t[i]:e[i]=t[i]})},t.prototype.$finalize=function(t){var e=this,i=this._$count,n=this._$index;this._$interval=this._$interval/i,this._$keys.forEach(function(r){var a=e[r];(a||0===a)&&((void 0===t[r]||t[r]<n)&&(t[r]=n),e[r]=a/i)})},t}]),angular.module("vgraph").factory("LinearSamplerModel",["DataCollection","LinearSamplerNode",function(t,e){"use strict";function i(i,r){this.$modelUid=n++,this.$stats={},this.$indexer=i,this.$makeNode=r||function(t){return new e(t)},t.call(this)}var n=1;return i.prototype=new t,i.prototype.$follow=function(t){var e,i,n,r,a=this.$indexer;for(this.length=0,this._$index={},t.$sort(),this.$parent=t,e=0,i=t.length;i>e;e++)r=t[e],n=a(r),this.$addNode(n,r).$x=r._$index;for(e=0,i=this.length;i>e;e++)this[e].$finalize(this.$stats)},i}]),angular.module("vgraph").directive("vgraphAxis",[function(){"use strict";function t(t,e){return!(t.bottom<e.top||t.top>e.bottom||t.right<e.left||t.left>e.right)}return{scope:{orient:"=vgraphAxis",adjust:"=axisAdjust",rotation:"=tickRotation"},require:["^vgraphChart"],link:function(e,i,n,r){function a(){P.attr("visibility","hidden")}var o,s,l,c,u,h,d,f,p,g,m,v=r[0],x=v.getView(n.view||"default"),y=d3.svg.axis(),$="axis",w=v.box,b=0,k=null,_=!0,C=!1,N=parseInt(n.tickLength)||0,E=parseInt(n.tickPadding)||3,V=parseInt(n.tickMargin)||0,P=d3.select(i[0]);switch(P.attr("visibility","hidden"),h=P.append("g").attr("class","ticks"),g=P.append("g").attr("class","padding"),d=g.append("g").attr("class","tick-marks"),f=g.append("rect").attr("class","tick-margin"),m=P.append("g").attr("class","label-wrap"),n.tickRotation&&(k=parseInt(n.tickRotation,10)%360),n.labelOffset&&(b=e.$eval(n.labelOffset)),n.labelClean&&(_=e.$eval(n.labelClean)),n.labelEndpoints&&(C=e.$eval(n.labelEndpoints)),n.axisLabel&&(p=m.append("text").attr("class","axis-label label"),e.$parent.$watch(n.axisLabel,function(t){p.text(t)})),o=function(){n.tickMarks?(y.tickValues(e.$eval(n.tickMarks)),l=[]):n.tickCount?(y.ticks(e.$eval(n.tickCount)),l=[]):(y.ticks(10),l=[])},e.orient){case"top":s=function(){var t;if(P.attr("class",$+" x top").attr("transform","translate("+w.left+","+(w.top-N)+")").attr("width",w.width).attr("height",w.padding.top),p&&p.attr("text-anchor","middle").attr("x",w.width/2).attr("y",w.padding.top-b),V&&f.attr("height",V).attr("width",w.innerWidth).attr("x",0).attr("y",-V),d.attr("transform","translate(-"+w.margin.left+",0)"),l&&(y.orient("top").tickFormat(x.x.format).innerTickSize(-(w.innerHeight+N+V)).outerTickSize(0).tickPadding(E+N+V).scale(x.x.scale),x.x.tick.interval&&y.ticks(x.x.tick.interval,x.x.tick.step),h.attr("transform","translate(-"+w.margin.left+","+w.padding.top+")").call(y),t=P.selectAll("g.axis-cap").data(x.x.scale.domain()),C&&(t.enter().append("g").attr("class",function(t,e){return"axis-cap "+(e?"axis-max":"axis-min")}).append("text"),t.exit().remove(),t.attr("transform",function(t){return"translate("+(x.x.scale(t)-w.margin.left)+",0)"}).select("text").text(function(t){var e=x.x.format(t);return(""+e).match("NaN")?"":e}).attr("dy","-0.25em").attr("y",w.padding.top).attr("text-anchor","middle")),k)){if(null===h.select(".tick text")[0][0])return;h.selectAll(".tick text").attr("transform","translate(0,"+h.select(".tick text").attr("y")+") rotate("+k+",0,0)").attr("y","0").style("text-anchor",k%360>0?"end":"start"),
t.select("text").attr("transform","rotate("+k+",0,0)").style("text-anchor",e.rotation%360>0?"end":"start")}};break;case"bottom":s=function(){var t;if(P.attr("class",$+" x bottom").attr("transform","translate("+w.left+","+w.innerBottom+")").attr("width",w.width).attr("height",w.padding.bottom),p&&p.attr("text-anchor","middle").attr("x",w.width/2).attr("y",w.padding.bottom+b),V&&f.attr("height",V).attr("width",w.innerWidth).attr("x",0).attr("y",0),d.attr("transform","translate(-"+w.margin.left+",0)"),l&&(y.orient("bottom").tickFormat(x.x.format).innerTickSize(w.innerHeight+N+V).outerTickSize(0).tickPadding(E+N+V).scale(x.x.scale),x.x.tick.interval&&y.ticks(x.x.tick.interval,x.x.tick.step),h.attr("transform","translate(-"+w.margin.left+","+-w.innerHeight+")").call(y),t=P.selectAll("g.axis-cap").data(x.x.scale.domain()),C&&(t.enter().append("g").attr("class",function(t,e){return"axis-cap "+(e?"axis-max":"axis-min")}).append("text"),t.exit().remove(),t.attr("transform",function(t){return"translate("+(x.x.scale(t)-w.margin.left)+",0)"}).select("text").text(function(t){var e=x.x.format(t);return(""+e).match("NaN")?"":e}).attr("dy","1em").attr("y",0).attr("text-anchor","middle")),k)){if(null===h.select(".tick text")[0][0])return;h.selectAll(".tick text").attr("transform",function(){return"translate(0,"+d3.select(this).attr("y")+") rotate("+k+",0,0)"}).attr("y","0").style("text-anchor",k%360>0?"start":"end"),t.select("text").attr("transform","rotate("+k+",0,0)").style("text-anchor",e.rotation%360>0?"start":"end")}};break;case"right":s=function(){var t;P.attr("class",$+" y right").attr("transform","translate("+N+","+w.top+")").attr("width",w.padding.right).attr("height",w.height),m.attr("transform","translate("+(w.right-w.padding.right)+","+w.height+") rotate( 90 )"),p&&p.attr("text-anchor","middle").attr("x",-(w.height/2)).attr("y",-b),V&&f.attr("height",w.innerHeight).attr("width",V).attr("x",-V).attr("y",0),d.attr("transform","translate(-"+w.padding.right+","+(-w.top||0)+")"),l&&(y.orient("right").tickFormat(x.y.format).innerTickSize(-(w.innerWidth+N+V)).outerTickSize(0).tickPadding(E+N+V).scale(x.y.scale),x.y.tick.interval&&y.ticks(x.y.tick.interval,x.y.tick.step),h.attr("transform","translate("+w.innerRight+","+(-w.top||0)+")"),h.call(y),h.select(".domain").attr("transform","translate("+(N+V)+",0)"),C&&(t=P.selectAll("g.axis-cap").data(x.y.scale.domain()),t.enter().append("g").attr("class",function(t,e){return"axis-cap "+(e?"axis-max":"axis-min")}).append("text"),t.exit().remove(),t.attr("transform",function(t){return"translate(0,"+(x.y.scale(t)-w.margin.top)+")"}).select("text").text(function(t){var e=x.y.format(t);return(""+e).match("NaN")?"":e}).attr("dy",".25em").attr("x",w.padding.left-y.tickPadding()).attr("text-anchor","end")))};break;case"left":s=function(){var t;P.attr("class",$+" y left").attr("transform","translate("+w.left+","+w.top+")").attr("width",w.padding.left).attr("height",w.height),m.attr("transform","translate("+w.padding.left+","+w.height+") rotate( -90 )"),p&&p.attr("text-anchor","middle").attr("x",w.height/2).attr("y",-b),V&&f.attr("height",w.innerHeight).attr("width",V).attr("x",-V).attr("y",0),d.attr("transform","translate("+w.padding.left+","+(-w.top||0)+")"),l&&(y.orient("left").tickFormat(x.y.format).innerTickSize(-(w.innerWidth+N+V)).outerTickSize(0).tickPadding(E+N+V).scale(x.y.scale),x.y.tick.interval&&y.ticks(x.y.tick.interval,x.y.tick.step),h.attr("transform","translate("+(w.padding.left-N-V)+","+(-w.top||0)+")").call(y),h.select(".domain").attr("transform","translate("+(N+V)+",0)"),C&&(t=P.selectAll("g.axis-cap").data(x.y.scale.domain()),t.enter().append("g").attr("class",function(t,e){return"axis-cap "+(e?"axis-max":"axis-min")}).append("text"),t.exit().remove(),t.attr("transform",function(t){return"translate(0,"+(x.y.scale(t)-w.margin.top)+")"}).select("text").text(function(t){var e=x.y.format(t);return(""+e).match("NaN")?"":e}).attr("dy",".25em").attr("x",w.padding.left-y.tickPadding()).attr("text-anchor","end")))}}e.$on("$destroy",v.$subscribe({error:a,loading:a})),x.register({build:function(){void 0===l&&o(),s()},process:function(){l.length=0,N&&(h.selectAll(".tick text").each(function(t){l.push({el:this,val:t,position:this.getBoundingClientRect()})}),l.sort(function(t,e){var i=t.position.top-e.position.top;return i?i:t.position.left-e.position.left})),_&&(c=P.select(".axis-min text").node(),c&&(c=c.getBoundingClientRect()),u=P.select(".axis-max text").node(),u&&(u=u.getBoundingClientRect()))},finalize:function(){var e,i,n,r,a,o,s=x.filtered,h={};if(!s.length)return void P.attr("visibility","hidden");for(P.attr("visibility",""),d.selectAll("line").remove(),r=0,a=l.length;a>r;r++)e=!0,i=l[r],n=i.position,_&&c&&(t(n,c)||t(n,u))?(i.el.setAttribute("class","collided"),e=!1):void 0===h.left?(h.left=n.left,h.right=n.right,h.width=n.width,h.top=n.top,h.bottom=n.bottom,h.height=n.height,i.el.setAttribute("class","")):_&&t(n,h)?(i.el.setAttribute("class","collided"),e=!1):(o=!1,n.left<h.left&&(h.left=n.left,o=!0),n.right>h.right&&(h.right=n.right,o=!0),o&&(h.width=h.right-h.left,o=!1),n.top<h.top&&(h.top=n.top,o=!0),n.bottom>h.bottom&&(h.bottom=n.bottom,o=!0),o&&(h.height=h.bottom-h.top),i.el.setAttribute("class",""))}},"axis-"+e.orient)}}}]),angular.module("vgraph").directive("vgraphBar",["ComponentGenerator","StatCalculations","ComponentElement",function(t,e,i){"use strict";return{scope:{config:"=vgraphBar",pair:"=?pair"},require:["^vgraphChart","vgraphBar"],controller:i,link:function(e,i,n,r){var a=i[0],o=t.normalizeConfig(e.config),s=e.pair,l=r[0],c=r[1],u="bar ";c.setElement(a),c.setDrawer(t.makeBarCalc(l,o,s,n.width)),c.setReferences([o,s]),o.classExtend&&(u+=o.classExtend+" "),u+=n.className||o.className,a.setAttribute("class",u),l.getView(o.view).register(c)}}}]),angular.module("vgraph").directive("vgraphBox",["ComponentGenerator","StatCalculations","ComponentElement",function(t,e,i){"use strict";return{scope:{config:"=vgraphBox"},require:["^vgraphChart","vgraphBox"],controller:i,link:function(e,i,n,r){var a=i[0],o=t.normalizeConfig(e.config),s=r[0],l=r[1],c="box ";l.setElement(a),l.setDrawer(t.makeBoxCalc(s,o)),l.setReferences(o),o.classExtend&&(c+=o.classExtend+" "),c+=n.className||o.className,a.setAttribute("class",c),s.getView(o.view).register(l)}}}]),angular.module("vgraph").directive("vgraphChart",["ComponentChart",function(t){"use strict";function e(t){t.$mat&&t.innerWidth&&(t.$mat.attr("class","mat").attr("width",t.innerWidth).attr("height",t.innerHeight).attr("transform","translate("+t.innerLeft+","+t.innerTop+")"),t.$frame.attr("class","frame").attr("width",t.width).attr("height",t.height).attr("transform","translate("+t.left+","+t.top+")"))}return{scope:{settings:"=vgraphChart","interface":"=?interface"},controller:t,require:["vgraphChart","^vgraphPage"],link:function(t,i,n,r){var a,o=r[1],s=r[0],l=s.box;a="svg"===i[0].tagName?i[0]:i.find("svg")[0],s.$root=i[0],l.register(function(){e(l),s.rerender(function(){t.$apply()})}),l.targetSvg(a),l.$mat=d3.select(a).insert("rect",":first-child"),l.$frame=d3.select(a).insert("rect",":first-child"),e(l),t.$watch("settings",function(t){s.configure(o,t)}),t["interface"]&&(t["interface"].resize=l.resize.bind(l),t["interface"].error=s.error.bind(s)),n.name&&o.setChart(n.name,s)},restrict:"A"}}]),angular.module("vgraph").directive("vgraphCompare",["$compile","ComponentGenerator","ComponentElement",function(t,e,i){"use strict";return{scope:{config1:"=config1",config2:"=config2"},require:["^vgraphChart"],link:function(e,n,r,a){var o,s=a[0],l=i.svgCompile('<g><path vgraph-line="config1" pair="config2" class-name="'+(r.className||"")+'"></path></g>')[0];n[0].appendChild(l),t(l)(e),o=s.$on("focus-point",function(t){var i=e.config1,n=e.config2,a=t[i.view][i.model],o=t[n.view][n.model],l=s.getView(i.view),c=s.getView(n.view);t[r.reference||"compare"]={value:Math.abs(a[i.field]-o[n.field]),y:(l.y.scale(a[i.field])+c.y.scale(o[n.field]))/2,x:(a._$interval+o._$interval)/2}}),e.$on("$destroy",o)}}}]),angular.module("vgraph").directive("vgraphFocus",[function(){"use strict";return{require:["^vgraphChart"],link:function(t,e,i,n){var r=n[0],a=r.box,o=d3.select(e[0]),s=o.append("rect").attr("class","focus").attr("visibility","hidden");a.register(function(){s.attr("height",a.innerHeight).attr("y",a.innerTop)}),t.$watch("follow",function(t){var e,i,n;t&&void 0!==t.xDiff&&(e=Math.abs(t.xDiff),i=t.x0-e,n=t.x0+e,s.attr("visibility","visible"),i>a.innerLeft?s.attr("x",i):(i=a.innerLeft,s.attr("x",a.innerLeft)),n>a.innerRight?s.attr("width",a.innerRight-i):s.attr("width",n-i))}),t.$watch("stop",function(t){var e,i,n,o,l;t&&(s.attr("visibility","hidden"),e=Math.abs(t.xDiff),e>3&&(i=t.x0-e,n=t.x0+e,i<a.innerLeft?i=0:i-=a.innerLeft,n>a.innerRight?n=a.innerWidth:n-=a.innerLeft,o=r.views[Object.keys(r.views)[0]].offset,l=a.innerWidth*o.right-a.innerWidth*o.left,r.setPane((a.innerWidth*o.left+i/a.innerWidth*l)/a.innerWidth,(a.innerWidth*o.right-(a.innerWidth-n)/a.innerWidth*l)/a.innerWidth),r.rerender()))})},scope:{follow:"=vgraphFocus",stop:"=loseFocus"}}}]),angular.module("vgraph").directive("vgraphHighlight",[function(){"use strict";return{require:["^vgraphChart"],scope:!0,link:function(t,e,i,n){n[0].$on("highlight",function(e){t[i.vgraphHighlight]=e,t.$digest()})}}}]),angular.module("vgraph").directive("vgraphIcon",["ComponentGenerator","StatCalculations","ComponentElement",function(t,e,i){"use strict";return{scope:{config:"=vgraphIcon"},require:["^vgraphChart","vgraphIcon"],controller:i,link:function(e,i,n,r){var a=i[0],o=d3.select(a),s=o.node().getBBox(),l=t.normalizeConfig(e.config),c=r[0],u=r[1],h=a.innerHTML,d="icon ",f=u.parse;u.parse=function(t){var e=f.call(this,t),i=s.height/2;return e.min-=i,e.max+=i,e},a.innerHTML="",u.setElement(a),u.setDrawer(t.makeIconCalc(c,l,s,h)),u.setReferences([l]),l.classExtend&&(d+=l.classExtend+" "),d+=n.className||l.className,a.setAttribute("class",d),c.getView(l.view).register(u)}}}]),angular.module("vgraph").directive("vgraphIndicator",[function(){"use strict";return{require:["^vgraphChart"],scope:{cfg:"=?vgraphIndicator"},link:function(t,e,i,n){function r(){h.attr("visibility","hidden")}var a,o,s=t.cfg,l=n[0],c=t.$eval(i.pointRadius)||3,u=t.$eval(i.outerRadius),h=d3.select(e[0]).attr("transform","translate(1000,1000)").attr("visibility","hidden"),d=h.append("circle").attr("r",c),f=h.append("circle").attr("r",c);d.attr("class","point inner "+s.className),f.attr("class","line outer "+s.className),u&&(o=function(){f.transition().duration(1e3).attr("r",u).transition().duration(1e3).attr("r",c).ease("sine").each("end",function(){setTimeout(function(){o()},3e3)})})(),t.$on("$destroy",l.$subscribe({error:r,loading:r})),a=l.getView(s.view),a.register({finalize:function(t){var e,i,n,o=s.field,l=t[s.model];n=l[l.length-1],n&&n[o]&&l.$parent.$maxIndex===l.$parent.$parent.$maxIndex?(e=n._$interval,i=a.y.scale(n[o]),e&&i&&(h.attr("transform","translate("+e+","+i+")"),h.attr("visibility","visible"))):r()}})}}}]),angular.module("vgraph").directive("vgraphInteract",[function(){"use strict";return{require:["^vgraphChart"],scope:{dragPos:"=?dChange",dragStop:"=?dEnd",dragStart:"=?dBegin"},link:function(t,e,i,n){var r,a,o=n[0],s=!1,l=o.box,c=d3.select(e[0]),u=c.append("rect").style("opacity","0").attr("class","focal").on("mousemove",function(){var t=d3.mouse(this);s||(clearTimeout(a),o.$trigger("focus",{x:t[0],y:t[1]}))}).on("mouseout",function(){s||(a=setTimeout(function(){o.$trigger("focus",null)},100))});c.attr("class","interactive"),c.call(d3.behavior.drag().on("dragstart",function(){r=d3.mouse(e[0]),s=!0,o.$trigger("focus",null),t.dragStart={x:r[0],y:r[1]},t.$apply()}).on("dragend",function(){var i=d3.mouse(e[0]);s=!1,t.dragStop={x0:r[0],y0:r[1],x1:i[0],x2:i[1],xDiff:i[0]-r[0],yDiff:i[1]-r[1]},t.$apply()}).on("drag",function(){var i=d3.mouse(e[0]);t.dragPos={x0:r[0],y0:r[1],x1:i[0],x2:i[1],xDiff:i[0]-r[0],yDiff:i[1]-r[1]},t.$apply()})),c.on("dblclick",function(){o.setPane({start:null,stop:null},{start:null,stop:null}),o.rerender()}),angular.forEach(o.views,function(t){t.register({finalize:function(){u.attr({x:l.innerLeft,y:l.innerTop,width:l.innerWidth,height:l.innerHeight})}})}),t.dragStart||(t.dragStart={}),t.dragPos||(t.dragPos={}),t.dragStop||(t.dragStop={})}}}]),angular.module("vgraph").directive("vgraphLeading",[function(){"use strict";return{require:["^vgraphChart"],scope:{config:"=vgraphLeading"},link:function(t,e,i,n){function r(t){var e,i,n;if(s={},c.selectAll("line").remove(),t)for(i=0,n=t.length;n>i;i++)e=t[i],s[e.name]=c.append("line").attr("class","line "+e.className)}function a(){c.attr("visibility","hidden")}function o(){var e,i=!0,n=[];angular.forEach(t.config,function(t){var e=l.views[t.view].models[t.model],r=e._$index[e.$stats[t.field]],a=r[t.field];r._$index<e.$parent.$maxIndex?i=!1:(a=r[t.field],n.push({el:s[t.name],x:r._$interval,y:l.views[t.view].y.scale(a)}))}),n.sort(function(t,e){return t.y-e.y}),angular.forEach(n,function(t){e&&e.el.attr("x1",e.x).attr("x2",t.x).attr("y1",e.y).attr("y2",t.y),e=t}),e&&i?(c.attr("visibility","visible"),e.el.attr("x1",e.x).attr("x2",e.x).attr("y1",e.y).attr("y2",l.box.innerBottom)):a()}var s,l=n[0],c=d3.select(e[0]);t.$watchCollection("config",r),t.$on("$destroy",l.$subscribe({error:a,loading:a,success:o}))}}}]),angular.module("vgraph").directive("vgraphLine",["ComponentGenerator","StatCalculations","ComponentElement",function(t,e,i){"use strict";return{scope:{config:"=vgraphLine",pair:"=?pair"},require:["^vgraphChart","vgraphLine"],controller:i,link:function(e,i,n,r){var a,o,s=i[0],l=t.normalizeConfig(e.config),c=r[0],u=r[1];u.setElement(s),console.log("--",s),n.pair?(a=t.normalizeConfig(e.pair),o="fill ",u.setDrawer(t.makeFillCalc(c,l,a)),u.setReferences([l,a])):(o="line ",u.setDrawer(t.makeLineCalc(c,l)),u.setReferences(l)),l.classExtend&&(o+=l.classExtend+" "),o+=n.className||l.className,s.setAttribute("class",o),c.getView(l.view).register(u)}}}]),angular.module("vgraph").directive("vgraphLoading",["$interval",function(t){"use strict";return{require:["^vgraphChart"],link:function(e,i,n,r){function a(){!p&&f.loading&&(v.attr("visibility","visible"),p=!0,t.cancel(c),s(),c=t(s,4005))}function o(){v.attr("visibility","hidden"),p=!1,t.cancel(c)}function s(){y.attr("x",function(){return u}).attr("width",function(){return 0}).transition().duration(1e3).attr("x",function(){return u}).attr("width",function(){return h}).ease("sine").transition().duration(1e3).attr("width",0).attr("x",function(){return d}).ease("sine").transition().duration(1e3).attr("width",function(){return h}).attr("x",function(){return u}).ease("sine").transition().duration(1e3).attr("x",function(){return u}).attr("width",0).ease("sine")}var l,c,u,h,d,f=r[0],p=!1,g=f.box,m=n.vgraphLoading||"Loading Data",v=d3.select(i[0]).attr("class","loading-view"),x=v.append("rect").attr("height",20).attr("class","outline"),y=v.append("rect").attr("width",0).attr("height",20).attr("class","filling"),$=v.append("text").text(m);g.register(function(){if(u=g.innerLeft+g.innerWidth/5,h=3*g.innerWidth/5,d=u+h,h){y.attr("x",u).attr("y",g.middle-10),x.attr("x",u).attr("y",g.middle-10).attr("width",h);try{$.attr("text-anchor","middle").attr("x",g.center).attr("y",g.middle+$.node().getBBox().height/2-2)}catch(t){$.attr("text-anchor","middle").attr("x",g.center).attr("y",g.middle)}a()}else o()}),a(),l=f.$subscribe({done:function(){o(),f.loading&&g.ratio&&a()},error:o}),e.$on("$destroy",function(){o(),l()})}}}]),angular.module("vgraph").directive("vgraphMessage",[function(){"use strict";return{require:["^vgraphChart"],link:function(t,e,i,n){var r,a=n[0],o=a.box,s=d3.select(e[0]).attr("class","error-view"),l=s.append("rect").attr("class","outline"),c=s.append("text");s.attr("visibility","hidden"),o.register(function(){if(o.innerHeight){l.attr("transform","translate("+o.innerLeft+","+o.innerTop+")").attr("width",o.innerWidth).attr("height",o.innerHeight);try{c.attr("text-anchor","middle").attr("x",o.center).attr("y",o.middle+c.node().getBBox().height/2)}catch(t){c.attr("text-anchor","middle").attr("x",o.center).attr("y",o.middle)}}}),r=a.$subscribe({error:function(){var t=a.message;t&&!a.loading&&(s.attr("visibility","visible"),c.text(t))},done:function(){s.attr("visibility","hidden")}})}}}]),angular.module("vgraph").directive("vgraphPage",["ComponentPage",function(t){"use strict";return{restrict:"A",scope:{settings:"=vgraphPage"},controller:t,require:["vgraphPage"],link:function(t,e,i,n){var r=n[0];t.$watch("settings",function(t){r.configure(t)})}}}]),angular.module("vgraph").directive("vgraphStack",["$compile","ComponentGenerator","StatCalculations","ComponentChart",function(t,e,i,n){"use strict";return{require:["^vgraphChart"],scope:{config:"=vgraphStack",feed:"=?feed"},link:function(r,a,o,s){function l(t){var e,i,n,a={};for(e=0,i=t.length;i>e;e++)n=t[e],n.$pos=e,n.feed||(n.feed=r.feed),n.ref||(n.ref={name:n.name,view:p}),n.pair=a,a=n.ref}function c(i){var n,o,s,c;if(u=[],f=[],i&&(l(i),g)){for(d3.select(a[0]).selectAll("g").remove(),d&&d.$destroy(),s="",n=0,o=i.length;o>n;n++)s+="<g "+g+'="config['+n+']"></g>';for(c=e.svgCompile(s),n=0,o=c.length;o>n;n++)a[0].appendChild(c[n]);d=r.$new(),t(c)(d)}}var u,h,d,f,p=o.view||n.defaultView,g=o.childTag,m=o.model||n.defaultModel,v=s[0],x=v.getView(p);r.$watchCollection("config",c),h=r.$watchCollection("config",c),r.$on("$destroy",function(){d.$destroy(),h()}),x.register({parse:function(t){var e=r.config;i.$resetCalcs(e),i.stack(e,t[m])}})}}}]),angular.module("vgraph").directive("vgraphTarget",[function(){"use strict";return{require:["^vgraphChart"],scope:{pointRadius:"=pointRadius",config:"=vgraphTarget"},link:function(t,e,i,n){function r(e){e?(a=e.pos.x,l.style("visibility","visible").attr("transform","translate("+a+",0)"),void 0===i.noDots&&angular.forEach(t.config,function(n){var r,s=o.getView(n.view),l=n.field,c=e[n.view][n.model],h=n.className,d=c[l];void 0!==d&&null!==d?(r=u.selectAll("circle.point."+h),r[0].length||(r=u.append("circle").attr("class","point "+h+" "+n.classExtend)),r.attr("cx",c._$interval-a).attr("cy",s.y.scale(d)).attr("r",t.$eval(i.pointRadius)||3)):u.selectAll("circle.point."+h).remove()})):l.style("visibility","hidden")}var a,o=n[0],s=o.box,l=d3.select(e[0]).attr("class","target"),c=l.append("line").attr("class","focus").attr("x1",0).attr("x2",0),u=l.append("g");l.style("visibility","hidden"),o.$on("highlight",r),s.register(function(){c.attr("y1",s.innerTop).attr("y2",s.innerBottom)})}}}]),angular.module("vgraph").directive("vgraphTooltip",[function(){"use strict";function t(t,i,n){var r=i.config;return n.reference?{formatter:function(t){return t[n.reference].value},xParse:function(t){return t[n.reference].x},yParse:function(t){return t[n.reference].y}}:r.formatter?r:e(t,r)}function e(t,e){return{formatter:function(t){return e.getValue(t[e.view][e.model])},xParse:function(t){return t[e.view][e.model]._$interval},yParse:function(i){return t.views[e.view].y.scale(e.getValue(i[e.view][e.model]))}}}return{require:["^vgraphChart"],scope:{config:"=?vgraphTooltip"},link:function(e,i,n,r){var a=r[0],o=t(a,e,n),s=parseInt(n.offsetX)||0,l=parseInt(n.offsetY)||0,c=d3.select(i[0]).attr("class","tooltip"),u=c.append("polygon").attr("class","outline").attr("transform","translate(0,-15)"),h=c.append("text").style("line-height","20").style("font-size","16").attr("class","label");a.$on("highlight",function(t){var e,i,n,r;t&&(n=o.yParse(t)),void 0!==n?(e=n+l,i=o.xParse(t)+s,h.text(o.formatter(t)),r=h.node().getComputedTextLength()+5,c.style("visibility","visible"),i+r+16<a.box.innerRight?(c.attr("transform","translate("+i+","+e+")"),h.attr("transform","translate(10,5)"),u.attr("points","0,15 10,0 "+(r+10)+",0 "+(r+10)+",30 10,30 0,15")):(c.attr("transform","translate("+(i-2*s-r-10)+","+e+")"),h.attr("transform","translate(5,5)"),u.attr("points","0,0 "+r+",0 "+(r+10)+",15 "+r+",30 0,30 0,0"))):c.style("visibility","hidden")})}}}]),angular.module("vgraph").directive("vgraphZoom",[function(){"use strict";return{scope:{min:"=zoomMin",max:"=zoomMax"},require:["^vgraphChart","^vgraphPage"],link:function(t,e,i,n){function r(e){0===o&&s===p.innerWidth?(v=!1,b.attr("class","focus")):(v=!0,b.attr("class","focus zoomed")),0>o&&(o=0),s>p.innerWidth&&(s=p.innerWidth),o>s?o=s:o>s&&(s=o),y.attr("transform","translate("+o+",0)"),$.attr("transform","translate(-"+o+",0 )").attr("width",o),k.attr("transform","translate("+s+",0)"),_.attr("width",p.innerWidth-s),b.attr("transform","translate("+o+",0)").attr("width",s-o),e||t.$apply(function(){g.setPane(o/p.innerWidth,s/p.innerWidth),g.rerender()})}var a,o,s,l,c,u,h,d=n[0],f=n[1],p=d.box,g=f.getChart(i.vgraphZoom),m=!1,v=!1,x=d3.select(e[0]),y=x.append("g").attr("class","left-control min-control"),$=y.append("rect").attr("class","shade"),w=y.append("g").attr("class","control"),b=x.append("rect").attr("class","focus"),k=x.append("g").attr("class","right-control max-control"),_=k.append("rect").attr("class","shade"),C=k.append("g").attr("class","control");c=w.append("path").attr("d","M-0.5,23.33A6,6 0 0 0 -6.5,29.33V40.66A6,6 0 0 0 -0.5,46.66ZM-2.5,31.33V38.66M-4.5,31.33V38.66").attr("transform","translate(0,-9)").attr("class","nub"),l=w.append("rect").attr("width","10").attr("transform","translate(-10,0)"),h=C.append("path").attr("d","M0.5,23.33A6,6 0 0 1 6.5,29.33V40.66A6,6 0 0 1 0.5,46.66ZM2.5,31.33V38.66M4.5,31.33V38.66").attr("transform","translate(0,-9)").attr("class","nub"),u=C.append("rect").attr("width","10"),t.box=p,l.call(d3.behavior.drag().on("dragstart",function(){m=!0}).on("dragend",function(){m=!1}).on("drag",function(){o=d3.mouse(e[0])[0],r()})),u.call(d3.behavior.drag().on("dragstart",function(){m=!0}).on("dragend",function(){m=!1}).on("drag",function(){s=d3.mouse(e[0])[0],r()})),b.call(d3.behavior.drag().on("dragstart",function(){a={mouse:d3.mouse(e[0])[0],minPos:o,maxPos:s},m=!0}).on("dragend",function(){m=!1,v=!0}).on("drag",function(){var t=d3.mouse(e[0]),i=t[0]-a.mouse;v?(s=a.maxPos+i,o=a.minPos+i,r()):i>1&&(s=a.mouse+Math.abs(i),o=a.mouse-Math.abs(i),r(),v=!1)})),x.on("dblclick",function(){s=p.innerWidth,o=0,r()}),p.register(function(){x.attr("width",p.innerWidth).attr("height",p.innerHeight).attr("transform","translate("+p.innerLeft+","+p.innerTop+")"),h.attr("transform","translate(0,"+(p.innerHeight/2-30)+")"),c.attr("transform","translate(0,"+(p.innerHeight/2-30)+")"),$.attr("height",p.innerHeight),_.attr("height",p.innerHeight),l.attr("height",p.innerHeight),u.attr("height",p.innerHeight),b.attr("height",p.innerHeight)}),g.$on("success",function(t){m||(t.offset?(o=t.offset.left*p.innerWidth,s=t.offset.right*p.innerWidth):(o=0,s=p.innerWidth),r(!0))})}}}]),function(t){"use strict";var e=/\S+/g,i=/[\t\r\n\f]/g;t&&(t.fn.addClass=function(n){var r,a,o,s,l,c,u,h="string"==typeof n&&n,d=0,f=this.length;if(t.isFunction(n))return this.each(function(e){t(this).addClass(n.call(this,e,this.className))});if(h)for(r=(n||"").match(e)||[];f>d;d++)if(a=this[d],u="string"!=typeof a.className,o=1===a.nodeType&&(a.className?(" "+(u?a.getAttribute("class")||"":a.className)+" ").replace(i," "):" ")){for(l=0;s=r[l++];)o.indexOf(" "+s+" ")<0&&(o+=s+" ");c=t.trim(o),a.className!==c&&(u?a.setAttribute("class",c):a.className=c)}return this},t.fn.removeClass=function(n){var r,a,o,s,l,c,u,h=0===arguments.length||"string"==typeof n&&n,d=0,f=this.length;if(t.isFunction(n))return this.each(function(e){t(this).removeClass(n.call(this,e,this.className))});if(h)for(r=(n||"").match(e)||[];f>d;d++)if(a=this[d],u="string"!=typeof a.className,o=1===a.nodeType&&(a.className?(" "+(u?a.getAttribute("class")||"":a.className)+" ").replace(i," "):"")){for(l=0;s=r[l++];)for(;o.indexOf(" "+s+" ")>=0;)o=o.replace(" "+s+" "," ");c=n?t.trim(o):"",a.className!==c&&(u?a.setAttribute("class",c):a.className=c)}return this})}(jQuery);
//# sourceMappingURL=vgraph.min.js.map