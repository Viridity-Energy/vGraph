angular.module("vgraph",[]),angular.module("vgraph").factory("BoxModel",[function(){"use strict";function a(a,b){var d=b.padding,e=a.padding,f=b.margin,g=a.margin;g||(a.margin=g={top:0,right:0,bottom:0,left:0}),f&&(g.top=c(f.top,g.top),g.right=c(f.right,g.right),g.bottom=c(f.bottom,g.bottom),g.left=c(f.left,g.left)),e||(a.padding=e={top:0,right:0,bottom:0,left:0}),d&&(e.top=c(d.top,e.top),e.right=c(d.right,e.right),e.bottom=c(d.bottom,e.bottom),e.left=c(d.left,e.left)),a.outerWidth=c(b.outerWidth,a.outerWidth)||0,a.outerHeight=c(b.outerHeight,a.outerHeight)||0,a.top=g.top,a.bottom=a.outerHeight-g.bottom,a.left=g.left,a.right=a.outerWidth-g.right,a.center=(a.left+a.right)/2,a.middle=(a.top+a.bottom)/2,a.width=a.right-a.left,a.height=a.bottom-a.top,a.innerTop=a.top+e.top,a.innerBottom=a.bottom-e.bottom,a.innerLeft=a.left+e.left,a.innerRight=a.right-e.right,a.innerWidth=a.innerRight-a.innerLeft,a.innerHeight=a.innerBottom-a.innerTop,a.ratio=a.outerWidth+" x "+a.outerHeight}function b(b){this.registrations=[],a(this,b||{})}function c(a,b){return void 0!==a?parseInt(a):b}return b.prototype.register=function(a){this.ratio&&a(),this.registrations.push(a)},b.prototype.targetSvg=function(a){this.$element=a,this.resize()},b.prototype.resize=function(){var b,c,d=this.$element;if(d.attr("width",null).attr("height",null),d[0].style.cssText=null,a(this,{outerWidth:d.outerWidth(!0),outerHeight:d.outerHeight(!0),margin:{top:d.css("margin-top"),right:d.css("margin-right"),bottom:d.css("margin-bottom"),left:d.css("margin-left")},padding:{top:d.css("padding-top"),right:d.css("padding-right"),bottom:d.css("padding-bottom"),left:d.css("padding-left")}}),d.css("margin","0").css("padding","0").attr("width",this.outerWidth).attr("height",this.outerHeight).css({width:this.outerWidth+"px",height:this.outerHeight+"px"}),this.innerWidth&&this.innerHeight)for(b=0,c=this.registrations.length;c>b;b++)this.registrations[b]()},b}]),angular.module("vgraph").factory("ComponentGenerator",["$timeout",function(a){"use strict";function b(a,b,c){var d,e;if(a)if(a.forEach)a.forEach(b,c);else if(a.length)for(d=0,e=a.length;e>d;d++)b.call(c,a[d],d)}function c(a,b,c,d){var e,f,g,h=b.name;return d||(d="path"),a[h]=b,e=angular.isFunction(b.value)?h+".value":"'"+(b.value||h)+"'",f=angular.isFunction(b.interval)?h+".interval":"'"+(b.interval||"x")+"'",angular.isString(b.data)?(g=b.data,a[b.data]=a.$parent[b.data]):g=b.data?h+".data":"data","<"+d+' class="'+c+" "+b.className+'" vgraph-feed="'+g+'" name="'+h+'" value="'+e+'" interval="'+f+'" control="'+(b.control||"default")+'"'+(b.filter?' filter="'+b.filter+'"':"")+"></"+d+">"}function d(a){return null===a?!1:Number.isFinite?Number.isFinite(a)&&!Number.isNaN(a):isFinite(a)&&!isNaN(a)}var e={require:["^vgraphChart"],link:function(b,c,d,e){function f(){i||(i=a(function(){g(),i=null},30))}function g(){var a,c;if(b.data&&m.valueParse){for(b.data._lastRead||(b.data._lastRead={}),a=b.data._lastRead[n]||0,c=b.data.length;c>a;a++)b.loadPoint(b.data[a]);b.data._lastRead[n]=c}}var h,i,j=d.control||"default",k=e[0].graph.views[j],l=k.model,m={model:l},n=d.name,o=[],p=parseInt(d.memory,10)||10;b.$watch("interval",function(a){m.intervalParse="string"==typeof a?function(b){return b[a]}:a}),b.$watch("extra",function(a){m.extraParse=a}),b.$watch("filter",function(a){m.filterParse=a}),b.$watch("value",function(a){"string"==typeof a?(h=d.alias||a,m.valueParse=function(b){return void 0!==b[a]?b[h]:void 0}):m.valueParse=a,f()}),b.$watch("data",f),b.$watch("data.length",f),b.loadPoint=b.loadPoint?b.loadPoint.bind(m):function(a){var b,c=this.valueParse(a);void 0!==c&&(this.filterParse?(o.length>p&&o.shift(),o.push(c),b=this.model.addPoint(n,this.intervalParse(a),this.filterParse(c,o))):b=this.model.addPoint(n,this.intervalParse(a),c),this.extraParse&&b&&this.extraParse(a,b))}.bind(m)},scope:{data:"=_undefined_",value:"=?value",interval:"=?interval",filter:"=?filter",extra:"=?extra"}};return{generate:function(a,b){function c(){}var d;return c.prototype=e,d=new c,d.scope=angular.copy(d.scope),d.scope.data="="+a,angular.forEach(b,function(a,b){var c=d[b];d[b]=c?angular.isFunction(c)?function(){c.apply(this,arguments),a.apply(this,arguments)}:angular.extend(c,a):a}),d.preLink&&(d.link={pre:d.preLink,post:d.link}),d},makeLineCalc:function(a,b){return d3.svg.line().interpolate("linear").defined(function(a){var c=a[b];return d(c)}).x(function(b){return a.x.scale(b.$interval)}).y(function(c){return a.y.scale(c[b])})},makeFillCalc:function(a,b,c,e,f){return c||(c=a),d3.svg.area().defined(function(g){var h=g[a.name]?g[a.name][b]:null,i=!e||g[c.name]&&d(g[c.name][e]);return d(h)&&i?(f&&e&&f(g,g[a.name][b],g[c.name][e]),!0):!1}).x(function(b){return a.x.scale(b[a.name].$interval)}).y(function(c){return a.y.scale(c[a.name][b])}).y1(function(a){return c.y.scale(e?a[c.name][e]:c.model.y.minimum)})},makeMyFillCalc:function(a,c,e,f,g){function h(b){var g=b[a.name]?b[a.name][c]:null,h=!f||b[e.name]&&d(b[e.name][f]);return d(g)&&h?!0:!1}function i(b){return b[a.name]._$interval}function j(b){return b[a.name][c]}function k(b){return a.y.scale(b)}function l(a){return f&&a[e.name][f]?a[e.name][f]:e.pane.y.minimum}function m(a){return e.y.scale(a)}return e||(e=a),function(a){function c(){d.push("M",f.join("L"),"L",e.reverse().join("L"),"Z")}var d=[],e=[],f=[];return b(a,function(a){var b,d,n,o,p;h(a)?(d=j(a),n=l(a),o=k(d),p=k(n),b=i(a),g&&g(a,d,n,o,p,b),e.push(b+","+k(d)),f.push(b+","+m(n))):e.length&&(c(),e=[],f=[])}),e.length&&c(),d.length?d.join(""):null}},decodeConfig:function(a,b,d){var e,f,g=[];if(angular.isArray(b))for(e=0,f=b.length;f>e;e++)g.push(c(a,b[e],d));else g.push(c(a,b,d));return g},compileConfig:function(a,b,c){var d,e,f,g;for(angular.isArray(b)||(b=[b]),f=this.decodeConfig(a,b,c),g=this.svgCompile(f.join("")),d=0,e=g.length;e>d;d++)f[d]={name:b[d].name,className:b[d].className,element:g[d],$d3:d3.select(g[d]),$conf:b[d]};return f},svgCompile:function(a){return(new DOMParser).parseFromString('<g xmlns="http://www.w3.org/2000/svg">'+a+"</g>","image/svg+xml").childNodes[0].childNodes},parseStackedLimits:function(a,b){var c,d,e,f,g,h,i,j,k,l;if(b&&b.length)for(c=0,d=a.length;d>c;c++){for(h=0,j=void 0,i=a[c],g=b[0].name,j=i[g]||0,void 0===k?(k=j,l=j):k>j&&(k=j),i["$"+g]=j,h=j,e=1,f=b.length;f>e;e++)g=b[e].name,j=i[g]||0,h+=j,i["$"+g]=h;i.$total=h,h>l&&(l=h)}return{min:k,max:l}},parseLimits:function(a,b,c){var e,f,g,h,i,j;if(angular.isString(b))if(c)for(e=0,f=a.length;f>e;e++)g=a[e],h=c(g,g[b]),d(h)&&(void 0===i?(i=h,j=h):i>h?i=h:h>j&&(j=h));else for(e=0,f=a.length;f>e;e++)g=a[e],h=g[b],d(h)&&(void 0===i?(i=h,j=h):i>h?i=h:h>j&&(j=h));else for(e=0,f=b.length;f>e;e++)h=this.parseLimits(a,b[e]),void 0===i?(i=h.min,j=h.max):(h.min<i&&(i=h.min),h.max>j&&(j=h.max));return{min:i,max:j}}}}]),angular.module("vgraph").factory("DataCollection",["LinearModel",function(a){"use strict";function b(b){b instanceof a&&(b={"default":b}),this.models=b}return b.prototype.forEach=function(a,b){angular.forEach(this.models,function(c,d){a.call(b,c,d)})},b.prototype.reset=function(){angular.forEach(this.models,function(a){a.reset()})},b}]),angular.module("vgraph").factory("GraphModel",["$timeout","ViewModel","BoxModel","LinearModel","DataCollection",function(a,b,c,d,e){"use strict";function f(){this.index=[],this.hash={},this.$dirty=!1}function g(){this.box=new c,this.models=[],this.views={},this.samples={},this.waiting={},this.registrations=[],this.loading=!0,this.message=null}function h(a,b){var c,d,e,f,g;for(d=0,e=a.length;e>d;d++)for(c=a[d],f=0,g=c.length;g>f;f++)null!==c[f]&&(b[d].unshift(c[f]),f=g)}function i(a,b,c,d,e){var f,g=[],h=[];for(f=0;e>f;f++)h.push([]);return h.push([]),angular.forEach(a,function(a){var f=b[a.view],i=c[f.name];g.push(a.label),f.publishData(h,a,function(a){return Math.round((a.$x-i.data.min)/d*e)})}),{header:g,body:h}}return f.prototype.addIndex=function(a,b){return this.hash[a]||(this.hash[a]={$index:a,$meta:b},this.index[this.index.length-1]>a&&(this.$dirty=!0),this.index.push(a),this.length=this.index.length),this.hash[a]},f.prototype.getClosest=function(a){var c,d,e,f,g;return this.length?(this.sort(),c=b.bisect(this,a,function(a){return a.$index},!0),f=this.get(c.left),g=this.get(c.right),d=a-f.$index,e=g.$index-a,e>d?f:g):void 0},f.prototype.get=function(a){return this.hash[this.index[a]]},f.prototype.sort=function(){this.$dirty&&(this.$dirty=!1,this.index.sort(function(a,b){return a-b}))},f.prototype.forEach=function(a,b){var c,d;for(this.sort(),c=0,d=this.index.length;d>c;c++)a.call(b,this.hash[this.index[c]])},g.prototype.register=function(a){this.registrations.push(a)},g.prototype.getPrimaryView=function(){return this.views[Object.keys(this.views)[0]]},g.prototype.publish=function(a,b){var c,d,e,f,g={},j={};return angular.forEach(a,function(a){var b=this.views[a.view];b&&!g[b.name]&&(g[b.name]=b)},this),angular.forEach(g,function(a){var b=a.publishStats(),d=b.data.max-b.data.min;j[a.name]=b,(!c||d>c)&&(c=d),(!e||b.step<e)&&(e=b.step)}),d=Math.ceil(c/e),f=i(a,g,j,c,d),b&&(b=i(b,g,j,c,d),h(b.body,f.body),f.header.unshift(b.header[0])),f.body.unshift(f.header),f.body},g.prototype.render=function(a){var b=0,c=this.getPrimaryView(),d=new f;angular.forEach(this.views,function(a){a.calcBounds()}),this.calcHook&&this.calcHook(),a=[],this.empty=[],angular.forEach(this.views,function(b){b.calcScales(d),b.hasData()?a.push(b):this.empty.push(b)},this),b=Object.keys(a).length,b?(this.unified=d,this.loading=!d.length,this.loading?angular.forEach(a,function(a){a.loading()}):(angular.forEach(a,function(a){a.build()}),angular.forEach(a,function(a){a.process()}),angular.forEach(a,function(a){a.finalize()}),angular.forEach(this.registrations,function(a){a(c.pane)}))):this.loading||(this.loading=!0,this.message="No Data Available")},g.prototype.scheduleRender=function(){this.nrTimeout||(this.nrTimeout=a(function(){this.render(this.waiting),this.waiting={},this.nrTimeout=null}.bind(this),30))},g.prototype.rerender=function(){this.scheduleRender(),this.waiting=this.views},g.prototype.needsRender=function(a){this.scheduleRender(),this.waiting[a.name]||(this.waiting[a.name]=a)},g.prototype.addDataCollection=function(a){a instanceof e?a=a.models:a instanceof d&&(a={"default":a}),angular.forEach(a,this.addDataModel,this)},g.prototype.addDataModel=function(a,c){var d=new b(this,c,a);this.views[d.name]=d,this.models.push(a),this.bounds&&d.pane.setBounds(this.bounds.x,this.bounds.y),this.pane&&d.pane.setPane(this.pane.x,this.pane.y),a.onError(function(a){a?(this.loading=!0,this.message=a):this.message=null}.bind(this))},g.prototype.setBounds=function(a,b,c){return this.bounds={x:a,y:b},c?this.views[c]&&this.views[c].pane.setBounds(a,b):angular.forEach(this.views,function(c){c.pane.setBounds(a,b)}),this},g.prototype.setPane=function(a,b,c){return this.pane={x:a,y:b},c?this.views[c]&&this.views[c].pane.setPane(a,b):angular.forEach(this.views,function(c){c.pane.setPane(a,b)}),this},g}]),angular.module("vgraph").factory("LinearModel",[function(){"use strict";function a(a){a||(a={}),a.x||(a.x={}),a.y||(a.y={}),this.$dataProc=b(20,200,function(a){var b=a.registrations;b.forEach(function(a){a()})}),this.data=[],this.construct(),this.reset(a)}function b(a,b,c,d){function e(){var b=+new Date;b>h||b>g?(h=null,c.apply(d,f)):setTimeout(e,a)}var f,g,h;return function(){var c=+new Date;g=c+a,f=arguments,h||(h=c+b,setTimeout(e,a))}}var c=0;return a.prototype.construct=function(){this.$modelId=c++,this.registrations=[],this.errorRegistrations=[],this.point={reset:function(a){a.$x=null,a.$y=null}}},a.prototype.reset=function(a){this.data.length=0,this.lookUp={},this.plots={},this.plotNames=[],this.filtered=null,this.needSort=!1,this.ratio=null,this.transitionDuration=30,this.config(a||this),this.dataReady(!0)},a.prototype.config=function(a){var b=this;this.x={$min:null,$max:null,massage:a.x.massage||null,padding:a.x.padding||0,scale:a.x.scale||function(){return d3.scale.linear()},disp:a.x.display||function(a){return a.$interval},simplify:a.x.simplify||function(a){return a.$x},parse:a.x.parse||function(a){return a.$interval},format:a.x.format||d3.format("03d"),tick:a.x.tick||{}},this.y={$min:null,$max:null,massage:a.y.massage||null,padding:a.y.padding||0,scale:a.y.scale||function(){return d3.scale.linear()},disp:a.y.display||function(a,c){return b.y.parse(a,c)},simplify:a.y.simplify||function(a){return b.y.parse(a)},parse:a.y.parse||function(a,b){return void 0===a||null===a?null:a[b]},format:a.y.format||d3.format(",.2f"),tick:a.y.tick||{}}},a.prototype.makeInterval=function(a){return a},a.prototype.onError=function(a){this.errorRegistrations.push(a)},a.prototype.setError=function(a){var b,c;for(b=0,c=this.errorRegistrations.length;c>b;b++)this.errorRegistrations[b](a)},a.prototype.getPoint=function(a){var b,c=this.data;return this.x.massage&&(a=this.x.massage(a)),a||0===a?(a=+a,b=this.lookUp[a],b||(b={$interval:this.makeInterval(a),$x:a},this.lookUp[a]=b,c.length&&c[c.length-1].$x>a&&(this.needSort=!0),c.push(b)),b):void 0},a.prototype.addPoint=function(a,b,c){var d,e=this.getPoint(b),f=parseFloat(c);if(e)return b=e.$x,this.y.massage&&(c=this.y.massage(b)),void 0===e.$max?isFinite(f)&&(e.$min=f,e.$max=f):isFinite(f)&&((void 0===e.$min||f<e.$min)&&(e.$min=f),(void 0===e.$max||f>e.$max)&&(e.$max=f)),this.x.min||(this.x.min=e,this.x.max=e),d=this.plots[a],d?d.x.max.$x<e.$x?(d.x.max=e,this.x.max.$x<e.$x&&(this.x.max=e)):d.x.min.$x>e.$x&&(d.x.min=e,e.$x<this.x.min.$x&&(this.x.min=e)):(this.plots[a]=d={x:{min:e,max:e}},this.x.max.$x<e.$x?this.x.max=e:e.$x<this.x.min.$x&&(this.x.min=e)),e[a]=c,this.dataReady(),e},a.prototype.addPlot=function(a,b,c,d){var e,f,g;if(!this.plots[a])for(e=0,f=b.length;f>e;e++)g=b[e],this.addPoint(a,c(g),d(g))},a.prototype.removePlot=function(a){var b,c,d,e,f,g,h,i,j=this.plots[a];if(j){for(delete this.plots[a],h=Object.keys(this.plots),b=0,c=this.data.length;c>b;b++){if(i=this.data[b],i.$max===i[a]){for(f=void 0,d=0,e=h.length;e>d;d++)g=i[h[d]],"number"==typeof g&&(void 0===f||g>f)&&(f=g);i.$max=f}if(i.$min===i[a]){for(f=void 0,d=0,e=h.length;e>d;d++)g=i[h[d]],"number"==typeof g&&(void 0===f||f>g)&&(f=g);i.$min=f}i[a]=null}if(this.x.min=null,this.x.max=null,this.y.min=null,this.y.max=null,h.length&&this.plots[h[0]]&&this.plots[h[0]].x&&this.plots[h[0]].y)for(this.x.min=this.plots[h[0]].x.min,this.x.max=this.plots[h[0]].x.max,this.y.min=this.plots[h[0]].y.min,this.y.max=this.plots[h[0]].y.max,b=1,c=h.length;c>b;b++)g=h[b],i=this.plots[g],i.min&&i.min.$x<this.x.min.$x?this.x.min=i.min:i.max&&this.x.max.$x<i.max.$x&&(this.x.max=i.max),i.min&&i.min.$min<this.y.min.$min?this.y.min=i.min:i.max&&this.y.max.$max<i.max.$max&&(this.y.max=i.max)}},a.prototype.dataReady=function(a){var b=this.registrations;a?b.forEach(function(a){a()}):this.$dataProc(this)},a.prototype.findExtemesY=function(a){var b,c,d,e,f;for(c=0,d=a.length;d>c;c++)b=a[c],(b.$min||0===b.$min)&&(void 0===e?e=b:b.$min<e.$min&&(e=b)),(b.$max||0===b.$max)&&(void 0===f?f=b:b.$max>f.$max&&(f=b));return{min:e,max:f}},a.prototype.register=function(a){this.registrations.push(a)},a.prototype.clean=function(){var a=this.x;this.needSort&&this.data.sort(function(a,b){return a.$x-b.$x}),a.$min=a.min.$x,a.$max=a.max.$x},a}]),angular.module("vgraph").factory("PaneModel",[function(){"use strict";function a(a){this.dataModel=a,this.x={},this.y={}}return a.prototype.setBounds=function(a,b){return a&&(void 0!==a.min&&(this.x.$min=a.min),void 0!==a.max&&(this.x.$max=a.max)),b&&(void 0!==b.min&&(this.y.$min=b.min),void 0!==b.max&&(this.y.$max=b.max)),this},a.prototype.setPane=function(a,b){return a&&(void 0!==a.start&&(this.x.start=a.start),void 0!==a.stop&&(this.x.stop=a.stop)),b&&(void 0!==b.start&&(this.y.start=b.start),void 0!==b.stop&&(this.y.stop=b.stop)),this.offset=null,this},a.prototype.isValid=function(a){var b;return void 0===this.x.start?!0:(b=a.$x,this.x.start.$x<=b&&b<=this.x.stop.$x)},a.prototype.adjust=function(a){var b,c,d,e,f,g=this.dataModel.data,h=this.x,i=this.dataModel.x;if(g.length){if(this.dataModel.clean(),e=h.$min||i.$min,f=h.$max||i.$max,this.offset={},"number"==typeof h.start)h.start=g[h.start];else{if(null===h.start||void 0===h.start)b=e;else if("string"==typeof h.start)if("%"===h.start.charAt(0))b=e+parseFloat(h.start.substring(1),10)*(f-e);else if("+"===h.start.charAt(0))b=e+parseInt(h.start.substring(1),10);else{if("="!==h.start.charAt(0))throw"Start of pane not properly defined";b=parseInt(h.start.substring(1),10)}else b=h.start.$x||0;h.start=a.makePoint(b,i.$min,i.$max,this.dataModel.makeInterval)}if(this.offset.$left=h.start.$x,this.offset.left=(h.start.$x-e)/(f-e),"number"==typeof h.stop)h.stop=g[h.stop];else{if(null===h.stop||void 0===h.stop)b=f;else if("string"==typeof h.stop)if("%"===h.stop.charAt(0))b=e+parseFloat(h.stop.substring(1),10)*(f-e);else if("+"===h.stop.charAt(0))b=e+parseInt(h.stop.substring(1),10);else{if("="!==h.stop.charAt(0))throw"End of pane not properly defined";b=parseInt(h.stop.substring(1),10)}else b=h.stop.$x||0;h.stop=a.makePoint(b,i.min.$x,i.max.$x,this.dataModel.makeInterval)}this.offset.$right=h.stop.$x,this.offset.right=(h.stop.$x-e)/(f-e),this.data=g,this.filtered=g.filter(function(a,b){var e=a.$x;return h.start.$x<=e&&e<=h.stop.$x?(c?d=b:c=b,a.$inPane=!0,!0):(a.$inPane=!1,!1)}),this.filtered.$first=c,this.filtered.$last=d,h.start.$faux&&this.filtered.unshift(h.start),h.stop.$faux&&this.filtered.push(h.stop),this.x.min=this.dataModel.x.min,this.x.max=this.dataModel.x.max,this.y={start:this.dataModel.y.start,stop:this.dataModel.y.stop,padding:this.dataModel.y.padding}}else this.filtered=[]},a}]),angular.module("vgraph").factory("ViewModel",["PaneModel",function(a){"use strict";function b(a,b,c,d){var e,f,g,h=0,i=a.length-1;if(g=a.get?function(b){return a.get(b)}:function(b){return a[b]},d||a.sort(function(a,b){return c(a)-c(b)}),c(g(h))>=b)return{left:h,right:h};if(c(g(i))<=b)return{left:i,right:i};if(a.length){for(;i-h>1;)e=Math.floor((i+h)/2),f=c(g(e)),f===b?(i=e,h=e):f>b?i=e:h=e;return i!==e&&c(g(i))===b?{left:i,right:i}:h!==e&&c(g(h))===b?{left:h,right:h}:{left:h,right:i}}}function c(a,c){return b(a,c,function(a){return a.$interval},!0)}function d(a,b){var d,e,f;return a.length?(d=c(a,b),e=b-a[d.left].$interval,f=a[d.right].$interval-b,a[f>e?d.left:d.right]):void 0}function e(b,c,d){var e,f,g=this;this.pane=new a(d),this.components=[],this.name=c,this.model=d,this.graph=b,e={scale:d.x.scale(),calc:function(a){return e.scale(d.x.parse(a))},center:function(){return(e.calc(g.pane.x.min)+e.calc(g.pane.x.max))/2}},this.x=e,f={scale:d.y.scale(),calc:function(a){return f.scale(d.y.parse(a))},center:function(){return(f.calc(g.pane.y.min)+f.calc(g.pane.y.max))/2}},this.y=f,d.register(function(){b.needsRender(this)}.bind(this))}function f(a,b,c,d){for(;c>b;)a[b].push(d),b++}function g(a,b,c,d,e){var g,h,i,j,k=0;for(g=0,h=a.length;h>g;g++)i=a[g][b],void 0!==i&&null!==i&&(j=d(a[g]),j!==k&&f(c,k,j,null),e&&(i=e(i)),c[j].push(i),k=j+1);f(c,k,c.length,null)}return e.bisect=b,e.prototype.getPoint=function(a){return this.model.data[a]?this.model.data[a]:0>a?this.model.data[0]:this.model.data[this.model.data.length]},e.prototype.getOffsetPoint=function(a){var b=Math.round(this.model.data.length*a);return this.getPoint(b)},e.prototype.makePoint=function(a,b,d,e){var f,g,h,i,j,k=this.model.data;if(a>b&&d>a){if(f=c(k,a),f.right===f.left)return k[f.right];g=k[f.right],h=k[f.left],i={},j=(a-h.$x)/(g.$x-h.$x),Object.keys(g).forEach(function(a){var b=h[a],c=g[a];void 0!==b&&null!==b&&void 0!==c&&null!==c&&(i[a]=b+(c-b)*j)}),i.$faux=!0}else i={$x:a};return i.$interval=e?e(i.$x):i.$x,i},e.prototype.getClosest=function(a,b){return d(b||this.model.data,a)},e.prototype.getSampledClosest=function(a){return this.getClosest(a,this.sampledData)},e.prototype.register=function(a){this.components.push(a)},e.prototype.hasData=function(){var a=this.pane.y.minimum,b=this.pane.y.maximum;return(a||0===a)&&(b||0===b)},e.prototype.calcBounds=function(){var a,b,c,d,e,f=this.graph.box,g=this.pane;g.adjust(this),b=parseInt(g.filtered.length/f.innerWidth)||1,e=g.filtered.filter(function(c,d){return g.x.start===c||g.x.stop===c||d%b===0?(a=c,c.$sampled=c,!0):(c.$sampled=a,!1)}),this.graph.samples[this.name]=e,this.components.forEach(function(a){var b;a.parse&&(b=a.parse(e,g.filtered),b&&(null!==b.min&&(!c&&0!==c||c>b.min)&&(c=b.min),null!==b.max&&(!d&&0!==d||d<b.max)&&(d=b.max)))}),g.y.top=d,g.y.bottom=c,g.y.minimum=c,g.y.maximum=d,this.sampledData=e},e.prototype.calcScales=function(a){var b,c=this.pane,d=this.graph.box,e=c.y.minimum,f=c.y.maximum;c.y.padding&&(b=(f-e)*c.y.padding,f+=b,e-=b,c.y.minimum=e,c.y.maximum=f),c.x.start?(this.model.adjustSettings&&this.model.adjustSettings(c.x.stop.$interval-c.x.start.$interval,f-e,c.filtered.$last-c.filtered.$first),this.x.scale.domain([c.x.start.$interval,c.x.stop.$interval]).range([d.innerLeft,d.innerRight]),this.y.scale.domain([e,f]).range([d.innerBottom,d.innerTop]),this.sampledData.forEach(function(b){var c=this.x.scale(b.$interval);b._$interval=c,a.addIndex(Math.floor(c),b.$interval)[this.name]=b},this)):this.sampledData=[]},e.prototype.build=function(){var a=this.pane,b=this.sampledData;this.components.forEach(function(c){c.build&&c.build(a,b,a.filtered,a.data)})},e.prototype.process=function(){var a=this.pane,b=this.sampledData;this.components.forEach(function(c){c.process&&c.process(a,b,a.filtered,a.data)})},e.prototype.finalize=function(){var a=this.pane,b=this.sampledData;this.components.forEach(function(c){c.finalize&&c.finalize(a,b,a.filtered,a.data)})},e.prototype.loading=function(){this.components.forEach(function(a){a.loading&&a.loading()})},e.prototype.publishStats=function(){var a,b,c=this.model.data,d=this.pane.x.$max||9007199254740991,e=c.length;for(a=1;e>a;a++)b=c[a].$x-c[a-1].$x,d>b&&(d=b);return{step:d,count:c.length,bound:{min:this.pane.x.$min,max:this.pane.x.$max},data:{min:this.model.x.$min,max:this.model.x.$max}}},e.prototype.publishData=function(a,b,c){g(this.model.data,b.name,a,c,b.format)},e}]),angular.module("vgraph").directive("vgraphAxis",[function(){"use strict";function a(a,b){return!(a.bottom<b.top||a.top>b.bottom||a.right<b.left||a.left>b.right)}return{scope:{orient:"=vgraphAxis",adjust:"=axisAdjust",rotation:"=tickRotation"},require:["^vgraphChart"],link:function(b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=d.control||"default",r=e[0].graph,s=r.views[q],t=d3.svg.axis(),u="axis",v=r.box,w=s.model,x=0,y=null,z=!0,A=!1,B=parseInt(d.tickLength)||0,C=parseInt(d.tickPadding)||3,D=parseInt(d.tickMargin)||0,E=d3.select(c[0]);switch(k=E.append("g").attr("class","ticks"),o=E.append("g").attr("class","padding"),l=o.append("g").attr("class","tick-marks"),m=o.append("rect").attr("class","tick-margin"),p=E.append("g").attr("class","label-wrap"),d.tickRotation&&(y=parseInt(d.tickRotation,10)%360),d.labelOffset&&(x=b.$eval(d.labelOffset)),d.labelClean&&(z=b.$eval(d.labelClean)),d.labelEndpoints&&(A=b.$eval(d.labelEndpoints)),d.axisLabel&&(n=p.append("text").attr("class","axis-label label"),b.$parent.$watch(d.axisLabel,function(a){n.text(a)})),f=function(){d.tickMarks?(t.tickValues(b.$eval(d.tickMarks)),h=[]):d.tickCount?(t.ticks(b.$eval(d.tickCount)),h=[]):(t.ticks(10),h=[])},b.orient){case"top":g=function(){var a;E.attr("class",u+" x top").attr("transform","translate("+v.left+","+(v.top-B)+")").attr("width",v.width).attr("height",v.padding.top),n&&n.attr("text-anchor","middle").attr("x",v.width/2).attr("y",v.padding.top-x),D&&m.attr("height",D).attr("width",v.innerWidth).attr("x",0).attr("y",-D),l.attr("transform","translate(-"+v.margin.left+",0)"),h&&(t.orient("top").tickFormat(w.x.format).innerTickSize(-(v.innerHeight+B+D)).outerTickSize(0).tickPadding(C+B+D).scale(s.x.scale),w.x.tick.interval&&t.ticks(w.x.tick.interval,w.x.tick.step),k.attr("transform","translate(-"+v.margin.left+","+v.padding.top+")").call(t),a=E.selectAll("g.axis-cap").data(s.x.scale.domain()),A&&(a.enter().append("g").attr("class",function(a,b){return"axis-cap "+(b?"axis-max":"axis-min")}).append("text"),a.exit().remove(),a.attr("transform",function(a){return"translate("+(s.x.scale(a)-v.margin.left)+",0)"}).select("text").text(function(a){var b=w.x.format(a);return(""+b).match("NaN")?"":b}).attr("dy","-0.25em").attr("y",v.padding.top).attr("text-anchor","middle")),y&&(k.selectAll(".tick text").attr("transform","translate(0,"+k.select(".tick text").attr("y")+") rotate("+y+",0,0)").attr("y","0").style("text-anchor",y%360>0?"end":"start"),a.select("text").attr("transform","rotate("+y+",0,0)").style("text-anchor",b.rotation%360>0?"end":"start")))};break;case"bottom":g=function(){var a;E.attr("class",u+" x bottom").attr("transform","translate("+v.left+","+v.innerBottom+")").attr("width",v.width).attr("height",v.padding.bottom),n&&n.attr("text-anchor","middle").attr("x",v.width/2).attr("y",v.padding.bottom+x),D&&m.attr("height",D).attr("width",v.innerWidth).attr("x",0).attr("y",0),l.attr("transform","translate(-"+v.margin.left+",0)"),h&&(t.orient("bottom").tickFormat(w.x.format).innerTickSize(v.innerHeight+B+D).outerTickSize(0).tickPadding(C+B+D).scale(s.x.scale),w.x.tick.interval&&t.ticks(w.x.tick.interval,w.x.tick.step),k.attr("transform","translate(-"+v.margin.left+","+-v.innerHeight+")").call(t),a=E.selectAll("g.axis-cap").data(s.x.scale.domain()),A&&(a.enter().append("g").attr("class",function(a,b){return"axis-cap "+(b?"axis-max":"axis-min")}).append("text"),a.exit().remove(),a.attr("transform",function(a){return"translate("+(s.x.scale(a)-v.margin.left)+",0)"}).select("text").text(function(a){var b=w.x.format(a);return(""+b).match("NaN")?"":b}).attr("dy","1em").attr("y",0).attr("text-anchor","middle")),y&&(k.selectAll(".tick text").attr("transform",function(){return"translate(0,"+d3.select(this).attr("y")+") rotate("+y+",0,0)"}).attr("y","0").style("text-anchor",y%360>0?"start":"end"),a.select("text").attr("transform","rotate("+y+",0,0)").style("text-anchor",b.rotation%360>0?"start":"end")))};break;case"right":g=function(){var a;E.attr("class",u+" y right").attr("transform","translate("+B+","+v.top+")").attr("width",v.padding.right).attr("height",v.height),p.attr("transform","translate("+(v.right-v.padding.right)+","+v.height+") rotate( 90 )"),n&&n.attr("text-anchor","middle").attr("x",-(v.height/2)).attr("y",-x),D&&m.attr("height",v.innerHeight).attr("width",D).attr("x",-D).attr("y",0),l.attr("transform","translate(-"+v.padding.right+","+(-v.top||0)+")"),h&&(t.orient("right").tickFormat(w.y.format).innerTickSize(-(v.innerWidth+B+D)).outerTickSize(0).tickPadding(C+B+D).scale(s.y.scale),w.y.tick.interval&&t.ticks(w.y.tick.interval,w.y.tick.step),k.attr("transform","translate("+v.innerRight+","+(-v.top||0)+")"),k.call(t),k.select(".domain").attr("transform","translate("+(B+D)+",0)"),A&&(a=E.selectAll("g.axis-cap").data(s.y.scale.domain()),a.enter().append("g").attr("class",function(a,b){return"axis-cap "+(b?"axis-max":"axis-min")}).append("text"),a.exit().remove(),a.attr("transform",function(a){return"translate(0,"+(s.y.scale(a)-v.margin.top)+")"}).select("text").text(function(a){var b=w.y.format(a);return(""+b).match("NaN")?"":b}).attr("dy",".25em").attr("x",v.padding.left-t.tickPadding()).attr("text-anchor","end")))};break;case"left":g=function(){var a;E.attr("class",u+" y left").attr("transform","translate("+v.left+","+v.top+")").attr("width",v.padding.left).attr("height",v.height),p.attr("transform","translate("+v.padding.left+","+v.height+") rotate( -90 )"),n&&n.attr("text-anchor","middle").attr("x",v.height/2).attr("y",-x),D&&m.attr("height",v.innerHeight).attr("width",D).attr("x",-D).attr("y",0),l.attr("transform","translate("+v.padding.left+","+(-v.top||0)+")"),h&&(t.orient("left").tickFormat(w.y.format).innerTickSize(-(v.innerWidth+B+D)).outerTickSize(0).tickPadding(C+B+D).scale(s.y.scale),w.y.tick.interval&&t.ticks(w.y.tick.interval,w.y.tick.step),k.attr("transform","translate("+(v.padding.left-B-D)+","+(-v.top||0)+")").call(t),k.select(".domain").attr("transform","translate("+(B+D)+",0)"),A&&(a=E.selectAll("g.axis-cap").data(s.y.scale.domain()),a.enter().append("g").attr("class",function(a,b){return"axis-cap "+(b?"axis-max":"axis-min")}).append("text"),a.exit().remove(),a.attr("transform",function(a){return"translate(0,"+(s.y.scale(a)-v.margin.top)+")"}).select("text").text(function(a){var b=w.y.format(a);return(""+b).match("NaN")?"":b}).attr("dy",".25em").attr("x",v.padding.left-t.tickPadding()).attr("text-anchor","end")))}}s.register({build:function(){void 0===h&&f(),g()},process:function(){h.length=0,B&&(k.selectAll(".tick text").each(function(a){h.push({el:this,val:a,position:this.getBoundingClientRect()})}),h.sort(function(a,b){var c=a.position.top-b.position.top;return c?c:a.position.left-b.position.left})),z&&(i=E.select(".axis-min text").node(),i&&(i=i.getBoundingClientRect()),j=E.select(".axis-max text").node(),j&&(j=j.getBoundingClientRect()))},loading:function(){E.attr("visibility","hidden")},finalize:function(){var b,c,d,e,f,g,k={};for(E.attr("visibility",""),l.selectAll("line").remove(),e=0,f=h.length;f>e;e++)b=!0,c=h[e],d=c.position,z&&i&&(a(d,i)||a(d,j))?(c.el.setAttribute("class","collided"),b=!1):void 0===k.left?(k.left=d.left,k.right=d.right,k.width=d.width,k.top=d.top,k.bottom=d.bottom,k.height=d.height,c.el.setAttribute("class","")):z&&a(d,k)?(c.el.setAttribute("class","collided"),b=!1):(g=!1,d.left<k.left&&(k.left=d.left,g=!0),d.right>k.right&&(k.right=d.right,g=!0),g&&(k.width=k.right-k.left,g=!1),d.top<k.top&&(k.top=d.top,g=!0),d.bottom>k.bottom&&(k.bottom=d.bottom,g=!0),g&&(k.height=k.bottom-k.top),c.el.setAttribute("class",""))}},"axis-"+b.orient)}}}]),angular.module("vgraph").directive("vgraphBar",["$compile","ComponentGenerator",function(a,b){"use strict";return{require:["^vgraphChart"],scope:{data:"=?vgraphBar",config:"=config"},link:function(c,d,e,f){function g(d){var e,f,g,h;if(d){for(d3.select(n).selectAll("path").remove(),i=b.compileConfig(c,d,"line");m.length;)m.pop().$destroy();for(f=0,g=i.length;g>f;f++)h=i[f],h.$valueField="$"+h.name,f?(n.insertBefore(h.element,i[f-1].element),h.$bottom=i[f-1].$valueField,h.calc=b.makeLineCalc(l,h.$valueField,h.$bottom)):(n.appendChild(h.element),h.calc=b.makeLineCalc(l,h.$valueField)),e=c.$new(),m.push(e),a(h.element)(e)}}function h(a,b,c,d){var e,f,g,h,j,m,n,r,s,t,u,v,w,x,y,z;for(j=b;c>j;j++)s=a[j],s&&(s.$els=[]);for(g=0,h=i.length;h>g;g++){for(n=i[g],z=i[g].$valueField,m=0,r=0,j=b,f=[];c>j;)s=a[j],s&&void 0!==s[z]&&(m+=s[z],r++,t=s),j++;if(m){for(v=l.y.scale(m/r),void 0===w&&(a[b]===t?(w=t._$interval-o/2,x=w+o):(w=a[b]._$interval+p,x=t._$interval-p),w<k.box.innerLeft?w=k.box.innerLeft:a[b-1]&&a[b-1]._$interval>w&&(w=a[b-1]._$interval+p),x>k.box.innerRight?x=k.box.innerRight:a[j]&&a[j]._$interval<x&&(x=a[j]._$interval-p),w>x&&(y=w,w=x,x=y),y=x-w),void 0===u?e=q.append("rect").attr("height",l.y.scale(d.y.minimum)-v):(e=q.append("rect"),u>v&&e.attr("height",u-v)),e.attr("class","bar "+n.className).attr("y",v).attr("x",w).attr("width",y),e=e[0][0],j=b;c>j;j++)s=a[j],s&&(s.$els.push(e),s.$bar={center:(w+x)/2,top:m/r});u=v}}}var i,j=e.control||"default",k=f[0].graph,l=k.views[j],m=[],n=d[0],o=parseInt(e.minWidth||1),p=parseInt(e.padding||1),q=d3.select(n).append("g").attr("class","mount");c.$watchCollection("config",g),l.register({parse:function(a){return b.parseStackedLimits(a,i)},build:function(a,b){var c,d,e=0,f=l.x.scale(a.x.min.$interval),g=l.x.scale(a.x.max.$interval),i=g-f,j=p+o,k=i/j,m=b.length/k;for(q.selectAll("rect").remove(),1>m&&(m=1),c=0,d=b.length;d>c;c=Math.floor(e))e+=m,h(b,c,e,a)},finalize:function(a,b){var c,d,e;for(c=0,d=i.length;d>c;c++)e=i[c],e.$d3.attr("d",e.calc(b))}})}}}]),angular.module("vgraph").directive("vgraphChart",[function(){"use strict";function a(a,b){b&&(a.$mat=d3.select(b).insert("rect",":first-child"),a.$frame=d3.select(b).insert("rect",":first-child")),a.$mat&&a.innerWidth&&(a.$mat.attr("class","mat").attr("width",a.innerWidth).attr("height",a.innerHeight).attr("transform","translate("+a.innerLeft+","+a.innerTop+")"),a.$frame.attr("class","frame").attr("width",a.width).attr("height",a.height).attr("transform","translate("+a.left+","+a.top+")"))
}return{scope:{graph:"=vgraphChart",model:"=model"},controller:["$scope",function(b){var c=b.model,d=b.graph;this.graph=d,d.addDataCollection(c),d.box.register(function(){a(d.box),d.rerender()})}],require:["vgraphChart"],link:function(b,c,d,e){var f=e[0].graph;f.box.targetSvg(c),a(f.box,c[0]),b.$watch("model.loading",function(a){a?c.addClass("loading"):c.removeClass("loading")}),b.$watch("model.error",function(a){a?c.addClass("hasError"):c.removeClass("hasError")})},restrict:"A"}}]),angular.module("vgraph").directive("vgraphClassifier",["ComponentGenerator",function(a){"use strict";function b(a,b,c){var d,e;for(d=c.length-1;d>=0;d--)e=c[d],e.$els.length&&(b(e)?$(e.$els).addClass(a):$(e.$els).removeClass(a))}return a.generate("vgraphClassifier",{scope:{classes:"=classes"},preLink:function(a){a.loadPoint=function(a){var b=this.intervalParse(a),c=this.model.getPoint(b);c&&this.valueParse(a,c)}},link:function(a,c,d,e){var f=d.control||"default",g=e[0].graph.views[f];g.register({finalize:function(c,d){var e,f,g,h,i=a.classes,j=Object.keys(i);for(e=0,f=j.length;f>e;e++)g=j[e],h=i[g],b(g,h,d)}})}})}]),angular.module("vgraph").directive("vgraphCompare",["$compile","ComponentGenerator",function(a,b){"use strict";return{require:["^vgraphChart"],scope:{config:"=config"},link:function(a,c,d,e){function f(a){function c(){g.$d3.attr("d",g.calc(h.unified)),d=!1,e=!1}var d=!1,e=!1,f=Object.keys(a),j=f[0],k=h.views[a[j]],l=f[1],m=h.views[a[l]];a&&2===f.length&&(g&&g.$d3.remove(),g={$d3:d3.select(i).append("path").attr("class","fill"),calc:b.makeMyFillCalc(k,j,m,l,function(a,b,c,d,e){a.$compare={value:{middle:(b+c)/2,difference:Math.abs(b-c)},position:{middle:(d+e)/2,top:d,bottom:e}}})},k.register({finalize:function(){d=!0,c()}}),m.register({finalize:function(){e=!0,c()}}))}var g,h=e[0].graph,i=c[0];a.$watchCollection("config",f)}}}]),angular.module("vgraph").directive("vgraphFeed",["ComponentGenerator",function(a){"use strict";return a.generate("vgraphFeed",{restrict:"A"})}]),angular.module("vgraph").directive("vgraphFill",["$compile","ComponentGenerator",function(a,b){"use strict";return b.generate("vgraphFill",{scope:{data:"=vgraphFill",fillTo:"=fillTo",value:"=value",interval:"=interval",filter:"=filter"},link:function(c,d,e,f){var g,h=e.control||"default",i=f[0].graph.views[h],j=e.name,k=d3.select(d[0]).append("path").attr("class","fill plot-"+j),l=d3.svg.area().defined(function(a){var b=a[j];return!(isNaN(b)||null===b)}).x(function(a){return i.x.scale(a.$interval)}).y(function(a){return i.y.scale(a[j])}).y1(function(a){var b,d=c.fillTo;return b=i.y.scale(void 0===d?i.pane.y.minimum:"object"==typeof d?c.fillTo.$min:"string"==typeof d?a[d]:d)});"string"==typeof c.fillTo&&(g=b.svgCompile('<g vgraph-feed="data" name="'+c.fillTo+'" value="fillTo" interval="interval" control="'+h+'"></g>')[0],d[0].appendChild(g),a(g)(c)),i.register({parse:function(a,c){return b.parseLimits(c,j)},finalize:function(a,b){k.attr("d",l(b))}})}})}]),angular.module("vgraph").directive("vgraphFocus",[function(){"use strict";return{require:["^vgraphChart"],link:function(a,b,c,d){var e=d[0].graph,f=e.box,g=d3.select(b[0]),h=g.append("rect").attr("class","focus").attr("visibility","hidden");f.register(function(){h.attr("height",f.innerHeight).attr("y",f.innerTop)}),a.$watch("follow",function(a){var b,c,d;a&&void 0!==a.xDiff&&(b=Math.abs(a.xDiff),c=a.x0-b,d=a.x0+b,h.attr("visibility","visible"),c>f.innerLeft?h.attr("x",c):(c=f.innerLeft,h.attr("x",f.innerLeft)),d>f.innerRight?h.attr("width",f.innerRight-c):h.attr("width",d-c))}),a.$watch("stop",function(a){var b,c,d,g,i;a&&(h.attr("visibility","hidden"),b=Math.abs(a.xDiff),b>3&&(c=a.x0-b,d=a.x0+b,c<f.innerLeft?c=0:c-=f.innerLeft,d>f.innerRight?d=f.innerWidth:d-=f.innerLeft,g=e.getPrimaryView().pane.offset,i=f.innerWidth*g.right-f.innerWidth*g.left,e.setPane({start:"%"+(f.innerWidth*g.left+c/f.innerWidth*i)/f.innerWidth,stop:"%"+(f.innerWidth*g.right-(f.innerWidth-d)/f.innerWidth*i)/f.innerWidth},{start:null,stop:null}),e.rerender()))})},scope:{follow:"=vgraphFocus",stop:"=loseFocus"}}}]),angular.module("vgraph").directive("vgraphIcon",["ComponentGenerator",function(a){"use strict";return a.generate("vgraphIcon",{scope:{getValue:"=trueValue"},link:function(b,c,d,e){var f,g,h,i=d.control||"default",j=e[0].graph.views[i],k=c[0],l=d.name,m=[],n=d3.select(k),o=n.node().getBBox();for(void 0===d.value&&(b.value=l),f=0,g=k.childNodes.length;g>f;f++)1===k.childNodes[f].nodeType&&m.push(k.childNodes[f]);c.html(""),j.register({parse:function(b,c){return h=[],a.parseLimits(c,l,function(a,b){b&&h.push(a)})},build:function(){function a(){return this.appendChild(m[g].cloneNode(!0))}var e,f,g,i;c.html(""),angular.forEach(h,function(c){var h;for(e=c.$sampled._$interval,f=j.y.scale(b.getValue(c.$sampled)),h=n.append("g"),g=0,i=m.length;i>g;g++)h.select(a);d.showUnder?h.attr("transform","translate("+(e-o.width/2)+","+f+")"):h.attr("transform","translate("+(e-o.width/2)+","+(f-o.height)+")")})}})}})}]),angular.module("vgraph").directive("vgraphIndicator",[function(){"use strict";return{require:["^vgraphChart"],scope:{model:"=model"},link:function(a,b,c,d){var e,f=c.control||"default",g=d[0].graph.views[f],h=c.vgraphIndicator,i=g.model,j=a.$eval(c.pointRadius)||3,k=a.$eval(c.outerRadius),l=d3.select(b[0]).attr("transform","translate(1000,1000)"),m=l.append("circle").attr("class","point inner").attr("r",j).attr("visibility","hidden"),n=l.append("circle").attr("class","point outer").attr("r",j).attr("visibility","hidden");k&&(e=function(){n.transition().duration(1e3).attr("r",k).transition().duration(1e3).attr("r",j).ease("sine").each("end",function(){setTimeout(function(){e()},3e3)})})(),g.register({finalize:function(a){var b,c,d;i.plots[h]?(b=i.plots[h].x.max,a.isValid(b)&&b[h]?(c=g.x.scale(b.$interval),d=g.y.scale(b["$"+h]||b[h]),m.attr("visibility","visible"),n&&n.attr("visibility","visible"),l.transition().duration(i.transitionDuration).ease("linear").attr("transform","translate("+c+","+d+")")):(m.attr("visibility","hidden"),n&&n.attr("visibility","hidden"))):(m.attr("visibility","hidden"),n&&n.attr("visibility","hidden"))}})}}}]),angular.module("vgraph").directive("vgraphInteract",[function(){"use strict";return{require:["^vgraphChart"],scope:{highlight:"=vgraphInteract",dragStart:"=?dBegin",dragPos:"=?dChange",dragStop:"=?dEnd"},link:function(a,b,c,d){function e(b,c,d,e){clearTimeout(h),a.$apply(function(){var f=d3.mouse(b);angular.forEach(a.highlight.point,function(a){$(a.$els).removeClass("active")}),a.highlight.offset=c,a.highlight.point=d,a.highlight.closest=e,a.highlight.position={x:f[0],y:f[1]},angular.forEach(a.highlight.point,function(a){$(a.$els).addClass("active")})})}function f(){h=setTimeout(function(){a.$apply(function(){angular.forEach(a.highlight.point,function(a){$(a.$els).removeClass("active")}),a.highlight.point=null,a.highlight.closest=null,a.highlight.offset=null})},100)}var g,h,i=d[0].graph,j=!1,k=i.box,l=d3.select(b[0]),m=l.append("rect").style("opacity","0").attr("class","focal").on("mousemove",function(){var a,b={},c=d3.mouse(this)[0];j||(a=Object.keys(i.views),a.forEach(function(a){var d=i.views[a],e=d.x.scale.invert(c);b[a]=d.getSampledClosest(e)}),e(this,c,i.unified.getClosest(c),b))}).on("mouseout",function(a){j||f(this,a)});l.attr("class","interactive"),l.call(d3.behavior.drag().on("dragstart",function(){g=d3.mouse(b[0]),j=!0,f(),a.dragStart={x:g[0],y:g[1]},a.$apply()}).on("dragend",function(){var c=d3.mouse(b[0]);j=!1,a.dragStop={x0:g[0],y0:g[1],x1:c[0],x2:c[1],xDiff:c[0]-g[0],yDiff:c[1]-g[1]},a.$apply()}).on("drag",function(){var c=d3.mouse(b[0]);a.dragPos={x0:g[0],y0:g[1],x1:c[0],x2:c[1],xDiff:c[0]-g[0],yDiff:c[1]-g[1]},a.$apply()})),l.on("dblclick",function(){i.setPane({start:null,stop:null},{start:null,stop:null}),i.rerender()}),angular.forEach(i.views,function(a){a.register({finalize:function(){m.attr({x:k.innerLeft,y:k.innerTop,width:k.innerWidth,height:k.innerHeight})}})}),a.highlight||(a.highlight={}),a.dragStart||(a.dragStart={}),a.dragPos||(a.dragPos={}),a.dragStop||(a.dragStop={})}}}]),angular.module("vgraph").directive("vgraphLeading",[function(){"use strict";return{require:["^vgraphChart"],scope:{config:"=config"},link:function(a,b,c,d){function e(a){var b,c,d;if(f={},j.selectAll("line").remove(),a)for(c=0,d=a.length;d>c;c++)b=a[c],f[b.name]=j.append("line").attr("class",b.className)}var f,g=c.control||"default",h=d[0].graph,i=h.views[g],j=d3.select(b[0]);a.$watchCollection("config",e),i.register({finalize:function(a){var b,c,d=i.model,e=[];angular.forEach(f,function(c,f){d.plots[f]&&(b=d.plots[f].x.max,a.isValid(b)&&b[f]&&e.push({el:c,x:i.x.scale(b.$interval),y:i.y.scale(b["$"+f]||b[f])}))}),e.sort(function(a,b){return a.y-b.y}),angular.forEach(e,function(a){c&&c.el.attr("x1",c.x).attr("x2",a.x).attr("y1",c.y).attr("y2",a.y),c=a}),c?(j.style("visibility","visible"),c.el.attr("x1",c.x).attr("x2",c.x).attr("y1",c.y).attr("y2",h.box.innerBottom)):j.style("visibility","hidden")}})}}}]),angular.module("vgraph").directive("vgraphLine",["ComponentGenerator",function(a){"use strict";return a.generate("vgraphLine",{link:function(b,c,d,e){var f=d.control||"default",g=e[0].graph.views[f],h=d.name,i=d3.select(c[0]).append("path").attr("class","line plot-"+h),j=a.makeLineCalc(g,h);g.register({parse:function(b){return a.parseLimits(b,h)},finalize:function(a,b){var c;i.attr("d",j(b.filter(function(a,d){var e,f=c;return c=a[h],f!==c?!0:(e=b[d+1],!e||e[h]!==c)})))},publish:function(b,c,d,e){c.push(h),a.publish(b,h,d,e)}})}})}]),angular.module("vgraph").directive("vgraphLoading",["$interval",function(a){"use strict";return{require:["^vgraphChart"],link:function(b,c,d,e){function f(){!n&&m.loading&&(q.attr("visibility","visible"),n=!0,a.cancel(i),h(),i=a(h,4005))}function g(){q.attr("visibility","hidden"),n=!1,a.cancel(i)}function h(){s.attr("x",function(){return j}).attr("width",function(){return 0}).transition().duration(1e3).attr("x",function(){return j}).attr("width",function(){return k}).ease("sine").transition().duration(1e3).attr("width",0).attr("x",function(){return l}).ease("sine").transition().duration(1e3).attr("width",function(){return k}).attr("x",function(){return j}).ease("sine").transition().duration(1e3).attr("x",function(){return j}).attr("width",0).ease("sine")}var i,j,k,l,m=e[0].graph,n=!1,o=m.box,p=d.vgraphLoading||"Loading Data",q=d3.select(c[0]).attr("class","loading-view"),r=q.append("rect").attr("height",20).attr("class","outline"),s=q.append("rect").attr("width",0).attr("height",20).attr("class","filling"),t=q.append("text").text(p);o.register(function(){if(j=o.innerLeft+o.innerWidth/5,k=3*o.innerWidth/5,l=j+k,k){s.attr("x",j).attr("y",o.middle-10),r.attr("x",j).attr("y",o.middle-10).attr("width",k);try{t.attr("text-anchor","middle").attr("x",o.center).attr("y",o.middle+t.node().getBBox().height/2-2)}catch(a){t.attr("text-anchor","middle").attr("x",o.center).attr("y",o.middle)}f()}else g()}),b.$on("$destroy",function(){g()}),b.$watch(function(){return m.loading},function(a){g(),a&&o.ratio&&f()})}}}]),angular.module("vgraph").directive("vgraphMessage",[function(){"use strict";return{require:["^vgraphChart"],link:function(a,b,c,d){var e=d[0].graph,f=e.box,g=d3.select(b[0]).attr("class","error-view"),h=g.append("rect").attr("class","outline"),i=g.append("text");f.register(function(){if(f.innerHeight){h.attr("transform","translate("+f.innerLeft+","+f.innerTop+")").attr("width",f.innerWidth).attr("height",f.innerHeight);try{i.attr("text-anchor","middle").attr("x",f.center).attr("y",f.middle+i.node().getBBox().height/2)}catch(a){i.attr("text-anchor","middle").attr("x",f.center).attr("y",f.middle)}}}),a.$watch(function(){return e.message},function(a){a?(g.attr("visibility","visible"),i.text(a)):g.attr("visibility","hidden")})}}}]),angular.module("vgraph").directive("vgraphMultiIndicator",["$compile",function(a){"use strict";return{scope:{config:"=config"},link:function(b,c,d){function e(c){var e,h,i,j,k,l,m,n,o=b.$eval(d.pointRadius)||3,p=b.$eval(d.outerRadius),q="";if(c){for(d3.select(g).selectAll("g").remove();f.length;)f.pop().$destroy();for(i=0,j=c.length;j>i;i++)n=c[i],m=n.name,k=n.className?n.className:"plot-"+m,q+='<g class="'+k+'" vgraph-indicator="'+m+'"'+(p?' outer-radius="'+p+'"':"")+' point-radius="'+o+'"></g>';for(l=(new DOMParser).parseFromString('<g xmlns="http://www.w3.org/2000/svg">'+q+"</g>","image/svg+xml").childNodes[0].childNodes;l.length;)h=l[0],g.appendChild(h),e=b.$new(),f.push(e),a(h)(e)}}var f=[],g=c[0];b.$watchCollection("config",e)}}}]),angular.module("vgraph").directive("vgraphMultiLine",["$compile","ComponentGenerator",function(a,b){"use strict";var c=0;return{require:["^vgraphChart"],scope:{data:"=vgraphMultiLine",config:"=config"},link:function(d,e,f,g){function h(c){var e,f,g,h,k,n;if(j=[],c){for(d3.select(q).selectAll("path").remove();p.length;)p.pop().$destroy();for(k=b.compileConfig(d,c,"line"),o={},f=0,g=k.length;g>f;f++)n=k[f],h=m.views[n.$conf.control||l],o[h.name]||(o[h.name]=[],i(h)),o[h.name].push(n),q.appendChild(n.element),n.calc=b.makeLineCalc(h,n.name),e=d.$new(),p.push(e),a(n.element)(e)}}function i(a){n[a.name]||(n[a.name]=a,a.register({parse:function(c){var d,e,f=[],g=o[a.name];if(g)for(d=0,e=g.length;e>d;d++)f.push(g[d].name);return b.parseLimits(c,f)},finalize:function(b,c){var d,e,f,g=o[a.name];if(g)for(d=0,e=g.length;e>d;d++)f=g[d],f.$d3.attr("d",f.calc(c))}}))}var j,k,l=f.control||"default",m=g[0].graph,n={},o={},p=[],q=e[0],r=c++;q.$id=r,k=d.$watchCollection("config",h),d.$on("$destroy",function(){for(;p.length;)p.pop().$destroy();k()})}}}]),angular.module("vgraph").directive("vgraphMultiTooltip",["$compile",function(a){"use strict";return{scope:{config:"=config",formatter:"=textFormatter",data:"=vgraphMultiTooltip"},link:function(b,c,d){function e(c){var e,h,i,j,k,l,m,n,o="";if(c){for(d3.select(g).selectAll("g").remove();f.length;)f.pop().$destroy();for(i=0,j=c.length;j>i;i++)n=c[i],m=n.name,k=n.className?n.className:"plot-"+m,o+='<g class="'+k+'" vgraph-tooltip="data" name="'+m+'" text-formatter="formatter"'+(d.offseX?' offset-x="'+d.offsetX+'"':"")+(d.offseY?' offset-y="'+d.offsetY+'"':"")+"></g>";for(l=(new DOMParser).parseFromString('<g xmlns="http://www.w3.org/2000/svg">'+o+"</g>","image/svg+xml").childNodes[0].childNodes;l.length;)h=l[0],g.appendChild(h),e=b.$new(),f.push(e),a(h)(e)}}var f=[],g=c[0];b.$watchCollection("config",e)}}}]),angular.module("vgraph").directive("vgraphStack",["$compile","ComponentGenerator",function(a,b){"use strict";return{require:["^vgraphChart"],scope:{config:"=config"},link:function(c,d,e,f){function g(d){var e,f,g,i;if(d){for(d3.select(m).selectAll("path").remove(),h=b.compileConfig(c,d,"fill");l.length;)l.pop().$destroy();for(f=0,g=h.length;g>f;f++)i=h[f],i.$valueField="$"+i.name,f?(m.insertBefore(i.element,h[f-1].element),i.$bottom=h[f-1].$valueField,i.calc=b.makeMyFillCalc(k,i.$valueField,k,i.$bottom)):(m.appendChild(i.element),i.calc=b.makeMyFillCalc(k,i.$valueField)),e=c.$new(),l.push(e),a(i.element)(e)}}var h,i=e.control||"default",j=f[0].graph,k=j.views[i],l=[],m=d[0];c.$watchCollection("config",g),k.register({parse:function(a){return b.parseStackedLimits(a,h)},finalize:function(){var a,b,c;for(a=0,b=h.length;b>a;a++)c=h[a],c.$d3.attr("d",c.calc(j.unified))}})}}}]),angular.module("vgraph").directive("vgraphTarget",[function(){"use strict";return{require:["^vgraphChart"],scope:{pointRadius:"=pointRadius",target:"=vgraphTarget",config:"=?config"},link:function(a,b,c,d){function e(a){var b,c,d={};if(a)for(b=0,c=a.length;c>b;b++)a[b]&&(d[a[b].name]=a[b].className);return d}function f(a){g=a,a?(k.style("visibility","visible").attr("transform","translate("+a+",0)"),angular.forEach(o,function(a){a&&a()})):k.style("visibility","hidden")}var g,h,i=d[0].graph,j=i.box,k=d3.select(b[0]).attr("class","target"),l=k.append("line").attr("class","focus").attr("x1",0).attr("x2",0),m=k.append("g"),n=c.type||"point",o={};c.offset?a.$watch("target.offset",f):a.$watch("target.point.$index",function(a){f(a)}),a.$watchCollection(function(){var b=c.control;try{b=a.$eval(c.control),angular.isString(b)&&(b=[b])}catch(d){}return b||(b=c.control?[c.control]:Object.keys(i.views)),b},function(b){angular.forEach(h,function(a){a()}),h=[],angular.forEach(b,function(b){var d,f=i.views[b],j=f.model;d=a.$watch('config["'+b+'"]',function(d){var h=e(d);o[b]=function(){var d,e,i=a.target[n][b];if(h&&i&&void 0===c.noDots){m.selectAll("circle.point."+b).remove();for(d in j.plots)i[d]&&(e=h[d]||"plot-"+d,m.append("circle").attr("class","point "+e+" "+b).attr("cx",c.offset?i._$interval-g:0).attr("cy",f.y.scale(i[d])).attr("r",a.$eval(c.pointRadius)||3))}else m.selectAll("circle.point."+b).remove()}}),h.push(function(){d(),o[b]=null})})}),j.register(function(){l.attr("y1",j.innerTop).attr("y2",j.innerBottom)})}}}]),angular.module("vgraph").directive("vgraphTooltip",[function(){"use strict";return{require:["^vgraphChart"],scope:{formatter:"=textFormatter",data:"=vgraphTooltip",value:"=?value",position:"=?yValue"},link:function(a,b,c,d){var e=c.control||"default",f=d[0].graph,g=f.views[e],h=c.name,i=a.formatter||function(a){var b=g.model;return b.y.format(b.y.parse(a))},j=parseInt(c.offsetX)||0,k=parseInt(c.offsetY)||0,l=d3.select(b[0]).attr("class","tooltip"),m=l.append("polygon").attr("class","outline").attr("transform","translate(0,-15)"),n=l.append("text").style("line-height","20").style("font-size","16").attr("class","label");a.$watch("data.point",function(b){var c,d,o,p,q;b&&(c=b[e],d=a.value?a.value(b):c[h],void 0!==d&&(o=a.position?a.position(b):g.y.scale(d),p=b.$index+j,n.text(i(d,c,b)),q=n.node().getComputedTextLength()+5,l.style("visibility","visible"),p+q+16<f.box.innerRight?(l.attr("transform","translate("+p+","+(o+k)+")"),n.attr("transform","translate(10,5)"),m.attr("points","0,15 10,0 "+(q+10)+",0 "+(q+10)+",30 10,30 0,15")):(l.attr("transform","translate("+(p-2*j-q-10)+","+(o+k)+")"),n.attr("transform","translate(5,5)"),m.attr("points","0,0 "+q+",0 "+(q+10)+",15 "+q+",30 0,30 0,0")))),void 0===d&&l.style("visibility","hidden")})}}}]),angular.module("vgraph").directive("vgraphZone",["ComponentGenerator",function(a){"use strict";return a.generate("vgraphZone",{link:function(a,b,c,d){var e=c.control||"default",f=d[0].graph,g=f.views[e],h=f.box,i=c.name,j=d3.select(b[0]).append("path").attr("class","line plot-"+i),k=d3.svg.area().defined(function(a){return a[i]===!0}).x(function(a){return g.x.scale(a.$interval)}).y(function(){return h.innerTop}).y1(function(){return h.innerBottom});g.register({finalize:function(a){j.attr("d",k(a))}})}})}]),angular.module("vgraph").directive("vgraphZoom",[function(){"use strict";return{scope:{target:"=vgraphZoom",min:"=zoomMin",max:"=zoomMax"},require:["^vgraphChart"],link:function(a,b,c,d){function e(b){0===g&&h===n.innerWidth?(q=!1,v.attr("class","focus")):(q=!0,v.attr("class","focus zoomed")),0>g&&(g=0),h>n.innerWidth&&(h=n.innerWidth),g>h?g=h:g>h&&(h=g),s.attr("transform","translate("+g+",0)"),t.attr("transform","translate(-"+g+",0 )").attr("width",g),w.attr("transform","translate("+h+",0)"),x.attr("width",n.innerWidth-h),v.attr("transform","translate("+g+",0)").attr("width",h-g),b||a.$apply(function(){o.setPane({start:"%"+g/n.innerWidth,stop:"%"+h/n.innerWidth},{start:null,stop:null}),o.rerender()})}var f,g,h,i,j,k,l,m=d[0].graph,n=m.box,o=a.target,p=!1,q=!1,r=d3.select(b[0]),s=r.append("g").attr("class","left-control min-control"),t=s.append("rect").attr("class","shade"),u=s.append("g").attr("class","control"),v=r.append("rect").attr("class","focus"),w=r.append("g").attr("class","right-control max-control"),x=w.append("rect").attr("class","shade"),y=w.append("g").attr("class","control");j=u.append("path").attr("d","M-0.5,23.33A6,6 0 0 0 -6.5,29.33V40.66A6,6 0 0 0 -0.5,46.66ZM-2.5,31.33V38.66M-4.5,31.33V38.66").attr("transform","translate(0,-9)").attr("class","nub"),i=u.append("rect").attr("width","10").attr("transform","translate(-10,0)"),l=y.append("path").attr("d","M0.5,23.33A6,6 0 0 1 6.5,29.33V40.66A6,6 0 0 1 0.5,46.66ZM2.5,31.33V38.66M4.5,31.33V38.66").attr("transform","translate(0,-9)").attr("class","nub"),k=y.append("rect").attr("width","10"),a.box=n,i.call(d3.behavior.drag().on("dragstart",function(){p=!0}).on("dragend",function(){p=!1}).on("drag",function(){g=d3.mouse(b[0])[0],e()})),k.call(d3.behavior.drag().on("dragstart",function(){p=!0}).on("dragend",function(){p=!1}).on("drag",function(){h=d3.mouse(b[0])[0],e()})),v.call(d3.behavior.drag().on("dragstart",function(){f={mouse:d3.mouse(b[0])[0],minPos:g,maxPos:h},p=!0}).on("dragend",function(){p=!1,q=!0}).on("drag",function(){var a=d3.mouse(b[0]),c=a[0]-f.mouse;q?(h=f.maxPos+c,g=f.minPos+c,e()):c>1&&(h=f.mouse+Math.abs(c),g=f.mouse-Math.abs(c),e(),q=!1)})),r.on("dblclick",function(){h=n.innerWidth,g=0,e()}),n.register(function(){r.attr("width",n.innerWidth).attr("height",n.innerHeight).attr("transform","translate("+n.innerLeft+","+n.innerTop+")"),l.attr("transform","translate(0,"+(n.innerHeight/2-30)+")"),j.attr("transform","translate(0,"+(n.innerHeight/2-30)+")"),t.attr("height",n.innerHeight),x.attr("height",n.innerHeight),i.attr("height",n.innerHeight),k.attr("height",n.innerHeight),v.attr("height",n.innerHeight)}),o.register(function(a){p||(a.offset?(g=a.offset.left*n.innerWidth,h=a.offset.right*n.innerWidth):(g=0,h=n.innerWidth),e(!0))})}}}]),function(a){"use strict";var b=/\S+/g,c=/[\t\r\n\f]/g;a&&(a.fn.addClass=function(d){var e,f,g,h,i,j,k,l="string"==typeof d&&d,m=0,n=this.length;if(a.isFunction(d))return this.each(function(b){a(this).addClass(d.call(this,b,this.className))});if(l)for(e=(d||"").match(b)||[];n>m;m++)if(f=this[m],k="string"!=typeof f.className,g=1===f.nodeType&&(f.className?(" "+(k?f.getAttribute("class")||"":f.className)+" ").replace(c," "):" ")){for(i=0;h=e[i++];)g.indexOf(" "+h+" ")<0&&(g+=h+" ");j=a.trim(g),f.className!==j&&(k?f.setAttribute("class",j):f.className=j)}return this},a.fn.removeClass=function(d){var e,f,g,h,i,j,k,l=0===arguments.length||"string"==typeof d&&d,m=0,n=this.length;if(a.isFunction(d))return this.each(function(b){a(this).removeClass(d.call(this,b,this.className))});if(l)for(e=(d||"").match(b)||[];n>m;m++)if(f=this[m],k="string"!=typeof f.className,g=1===f.nodeType&&(f.className?(" "+(k?f.getAttribute("class")||"":f.className)+" ").replace(c," "):"")){for(i=0;h=e[i++];)for(;g.indexOf(" "+h+" ")>=0;)g=g.replace(" "+h+" "," ");j=d?a.trim(g):"",f.className!==j&&(k?f.setAttribute("class",j):f.className=j)}return this})}(jQuery);
//# sourceMappingURL=vgraph.min.js.map