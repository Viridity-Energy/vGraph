angular.module("vgraph",[]),angular.module("vgraph").factory("BoxModel",[function(){"use strict";function a(a){this.registrations=[],this.extend(a||{})}function b(a,b){return void 0!==a?parseInt(a):b}return a.prototype.register=function(a){this.ratio&&a(),this.registrations.push(a)},a.prototype.extend=function(a){var c,d,e=a.padding,f=this.padding,g=a.margin,h=this.margin;for(h||(this.margin=h={top:0,right:0,bottom:0,left:0}),g&&(h.top=b(g.top,h.top),h.right=b(g.right,h.right),h.bottom=b(g.bottom,h.bottom),h.left=b(g.left,h.left)),f||(this.padding=f={top:0,right:0,bottom:0,left:0}),e&&(f.top=b(e.top,f.top),f.right=b(e.right,f.right),f.bottom=b(e.bottom,f.bottom),f.left=b(e.left,f.left)),this.outerWidth=b(a.outerWidth,this.outerWidth)||0,this.outerHeight=b(a.outerHeight,this.outerHeight)||0,this.top=h.top,this.bottom=this.outerHeight-h.bottom,this.left=h.left,this.right=this.outerWidth-h.right,this.center=(this.left+this.right)/2,this.middle=(this.top+this.bottom)/2,this.width=this.right-this.left,this.height=this.bottom-this.top,this.innerTop=this.top+f.top,this.innerBottom=this.bottom-f.bottom,this.innerLeft=this.left+f.left,this.innerRight=this.right-f.right,this.innerWidth=this.innerRight-this.innerLeft,this.innerHeight=this.innerBottom-this.innerTop,this.ratio=this.outerWidth+" x "+this.outerHeight,c=0,d=this.registrations.length;d>c;c++)this.registrations[c]()},a}]),angular.module("vgraph").factory("GraphModel",[function(){"use strict";function a(a,b){return a[e(a,b,1)-1]}function b(a,b){return{$x:b,$interval:a.makeInterval(b)}}function c(a){a||(a={}),a.x||(a.x={}),a.y||(a.y={}),this.queued=null,this.construct(),this.reset(a)}var d=0,e=d3.bisector(function(a){return a.$interval}).left;return c.prototype.construct=function(){var a=this;this.$modelId=d++,this.registrations=[],this.point={reset:function(a){a.$x=null,a.$y=null},isValid:function(b){var c;return void 0===a.x.start?!0:(c=b.$x,a.x.start.$x<=c&&c<=a.x.stop.$x)}}},c.prototype.reset=function(a){this.data=[],this.lookUp={},this.plots={},this.plotNames=[],this.filtered=null,this.needSort=!1,this.ratio=null,this.transitionDuration=30,this.setStatus("loading"),this.config(a||this)},c.prototype.setBounds=function(a,b){return a&&(void 0!==a.min&&(this.x.$min=a.min),void 0!==a.max&&(this.x.$max=a.max)),b&&(void 0!==b.min&&(this.y.$min=b.min),void 0!==b.max&&(this.y.$max=b.max)),this},c.prototype.setPane=function(a,b){return a&&(void 0!==a.start&&(this.x.start=a.start),void 0!==a.stop&&(this.x.stop=a.stop)),b&&(void 0!==b.start&&(this.y.start=b.start),void 0!==b.stop&&(this.y.stop=b.stop)),this},c.prototype.config=function(a){var b=this;this.x={$min:null,$max:null,massage:a.x.massage||null,padding:a.x.padding||0,scale:a.x.scale||function(){return d3.scale.linear()},disp:a.x.display||function(a){return a.$interval},simplify:a.x.simplify||function(a){return a.$x},parse:a.x.parse||function(a){return a.$interval},format:a.x.format||d3.format("03d"),tick:a.x.tick||{}},this.y={$min:null,$max:null,massage:a.y.massage||null,padding:a.y.padding||0,scale:a.y.scale||function(){return d3.scale.linear()},disp:a.y.display||function(a,c){return b.y.parse(a,c)},simplify:a.y.simplify||function(a){return b.y.parse(a)},parse:a.y.parse||function(a,b){return void 0===a||null===a?null:a[b]},format:a.y.format||d3.format(",.2f"),tick:a.y.tick||{}},this.setPane(a.x,a.y)},c.prototype.makeInterval=function(a){return a},c.prototype.addPoint=function(a,b,c){var d,e,f=this.data,g=parseFloat(c);this.x.massage&&(b=this.x.massage(b)),this.y.massage&&(c=this.y.massage(b)),(b||0===b)&&(e=this.lookUp[b],e?isFinite(g)&&((void 0===e.$min||g<e.$min)&&(e.$min=g),(void 0===e.$max||g>e.$max)&&(e.$max=g)):(e={$interval:this.makeInterval(b),$x:b},isFinite(g)&&(e.$min=g,e.$max=g),this.lookUp[b]=e,f.length&&f[f.length-1].$x>b&&(this.needSort=!0),this.data.push(e)),this.x.min||(this.x.min=e,this.x.max=e),!this.y.min&&isFinite(g)&&(this.y.min=e,this.y.max=e),d=this.plots[a],d?(d.x.max.$x<e.$x?(d.x.max=e,this.x.max.$x<e.$x&&(this.x.max=e)):d.x.min.$x>e.$x&&(d.x.min=e,e.$x<this.x.min.$x&&(this.x.min=e)),isFinite(g)&&(d.y.max.$max<e.$max?(d.y.max=e,this.y.max.$max<e.$max&&(this.y.max=e)):d.y.min.$min>e.$min&&(d.y.min=e,this.y.min.$min>e.$min&&(this.y.min=e)))):(this.plots[a]=d={x:{min:e,max:e},y:{min:e,max:e}},this.x.max.$x<e.$x?this.x.max=e:e.$x<this.x.min.$x&&(this.x.min=e),isFinite(g)&&(this.y.max.$max<e.$max?this.y.max=e:this.y.min.$min>e.$min&&(this.y.min=e))),e[a]=c)},c.prototype.setError=function(a){this.setStatus("error",a)},c.prototype.setStatus=function(a,b){"error"===a?(this.loaded=!1,this.loading=!1,this.error=b,this.message=null):"loaded"===a?(this.loaded=!0,this.loading=!1,this.error=null,this.message=b):"updating"===a?(this.loaded=!0,this.loading=!0,this.error=null,this.message=b):(this.loaded=!1,this.loading=!0,this.error=null,this.message=b),this.status=a},c.prototype.addPlot=function(a,b,c,d){var e,f,g;if(!this.plots[a])for(e=0,f=b.length;f>e;e++)g=b[e],this.addPoint(a,c(g),d(g))},c.prototype.removePlot=function(a){var b,c,d,e,f,g,h,i,j=this.plots[a];if(j){for(delete this.plots[a],h=Object.keys(this.plots),b=0,c=this.data.length;c>b;b++){if(i=this.data[b],i.$max===i[a]){for(f=void 0,d=0,e=h.length;e>d;d++)g=i[h[d]],"number"==typeof g&&(void 0===f||g>f)&&(f=g);i.$max=f}if(i.$min===i[a]){for(f=void 0,d=0,e=h.length;e>d;d++)g=i[h[d]],"number"==typeof g&&(void 0===f||f>g)&&(f=g);i.$min=f}i[a]=null}if(this.x.min=null,this.x.max=null,this.y.min=null,this.y.max=null,h.length)for(this.x.min=this.plots[h[0]].x.min,this.x.max=this.plots[h[0]].x.max,this.y.min=this.plots[h[0]].y.min,this.y.max=this.plots[h[0]].y.max,b=1,c=h.length;c>b;b++)g=h[b],i=this.plots[g],i.min&&i.min.$x<this.x.min.$x?this.x.min=i.min:i.max&&this.x.max.$x<i.max.$x&&(this.x.max=i.max),i.min&&i.min.$min<this.y.min.$min?this.y.min=i.min:i.max&&this.y.max.$max<i.max.$max&&(this.y.max=i.max)}},c.prototype.dataReady=function(){var a=this;clearTimeout(this.queued),this.queued=setTimeout(function(){a.adjusting||a.adjust()},15)},c.prototype.findExtemesY=function(a){var b,c,d,e,f;for(c=0,d=a.length;d>c;c++)b=a[c],(b.$min||0===b.$min)&&(void 0===e?e=b:b.$min<e.$min&&(e=b)),(b.$max||0===b.$max)&&(void 0===f?f=b:b.$max>f.$max&&(f=b));return{min:e,max:f}},c.prototype.register=function(a){this.registrations.push(a)},c.prototype.adjust=function(c){var d,e,f,g,h,i,j,k,l=!1,m=this,n=this.data,o=this.x,p=this.y;n.length&&(this.nexAdjust=function(){this.adjusting=!0,this.error=!1,this.needSort&&this.data.sort(function(a,b){return a.$x-b.$x});try{if(null===o.$min&&(o.$min=o.min.$x),null===o.$max)o.$max=o.max.$x;else if("string"==typeof o.$max){if("+"!==o.$max.charAt(0))throw"I gotz nothing";o.$max=parseInt(o.$max.substring(1),10)+o.$min}if("number"==typeof o.start)o.start=this.data[o.start];else{if(o.start)if("string"==typeof o.start)if(l=!0,"%"===o.start.charAt(0))j=o.$min+parseFloat(o.start.substring(1),10)*(o.$max-o.$min);else if("+"===o.start.charAt(0))j=o.$min+parseInt(o.start.substring(1),10);else{if("="!==o.start.charAt(0))throw"I gotz nothing";j=parseInt(o.start.substring(1),10)}else j=o.start.$x;else l=!0,j=o.$min;o.start=j>o.min.$x&&j<o.max.$x?a(this.data,j):b(this,j)}if("number"==typeof o.stop)o.stop=this.data[o.stop];else{if(o.stop)if("string"==typeof o.stop)if(l=!0,"%"===o.stop.charAt(0))j=o.$min+parseFloat(o.stop.substring(1),10)*(o.$max-o.$min);else if("+"===o.stop.charAt(0))j=o.$min+parseInt(o.stop.substring(1),10);else{if("="!==o.stop.charAt(0))throw"I gotz nothing";j=parseInt(o.stop.substring(1),10)}else j=o.stop.$x;else l=!0,j=o.$max;o.stop=j>o.min.$x&&j<o.max.$x?a(this.data,j):b(this,j)}if(this.filtered=this.data.filter(function(a,b){var c=a.$x;return o.start.$x<=c&&c<=o.stop.$x?(g?h=b:g=b,!0):!1}),this.filtered.$first=g,this.filtered.$last=h,this.filtered.length?p.start||(l=!0,i=this.findExtemesY(this.filtered),p.start=i.min,p.stop=i.max):(p.start=p.min,p.stop=p.max),o.stop&&o.start&&p.stop&&p.start&&(this.adjustSettings&&this.adjustSettings(o.stop.$x-o.start.$x,p.stop.$max-p.start.$min,this.filtered.$last-this.filtered.$first),this.y.padding&&(k=(this.y.stop.$max-this.y.start.$min)*this.y.padding,(void 0===this.y.start.$shifted||this.y.start.$shifted!==this.y.start.$min)&&(this.y.start={$shifted:this.y.start.$min-k,$min:this.y.start.$min-k}),(void 0===this.y.stop.$shifted||this.y.stop.$shifted!==this.y.stop.$max)&&(this.y.stop={$shifted:this.y.stop.$max+k,$max:this.y.stop.$max+k})),f=n.length+" : "+this.filtered.length,f!==this.ratio||c||l))for(this.ratio=f,d=0,e=this.registrations.length;e>d;d++)this.registrations[d](this)}catch(q){m.setError("Model Failed"),console.debug(q)}this.adjusting=!1},this.adjustInterval||(this.adjustInterval=setTimeout(function(){m.adjustInterval=null,m.nexAdjust()},30)))},c}]),angular.module("vgraph").directive("vgraphAxis",[function(){"use strict";function a(a,b){return!(a.bottom<b.top||a.top>b.bottom||a.right<b.left||a.left>b.right)}return{require:"^vgraphChart",link:function(b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=d3.svg.axis(),r="axis",s=e.box,t=e.model,u=0,v=null,w=!0,x=!1,y=parseInt(d.tickLength)||0,z=parseInt(d.tickPadding)||3,A=parseInt(d.tickMargin)||0,B=d3.select(c[0]);switch(k=B.append("g").attr("class","ticks"),o=B.append("g").attr("class","padding"),l=o.append("g").attr("class","tick-marks"),m=o.append("rect").attr("class","tick-margin"),p=B.append("g").attr("class","label-wrap"),d.tickRotation&&(v=parseInt(d.tickRotation,10)%360),d.labelOffset&&(u=b.$eval(d.labelOffset)),d.labelClean&&(w=b.$eval(d.labelClean)),d.labelEndpoints&&(x=b.$eval(d.labelEndpoints)),d.axisLabel&&(n=p.append("text").attr("class","axis-label label").text(b.$eval(d.axisLabel))),f=function(){d.tickMarks?(q.tickValues(b.$eval(d.tickMarks)),h=[]):d.tickCount?(q.ticks(b.$eval(d.tickCount)),h=[]):(q.ticks(10),h=[])},b.orient){case"top":g=function(){var a;B.attr("class",r+" x top").attr("transform","translate("+s.left+","+s.top+")").attr("width",s.width).attr("height",s.padding.top),n&&n.attr("text-anchor","middle").attr("x",s.width/2).attr("y",s.padding.top-u),A&&m.attr("height",A).attr("width",s.innerWidth).attr("x",0).attr("y",-A),l.attr("transform","translate(-"+s.margin.left+",0)"),h&&(q.orient("top").tickFormat(t.x.format).innerTickSize(-s.innerHeight+y+A).outerTickSize(0).tickPadding(z+y+A).scale(e.x.scale),t.x.tick.interval&&q.ticks(t.x.tick.interval,t.x.tick.step),k.attr("transform","translate(-"+s.margin.left+","+s.padding.top+")").call(q),a=B.selectAll("g.axis-cap").data(e.x.scale.domain()),x&&(a.enter().append("g").attr("class",function(a,b){return"axis-cap "+(b?"axis-max":"axis-min")}).append("text"),a.exit().remove(),a.attr("transform",function(a){return"translate("+(e.x.scale(a)-s.margin.left)+",0)"}).select("text").text(function(a){var b=t.x.format(a);return(""+b).match("NaN")?"":b}).attr("dy","-0.25em").attr("y",s.padding.top).attr("text-anchor","middle")),v&&(k.selectAll(".tick text").attr("transform","translate(0,"+k.select(".tick text").attr("y")+") rotate("+v+",0,0)").attr("y","0").style("text-anchor",v%360>0?"end":"start"),a.select("text").attr("transform","rotate("+v+",0,0)").style("text-anchor",b.rotation%360>0?"end":"start")))};break;case"bottom":g=function(){var a;B.attr("class",r+" x bottom").attr("transform","translate("+s.left+","+s.innerBottom+")").attr("width",s.width).attr("height",s.padding.bottom),n&&n.attr("text-anchor","middle").attr("x",s.width/2).attr("y",s.padding.bottom+u),A&&m.attr("height",A).attr("width",s.innerWidth).attr("x",0).attr("y",0),l.attr("transform","translate(-"+s.margin.left+",0)"),h&&(q.orient("bottom").tickFormat(t.x.format).innerTickSize(s.innerHeight+y+A).outerTickSize(0).tickPadding(z+y+A).scale(e.x.scale),t.x.tick.interval&&q.ticks(t.x.tick.interval,t.x.tick.step),k.attr("transform","translate(-"+s.margin.left+","+-s.innerHeight+")").call(q),a=B.selectAll("g.axis-cap").data(e.x.scale.domain()),x&&(a.enter().append("g").attr("class",function(a,b){return"axis-cap "+(b?"axis-max":"axis-min")}).append("text"),a.exit().remove(),a.attr("transform",function(a){return"translate("+(e.x.scale(a)-s.margin.left)+",0)"}).select("text").text(function(a){var b=t.x.format(a);return(""+b).match("NaN")?"":b}).attr("dy","1em").attr("y",0).attr("text-anchor","middle")),v&&(k.selectAll(".tick text").attr("transform",function(){return"translate(0,"+d3.select(this).attr("y")+") rotate("+v+",0,0)"}).attr("y","0").style("text-anchor",v%360>0?"start":"end"),a.select("text").attr("transform","rotate("+v+",0,0)").style("text-anchor",b.rotation%360>0?"start":"end")))};break;case"right":break;case"left":var C;g=function(){B.attr("class",r+" y left").attr("transform","translate("+s.left+","+s.top+")").attr("width",s.padding.left).attr("height",s.height),p.attr("transform","translate("+s.padding.left+","+s.height+") rotate( -90 )"),n&&n.attr("text-anchor","middle").attr("x",s.height/2).attr("y",-u),A&&m.attr("height",s.innerHeight).attr("width",A).attr("x",-A).attr("y",0),l.attr("transform","translate("+s.padding.left+","+-s.top+")"),h&&(q.orient("left").tickFormat(t.y.format).innerTickSize(-(s.innerWidth+y+A)).outerTickSize(0).tickPadding(z+y+A).scale(e.y.scale),t.y.tick.interval&&q.ticks(t.y.tick.interval,t.y.tick.step),k.attr("transform","translate("+(s.padding.left-y-A)+","+-s.top+")").call(q),k.select(".domain").attr("transform","translate("+(y+A)+",0)"),x&&(C=B.selectAll("g.axis-cap").data(e.y.scale.domain()),C.enter().append("g").attr("class",function(a,b){return"axis-cap "+(b?"axis-max":"axis-min")}).append("text"),C.exit().remove(),C.attr("transform",function(a){return"translate(0,"+(e.y.scale(a)-s.margin.top)+")"}).select("text").text(function(a){var b=t.y.format(a);return(""+b).match("NaN")?"":b}).attr("dy",".25em").attr("x",s.padding.left-q.tickPadding()).attr("text-anchor","end")))}}e.register({build:function(){void 0===h&&f(),g()},process:function(){h.length=0,y&&(k.selectAll(".tick text").each(function(a){h.push({el:this,val:a,position:this.getBoundingClientRect()})}),h.sort(function(a,b){var c=a.position.top-b.position.top;return c?c:a.position.left-b.position.left})),w&&(i=B.select(".axis-min text").node(),i&&(i=i.getBoundingClientRect()),j=B.select(".axis-max text").node(),j&&(j=j.getBoundingClientRect()))},finalize:function(){var b,c,d,e,f,g,k={};for(l.selectAll("line").remove(),e=0,f=h.length;f>e;e++)b=!0,c=h[e],d=c.position,w&&i&&(a(d,i)||a(d,j))?(c.el.setAttribute("class","collided"),b=!1):void 0===k.left?(k.left=d.left,k.right=d.right,k.width=d.width,k.top=d.top,k.bottom=d.bottom,k.height=d.height,c.el.setAttribute("class","")):w&&a(d,k)?(c.el.setAttribute("class","collided"),b=!1):(g=!1,d.left<k.left&&(k.left=d.left,g=!0),d.right>k.right&&(k.right=d.right,g=!0),g&&(k.width=k.right-k.left,g=!1),d.top<k.top&&(k.top=d.top,g=!0),d.bottom>k.bottom&&(k.bottom=d.bottom,g=!0),g&&(k.height=k.bottom-k.top),c.el.setAttribute("class",""))}},"axis-"+b.orient)},scope:{orient:"=vgraphAxis",adjust:"=axisAdjust",rotation:"=tickRotation"}}}]),angular.module("vgraph").directive("vgraphChart",[function(){"use strict";return{controller:function(a){var b=[],c=[],d=a.model,e=a.box,f={register:function(a,d){b.push(a),c.push(d)},model:d,box:e,x:{scale:d.x.scale(),calc:function(a){return f.x.scale(d.x.parse(a))},center:function(){return(f.x.calc(d.x.min)+f.x.calc(d.x.max))/2}},y:{scale:d.y.scale(),calc:function(a){return f.y.scale(d.y.parse(a))},center:function(){return(f.y.calc(d.y.min)+f.y.calc(d.y.max))/2}}};return d.register(function(){var a,c,g,h;for(f.x.scale.domain([d.x.start.$interval,d.x.stop.$interval]).range([e.innerLeft,e.innerRight]),f.y.scale.domain([d.y.start.$min,d.y.stop.$max]).range([e.innerBottom,e.innerTop]),h=parseInt(d.filtered.length/e.innerWidth)||1,a=d.filtered.filter(function(a,b){return d.x.start===a||d.x.stop===a||b%h===0}),c=0,g=b.length;g>c;c++)b[c].build&&b[c].build(a);for(c=0,g=b.length;g>c;c++)b[c].process&&b[c].process(a);for(c=0,g=b.length;g>c;c++)b[c].finalize&&b[c].finalize(a)}),f},link:function(a,b){a.box.extend({outerWidth:b.outerWidth(!0),outerHeight:b.outerHeight(!0),margin:{top:b.css("margin-top"),right:b.css("margin-right"),bottom:b.css("margin-bottom"),left:b.css("margin-left")},padding:{top:b.css("padding-top"),right:b.css("padding-right"),bottom:b.css("padding-bottom"),left:b.css("padding-left")}}),b.css("margin","0").css("padding","0").attr("width",a.box.outerWidth).attr("height",a.box.outerHeight).css({width:a.box.outerWidth+"px",height:a.box.outerHeight+"px"}),d3.select(b[0]).insert("rect",":first-child").attr("class","mat").attr("width",a.box.innerWidth).attr("height",a.box.innerHeight).attr("transform","translate("+a.box.innerLeft+","+a.box.innerTop+")"),d3.select(b[0]).insert("rect",":first-child").attr("class","frame").attr("width",a.box.width).attr("height",a.box.height).attr("transform","translate("+a.box.left+","+a.box.top+")"),a.$watch("model.loading",function(a){a?b.addClass("loading"):b.removeClass("loading")}),a.$watch("model.error",function(a){a?b.addClass("hasError"):b.removeClass("hasError")})},restrict:"A",scope:{box:"=vgraphChart",model:"=model"}}}]),angular.module("vgraph").directive("vgraphError",[function(){"use strict";return{require:"^vgraphChart",link:function(a,b,c,d){var e=d.box,f=d3.select(b[0]).attr("class","error-view"),g=f.append("rect").attr("class","outline"),h=f.append("text");a.model=d.model,a.box=e,e.register(function(){g.attr("transform","translate("+e.innerLeft+","+e.innerTop+")").attr("width",e.innerWidth).attr("height",e.innerHeight),h.attr("text-anchor","middle").attr("x",e.center).attr("y",e.middle+h.node().getBBox().height/2)}),a.$watch("model.error",function(a){a?(f.attr("visibility","visible"),h.text(a)):f.attr("visibility","hidden")})}}}]),angular.module("vgraph").directive("vgraphFill",[function(){"use strict";return{require:"^vgraphChart",link:function(a,b,c,d){function e(b){var c,d,e=b.length;if(e&&e!==h){for(;e>h;h++)c=a.data[h],d=j(c),void 0!==d&&(l?(m.length>n&&m.shift(),m.push(d),i.addPoint(f,k(c),l(d,m))):i.addPoint(f,k(c),d));i.dataReady(a)}}var f=c.name,g=d3.select(b[0]).append("path").attr("class","fill plot-"+f),h=0,i=d.model,j=a.value,k=a.interval,l=a.filter,m=[],n=parseInt(c.memory,10)||10,o=d3.svg.area().defined(function(a){var b=a[f];return!(isNaN(b)||null===b)}).x(function(a){return d.x.scale(a.$interval)}).y(function(a){return d.y.scale(a[f])}).y1(function(){return d.y.scale(void 0===a.fillTo?i.y.start.$min:"object"==typeof a.fillTo?a.fillTo.$min:a.fillTo)});"string"==typeof j&&(j=function(a){return function(b){return b[a]||null}}(j)),"string"==typeof k&&(k=function(a){return function(b){return b[a]}}(k)),d.register({finalize:function(a){g.transition().duration(i.transitionDuration).ease("linear").attr("d",o(a))}}),a.$watch("data",function(b){b&&(i.removePlot(f),h=0,e(b),d.model.dataReady(a))}),a.$watch("data.length",function(b){b&&e(a.data)})},scope:{data:"=vgraphFill",fillTo:"=fillTo",value:"=value",interval:"=interval",filter:"=filter"}}}]),angular.module("vgraph").directive("vgraphFocus",[function(){"use strict";return{require:"^vgraphChart",link:function(a,b,c,d){var e=d.box,f=d3.select(b[0]),g=f.append("rect").attr("class","focus").attr("visibility","hidden");e.register(function(){g.attr("height",e.innerHeight).attr("y",e.innerTop)}),a.$watch("follow",function(a){var b,c,d;a&&void 0!==a.xDiff&&(b=Math.abs(a.xDiff),c=a.x0-b,d=a.x0+b,g.attr("visibility","visible"),c>e.innerLeft?g.attr("x",c):(c=e.innerLeft,g.attr("x",e.innerLeft)),d>e.innerRight?g.attr("width",e.innerRight-c):g.attr("width",d-c))}),a.$watch("stop",function(b){var c,f,h,i,j,k=d.model;b&&k.filtered&&(f=k.filtered.$first,c=k.filtered.$last-f,g.attr("visibility","hidden"),h=Math.abs(b.xDiff),h>5&&(i=b.x0-h,j=b.x0+h,i<e.innerLeft?i=0:i-=e.innerLeft,j>e.innerRight?j=e.innerWidth:j-=e.innerLeft,k.setPane({start:"="+(k.x.start.$x+i/e.innerWidth*(k.x.stop.$x-k.x.start.$x)),stop:"="+(k.x.start.$x+j/e.innerWidth*(k.x.stop.$x-k.x.start.$x))},{start:null,stop:null}),k.adjust(a)))})},scope:{follow:"=vgraphFocus",stop:"=loseFocus"}}}]),angular.module("vgraph").directive("vgraphIndicator",[function(){"use strict";return{require:"^vgraphChart",link:function(a,b,c,d){var e,f,g=c.vgraphIndicator,h=d.model,i=a.$eval(c.pointRadius)||3,j=a.$eval(c.outerRadius),k=d3.select(b[0]).attr("class","leading").attr("transform","translate(1000,1000)"),l=k.append("circle").attr("class","point inner").attr("r",i).attr("visibility","hidden");j&&(f=k.append("circle").attr("class","point outer").attr("r",i).attr("visibility","hidden"),(e=function(){f.transition().duration(1e3).attr("r",j).transition().duration(1e3).attr("r",i).ease("sine").each("end",e)})()),d.register({finalize:function(){var a,b,c;h.plots[g]?(a=h.plots[g].x.max,h.point.isValid(a)&&a[g]?(b=d.x.scale(a.$interval),c=d.y.scale(a[g]),l.attr("visibility","visible"),f&&f.attr("visibility","visible"),k.transition().duration(h.transitionDuration).ease("linear").attr("transform","translate("+b+","+c+")")):(l.attr("visibility","hidden"),f&&f.attr("visibility","hidden"))):(l.attr("visibility","hidden"),f&&f.attr("visibility","hidden"))}})},scope:{model:"=model"}}}]),angular.module("vgraph").directive("vgraphInteract",[function(){"use strict";return{require:"^vgraphChart",link:function(a,b,c,d){function e(b,c){clearTimeout(h),a.$apply(function(){var d=d3.mouse(b);a.highlight.point=c,a.highlight.position={x:d[0],y:d[1]}})}function f(){h=setTimeout(function(){a.$apply(function(){a.highlight.point=null})},100)}var g,h,i=!1,j=d.model,k=d.box,l=d3.select(b[0]),m=l.append("rect").style("opacity","0").attr("class","focal").on("mousemove",function(){var a,b;i||(a=d.x.scale.invert(d3.mouse(this)[0]),b=n(j.data,a,1),e(this,j.data[b]))}).on("mouseout",function(a){i||f(this,a)}),n=d3.bisector(function(a){return a.$interval}).left;l.attr("class","interactive"),l.call(d3.behavior.drag().on("dragstart",function(){g=d3.mouse(b[0]),i=!0,f(),a.dragStart={x:g[0],y:g[1]},a.$apply()}).on("dragend",function(){var c=d3.mouse(b[0]);i=!1,a.dragStop={x0:g[0],y0:g[1],x1:c[0],x2:c[1],xDiff:c[0]-g[0],yDiff:c[1]-g[1]},a.$apply()}).on("drag",function(){var c=d3.mouse(b[0]);a.dragPos={x0:g[0],y0:g[1],x1:c[0],x2:c[1],xDiff:c[0]-g[0],yDiff:c[1]-g[1]},a.$apply()})),l.on("dblclick",function(){j.setPane({start:null,stop:null},{start:null,stop:null}),j.adjust()}),d.register({build:function(){},finalize:function(){m.attr({x:k.innerLeft,y:k.innerTop,width:k.innerWidth,height:k.innerHeight})}}),a.highlight||(a.highlight={}),a.dragStart||(a.dragStart={}),a.dragPos||(a.dragPos={}),a.dragStop||(a.dragStop={})},scope:{highlight:"=vgraphInteract",dragStart:"=dBegin",dragPos:"=dChange",dragStop:"=dEnd"}}}]),angular.module("vgraph").directive("vgraphLine",[function(){"use strict";return{require:"^vgraphChart",link:function(a,b,c,d){function e(b){var c,d,e=b.length;if(e&&e!==h){for(;e>h;h++)c=a.data[h],d=j(c),void 0!==d&&(l?(m.length>n&&m.shift(),m.push(d),i.addPoint(f,k(c),l(d,m))):i.addPoint(f,k(c),d));i.dataReady(a)}}var f=c.name,g=d3.select(b[0]).append("path").attr("class","line plot-"+f),h=0,i=d.model,j=a.value,k=a.interval,l=a.filter,m=[],n=parseInt(c.memory,10)||10,o=d3.svg.line().interpolate("linear").defined(function(a){var b=a[f];return!(isNaN(b)||null===b)}).x(function(a){return d.x.scale(a.$interval)}).y(function(a){return d.y.scale(a[f])});"string"==typeof j&&(j=function(a){return function(b){return b[a]||null}}(j)),"string"==typeof k&&(k=function(a){return function(b){return b[a]}}(k)),d.register({finalize:function(a){var b;g.transition().duration(i.transitionDuration).ease("linear").attr("d",o(a.filter(function(c,d){var e,g=b;return b=c[f],g!==b?!0:(e=a[d+1],!e||e[f]!==b)})))}},f),a.$watch("data",function(b){b&&(i.removePlot(f),h=0,e(b),d.model.dataReady(a))}),a.$watch("data.length",function(b){b&&e(a.data)})},scope:{data:"=vgraphLine",value:"=value",interval:"=interval",filter:"=filter"}}}]),angular.module("vgraph").directive("vgraphLoading",["$interval",function(a){"use strict";return{require:"^vgraphChart",link:function(b,c,d,e){function f(){a.cancel(h),g(),h=a(g,4005)}function g(){l=!0,q.attr("x",function(){return i}).attr("width",function(){return 0}).transition().duration(1e3).attr("x",function(){return i}).attr("width",function(){return j}).ease("sine").transition().duration(1e3).attr("width",0).attr("x",function(){return k}).ease("sine").transition().duration(1e3).attr("width",function(){return j}).attr("x",function(){return i}).ease("sine").transition().duration(1e3).attr("x",function(){return i}).attr("width",0).ease("sine")}var h,i,j,k,l=!1,m=e.box,n=d.vgraphLoading,o=d3.select(c[0]).attr("class","loading-view"),p=o.append("rect").attr("height",20).attr("class","outline"),q=o.append("rect").attr("width",0).attr("height",20).attr("class","filling"),r=o.append("text").text(n);b.model=e.model,m.register(function(){i=m.innerLeft+m.innerWidth/5,j=3*m.innerWidth/5,k=i+j,q.attr("x",i).attr("y",m.middle-10),p.attr("x",i).attr("y",m.middle-10).attr("width",j),r.attr("text-anchor","middle").attr("x",m.center).attr("y",m.middle+r.node().getBBox().height/2-2),l||f()}),b.$watch("model.loading",function(c){a.cancel(h),c&&b.box.ratio&&f()})}}}]),angular.module("vgraph").directive("vgraphMultiLine",["$compile",function(a){"use strict";return{require:"^vgraphChart",link:function(b,c){var d=c[0],e=document.createElement("style");document.body.appendChild(e),b.$on("$destroy",function(){document.body.removeElement(e)}),b.$watch("config",function(c){var f,g,h,i,j,k,l="",m="";if(c){for(g=0,h=c.length;h>g;g++)k=c[g],j=k.name,l+='<g vgraph-line="data" interval="'+j+'.x" value="'+j+'.y" name="'+j+'"></g>',m+="path.plot-"+j+" { stroke: "+k.color+"; fill: transparent; }circle.plot-"+j+" { stroke: "+k.color+"; fill: "+k.color+";}.legend .plot-"+j+" .value { background-color: "+k.color+"; }",b[j]=k;for(d3.select(d).selectAll("g").remove(),e.innerHTML=m,i=(new DOMParser).parseFromString('<g xmlns="http://www.w3.org/2000/svg">'+l+"</g>","image/svg+xml").childNodes[0].childNodes;i.length;)f=i[0],d.appendChild(f),a(f)(b)}})},scope:{data:"=vgraphMultiLine",config:"=config"}}}]),angular.module("vgraph").directive("vgraphTarget",[function(){"use strict";return{require:"^vgraphChart",link:function(a,b,c,d){var e=d.model,f=d.box,g=d3.select(b[0]).attr("class","target"),h=g.append("line").attr("class","focus").attr("x1",0).attr("x2",0),i=g.append("g");f.register(function(){h.attr("y1",f.innerTop).attr("y2",f.innerBottom)}),a.$watch("target.point",function(b){var f;if(b){i.selectAll("circle.point").remove(),g.style("visibility","visible").attr("transform","translate( "+d.x.scale(b.$interval)+" , 0 )");for(f in e.plots)b[f]&&i.append("circle").attr("class","point plot-"+f).attr("x",0).attr("cy",d.y.scale(b[f])).attr("r",a.$eval(c.pointRadius)||3)}else g.style("visibility","hidden")})},scope:{target:"=vgraphTarget",pointRadius:"=pointRadius"}}}]),angular.module("vgraph").directive("vgraphTooltip",[function(){"use strict";return{require:"^vgraphChart",link:function(a,b,c,d){var e=c.name,f=d.model,g=a.formatter||function(a){return f.y.format(f.y.parse(a))},h=parseInt(c.offsetX)||0,i=parseInt(c.offsetY)||0,j=d3.select(b[0]).attr("class","tooltip"),k=j.append("polygon").attr("class","outline").attr("transform","translate(0,-15)"),l=j.append("text").style("line-height","20").style("font-size","16").attr("class","label");a.$watch("data.point",function(a){var b,c,m;a&&a[e]?(b=d.y.scale(a[e]),c=d.x.scale(a.$interval)+h,l.text(g(a[e],a)),m=l.node().getComputedTextLength()+5,j.style("visibility","visible"),c+m+16<d.x.scale(f.x.stop.$interval)?(j.attr("transform","translate("+c+","+(b+i)+")"),l.attr("transform","translate(10,5)"),k.attr("points","0,15 10,0 "+(m+10)+",0 "+(m+10)+",30 10,30 0,15")):(j.attr("transform","translate("+(c-2*h-m-10)+","+(b+i)+")"),l.attr("transform","translate(5,5)"),k.attr("points","0,0 "+m+",0 "+(m+10)+",15 "+m+",30 0,30 0,0"))):j.style("visibility","hidden")})},scope:{formatter:"=textFormatter",data:"=vgraphTooltip"}}}]),angular.module("vgraph").directive("vgraphZone",[function(){"use strict";return{require:"^vgraphChart",link:function(a,b,c,d){function e(b){var c,d,e=b.length;if(e&&e!==h){for(;e>h;h++)c=a.data[h],d=j(c),void 0!==d&&(l?(m.length>n&&m.shift(),m.push(d),i.addPoint(f,k(c),l(d,m))):i.addPoint(f,k(c),d));i.dataReady(a)}}var f=c.name,g=d3.select(b[0]).append("path").attr("class","line plot-"+f),h=0,i=d.model,j=a.value,k=a.interval,l=a.filter,m=[],n=parseInt(c.memory,10)||10,o=d3.svg.area().defined(function(a){return a[f]===!0}).x(function(a){return d.x.scale(a.$interval)}).y(function(){return d.box.innerTop}).y1(function(){return d.box.innerBottom});"string"==typeof j&&(j=function(a){return function(b){return b[a]||!1}}(j)),"string"==typeof k&&(k=function(a){return function(b){return b[a]}}(k)),d.register({finalize:function(a){g.attr("d",o(a))}}),a.$watch("data",function(b){b&&(i.removePlot(f),h=0,e(b),d.model.dataReady(a))}),a.$watch("data.length",function(b){b&&e(a.data)})},scope:{data:"=vgraphZone",value:"=value",interval:"=interval"}}}]),angular.module("vgraph").directive("vgraphZoom",[function(){"use strict";return{require:"^vgraphChart",link:function(a,b,c,d){function e(b){0===g&&h===k.innerWidth?(m=!1,r.attr("class","focus")):(m=!0,r.attr("class","focus zoomed")),0>g&&(g=0),h>k.innerWidth&&(h=k.innerWidth),g>h?g=h:g>h&&(h=g),o.attr("transform","translate("+g+",0)"),p.attr("transform","translate(-"+g+",0 )").attr("width",g),s.attr("transform","translate("+h+",0)"),t.attr("width",k.innerWidth-h),r.attr("transform","translate("+g+",0)").attr("width",h-g),b||a.$apply(function(){var b=a.model;b.setPane({start:"%"+g/k.innerWidth,stop:"%"+h/k.innerWidth},{start:null,stop:null}),b.adjust(a)})}var f,g,h,i,j,k=d.box,l=!1,m=!1,n=d3.select(b[0]),o=n.append("g").attr("class","left-control min-control"),p=o.append("rect").attr("class","shade"),q=o.append("g").attr("class","control"),r=n.append("rect").attr("class","focus"),s=n.append("g").attr("class","right-control max-control"),t=s.append("rect").attr("class","shade"),u=s.append("g").attr("class","control");q.append("path").attr("d","M-0.5,23.33A6,6 0 0 0 -6.5,29.33V40.66A6,6 0 0 0 -0.5,46.66ZM-2.5,31.33V38.66M-4.5,31.33V38.66").attr("transform","translate(0,-9)").attr("class","nub"),i=q.append("rect").attr("width","10").attr("transform","translate(-10,0)"),u.append("path").attr("d","M0.5,23.33A6,6 0 0 1 6.5,29.33V40.66A6,6 0 0 1 0.5,46.66ZM2.5,31.33V38.66M4.5,31.33V38.66").attr("transform","translate(0,-9)").attr("class","nub"),j=u.append("rect").attr("width","10"),a.box=k,i.call(d3.behavior.drag().on("dragstart",function(){l=!0}).on("dragend",function(){l=!1}).on("drag",function(){g=d3.mouse(b[0])[0],e()})),j.call(d3.behavior.drag().on("dragstart",function(){l=!0}).on("dragend",function(){l=!1}).on("drag",function(){h=d3.mouse(b[0])[0],e()})),r.call(d3.behavior.drag().on("dragstart",function(){f={mouse:d3.mouse(b[0])[0],minPos:g,maxPos:h,min:a.model.x.start.$x,max:a.model.x.stop.$x},l=!0}).on("dragend",function(){l=!1,m=!0}).on("drag",function(){var a=d3.mouse(b[0]),c=a[0]-f.mouse;m?(h=f.maxPos+c,g=f.minPos+c,e()):c>5&&(h=f.mouse+Math.abs(c),g=f.mouse-Math.abs(c),e(),m=!1)})),n.on("dblclick",function(){h=k.innerWidth,g=0,e()}),k.register(function(){n.attr("width",k.innerWidth).attr("height",k.innerHeight).attr("transform","translate("+k.innerLeft+","+k.innerTop+")"),p.attr("height",k.innerHeight),t.attr("height",k.innerHeight),i.attr("height",k.innerHeight),j.attr("height",k.innerHeight),r.attr("height",k.innerHeight)}),a.model.register(function(){var b,c,d,f=a.model;l||(b=f.x,c=void 0===a.min?b.$min:a.min,d=void 0===a.max?b.$max:a.max,g=(b.start.$x-c)/(d-c)*k.innerWidth,h=(b.stop.$x-c)/(d-c)*k.innerWidth,e(!0))})},scope:{model:"=vgraphZoom",min:"=zoomMin",max:"=zoomMax"}}}]);
//# sourceMappingURL=vgraph.min.js.map