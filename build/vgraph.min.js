angular.module("vgraph",[]),angular.module("vgraph").factory("BoxModel",[function(){"use strict";function a(a,b){var d=b.padding,e=a.padding,f=b.margin,g=a.margin;g||(a.margin=g={top:0,right:0,bottom:0,left:0}),f&&(g.top=c(f.top,g.top),g.right=c(f.right,g.right),g.bottom=c(f.bottom,g.bottom),g.left=c(f.left,g.left)),e||(a.padding=e={top:0,right:0,bottom:0,left:0}),d&&(e.top=c(d.top,e.top),e.right=c(d.right,e.right),e.bottom=c(d.bottom,e.bottom),e.left=c(d.left,e.left)),a.outerWidth=c(b.outerWidth,a.outerWidth)||0,a.outerHeight=c(b.outerHeight,a.outerHeight)||0,a.top=g.top,a.bottom=a.outerHeight-g.bottom,a.left=g.left,a.right=a.outerWidth-g.right,a.center=(a.left+a.right)/2,a.middle=(a.top+a.bottom)/2,a.width=a.right-a.left,a.height=a.bottom-a.top,a.innerTop=a.top+e.top,a.innerBottom=a.bottom-e.bottom,a.innerLeft=a.left+e.left,a.innerRight=a.right-e.right,a.innerWidth=a.innerRight-a.innerLeft,a.innerHeight=a.innerBottom-a.innerTop,a.ratio=a.outerWidth+" x "+a.outerHeight}function b(b){this.registrations=[],a(this,b||{})}function c(a,b){return void 0!==a?parseInt(a):b}return b.prototype.register=function(a){this.registrations.push(a)},b.prototype.targetSvg=function(a){this.$element=a,this.resize()},b.prototype.resize=function(){var b,c,d=this.$element;if(d.attr("width",null).attr("height",null),d[0].style.cssText=null,a(this,{outerWidth:d.outerWidth(!0),outerHeight:d.outerHeight(!0),margin:{top:d.css("margin-top"),right:d.css("margin-right"),bottom:d.css("margin-bottom"),left:d.css("margin-left")},padding:{top:d.css("padding-top"),right:d.css("padding-right"),bottom:d.css("padding-bottom"),left:d.css("padding-left")}}),d.css("margin","0").css("padding","0").attr("width",this.outerWidth).attr("height",this.outerHeight).css({width:this.outerWidth+"px",height:this.outerHeight+"px"}),this.innerWidth&&this.innerHeight)for(b=0,c=this.registrations.length;c>b;b++)this.registrations[b]()},b}]),angular.module("vgraph").factory("ComponentGenerator",["$timeout","DrawLine","DrawArea","DataFeed","DataLoader",function(a,b,c,d,e){"use strict";function f(a,b){var c={ref:{name:b.name,view:b.control},pair:a.pair,massage:a.massage,interval:a.interval,value:a.value};return a.pair&&(c.pair="-"===a.pair?{}:{ref:{name:b.name+"2",view:b.control},massage:a.massage,interval:a.interval,value:a.pair}),a.$watch("feed",function(a){c.feed=a,c.pair&&c.pair.ref&&(c.pair.feed=a)}),c}function g(a,b){var c=a.value,d=a.interval;return a.$uid||(a.$uid=j++),a.ref||(a.ref={}),a.ref.name||(a.ref.name=a.name),a.ref.field=a.ref.name,a.ref.view||(a.ref.view="default"),a.ref.$view=b.views[a.ref.view],a.pair&&a.pair.ref&&g(a.pair,b),a.parseValue||(c||(c=a.ref.name),a.parseValue="string"==typeof c?function(a){return a[c]}:c),a.parseInterval||(a.parseInterval="string"==typeof d?function(a){return a[d]}:d),a}function h(a,b,c){var d;return d=a.config||f(a,b),g(d,c)}function i(a){return null===a?!1:Number.isFinite?Number.isFinite(a)&&!Number.isNaN(a):isFinite(a)&&!isNaN(a)}var j=0,k={};return{isNumeric:i,getConfig:h,normalizeConfig:g,watchFeed:function(a,b){function c(a){var c,g=d.create(a,b.massage),h=b.ref.$view,i=h.dataModel;c=k[g._$dfUid],c||(c=k[g._$dfUid]={}),f=c[h.name],f||(f=c[h.name]=new e(g,i))}var f;a.$watch(function(){return b.feed},function(a){a&&(f&&f.removeConf(b),c(a),f.addConf(b))})},makeDiffCalc:function(a,b,d,e){var f=new c;return d||(d=a),f.preParse=function(c){var f,g,h=c[a.name],j=c[d.name];return h&&(f=h[b]),j&&(g=j[e]),i(f)&&i(g)?{interval:(h._$interval+j._$interval)/2,y1:a.y.scale(f),y2:d.y.scale(g)}:void 0},f.parseInterval=function(a){return a.interval},f.parseValue1=function(a){return a.y1},f.parseValue2=function(a){return a.y2},function(a){return f.render(a).join("")}},makeAreaCalc:function(a){return d3.svg.area().defined(function(a){return i(a[name])}).x(function(a){return a._$interval}).y(function(b){return a.y.scale(b[name+"$Min"])}).y1(function(b){return a.y.scale(b[name+"$Max"])})},makeLineCalc:function(a){var c,d,e=new b;return e.preParse=function(a,b){var c=a[d];return i(c)?a:b&&void 0===c?(a[d]=b[d],a):null},e.parseValue=function(a){return c.y.scale(a[d])},e.parseInterval=function(a){return a._$interval},function(b){return d=a.field,c=a.$view,e.render(b).join("")}},makeFillCalc:function(a,b){var d,e,f,g=new c;return g.preParse=function(a){var b,c;return b=a[e],c=f?a[f]:d.viewport.minValue,i(b)&&i(c)?{interval:a._$interval,y1:d.y.scale(b),y2:d.y.scale(c)}:void 0},g.parseInterval=function(a){return a.interval},g.parseValue1=function(a){return a.y1},g.parseValue2=function(a){return a.y2},function(c){return d=a.$view,e=a.field,b&&(f=b.field),g.render(c).join("")}},svgCompile:function(a){var b=(new DOMParser).parseFromString('<g xmlns="http://www.w3.org/2000/svg">'+a+"</g>","image/svg+xml"),c=(b.childNodes,b.childNodes[0]),d=c.childNodes;return Array.prototype.slice.call(d,0)},parseStackedLimits:function(a,b){var c,d,e,f,g,h,i,j,k,l;if(b&&b.length)for(c=0,d=a.length;d>c;c++){for(l=0,h=void 0,g=a[c],k=b[0].name,h=g[k]||0,void 0===i?(i=h,j=h):i>h&&(i=h),g["$"+k]=h,l=h,e=1,f=b.length;f>e;e++)k=b[e].name,h=g[k]||0,l+=h,g["$"+k]=l;g.$total=l,l>j&&(j=l)}return{min:i,max:j}},parseSegmentedLimits:function(a,b,c,d){function e(a){a[b+"$Max"]=l,a[b+"$Min"]=k}var f,g,h,j,k,l,m={},n=[];if(d||(d=0),angular.isString(b)){for(c||(c=function(a,b){return b});d<a.length&&!i(c(a[d],a[d][b]));)d++;for(f=d,g=a.length;g>f;f++)h=a[f],j=c(h,h[b]),i(j)?(void 0===k?(k=j,l=j):k>j?k=j:j>l&&(l=j),n.push(h)):(n.forEach(e),m=this.parseSegmentedLimits(a,b,c,f+1),f=a.length);i(m.min)&&m.min<k&&(k=m.min),i(m.max)&&m.max>l&&(l=m.max)}else for(f=0,g=b.length;g>f;f++)j=this.parseSegmentedLimits(a,b[f],c),void 0===k?(k=j.min,l=j.max):(j.min<k&&(k=j.min),j.max>l&&(l=j.max));return{min:k,max:l}}}}]),angular.module("vgraph").factory("DataCollection",["LinearModel",function(a){"use strict";function b(b){b instanceof a&&(b={"default":b}),this.models=b}return b.prototype.forEach=function(a,b){angular.forEach(this.models,function(c,d){a.call(b,c,d)})},b.prototype.reset=function(){angular.forEach(this.models,function(a){a.reset()})},b}]),angular.module("vgraph").factory("GraphModel",["$timeout","StatCollection","ViewModel","BoxModel","LinearModel","DataCollection",function(a,b,c,d,e,f){"use strict";function g(){this.$scripts={},this.$master=this.schedule=[]}function h(){return+new Date}function i(a){this.$vguid=++o,this.box=new d,this.models=[],this.views={},this.refs={},this.samples={},this.waiting={},this.loading=!0,this.message=null,this.$interface=a||{}}function j(a,b){var c,d,e,f,g;for(d=0,e=a.length;e>d;d++)for(c=a[d],f=0,g=c.length;g>f;f++)null!==c[f]&&(b[d].unshift(c[f]),f=g)}function k(a,b,c,d,e){var f,g=[],h=[];for(f=0;e>f;f++)h.push([]);return h.push([]),angular.forEach(a,function(a){var f=b[a.view],i=c[f.name];g.push(a.label),f.publishData(h,a,function(a){return Math.round((a.$x-i.data.min)/d*e)})}),{header:g,body:h}}function l(a){var b,c;a.forEach(function(a){var d=a.viewport;(void 0===b||b>d.minValue)&&(b=d.minValue),(void 0===c||c<d.maxValue)&&(c=d.maxValue)}),a.forEach(function(a){a.setViewportValues(b,c)})}function m(a){var b,c;a.forEach(function(a){var d=a.viewport;(void 0===b||b>d.minInterval)&&(b=d.minInterval),(void 0===c||c<d.maxInterval)&&(c=d.maxInterval)}),a.forEach(function(a){a.setViewportIntervals(b,c)})}g.prototype.startScript=function(a){a?this.$scripts[a]?(this.schedule=this.$scripts[a],this.schedule.length=0):this.schedule=this.$scripts[a]=[]:this.schedule=[]},g.prototype.endScript=function(){this.$master.push(this.schedule),this.schedule=this.$master},g.prototype.loop=function(a,b,c){this.schedule.push({start:0,stop:a.length,data:a,op:b,ctx:c})},g.prototype.func=function(a,b){this.schedule.push({op:a,ctx:b})},g.prototype.run=function(a){var b=this;this.$lock||(this.$lock=!0,setTimeout(function(){b.$eval(function(){b.$lock=!1},a)},5))},g.prototype.$eval=function(a,b){function c(){g.$eval(a,b)}var d,e,f,g=this,i=!0,j=h(),k=j+500;try{for(;(f=this.schedule.shift())&&i;){if(f.length)for(;f.length;)this.schedule.unshift(f.pop());else if("start"in f)for(d=f.start,e=f.stop;e>d;d++)f.op.call(f.ctx,f.data[d],d);else f.op.call(f.ctx);h()>k&&(i=!1,setTimeout(c,5))}}catch(l){console.log(l),b()}0===this.schedule.length&&a()};var n=new g,o=0;return i.prototype.setInputReference=function(a,b){this.refs[a]=b},i.prototype.getPrimaryView=function(){return this.views[Object.keys(this.views)[0]]},i.prototype.publish=function(a,b){var c,d,e,f,g={},h={};return angular.forEach(a,function(a){var b=this.views[a.view];b&&!g[b.name]&&(g[b.name]=b)},this),angular.forEach(g,function(a){var b=a.publishStats(),d=b.data.max-b.data.min;h[a.name]=b,(!c||d>c)&&(c=d),(!e||b.step<e)&&(e=b.step)}),d=Math.ceil(c/e),f=k(a,g,h,c,d),b&&(b=k(b,g,h,c,d),j(b.body,f.body),f.header.unshift(b.header[0])),f.body.unshift(f.header),f.body},i.prototype.render=function(a,c){{var d,e=this,f=0,g=Object.keys(this.views).length;this.getPrimaryView(),new b}angular.forEach(this.views,function(a){a.parse()}),d=[],angular.forEach(this.views,function(a){a.hasData()&&d.push(a)}),this.normalizeY&&l(d),this.normalizeX&&m(d),f=d.length,n.startScript(this.$uid),g?f?(n.startScript(this.$uid),e.loading=!0,n.func(function(){e.message=null}),n.loop(d,function(a){a.build()}),n.loop(d,function(a){a.process()}),n.func(function(){e.loading=!1,e.pristine=!0}),n.loop(d,function(a){a.finalize()})):this.loading?(n.loop(this.views,function(a){a.error()}),n.func(function(){e.pristine=!1})):(n.loop(this.views,function(a){a.error()}),n.func(function(){e.message="No Data Available",e.pristine=!1})):n.func(function(){e.loading=!0,e.pristine=!1}),n.func(function(){c&&c(),e.$interface.onRender&&e.$interface.onRender()}),n.endScript(),n.run(function(){e.pristine=!1,e.message="Unable to Render"})},i.prototype.scheduleRender=function(b){var c=this;this.nrTimeout||(this.nrTimeout=a(function(){c.render(c.waiting,b),c.waiting={},c.nrTimeout=null},30))},i.prototype.rerender=function(a){this.scheduleRender(a),this.waiting=this.views},i.prototype.needsRender=function(a,b){this.scheduleRender(b),this.waiting[a.name]||(this.waiting[a.name]=a)},i.prototype.highlight=function(a){var b,c=0,d=0,e={};return angular.forEach(this.views,function(f){f.highlight(e,a),b=e[f.name]._$interval,b&&(d++,c+=b)}),e.$pos=c/d,e},i.prototype.addDataCollection=function(a){a instanceof f?a=a.models:a instanceof e&&(a={"default":a}),angular.forEach(a,this.addDataModel,this)},i.prototype.addDataModel=function(a,b){var d=new c(this,b,a);this.views[d.name]=d,this.models.push(a),this.bounds&&d.pane.setBounds(this.bounds.x,this.bounds.y),this.pane&&d.pane.setPane(this.pane.x,this.pane.y),a.onError(function(a){a?(this.loading=!1,this.message=a):this.message=null}.bind(this))},i.prototype.setBounds=function(a,b,c){return this.bounds={x:a,y:b},c?this.views[c]&&this.views[c].pane.setBounds(a,b):angular.forEach(this.views,function(c){c.pane.setBounds(a,b)}),this},i.prototype.setPane=function(a,b,c){return this.pane={x:a,y:b},c?this.views[c]&&this.views[c].pane.setPane(a,b):angular.forEach(this.views,function(c){c.pane.setPane(a,b)}),this},i}]),angular.module("vgraph").factory("LinearModel",["StatCollection",function(a){"use strict";function b(a){a||(a={}),a.x||(a.x={}),a.y||(a.y={}),this.$dataProc=c(20,200,function(a){var b=a.registrations;b.forEach(function(a){a()})}),this.construct(),this.reset(a)}function c(a,b,c,d){function e(){var b=+new Date;b>h||b>g?(h=null,c.apply(d,f)):setTimeout(e,a)}var f,g,h;return function(){var c=+new Date;g=c+a,f=arguments,h||(h=c+b,setTimeout(e,a))}}var d=0;return b.prototype.construct=function(){var a=[];this.$modelId=d++,this.registrations=[],this.errorRegistrations=[],this.point={reset:function(a){a.$x=null,a.$y=null}},this.getLoaders=function(){return a},this.$follow=function(b){a.push(b)},this.$ignore=function(b){var c=a.indexOf(b);-1!==c&&a.splice(c,1)}},b.prototype.$ready=function(){var a,b,c=!1,d=this.getLoaders();for(a=0,b=d.length;b>a&&!c;a++)d[a].ready&&(c=!0);return c},b.prototype.reset=function(b){this.ready=!1,this.ratio=null,this.data=new a,b&&this.config(b||this),this.dataReady(!0)},b.prototype.config=function(a){this.x={massage:a.x.massage||null,padding:a.x.padding||0,scale:a.x.scale||function(){return d3.scale.linear()},parse:a.x.parse||function(a){return a.$interval},format:a.x.format||d3.format("03d"),tick:a.x.tick||{}},this.y={massage:a.y.massage||null,padding:a.y.padding||0,scale:a.y.scale||function(){return d3.scale.linear()},parse:a.y.parse||function(a,b){return void 0===a||null===a?null:a[b]},format:a.y.format||d3.format(",.2f"),tick:a.y.tick||{}}},b.prototype.onError=function(a){this.errorRegistrations.push(a)},b.prototype.setError=function(a){var b,c;for(b=0,c=this.errorRegistrations.length;c>b;b++)this.errorRegistrations[b](a)},b.prototype.getNode=function(a){return this.dataReady(),this.data.$getNode(a)},b.prototype.setValue=function(a,b,c){return this.dataReady(),this.data.$setValue(a,b,c)},b.prototype.removePlot=function(){},b.prototype.dataReady=function(a){var b=this.registrations;a?b.forEach(function(a){a()}):this.$dataProc(this)},b.prototype.register=function(a){this.registrations.push(a)},b.prototype.clean=function(){this.data.$sort()},b}]),angular.module("vgraph").factory("PaneModel",[function(){"use strict";function a(a){this.dataModel=a,this.x={},this.y={},this._bounds={},this._pane={}}return a.prototype.setBounds=function(a,b){return this._bounds.x=a,this._bounds.y=b,this},a.prototype.setPane=function(a,b){return this._pane.x=a,this._pane.y=b,this},a.prototype.isValid=function(a){var b;return this.filtered?(b=a.$interval,this.filtered.$minInterval<=b&&b<=this.filtered.$maxInterval):!1},a.prototype.filter=function(){var a,b,c,d,e,f,g=this.x,h=this.dataModel.data;if(h.length){if(this.dataModel.clean(),this._bounds.x?(b=this._bounds.x.min||h.$minIndex,c=this._bounds.x.max||h.$maxIndex,g.$min=b,g.$max=c):(b=g.$min||h.$minIndex,c=g.$max||h.$maxIndex),this.offset={},this._pane.x){if(d=this._pane.x,"number"==typeof d.start)e=h[d.start];else{if(d.start?"string"==typeof d.start&&("%"===d.start.charAt(0)?a=b+parseFloat(d.start.substring(1),10)*(c-b):"+"===d.start.charAt(0)?a=b+parseInt(d.start.substring(1),10):"="===d.start.charAt(0)&&(a=parseInt(d.start.substring(1),10))):a=b,void 0===a)throw"Start of pane not properly defined";e=a}if("number"==typeof d.stop)d.stop=h[d.stop];else{if(null===d.stop||void 0===d.stop?a=c:"string"==typeof d.stop&&("%"===d.stop.charAt(0)?a=b+parseFloat(d.stop.substring(1),10)*(c-b):"+"===d.stop.charAt(0)?a=b+parseInt(d.stop.substring(1),10):"="===d.stop.charAt(0)&&(a=parseInt(d.stop.substring(1),10))),void 0===a)throw"End of pane not properly defined";f=a}}else e=b,f=c;this.offset.$left=e,this.offset.left=(e-b)/(c-b),this.offset.$right=f,this.offset.right=(f-b)/(c-b),this.filtered=h.$filter(e,f),this.dataModel.fitToPane&&(this.filtered.$addNode(h.$makePoint(e)),this.filtered.$addNode(h.$makePoint(f)))}else this.filtered=h},a}]),angular.module("vgraph").factory("ViewModel",["PaneModel",function(a){"use strict";function b(b,c,d){var e,f,g=this;this.pane=new a(d),this.name=c,this.graph=b,this.components=[],this.dataModel=d,e={scale:d.x.scale(),calc:function(a){return e.scale(d.x.parse(a))},center:function(){return(e.calc(g.pane.filtered.$minIndex)+e.calc(g.pane.filtered.$maxIndex))/2}},this.x=e,f={scale:d.y.scale(),calc:function(a){return f.scale(d.y.parse(a))},center:function(){return(f.calc(g.pane.filtered.$minNode.$min)+f.calc(g.pane.filtered.$maxNode.$max))/2}},this.y=f,d.register(function(){b.needsRender(this)}.bind(this))}function c(a,b,c,d){for(;c>b;)a[b].push(d),b++}function d(a,b,d,e,f){var g,h,i,j,k=0;for(g=0,h=a.length;h>g;g++)i=a[g][b],void 0!==i&&null!==i&&(j=e(a[g]),j!==k&&c(d,k,j,null),f&&(i=f(i)),d[j].push(i),k=j+1);c(d,k,d.length,null)}return b.prototype.getPoint=function(a){var b=this.dataModel.data[a];return b?b:0>a?this.dataModel.data[0]:this.dataModel.data[this.dataModel.data.length]},b.prototype.getOffsetPoint=function(a){var b=Math.round(this.dataModel.data.length*a);return this.getPoint(b)},b.prototype.register=function(a){this.components.push(a)},b.prototype.hasData=function(){return this.pane.filtered&&this.pane.filtered.length>0},b.prototype.sample=function(){var a,b,c=this.graph.box,d=this.pane;d.filter(),b=d.filtered,b&&(this.x.scale.domain([b.$minIndex,b.$maxIndex]).range([c.innerLeft,c.innerRight]),a=this.x.scale,this.sampled=b.$sample(function(b,c){var d=a(b);return c.$interval=b,c._$interval=d,Math.round(d)},!0))},b.prototype.parse=function(){var a,b,c,d=(this.graph.box,this.pane),e=d.dataModel.data;this.sample(),c=this.sampled,c&&(this.components.forEach(function(e){var f;e.parse&&(f=e.parse(c,d.filtered,d.data),f&&(null!==f.min&&(!a&&0!==a||a>f.min)&&(a=f.min),null!==f.max&&(!b&&0!==b||b<f.max)&&(b=f.max)))}),this.viewport||(this.viewport={}),this.setViewportValues(a,b),this.setViewportIntervals(d.filtered.$minIndex,d.filtered.$maxIndex),this.dataModel.adjustSettings&&this.dataModel.adjustSettings(c.$maxIndex-c.$minIndex,b-a,e.$maxIndex-e.$minIndex))},b.prototype.setViewportValues=function(a,b){var c,d=this.graph.box;this.dataModel.y.padding&&(c=b===a?a*this.dataModel.y.padding:(b-a)*this.dataModel.y.padding,b+=c,a-=c),this.viewport.minValue=a,this.viewport.maxValue=b,this.y.scale.domain([a,b]).range([d.innerBottom,d.innerTop])},b.prototype.setViewportIntervals=function(a,b){var c=this.graph.box;this.viewport.minInterval=a,this.viewport.maxInterval=b,this.x.scale.domain([a,b]).range([c.innerLeft,c.innerRight])},b.prototype.build=function(){var a=this.pane,b=this.sampled;this.components.forEach(function(c){c.build&&c.build(b,a.filtered,a.dataModel)})},b.prototype.process=function(){var a=this.pane,b=this.sampled;this.components.forEach(function(c){c.process&&c.process(b,a.filtered,a.dataModel)})},b.prototype.finalize=function(){var a=this.pane,b=this.sampled;this.components.forEach(function(c){c.finalize&&c.finalize(b,a.filtered,a.dataModel)})},b.prototype.loading=function(){this.components.forEach(function(a){a.loading&&a.loading()})},b.prototype.error=function(){this.components.forEach(function(a){a.error&&a.error()})},b.prototype.highlight=function(a,b){var c,d=this.sampled;c=d.$get(b),c||(c=d.$getClosest(b)),a[this.name]=c,this.components.forEach(function(d){d.highlight&&d.highlight(a,b,c)})},b.prototype.publishStats=function(){var a,b,c=this.dataModel.data,d=this.pane.x.$max||9007199254740991,e=c.length;for(a=1;e>a;a++)b=c[a].$x-c[a-1].$x,d>b&&(d=b);return{step:d,count:c.length,bound:{min:this.pane.x.$min,max:this.pane.x.$max},data:{min:this.dataModel.x.$min,max:this.dataModel.x.$max}}},b.prototype.publishData=function(a,b,c){d(this.dataModel.data,b.name,a,c,b.format)},b}]),angular.module("vgraph").factory("DataFeed",[function(){"use strict";function a(a,c){this.explode=c,this.setSource(a),this._$dfUid=b++}var b=1,c={};return a.create=function(b,d){var e;return b._$dfUid&&c[b._$dfUid]?e=c[b._$dfUid]:(e=new a(b,d),b._$dfUid=e._$dfUid,c[e._$dfUid]=e),e},a.prototype.setSource=function(a){var b=this,c=a.push;this.data=a,this._readPos=0,a.push=function(){c.apply(this,arguments),b.$push()},a.$ready=function(){b.$trigger("ready")},this.$push()},a.prototype.$on=function(a,b){var c=this;return this._$listeners||(this._$listeners={}),this._$listeners[a]||(this._$listeners[a]=[]),this._$listeners[a].push(b),function(){c._$listeners[a].splice(c._$listeners[a].indexOf(b),1)}},a.prototype.$trigger=function(a,b){var c,d,e;if(this._$listeners&&(c=this._$listeners[a]))for(d=0,e=c.length;e>d;d++)c[d](b)},a.prototype.$push=function(){var a=this;this._$push||(this._$push=setTimeout(function(){var b=a._readNext();for(b&&a.$trigger("ready");b;)a.$trigger("data",b),b=a._readNext();a._$push=null},0))},a.prototype._readAll=function(a){for(var b=this._read(0);b;)a(b),b=this._read(b.next)},a.prototype._readNext=function(){var a=this._read(this._readPos);return a&&(this._readPos=a.next),a},a.prototype._read=function(a){var b,c=this.data,d=this.explode;return!c.length||a>=c.length?null:d?(b=c[a],{points:d(b),next:a+1,ref:b}):{points:c,next:c.length}},a}]),angular.module("vgraph").factory("DataLoader",[function(){"use strict";function a(a,b){var c=this,d={},e=this._process.bind(this),f=a.$on("ready",function(){c.ready=!0}),g=a.$on("data",function(a){function b(b){var f=d[b];e(f,a.points[c],a.ref)}var c,f;for(c=0,f=a.points.length;f>c;c++)Object.keys(d).forEach(b)});this.feed=a,this.confs=d,this.dataModel=b,b.$follow(this),this.$destroy=function(){b.$ignore(this),f(),g()}}var b={};return a.create=function(c,d,e){var f;return b[c._$dfUid]||(f=new a(c,d),b[c._$dfUid]=f),e&&f.addConf(e),f},a.unregister=function(){},a.prototype.addConf=function(a){var b=this._process.bind(this);this.confs[a.$uid]||(this.feed._readAll(function(c){var d,e,f=c.points;for(d=0,e=f.length;e>d;d++)b(a,f[d],c.ref)}),this.confs[a.$uid]=a)},a.prototype.removeConf=function(a){this.confs[a.$uid]&&delete this.confs[a.$uid]},a.prototype._process=function(a,b,c){var d;(!a.isDefined||a.isDefined(b))&&(d=a.parseValue?this.dataModel.setValue(a.parseInterval(b),a.ref.name,a.parseValue(b)):this.dataModel.getNode(a.parseInterval(b)),a.massage&&a.massage(d,b,c))},a}]),angular.module("vgraph").factory("DrawArea",["DrawBuilder",function(a){"use strict";function b(){}return b.prototype=new a,b.prototype.parseValue1=null,b.prototype.parseValue2=null,b.prototype.parseInterval=null,b.prototype.build=function(a){var b,c,d,e,f=[],g=[];for(b=0,c=a.length;c>b;b++)d=a[b],e=this.parseInterval(d),f.push(e+","+this.parseValue1(d)),g.unshift(e+","+this.parseValue2(d));return f.length?"M"+f.join("L")+"L"+g.join("L")+"Z":""},b}]),angular.module("vgraph").factory("DrawBox",["DrawBuilder",function(a){"use strict";function b(){}return b.prototype=new a,b.prototype.parseValue=null,b.prototype.parseInterval=null,b.prototype.build=function(a){var b,c,d,e,f,g,h;for(b=0,c=a.length;c>b;b++)d=this.valueParse(a[b]),void 0===e?(e=d,f=c):e>d?e=d:d>f&&(f=d);return g=this.parseInterval(a[0]),h=this.parseInterval(a[a.length-1]),"M"+(g+","+f)+"L"+(h+","+f)+"L"+(h+","+e)+"L"+(g+","+e)+"LZ"},b}]),angular.module("vgraph").factory("DrawBuilder",[function(){"use strict";function a(){}return a.prototype.preParse=function(a){return a},a.prototype.parse=function(a){var b,c,d,e,f=[],g=[f],h=this.preParse.bind(this);for(b=0,c=a.length;c>b;b++)d=a[b],e=h(d,e),e?f.push(e):0!==f.length&&(f=[],g.push(f));return g},a.prototype.render=function(a){var b,c,d;for(a=this.parse(a),b=0,c=a.length;c>b;b++)d=a[b],a[b]=this.build(d);return a},a.prototype.build=function(){return"M0,0Z"},a}]),angular.module("vgraph").factory("DrawElement",[function(){"use strict";function a(a){return(new DOMParser).parseFromString('<g xmlns="http://www.w3.org/2000/svg">'+a+"</g>","image/svg+xml").childNodes[0].childNodes}function b(b,c,d){var e,f;"object"==typeof b?e=b:(f="<"+this._tag+' class="'+c.className+'"></'+this._tag+">",e=d?a("<g>"+f+"</g>")[0]:a(f)[0]),this.getNode=function(){return e}}return b.svgCompile=a,b.prototype.build=function(a){var b,c,d,e=this.getNode();if("g"===e.tagName){if(d=e.childNodes,d.length>a.length)for(;d.length>a.length;)e.removeChild(d.pop());else if(d.length<a.length)for(;e.childNodes.length<a.length;)e.appendChild(d[0].cloneNode());for(d=e.childNodes,b=0,c=a.length;c>b;b++)d[b].setAttribute("d",a[b])}else e.setAttribute("d",a.join(""))},b}]),angular.module("vgraph").factory("DrawLine",["DrawBuilder",function(a){"use strict";function b(){}return b.prototype=new a,b.prototype.parseValue=null,b.prototype.parseInterval=null,b.prototype.build=function(a){var b,c,d;for(b=0,c=a.length;c>b;b++)d=a[b],a[b]=this.parseInterval(d)+","+this.parseValue(d);return"M"+a.join("L")},b}]),angular.module("vgraph").factory("StatCalculations",[function(){"use strict";function a(a){return null===a?!1:Number.isFinite?Number.isFinite(a)&&!Number.isNaN(a):isFinite(a)&&!isNaN(a)}function b(a,b){var c=[];return a.forEach(function(a){c.push("$"+b+"$"+a.ref.field)}),c}return{$resetCalcs:function(a){a.forEach(function(a){a.ref.field=a.ref.name})},$getFields:function(a){var b,c,d,e=[];for(b=0,c=a.length;c>b;b++)d=a[b].ref,e.push(d.field);return e},$setFields:function(a,b){var c,d,e;for(c=0,d=a.length;d>c;c++)e=a[c],e.ref&&(e=e.ref),e.field=b[c]},$getReferences:function(a){var b,c,d,e=[];for(b=0,c=a.length;c>b;b++)d=a[b].ref,e.push(d);return e},sum:function(a,c){var d=b(a,"sum");return a.forEach(function(a,b){var e=a.ref.field,f=d[b],g=0;c.forEach(function(a){var b=a[e];b&&(g+=b)}),c[f]=g,a.ref.field=f}),d},average:function(a,c){var d=b(a,"average");return a.forEach(function(a,b){var e=a.ref.field,f=d[b],g=0,h=0;c.forEach(function(a){var b=a[e];b?(g+=b,h++):0===b&&h++}),c[f]=g/h,a.ref.field=f}),d},stack:function(a,c){var d=b(a,"stack"),e=this.$getFields(a);return c.forEach(function(a){var b=0;e.forEach(function(c,e){var f=a[c]||0;b+=f,a[d[e]]=b})}),a.forEach(function(a,b){a.ref.field=d[b]}),d},limits:function(b,c){var d,e,f,g,h,i,j=b.field;if(angular.isArray(b))for(d=0,e=b.length;e>d;d++)g=this.limits(b[d],c),void 0===h?(h=g.min,i=g.max):(g.min<h&&(h=g.min),g.max>i&&(i=g.max));else for(d=0,e=c.length;e>d;d++)f=c[d],g=f[j],a(g)&&(void 0===h?(h=g,i=g):h>g?h=g:g>i&&(i=g));return{min:h,max:i}}}}]),angular.module("vgraph").factory("StatCollection",[function(){"use strict";function a(a,b,c,d){var e,f,g,h=0,i=a.length-1;if(g=a.get?function(b){return a.get(b)}:function(b){return a[b]},d||a.sort(function(a,b){return c(a)-c(b)}),c(g(h))>=b)return{left:h,right:h};if(c(g(i))<=b)return{left:i,right:i};if(a.length){for(;i-h>1;)e=Math.floor((i+h)/2),f=c(g(e)),f===b?(i=e,h=e):f>b?i=e:h=e;return i!==e&&c(g(i))===b?{left:i,right:i}:h!==e&&c(g(h))===b?{left:h,right:h}:{left:h,right:i}}}function b(){}function c(a){this._fullStat=a,this.$vgcUid=h++,this.$index={},this.$dirty=!1}function d(a){return null!==a&&void 0!==a&&"object"!=typeof a}function e(a){var b={};return Object.keys(a).filter(function(a){"$"!==a.charAt(0)&&"_"!==a.charAt(0)&&(b[a]={})}),b}function f(a,b,d,e){var f,g,h,i,j=[];for(f=0,g=a.length;g>f;f++)h=a[f],b(h)&&(d(h)||(i=new c(e),j.push(i))),i.$addNode(h[a.$vgcUid],h)}function g(a,b,d){var e,f,g,h,i=[],j=0;for(e=0,f=a.length;f>e;e++)g=a[e],e>=j&&(j+=b,h=new c(d),i.push(h)),h.$addNode(g[a.$vgcUid],g)}var h=0;return b.create=function(){return new b},b.prototype.$addValue=function(a,b){d(b)&&(void 0===this.$min?(this.$min=b,this.$max=b):b<this.$min?this.$min=b:b>this.$max&&(this.$max=b)),this[a]=b},b.prototype.$mimic=function(a){var b,c,d,e=Object.keys(a);for(b=0,c=e.length;c>b;b++)d=e[b],this[d]=a[d]},c.prototype=[],c.prototype._registerNode=function(a,b){var c=this.$vgcUid;b[c]=a,this.$index[a]=b,void 0===this.$minIndex?(this.$minIndex=a,this.$maxIndex=a,this.push(b)):a<this.$minIndex?(this.$minIndex=a,this.unshift(b)):a>this.$maxIndex?(this.$maxIndex=a,this.push(b)):(this.$dirty=!0,this.push(b))},c.prototype._registerValue=function(a,b){d(b)&&(void 0===this.$minNode?(this.$minNode=a,this.$maxNode=a):this.$minNode.$min>b?this.$minNode=a:this.$maxNode.$max<b&&(this.$maxNode=a))},c.prototype._registerStats=function(a,b,c){d(c)&&(void 0===a.$minIndex?(a.$minIndex=b,a.$maxIndex=b):b<a.$minIndex?a.$minIndex=b:b>a.$maxIndex&&(a.$maxIndex=b))},c.prototype._resetMin=function(){var a,b,c,d=this[0];for(a=1,b=this.length;b>a;a++)c=this[a],c.$min<d.$min&&(d=c);this.$minNode=d},c.prototype._restatMin=function(a){var b,c=0,e=this.$vgcUid,f=this.$fields[a];this.$sort();do b=this[c],c++;while(b&&!d(b[a]));f.$minIndex=b?b[e]:void 0},c.prototype._resetMax=function(){var a,b,c,d=this[0];for(a=1,b=this.length;b>a;a++)c=this[a],c.$max>d.$max&&(d=c);this.$maxNode=d},c.prototype._restatMax=function(a){var b,c=this.length-1,e=this.$vgcUid,f=this.$fields[a];this.$sort();do b=this[c],c--;while(b&&!d(b[a]));f.$maxIndex=b?b[e]:void 0},c.prototype._statNode=function(a){var b=this,c=this.$vgcUid,e=this.$fields;Object.keys(e).forEach(function(f){var g=a[f],h=e[f];d(g)?b._registerStats(h,a[c],g):(h.$minIndex===a[c]&&b._restatMin(f),h.$maxIndex===a[c]&&b._restatMax(f))})},c.prototype.$getNode=function(a){var c=+a,d=this.$index[c];if(isNaN(c))throw new Error("index must be a number, not: "+a+" that becomes "+c);return d||(d=new b,this._registerNode(a,d)),d},c.prototype.$setValue=function(a,b,c){var d=this.$getNode(a);return this.$fields||(this.$fields={}),this.$fields[b]||(this.$fields[b]={}),d[b]=c,this._fullStat&&this._registerStats(this.$fields[b],a,c),this._registerValue(d,c),d},c.prototype._copyFields=function(){var a={};return Object.keys(this.$fields).forEach(function(b){a[b]={}}),a},c.prototype.$addNode=function(a,b){var c;if(c=this.$index[a],this.$fields||(this.$fields=e(c)),c){if(c===b)return;c.$mimic(b),this._fullStat&&(c===this.$minNode&&this._resetMin(),c===this.$maxNode&&this._resetMax(),this._statNode(c))}else this._registerNode(a,b),this._fullStat&&(void 0!==b.$min&&this._registerValue(b,b.$min),void 0!==b.$max&&this._registerValue(b,b.$max),this._statNode(b))},c.prototype.$pos=function(b){var c,d=this.$vgcUid;return this.$sort(),c=a(this,b,function(a){return a[d]},!0)},c.prototype.$getClosestPair=function(a){var b=this.$pos(a);return{left:this[b.left],right:this[b.right]}},c.prototype.$getClosest=function(a){var b,c,d=this.$getClosestPair(a),e=this.$vgcUid;return b=a-d.left[e],c=d.right[e]-a,c>b?d.left:d.right},c.prototype.$get=function(a){return this.$index[a]},c.prototype.$sort=function(){var a=this.$vgcUid;this.$dirty&&(this.$dirty=!1,this.sort(function(b,c){return b[a]-c[a]}))},c.prototype.$makePoint=function(a){var b,c,d,e,f,g,h=this.$getClosestPair(a),i={},j=Object.keys(this.$fields),k=this.$vgcUid;if(h.left!==h.right)for(e=(a-h.left[k])/(h.right[k]-h.left[k]),b=0,c=j.length;c>b;b++)d=j[b],f=h.left[d],g=h.right[d],void 0!==g&&null!==g&&void 0!==f&&null!==f&&(i[d]=f+(g-f)*e);return i[k]=a,i},c.prototype.$makeNode=function(a){this.$addNode(a,this.$makePoint(a))},c.prototype.$filter=function(a,b,d){var e,f=-1,g=this.$vgcUid,h=new c(d);h.$fields=this._copyFields(),this.$sort();do f++,e=this[f];while(e&&e[g]<a);for(;e&&e[g]<=b;)h.$addNode(e[g],e),f++,e=this[f];return h},c.prototype.$sample=function(a,b){var d,e,f,g,h,i,j=this.$vgcUid;if(i=new c(b),this.length){for(i.$fields=this._copyFields(),h=this[0],f=a(h[j],h),i.$addNode(f,h),d=1,e=this.length;e>d;d++)h=this[d],g=a(h[j],h),g!==f&&(f=g,i.$addNode(g,h));h=this[e-1],i.$addNode(a(h[j],h),h)}return i},c.prototype.$bucketize=function(a,b,c){return"function"==typeof a?(2===arguments.length&&(c=this._fullStat),f(this,a,b,c)):(c=1===arguments.length?this._fullStat:b,g(this,this.length/a,c))},c}]),angular.module("vgraph").directive("vgraphArea",["$compile","ComponentGenerator",function(a,b){"use strict";var c=0;return{require:["^vgraphChart"],scope:{data:"=vgraphArea",config:"=config"},link:function(d,e,f,g){function h(c){var e,f,g,h,k,n;if(j=[],c){for(d3.select(q).selectAll("path").remove();p.length;)p.pop().$destroy();for(k=b.compileConfig(d,c,"line"),o={},f=0,g=k.length;g>f;f++)n=k[f],h=m.views[n.$conf.control||l],o[h.name]||(o[h.name]=[],i(h)),o[h.name].push(n),q.appendChild(n.element),n.calc=b.makeAreaCalc(h,n.name),e=d.$new(),p.push(e),a(n.element)(e)}}function i(a){n[a.name]||(n[a.name]=a,a.register({parse:function(c){var d,e,f=[],g=o[a.name];if(g)for(d=0,e=g.length;e>d;d++)f.push(g[d].name);return b.parseSegmentedLimits(c,f)},finalize:function(b,c){var d,e,f,g=o[a.name];if(g)for(d=0,e=g.length;e>d;d++)f=g[d],f.$d3.attr("d",f.calc(c))}}))}var j,k,l=f.control||"default",m=g[0].graph,n={},o={},p=[],q=e[0],r=c++;q.$id=r,k=d.$watchCollection("config",h),d.$on("$destroy",function(){for(;p.length;)p.pop().$destroy();k()})}}}]),angular.module("vgraph").directive("vgraphAxis",[function(){"use strict";function a(a,b){return!(a.bottom<b.top||a.top>b.bottom||a.right<b.left||a.left>b.right)}return{scope:{orient:"=vgraphAxis",adjust:"=axisAdjust",rotation:"=tickRotation"},require:["^vgraphChart"],link:function(b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=d.control||"default",r=e[0].graph,s=r.views[q],t=d3.svg.axis(),u="axis",v=r.box,w=s.dataModel,x=0,y=null,z=!0,A=!1,B=parseInt(d.tickLength)||0,C=parseInt(d.tickPadding)||3,D=parseInt(d.tickMargin)||0,E=d3.select(c[0]);
switch(E.attr("visibility","hidden"),k=E.append("g").attr("class","ticks"),o=E.append("g").attr("class","padding"),l=o.append("g").attr("class","tick-marks"),m=o.append("rect").attr("class","tick-margin"),p=E.append("g").attr("class","label-wrap"),d.tickRotation&&(y=parseInt(d.tickRotation,10)%360),d.labelOffset&&(x=b.$eval(d.labelOffset)),d.labelClean&&(z=b.$eval(d.labelClean)),d.labelEndpoints&&(A=b.$eval(d.labelEndpoints)),d.axisLabel&&(n=p.append("text").attr("class","axis-label label"),b.$parent.$watch(d.axisLabel,function(a){n.text(a)})),f=function(){d.tickMarks?(t.tickValues(b.$eval(d.tickMarks)),h=[]):d.tickCount?(t.ticks(b.$eval(d.tickCount)),h=[]):(t.ticks(10),h=[])},b.orient){case"top":g=function(){var a;if(E.attr("class",u+" x top").attr("transform","translate("+v.left+","+(v.top-B)+")").attr("width",v.width).attr("height",v.padding.top),n&&n.attr("text-anchor","middle").attr("x",v.width/2).attr("y",v.padding.top-x),D&&m.attr("height",D).attr("width",v.innerWidth).attr("x",0).attr("y",-D),l.attr("transform","translate(-"+v.margin.left+",0)"),h&&(t.orient("top").tickFormat(w.x.format).innerTickSize(-(v.innerHeight+B+D)).outerTickSize(0).tickPadding(C+B+D).scale(s.x.scale),w.x.tick.interval&&t.ticks(w.x.tick.interval,w.x.tick.step),k.attr("transform","translate(-"+v.margin.left+","+v.padding.top+")").call(t),a=E.selectAll("g.axis-cap").data(s.x.scale.domain()),A&&(a.enter().append("g").attr("class",function(a,b){return"axis-cap "+(b?"axis-max":"axis-min")}).append("text"),a.exit().remove(),a.attr("transform",function(a){return"translate("+(s.x.scale(a)-v.margin.left)+",0)"}).select("text").text(function(a){var b=w.x.format(a);return(""+b).match("NaN")?"":b}).attr("dy","-0.25em").attr("y",v.padding.top).attr("text-anchor","middle")),y)){if(null===k.select(".tick text")[0][0])return;k.selectAll(".tick text").attr("transform","translate(0,"+k.select(".tick text").attr("y")+") rotate("+y+",0,0)").attr("y","0").style("text-anchor",y%360>0?"end":"start"),a.select("text").attr("transform","rotate("+y+",0,0)").style("text-anchor",b.rotation%360>0?"end":"start")}};break;case"bottom":g=function(){var a;if(E.attr("class",u+" x bottom").attr("transform","translate("+v.left+","+v.innerBottom+")").attr("width",v.width).attr("height",v.padding.bottom),n&&n.attr("text-anchor","middle").attr("x",v.width/2).attr("y",v.padding.bottom+x),D&&m.attr("height",D).attr("width",v.innerWidth).attr("x",0).attr("y",0),l.attr("transform","translate(-"+v.margin.left+",0)"),h&&(t.orient("bottom").tickFormat(w.x.format).innerTickSize(v.innerHeight+B+D).outerTickSize(0).tickPadding(C+B+D).scale(s.x.scale),w.x.tick.interval&&t.ticks(w.x.tick.interval,w.x.tick.step),k.attr("transform","translate(-"+v.margin.left+","+-v.innerHeight+")").call(t),a=E.selectAll("g.axis-cap").data(s.x.scale.domain()),A&&(a.enter().append("g").attr("class",function(a,b){return"axis-cap "+(b?"axis-max":"axis-min")}).append("text"),a.exit().remove(),a.attr("transform",function(a){return"translate("+(s.x.scale(a)-v.margin.left)+",0)"}).select("text").text(function(a){var b=w.x.format(a);return(""+b).match("NaN")?"":b}).attr("dy","1em").attr("y",0).attr("text-anchor","middle")),y)){if(null===k.select(".tick text")[0][0])return;k.selectAll(".tick text").attr("transform",function(){return"translate(0,"+d3.select(this).attr("y")+") rotate("+y+",0,0)"}).attr("y","0").style("text-anchor",y%360>0?"start":"end"),a.select("text").attr("transform","rotate("+y+",0,0)").style("text-anchor",b.rotation%360>0?"start":"end")}};break;case"right":g=function(){var a;E.attr("class",u+" y right").attr("transform","translate("+B+","+v.top+")").attr("width",v.padding.right).attr("height",v.height),p.attr("transform","translate("+(v.right-v.padding.right)+","+v.height+") rotate( 90 )"),n&&n.attr("text-anchor","middle").attr("x",-(v.height/2)).attr("y",-x),D&&m.attr("height",v.innerHeight).attr("width",D).attr("x",-D).attr("y",0),l.attr("transform","translate(-"+v.padding.right+","+(-v.top||0)+")"),h&&(t.orient("right").tickFormat(w.y.format).innerTickSize(-(v.innerWidth+B+D)).outerTickSize(0).tickPadding(C+B+D).scale(s.y.scale),w.y.tick.interval&&t.ticks(w.y.tick.interval,w.y.tick.step),k.attr("transform","translate("+v.innerRight+","+(-v.top||0)+")"),k.call(t),k.select(".domain").attr("transform","translate("+(B+D)+",0)"),A&&(a=E.selectAll("g.axis-cap").data(s.y.scale.domain()),a.enter().append("g").attr("class",function(a,b){return"axis-cap "+(b?"axis-max":"axis-min")}).append("text"),a.exit().remove(),a.attr("transform",function(a){return"translate(0,"+(s.y.scale(a)-v.margin.top)+")"}).select("text").text(function(a){var b=w.y.format(a);return(""+b).match("NaN")?"":b}).attr("dy",".25em").attr("x",v.padding.left-t.tickPadding()).attr("text-anchor","end")))};break;case"left":g=function(){var a;E.attr("class",u+" y left").attr("transform","translate("+v.left+","+v.top+")").attr("width",v.padding.left).attr("height",v.height),p.attr("transform","translate("+v.padding.left+","+v.height+") rotate( -90 )"),n&&n.attr("text-anchor","middle").attr("x",v.height/2).attr("y",-x),D&&m.attr("height",v.innerHeight).attr("width",D).attr("x",-D).attr("y",0),l.attr("transform","translate("+v.padding.left+","+(-v.top||0)+")"),h&&(t.orient("left").tickFormat(w.y.format).innerTickSize(-(v.innerWidth+B+D)).outerTickSize(0).tickPadding(C+B+D).scale(s.y.scale),w.y.tick.interval&&t.ticks(w.y.tick.interval,w.y.tick.step),k.attr("transform","translate("+(v.padding.left-B-D)+","+(-v.top||0)+")").call(t),k.select(".domain").attr("transform","translate("+(B+D)+",0)"),A&&(a=E.selectAll("g.axis-cap").data(s.y.scale.domain()),a.enter().append("g").attr("class",function(a,b){return"axis-cap "+(b?"axis-max":"axis-min")}).append("text"),a.exit().remove(),a.attr("transform",function(a){return"translate(0,"+(s.y.scale(a)-v.margin.top)+")"}).select("text").text(function(a){var b=w.y.format(a);return(""+b).match("NaN")?"":b}).attr("dy",".25em").attr("x",v.padding.left-t.tickPadding()).attr("text-anchor","end")))}}s.register({loading:function(){E.attr("visibility","hidden")},build:function(){void 0===h&&f(),g()},process:function(){h.length=0,B&&(k.selectAll(".tick text").each(function(a){h.push({el:this,val:a,position:this.getBoundingClientRect()})}),h.sort(function(a,b){var c=a.position.top-b.position.top;return c?c:a.position.left-b.position.left})),z&&(i=E.select(".axis-min text").node(),i&&(i=i.getBoundingClientRect()),j=E.select(".axis-max text").node(),j&&(j=j.getBoundingClientRect()))},finalize:function(b,c){var d,e,f,g,k,m,n={};if(!c.length)return void E.attr("visibility","hidden");for(E.attr("visibility",""),l.selectAll("line").remove(),g=0,k=h.length;k>g;g++)d=!0,e=h[g],f=e.position,z&&i&&(a(f,i)||a(f,j))?(e.el.setAttribute("class","collided"),d=!1):void 0===n.left?(n.left=f.left,n.right=f.right,n.width=f.width,n.top=f.top,n.bottom=f.bottom,n.height=f.height,e.el.setAttribute("class","")):z&&a(f,n)?(e.el.setAttribute("class","collided"),d=!1):(m=!1,f.left<n.left&&(n.left=f.left,m=!0),f.right>n.right&&(n.right=f.right,m=!0),m&&(n.width=n.right-n.left,m=!1),f.top<n.top&&(n.top=f.top,m=!0),f.bottom>n.bottom&&(n.bottom=f.bottom,m=!0),m&&(n.height=n.bottom-n.top),e.el.setAttribute("class",""))}},"axis-"+b.orient)}}}]),angular.module("vgraph").directive("vgraphBar",["$compile","ComponentGenerator",function(a,b){"use strict";return{require:["^vgraphChart"],scope:{data:"=?vgraphBar",config:"=config"},link:function(c,d,e,f){function g(d){var e,f,g,i;if(d){for(d3.select(m).selectAll("path").remove(),h=b.compileConfig(c,d,"line");l.length;)l.pop().$destroy();for(f=0,g=h.length;g>f;f++)i=h[f],i.$valueField="$"+i.name,f?(m.insertBefore(i.element,h[f-1].element),i.$bottom=h[f-1].$valueField):m.appendChild(i.element),i.calc=b.makeLineCalc(k,i.$valueField),e=c.$new(),l.push(e),a(i.element)(e)}}var h,i=e.control||"default",j=f[0].graph,k=j.views[i],l=[],m=d[0],n=parseInt(e.minWidth||1),o=parseInt(e.padding||1),p=d3.select(m).append("g").attr("class","mount");c.$watchCollection("config",g),k.register({parse:function(a){{var c=k.x.scale(k.viewport.minInterval),d=k.x.scale(k.viewport.maxInterval),e=d-c,f=o+n,g=e/f;a.$bucketize(g)}return b.parseStackedLimits(a,h)},build:function(a,b){var c,d,e=0,f=k.x.scale(k.viewport.minInterval),g=k.x.scale(k.viewport.maxInterval),h=g-f,i=o+n,j=h/i,l=b.length/j;for(p.selectAll("rect").remove(),1>l&&(l=1),c=0,d=b.length;d>c;c=Math.floor(e))e+=l},finalize:function(a,b){var c,d,e;for(c=0,d=h.length;d>c;c++)e=h[c],e.$d3.attr("d",e.calc(b))}})}}}]),angular.module("vgraph").directive("vgraphChart",[function(){"use strict";function a(a,b){b&&(a.$mat=d3.select(b).insert("rect",":first-child"),a.$frame=d3.select(b).insert("rect",":first-child")),a.$mat&&a.innerWidth&&(a.$mat.attr("class","mat").attr("width",a.innerWidth).attr("height",a.innerHeight).attr("transform","translate("+a.innerLeft+","+a.innerTop+")"),a.$frame.attr("class","frame").attr("width",a.width).attr("height",a.height).attr("transform","translate("+a.left+","+a.top+")"))}return{scope:{graph:"=vgraphChart",model:"=model"},controller:["$scope",function(b){var c=b.model,d=b.graph;this.graph=d,d.addDataCollection(c),d.box.register(function(){a(d.box),d.rerender(function(){b.$apply()})})}],require:["vgraphChart"],link:function(b,c,d,e){var f=e[0].graph;f.box.targetSvg(c),a(f.box,c[0]),b.$watch("model.loading",function(a){a?c.addClass("loading"):c.removeClass("loading")}),b.$watch("model.error",function(a){a?c.addClass("hasError"):c.removeClass("hasError")})},restrict:"A"}}]),angular.module("vgraph").directive("vgraphCompare",["$compile","ComponentGenerator",function(a,b){"use strict";return{require:["^vgraphChart"],scope:{config1:"=config1",config2:"=config2"},link:function(c,d,e,f){var g=f[0].graph,h=g.getPrimaryView(),i=b.svgCompile('<g vgraph-line="config1" pair="config2" class="compare"></g>');d[0].appendChild(i[0]),a(i)(c),h.register({highlight:function(a){var b=c.config1.ref,d=c.config2.ref,f=a[b.view],g=a[d.view];a[e.reference||"compare"]={diff:Math.abs(f[b.field]-g[d.field]),y:(b.$view.y.scale(f[b.field])+d.$view.y.scale(g[d.field]))/2,_$interval:(f._$interval+g._$interval)/2}}})}}}]),angular.module("vgraph").directive("vgraphFill",["$compile","ComponentGenerator","StatCalculations",function(a,b,c){"use strict";return b.generate("vgraphFill",{scope:{data:"=vgraphFill",fillTo:"=fillTo",value:"=value",interval:"=interval",filter:"=filter"},link:function(d,e,f,g){var h,i=f.control||"default",j=g[0].graph,k=j.views[i],l=f.name,m=d3.select(e[0]).append("path").attr("class","fill plot-"+l),n=b.makeFillCalc(k,l,d.fillTo);"string"==typeof d.fillTo&&(h=b.svgCompile('<g vgraph-feed="data" name="'+d.fillTo+'" value="fillTo" interval="interval" control="'+i+'"></g>')[0],e[0].appendChild(h),a(h)(d)),k.register({parse:function(a){return c.limits(l,a)},finalize:function(a){m.attr("d",n(a))}})}})}]),angular.module("vgraph").directive("vgraphFocus",[function(){"use strict";return{require:["^vgraphChart"],link:function(a,b,c,d){var e=d[0].graph,f=e.box,g=d3.select(b[0]),h=g.append("rect").attr("class","focus").attr("visibility","hidden");f.register(function(){h.attr("height",f.innerHeight).attr("y",f.innerTop)}),a.$watch("follow",function(a){var b,c,d;a&&void 0!==a.xDiff&&(b=Math.abs(a.xDiff),c=a.x0-b,d=a.x0+b,h.attr("visibility","visible"),c>f.innerLeft?h.attr("x",c):(c=f.innerLeft,h.attr("x",f.innerLeft)),d>f.innerRight?h.attr("width",f.innerRight-c):h.attr("width",d-c))}),a.$watch("stop",function(a){var b,c,d,g,i;a&&(h.attr("visibility","hidden"),b=Math.abs(a.xDiff),b>3&&(c=a.x0-b,d=a.x0+b,c<f.innerLeft?c=0:c-=f.innerLeft,d>f.innerRight?d=f.innerWidth:d-=f.innerLeft,g=e.getPrimaryView().pane.offset,i=f.innerWidth*g.right-f.innerWidth*g.left,e.setPane({start:"%"+(f.innerWidth*g.left+c/f.innerWidth*i)/f.innerWidth,stop:"%"+(f.innerWidth*g.right-(f.innerWidth-d)/f.innerWidth*i)/f.innerWidth},{start:null,stop:null}),e.rerender()))})},scope:{follow:"=vgraphFocus",stop:"=loseFocus"}}}]),angular.module("vgraph").directive("vgraphIndicator",[function(){"use strict";return{require:["^vgraphChart"],scope:{ref:"=?vgraphIndicator"},link:function(a,b,c,d){function e(){k.attr("visibility","hidden")}var f,g,h,i=a.$eval(c.pointRadius)||3,j=a.$eval(c.outerRadius),k=d3.select(b[0]).attr("transform","translate(1000,1000)"),l=k.append("circle").attr("class","point inner").attr("r",i).attr("visibility","hidden"),m=k.append("circle").attr("class","point outer").attr("r",i).attr("visibility","hidden");f=a.ref?a.ref:d[0].graph.refs[c.vgraphIndicator],j&&(g=function(){m.transition().duration(1e3).attr("r",j).transition().duration(1e3).attr("r",i).ease("sine").each("end",function(){setTimeout(function(){g()},3e3)})})(),f.$view.register({error:e,loading:e,finalize:function(a){var b,c,d,e=f.alias||f.name,g=a.$fields[e];g?(b=a.$index[g.$maxIndex],b&&b[e]?(c=b._$interval,d=f.$view.y.scale(b[e]),c&&d&&(h=!0,k.attr("transform","translate("+c+","+d+")"),l.attr("visibility","visible"),m&&m.attr("visibility","visible"))):(h=!1,l.attr("visibility","hidden"),m&&m.attr("visibility","hidden"))):(h=!1,l.attr("visibility","hidden"),m&&m.attr("visibility","hidden"))}})}}}]),angular.module("vgraph").directive("vgraphInteract",[function(){"use strict";return{require:["^vgraphChart"],scope:{highlight:"=vgraphInteract",dragStart:"=?dBegin",dragPos:"=?dChange",dragStop:"=?dEnd"},link:function(a,b,c,d){function e(b,c,d){clearTimeout(h),a.$apply(function(){var e=d3.mouse(b);angular.forEach(a.highlight.point,function(a){$(a.$els).removeClass("active")}),a.highlight.point=d,a.highlight.offset=c,a.highlight.position={x:e[0],y:e[1]},angular.forEach(a.highlight.point,function(a){$(a.$els).addClass("active")})})}function f(){h=setTimeout(function(){a.$apply(function(){angular.forEach(a.highlight.point,function(a){$(a.$els).removeClass("active")}),a.highlight.point=null,a.highlight.closest=null,a.highlight.offset=null})},100)}var g,h,i=d[0].graph,j=!1,k=i.box,l=d3.select(b[0]),m=l.append("rect").style("opacity","0").attr("class","focal").on("mousemove",function(){var a=d3.mouse(this)[0];j||e(this,a,i.highlight(a))}).on("mouseout",function(a){j||f(this,a)});l.attr("class","interactive"),l.call(d3.behavior.drag().on("dragstart",function(){g=d3.mouse(b[0]),j=!0,f(),a.dragStart={x:g[0],y:g[1]},a.$apply()}).on("dragend",function(){var c=d3.mouse(b[0]);j=!1,a.dragStop={x0:g[0],y0:g[1],x1:c[0],x2:c[1],xDiff:c[0]-g[0],yDiff:c[1]-g[1]},a.$apply()}).on("drag",function(){var c=d3.mouse(b[0]);a.dragPos={x0:g[0],y0:g[1],x1:c[0],x2:c[1],xDiff:c[0]-g[0],yDiff:c[1]-g[1]},a.$apply()})),l.on("dblclick",function(){i.setPane({start:null,stop:null},{start:null,stop:null}),i.rerender()}),angular.forEach(i.views,function(a){a.register({finalize:function(){m.attr({x:k.innerLeft,y:k.innerTop,width:k.innerWidth,height:k.innerHeight})}})}),a.highlight||(a.highlight={}),a.dragStart||(a.dragStart={}),a.dragPos||(a.dragPos={}),a.dragStop||(a.dragStop={})}}}]),angular.module("vgraph").directive("vgraphLine",["ComponentGenerator","StatCalculations",function(a,b){"use strict";return{scope:{config:"=?vgraphLine",feed:"=?feed",pair:"=?pair",value:"=?value",interval:"=?interval",explode:"=?explode",massage:"=?massage"},require:["^vgraphChart"],link:function(c,d,e,f){var g,h,i,j,k=[],l=f[0].graph,m=a.getConfig(c,e,l),n=d3.select(d[0]).append("path");g=m.ref,k.push(g),a.watchFeed(c,m),e.reference&&l.setInputReference(e.reference,g),h=m.pair||c.pair,h?(j="fill ",h.ref&&(k.push(h.ref),a.watchFeed(c,h),h=h.ref),h.field||(h.field=h.name),i=a.makeFillCalc(g,h),e.pairReference&&l.setInputReference(e.pairReference,h)):(j="line ",i=a.makeLineCalc(g)),m.className&&(j+=m.className+" "),j+="plot-"+g.name,n.attr("class",j),g.$view.register({parse:function(a){return b.limits(k,a)},finalize:function(a){n.attr("d",i(a))},publish:function(b,c,d,e){c.push(name),a.publish(b,name,d,e)}})}}}]),angular.module("vgraph").directive("vgraphLoading",["$interval",function(a){"use strict";return{require:["^vgraphChart"],link:function(b,c,d,e){function f(){!o&&m.loading&&(r.attr("visibility","visible"),o=!0,a.cancel(i),h(),i=a(h,4005))}function g(){r.attr("visibility","hidden"),o=!1,a.cancel(i)}function h(){t.attr("x",function(){return j}).attr("width",function(){return 0}).transition().duration(1e3).attr("x",function(){return j}).attr("width",function(){return k}).ease("sine").transition().duration(1e3).attr("width",0).attr("x",function(){return l}).ease("sine").transition().duration(1e3).attr("width",function(){return k}).attr("x",function(){return j}).ease("sine").transition().duration(1e3).attr("x",function(){return j}).attr("width",0).ease("sine")}var i,j,k,l,m=e[0].graph,n=m.getPrimaryView(),o=!1,p=m.box,q=d.vgraphLoading||"Loading Data",r=d3.select(c[0]).attr("class","loading-view"),s=r.append("rect").attr("height",20).attr("class","outline"),t=r.append("rect").attr("width",0).attr("height",20).attr("class","filling"),u=r.append("text").text(q);p.register(function(){if(j=p.innerLeft+p.innerWidth/5,k=3*p.innerWidth/5,l=j+k,k){t.attr("x",j).attr("y",p.middle-10),s.attr("x",j).attr("y",p.middle-10).attr("width",k);try{u.attr("text-anchor","middle").attr("x",p.center).attr("y",p.middle+u.node().getBBox().height/2-2)}catch(a){u.attr("text-anchor","middle").attr("x",p.center).attr("y",p.middle)}f()}else g()}),b.$on("$destroy",function(){g()}),n.register({finalize:function(){g(),m.loading&&p.ratio&&f()}})}}}]),angular.module("vgraph").directive("vgraphMessage",[function(){"use strict";return{require:["^vgraphChart"],link:function(a,b,c,d){var e=d[0].graph,f=e.box,g=d3.select(b[0]).attr("class","error-view"),h=g.append("rect").attr("class","outline"),i=g.append("text");f.register(function(){if(f.innerHeight){h.attr("transform","translate("+f.innerLeft+","+f.innerTop+")").attr("width",f.innerWidth).attr("height",f.innerHeight);try{i.attr("text-anchor","middle").attr("x",f.center).attr("y",f.middle+i.node().getBBox().height/2)}catch(a){i.attr("text-anchor","middle").attr("x",f.center).attr("y",f.middle)}}}),a.$watch(function(){return e.message},function(a){a&&!e.loading?(g.attr("visibility","visible"),i.text(a)):g.attr("visibility","hidden")})}}}]),angular.module("vgraph").directive("vgraphMultiLine",["$compile","ComponentGenerator",function(a,b){"use strict";return{require:["^vgraphChart"],scope:{config:"=vgraphMultiLine",feed:"=?feed"},link:function(c,d,e){function f(e){var f,h,j,k,l;if(e){for(d3.select(d[0]).selectAll("g").remove(),g&&g.$destroy(),k="",f=0,h=e.length;h>f;f++)j=e[f],j.feed||(j.feed=c.feed),j.ref||(j.ref={name:j.name,view:i}),k+='<g vgraph-line="config['+f+']"></g>';for(l=b.svgCompile(k),f=0,h=l.length;h>f;f++)d[0].appendChild(l[f]);g=c.$new(),a(l)(g)}}var g,h,i=e.control||"default";h=c.$watchCollection("config",f),c.$on("$destroy",function(){g.$destroy(),h()})}}}]),angular.module("vgraph").directive("vgraphStack",["$compile","ComponentGenerator","StatCalculations",function(a,b,c){"use strict";return{require:["^vgraphChart"],scope:{config:"=vgraphStack",feed:"=?feed"},link:function(d,e,f,g){function h(c){var f,g,h,i,n,o={};if(k=[],l=[],c){for(d3.select(e[0]).selectAll("g").remove(),j&&j.$destroy(),i="",f=0,g=c.length;g>f;f++)h=c[f],h.feed||(h.feed=d.feed),h.ref||(h.ref={name:h.name,view:m}),h.pair=o,o=h.ref,i+='<g vgraph-line="config['+f+']"></g>';for(n=b.svgCompile(i),f=0,g=n.length;g>f;f++)e[0].appendChild(n[f]);j=d.$new(),a(n)(j)}}{var i,j,k,l,m=f.control||"default",n=g[0].graph,o=n.views[m];e[0]}d.$watchCollection("config",h),i=d.$watchCollection("config",h),d.$on("$destroy",function(){j.$destroy(),i()}),o.register({parse:function(a){var b=d.config;c.$resetCalcs(b),c.stack(b,a)}})}}}]),angular.module("vgraph").directive("vgraphTarget",[function(){"use strict";return{require:["^vgraphChart"],scope:{pointRadius:"=pointRadius",config:"=vgraphTarget",target:"=target"},link:function(a,b,c,d){function e(b){f=b,b?(i.style("visibility","visible").attr("transform","translate("+b+",0)"),void 0===c.noDots&&angular.forEach(a.config,function(d){var e,f=angular.isString(d)?g.refs[d]:d.ref,h=f.$view,i=f.name,j=f.field,m=a.target[l][h.name],n="plot-"+i,o=m[j];void 0!==o?(e=k.selectAll("circle.point."+n),e[0].length||(e=k.append("circle").attr("class","point "+n+" "+h.name)),e.attr("cx",c.offset?m._$interval-b:0).attr("cy",h.y.scale(o)).attr("r",a.$eval(c.pointRadius)||3)):k.selectAll("circle.point."+n).remove()})):i.style("visibility","hidden")}var f,g=d[0].graph,h=g.box,i=d3.select(b[0]).attr("class","target"),j=i.append("line").attr("class","focus").attr("x1",0).attr("x2",0),k=i.append("g"),l=c.type||"point";c.offset?a.$watch("target.offset",e):a.$watch("target.point.$pos",function(a){e(a)}),h.register(function(){j.attr("y1",h.innerTop).attr("y2",h.innerBottom)})}}}]),angular.module("vgraph").directive("vgraphTooltip",[function(){"use strict";return{require:["^vgraphChart"],scope:{formatter:"=textFormatter",config:"=?vgraphTooltip",point:"=?point",x:"=?positionX",y:"=?positionY"},link:function(a,b,c,d){var e=(a.config,d[0].graph),f=a.formatter||function(a){return a.compare.diff},g=a.x||function(a){return a.compare.$_interval},h=a.y||function(a){return a.compare.y},i=parseInt(c.offsetX)||0,j=parseInt(c.offsetY)||0,k=d3.select(b[0]).attr("class","tooltip"),l=k.append("polygon").attr("class","outline").attr("transform","translate(0,-15)"),m=k.append("text").style("line-height","20").style("font-size","16").attr("class","label");a.$watch("point",function(a){var b,c,d,n;a&&(d=h(a)),void 0!==d?(b=d+j,c=g(a)+i,m.text(f(a)),n=m.node().getComputedTextLength()+5,k.style("visibility","visible"),c+n+16<e.box.innerRight?(k.attr("transform","translate("+c+","+b+")"),m.attr("transform","translate(10,5)"),l.attr("points","0,15 10,0 "+(n+10)+",0 "+(n+10)+",30 10,30 0,15")):(k.attr("transform","translate("+(c-2*i-n-10)+","+b+")"),m.attr("transform","translate(5,5)"),l.attr("points","0,0 "+n+",0 "+(n+10)+",15 "+n+",30 0,30 0,0"))):k.style("visibility","hidden")})}}}]),function(a){"use strict";var b=/\S+/g,c=/[\t\r\n\f]/g;a&&(a.fn.addClass=function(d){var e,f,g,h,i,j,k,l="string"==typeof d&&d,m=0,n=this.length;if(a.isFunction(d))return this.each(function(b){a(this).addClass(d.call(this,b,this.className))});if(l)for(e=(d||"").match(b)||[];n>m;m++)if(f=this[m],k="string"!=typeof f.className,g=1===f.nodeType&&(f.className?(" "+(k?f.getAttribute("class")||"":f.className)+" ").replace(c," "):" ")){for(i=0;h=e[i++];)g.indexOf(" "+h+" ")<0&&(g+=h+" ");j=a.trim(g),f.className!==j&&(k?f.setAttribute("class",j):f.className=j)}return this},a.fn.removeClass=function(d){var e,f,g,h,i,j,k,l=0===arguments.length||"string"==typeof d&&d,m=0,n=this.length;if(a.isFunction(d))return this.each(function(b){a(this).removeClass(d.call(this,b,this.className))});if(l)for(e=(d||"").match(b)||[];n>m;m++)if(f=this[m],k="string"!=typeof f.className,g=1===f.nodeType&&(f.className?(" "+(k?f.getAttribute("class")||"":f.className)+" ").replace(c," "):"")){for(i=0;h=e[i++];)for(;g.indexOf(" "+h+" ")>=0;)g=g.replace(" "+h+" "," ");j=d?a.trim(g):"",f.className!==j&&(k?f.setAttribute("class",j):f.className=j)}return this})}(jQuery);
//# sourceMappingURL=vgraph.min.js.map