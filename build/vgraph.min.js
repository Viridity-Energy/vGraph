angular.module("vgraph",[]),angular.module("vgraph").factory("BoxModel",[function(){"use strict";function t(t,e){var a=e.padding,r=t.padding,n=e.margin,o=t.margin;o||(t.margin=o={top:0,right:0,bottom:0,left:0}),n&&(o.top=i(n.top,o.top),o.right=i(n.right,o.right),o.bottom=i(n.bottom,o.bottom),o.left=i(n.left,o.left)),r||(t.padding=r={top:0,right:0,bottom:0,left:0}),a&&(r.top=i(a.top,r.top),r.right=i(a.right,r.right),r.bottom=i(a.bottom,r.bottom),r.left=i(a.left,r.left)),t.outerWidth=i(e.outerWidth,t.outerWidth)||0,t.outerHeight=i(e.outerHeight,t.outerHeight)||0,t.top=o.top,t.bottom=t.outerHeight-o.bottom,t.left=o.left,t.right=t.outerWidth-o.right,t.center=(t.left+t.right)/2,t.middle=(t.top+t.bottom)/2,t.width=t.right-t.left,t.height=t.bottom-t.top,t.innerTop=t.top+r.top,t.innerBottom=t.bottom-r.bottom,t.innerLeft=t.left+r.left,t.innerRight=t.right-r.right,t.innerWidth=t.innerRight-t.innerLeft,t.innerHeight=t.innerBottom-t.innerTop,t.ratio=t.outerWidth+" x "+t.outerHeight}function e(e){this.registrations=[],t(this,e||{})}function i(t,e){return void 0!==t?parseInt(t):e}return e.prototype.register=function(t){this.ratio&&t(),this.registrations.push(t)},e.prototype.targetSvg=function(t){this.$element=t,this.resize()},e.prototype.resize=function(){var e,i,a=this.$element;for(a.attr("width",null).attr("height",null),a[0].style.cssText=null,t(this,{outerWidth:a.outerWidth(!0),outerHeight:a.outerHeight(!0),margin:{top:a.css("margin-top"),right:a.css("margin-right"),bottom:a.css("margin-bottom"),left:a.css("margin-left")},padding:{top:a.css("padding-top"),right:a.css("padding-right"),bottom:a.css("padding-bottom"),left:a.css("padding-left")}}),a.css("margin","0").css("padding","0").attr("width",this.outerWidth).attr("height",this.outerHeight).css({width:this.outerWidth+"px",height:this.outerHeight+"px"}),e=0,i=this.registrations.length;i>e;e++)this.registrations[e]()},e}]),angular.module("vgraph").factory("ComponentGenerator",[function(){"use strict";function t(t,e,i){var a,r,n,o=e.name;return t[o]=e,a=angular.isFunction(e.value)?o+".value":"'"+(e.value||o)+"'",r=angular.isFunction(e.interval)?o+".interval":"'"+(e.interval||"x")+"'",angular.isString(e.data)?(n=e.data,t[e.data]=t.$parent[e.data]):n=e.data?o+".data":"data",'<path class="'+i+" "+e.className+'" vgraph-feed="'+n+'" name="'+o+'" value="'+a+'" interval="'+r+'"'+(e.filter?' filter="'+e.filter+'"':"")+"></path>"}var e={require:["^vgraphChart"],link:function(t,e,i,a){function r(){t.data&&h&&(d.removePlot(l),c=0,n(t.data),s.model.dataReady(t))}function n(e){var i,a,r=e.length;if(r&&r!==c){for(;r>c;c++)i=t.data[c],a=h(i),void 0!==a&&(f?(m.length>p&&m.shift(),m.push(a),d.addPoint(l,u(i),f(a,m))):d.addPoint(l,u(i),a));d.dataReady(t)}}var o,s=a[0],l=i.name,c=0,d=s.model,h=t.value,u=t.interval,f=t.filter,m=[],p=parseInt(i.memory,10)||10;t.$watch("interval",function(t){u="string"==typeof t?function(e){return e[t]}:t}),t.$watch("value",function(t){"string"==typeof t?(o=i.alias||t,h=function(e){return void 0!==e[t]?e[o]:void 0}):h=t,r()}),t.$watch("data",r),t.$watch("data.length",function(e){e&&h&&n(t.data)})},scope:{data:"=_undefined_",value:"=value",interval:"=interval",filter:"=filter"}};return{generate:function(t,i){function a(){}var r;return a.prototype=e,r=new a,r.scope=angular.copy(r.scope),r.scope.data="="+t,angular.forEach(i,function(t,e){var i=r[e];i&&angular.isFunction(i)?r[e]=function(){i.apply(this,arguments),t.apply(this,arguments)}:r[e]=t}),r},makeLineCalc:function(t,e){return d3.svg.line().interpolate("linear").defined(function(t){var i=t[e];return!(isNaN(i)||null===i)}).x(function(e){return t.x.scale(e.$interval)}).y(function(i){return t.y.scale(i[e])})},makeFillCalc:function(t,e,i){return d3.svg.area().defined(function(t){var i=t[e];return!(isNaN(i)||null===i)}).x(function(e){return t.x.scale(e.$interval)}).y(function(i){return t.y.scale(i[e])}).y1(function(e){return t.y.scale(e[i]?e[i]:t.model.y.minimum)})},decodeConfig:function(e,i,a){var r,n,o=[];if(angular.isArray(i))for(r=0,n=i.length;n>r;r++)o.push(t(e,i[r],a));else o.push(t(e,i,a));return o},compileConfig:function(t,e,i){var a,r,n,o;for(angular.isArray(e)||(e=[e]),n=this.decodeConfig(t,e,i),o=(new DOMParser).parseFromString('<g xmlns="http://www.w3.org/2000/svg">'+n.join("")+"</g>","image/svg+xml").childNodes[0].childNodes,a=0,r=o.length;r>a;a++)n[a]={name:e[a].name,className:e[a].className,element:o[a],$d3:d3.select(o[a])};return n},parseLimits:function(t,e,i){var a,r,n,o,s,l;if(angular.isString(e))if(i)for(a=0,r=t.length;r>a;a++)n=t[a],o=n[e],void 0!==o&&(i(n,o),void 0===s?(s=o,l=o):s>o?s=o:o>l&&(l=o));else for(a=0,r=t.length;r>a;a++)n=t[a],o=n[e],void 0!==o&&(void 0===s?(s=o,l=o):s>o?s=o:o>l&&(l=o));else for(a=0,r=e.length;r>a;a++)o=this.parseLimits(t,e[a]),void 0===s?(s=o.min,l=o.max):(o.min<s&&(s=o.min),o.max>l&&(l=o.max));return{min:s,max:l}}}}]),angular.module("vgraph").factory("GraphModel",[function(){"use strict";function t(t,e){return t[r(t,e,1)-1]}function e(t,e){return{$x:e,$interval:t.makeInterval(e)}}function i(t){t||(t={}),t.x||(t.x={}),t.y||(t.y={}),this.queued=null,this.construct(),this.reset(t)}var a=0,r=d3.bisector(function(t){return t.$interval}).left;return i.prototype.construct=function(){var t=this;this.$modelId=a++,this.registrations=[],this.point={reset:function(t){t.$x=null,t.$y=null},isValid:function(e){var i;return void 0===t.x.start?!0:(i=e.$x,t.x.start.$x<=i&&i<=t.x.stop.$x)}}},i.prototype.reset=function(t){this.data=[],this.lookUp={},this.plots={},this.plotNames=[],this.filtered=null,this.needSort=!1,this.ratio=null,this.transitionDuration=30,this.setStatus("loading"),this.config(t||this)},i.prototype.setBounds=function(t,e){return t&&(void 0!==t.min&&(this.x.$min=t.min),void 0!==t.max&&(this.x.$max=t.max)),e&&(void 0!==e.min&&(this.y.$min=e.min),void 0!==e.max&&(this.y.$max=e.max)),this},i.prototype.setPane=function(t,e){return t&&(void 0!==t.start&&(this.x.start=t.start),void 0!==t.stop&&(this.x.stop=t.stop)),e&&(void 0!==e.start&&(this.y.start=e.start),void 0!==e.stop&&(this.y.stop=e.stop)),this},i.prototype.config=function(t){var e=this;this.x={$min:null,$max:null,massage:t.x.massage||null,padding:t.x.padding||0,scale:t.x.scale||function(){return d3.scale.linear()},disp:t.x.display||function(t){return t.$interval},simplify:t.x.simplify||function(t){return t.$x},parse:t.x.parse||function(t){return t.$interval},format:t.x.format||d3.format("03d"),tick:t.x.tick||{}},this.y={$min:null,$max:null,massage:t.y.massage||null,padding:t.y.padding||0,scale:t.y.scale||function(){return d3.scale.linear()},disp:t.y.display||function(t,i){return e.y.parse(t,i)},simplify:t.y.simplify||function(t){return e.y.parse(t)},parse:t.y.parse||function(t,e){return void 0===t||null===t?null:t[e]},format:t.y.format||d3.format(",.2f"),tick:t.y.tick||{}},this.setPane(t.x,t.y)},i.prototype.makeInterval=function(t){return t},i.prototype.addPoint=function(t,e,i){var a,r,n=this.data,o=parseFloat(i);return this.x.massage&&(e=this.x.massage(e)),this.y.massage&&(i=this.y.massage(e)),e||0===e?(r=this.lookUp[e],r?isFinite(o)&&((void 0===r.$min||o<r.$min)&&(r.$min=o),(void 0===r.$max||o>r.$max)&&(r.$max=o)):(r={$interval:this.makeInterval(e),$x:+e},isFinite(o)&&(r.$min=o,r.$max=o),this.lookUp[e]=r,n.length&&n[n.length-1].$x>e&&(this.needSort=!0),this.data.push(r)),this.x.min||(this.x.min=r,this.x.max=r),a=this.plots[t],a?a.x.max.$x<r.$x?(a.x.max=r,this.x.max.$x<r.$x&&(this.x.max=r)):a.x.min.$x>r.$x&&(a.x.min=r,r.$x<this.x.min.$x&&(this.x.min=r)):(this.plots[t]=a={x:{min:r,max:r}},this.x.max.$x<r.$x?this.x.max=r:r.$x<this.x.min.$x&&(this.x.min=r)),r[t]=i,r):void 0},i.prototype.setError=function(t){this.setStatus("error",t)},i.prototype.setStatus=function(t,e){"error"===t?(this.loaded=!1,this.loading=!1,this.error=e,this.message=null):"loaded"===t?(this.loaded=!0,this.loading=!1,this.error=null,this.message=e):"updating"===t?(this.loaded=!0,this.loading=!0,this.error=null,this.message=e):(this.loaded=!1,this.loading=!0,this.error=null,this.message=e),this.status=t},i.prototype.addPlot=function(t,e,i,a){var r,n,o;if(!this.plots[t])for(r=0,n=e.length;n>r;r++)o=e[r],this.addPoint(t,i(o),a(o))},i.prototype.removePlot=function(t){var e,i,a,r,n,o,s,l,c=this.plots[t];if(c){for(delete this.plots[t],s=Object.keys(this.plots),e=0,i=this.data.length;i>e;e++){if(l=this.data[e],l.$max===l[t]){for(n=void 0,a=0,r=s.length;r>a;a++)o=l[s[a]],"number"==typeof o&&(void 0===n||o>n)&&(n=o);l.$max=n}if(l.$min===l[t]){for(n=void 0,a=0,r=s.length;r>a;a++)o=l[s[a]],"number"==typeof o&&(void 0===n||n>o)&&(n=o);l.$min=n}l[t]=null}if(this.x.min=null,this.x.max=null,this.y.min=null,this.y.max=null,s.length&&this.plots[s[0]]&&this.plots[s[0]].x&&this.plots[s[0]].y)for(this.x.min=this.plots[s[0]].x.min,this.x.max=this.plots[s[0]].x.max,this.y.min=this.plots[s[0]].y.min,this.y.max=this.plots[s[0]].y.max,e=1,i=s.length;i>e;e++)o=s[e],l=this.plots[o],l.min&&l.min.$x<this.x.min.$x?this.x.min=l.min:l.max&&this.x.max.$x<l.max.$x&&(this.x.max=l.max),l.min&&l.min.$min<this.y.min.$min?this.y.min=l.min:l.max&&this.y.max.$max<l.max.$max&&(this.y.max=l.max)}},i.prototype.dataReady=function(t){var e=this;clearTimeout(this.queued),this.queued=setTimeout(function(){e.adjusting||e.adjust(t)},15)},i.prototype.findExtemesY=function(t){var e,i,a,r,n;for(i=0,a=t.length;a>i;i++)e=t[i],(e.$min||0===e.$min)&&(void 0===r?r=e:e.$min<r.$min&&(r=e)),(e.$max||0===e.$max)&&(void 0===n?n=e:e.$max>n.$max&&(n=e));return{min:r,max:n}},i.prototype.register=function(t){this.registrations.push(t)},i.prototype.adjust=function(i){var a,r,n,o,s,l,c=!1,d=this,h=this.data,u=this.x;h.length&&(this.nexAdjust=function(){this.adjusting=!0,this.error=!1,this.needSort&&this.data.sort(function(t,e){return t.$x-e.$x});try{if(null===u.$min&&(u.$min=u.min.$x),null===u.$max)u.$max=u.max.$x;else if("string"==typeof u.$max){if("+"!==u.$max.charAt(0))throw"Unable to handle shift as string";u.$max=parseInt(u.$max.substring(1),10)+u.$min}if("number"==typeof u.start)u.start=this.data[u.start];else{if(u.start)if("string"==typeof u.start)if(c=!0,"%"===u.start.charAt(0))l=u.$min+parseFloat(u.start.substring(1),10)*(u.$max-u.$min);else if("+"===u.start.charAt(0))l=u.$min+parseInt(u.start.substring(1),10);else{if("="!==u.start.charAt(0))throw"Start of pane not properly defined";l=parseInt(u.start.substring(1),10)}else l=u.start.$x;else c=!0,l=u.$min;u.start=l>u.min.$x&&l<u.max.$x?t(this.data,l):e(this,l)}if("number"==typeof u.stop)u.stop=this.data[u.stop];else{if(u.stop)if("string"==typeof u.stop)if(c=!0,"%"===u.stop.charAt(0))l=u.$min+parseFloat(u.stop.substring(1),10)*(u.$max-u.$min);else if("+"===u.stop.charAt(0))l=u.$min+parseInt(u.stop.substring(1),10);else{if("="!==u.stop.charAt(0))throw"End of pane not properly defined";l=parseInt(u.stop.substring(1),10)}else l=u.stop.$x;else c=!0,l=u.$max;u.stop=l>u.min.$x&&l<u.max.$x?t(this.data,l):e(this,l)}if(this.filtered=this.data.filter(function(t,e){var i=t.$x;return u.start.$x<=i&&i<=u.stop.$x?(o?s=e:o=e,t.$inPane=!0,!0):(t.$inPane=!1,!1)}),this.filtered.$first=o,this.filtered.$last=s,u.stop&&u.start&&(n=h.length+" : "+this.filtered.length,n!==this.ratio||i||c))for(this.ratio=n,a=0,r=this.registrations.length;r>a;a++)this.registrations[a](this)}catch(f){d.setError("Model Failed"),f.message?(console.debug(f.message),console.debug(f.stack)):console.debug(f)}this.adjusting=!1},this.adjustInterval||(this.adjustInterval=setTimeout(function(){d.adjustInterval=null,d.nexAdjust()},30)))},i}]),angular.module("vgraph").directive("vgraphAxis",[function(){"use strict";function t(t,e){return!(t.bottom<e.top||t.top>e.bottom||t.right<e.left||t.left>e.right)}return{require:["^vgraphChart"],link:function(e,i,a,r){var n,o,s,l,c,d,h,u,f,m,p,g=r[0],x=d3.svg.axis(),v="axis",y=g.box,$=g.model,b=0,k=null,w=!0,C=!1,N=parseInt(a.tickLength)||0,A=parseInt(a.tickPadding)||3,T=parseInt(a.tickMargin)||0,L=d3.select(i[0]);switch(d=L.append("g").attr("class","ticks"),m=L.append("g").attr("class","padding"),h=m.append("g").attr("class","tick-marks"),u=m.append("rect").attr("class","tick-margin"),p=L.append("g").attr("class","label-wrap"),a.tickRotation&&(k=parseInt(a.tickRotation,10)%360),a.labelOffset&&(b=e.$eval(a.labelOffset)),a.labelClean&&(w=e.$eval(a.labelClean)),a.labelEndpoints&&(C=e.$eval(a.labelEndpoints)),a.axisLabel&&(f=p.append("text").attr("class","axis-label label").text(e.$eval(a.axisLabel))),n=function(){a.tickMarks?(x.tickValues(e.$eval(a.tickMarks)),s=[]):a.tickCount?(x.ticks(e.$eval(a.tickCount)),s=[]):(x.ticks(10),s=[])},e.orient){case"top":o=function(){var t;L.attr("class",v+" x top").attr("transform","translate("+y.left+","+y.top+")").attr("width",y.width).attr("height",y.padding.top),f&&f.attr("text-anchor","middle").attr("x",y.width/2).attr("y",y.padding.top-b),T&&u.attr("height",T).attr("width",y.innerWidth).attr("x",0).attr("y",-T),h.attr("transform","translate(-"+y.margin.left+",0)"),s&&(x.orient("top").tickFormat($.x.format).innerTickSize(-y.innerHeight+N+T).outerTickSize(0).tickPadding(A+N+T).scale(g.x.scale),$.x.tick.interval&&x.ticks($.x.tick.interval,$.x.tick.step),d.attr("transform","translate(-"+y.margin.left+","+y.padding.top+")").call(x),t=L.selectAll("g.axis-cap").data(g.x.scale.domain()),C&&(t.enter().append("g").attr("class",function(t,e){return"axis-cap "+(e?"axis-max":"axis-min")}).append("text"),t.exit().remove(),t.attr("transform",function(t){return"translate("+(g.x.scale(t)-y.margin.left)+",0)"}).select("text").text(function(t){var e=$.x.format(t);return(""+e).match("NaN")?"":e}).attr("dy","-0.25em").attr("y",y.padding.top).attr("text-anchor","middle")),k&&(d.selectAll(".tick text").attr("transform","translate(0,"+d.select(".tick text").attr("y")+") rotate("+k+",0,0)").attr("y","0").style("text-anchor",k%360>0?"end":"start"),t.select("text").attr("transform","rotate("+k+",0,0)").style("text-anchor",e.rotation%360>0?"end":"start")))};break;case"bottom":o=function(){var t;L.attr("class",v+" x bottom").attr("transform","translate("+y.left+","+y.innerBottom+")").attr("width",y.width).attr("height",y.padding.bottom),f&&f.attr("text-anchor","middle").attr("x",y.width/2).attr("y",y.padding.bottom+b),T&&u.attr("height",T).attr("width",y.innerWidth).attr("x",0).attr("y",0),h.attr("transform","translate(-"+y.margin.left+",0)"),s&&(x.orient("bottom").tickFormat($.x.format).innerTickSize(y.innerHeight+N+T).outerTickSize(0).tickPadding(A+N+T).scale(g.x.scale),$.x.tick.interval&&x.ticks($.x.tick.interval,$.x.tick.step),d.attr("transform","translate(-"+y.margin.left+","+-y.innerHeight+")").call(x),t=L.selectAll("g.axis-cap").data(g.x.scale.domain()),C&&(t.enter().append("g").attr("class",function(t,e){return"axis-cap "+(e?"axis-max":"axis-min")}).append("text"),t.exit().remove(),t.attr("transform",function(t){return"translate("+(g.x.scale(t)-y.margin.left)+",0)"}).select("text").text(function(t){var e=$.x.format(t);return(""+e).match("NaN")?"":e}).attr("dy","1em").attr("y",0).attr("text-anchor","middle")),k&&(d.selectAll(".tick text").attr("transform",function(){return"translate(0,"+d3.select(this).attr("y")+") rotate("+k+",0,0)"}).attr("y","0").style("text-anchor",k%360>0?"start":"end"),t.select("text").attr("transform","rotate("+k+",0,0)").style("text-anchor",e.rotation%360>0?"start":"end")))};break;case"right":break;case"left":var W;o=function(){L.attr("class",v+" y left").attr("transform","translate("+y.left+","+y.top+")").attr("width",y.padding.left).attr("height",y.height),p.attr("transform","translate("+y.padding.left+","+y.height+") rotate( -90 )"),f&&f.attr("text-anchor","middle").attr("x",y.height/2).attr("y",-b),T&&u.attr("height",y.innerHeight).attr("width",T).attr("x",-T).attr("y",0),h.attr("transform","translate("+y.padding.left+","+-y.top+")"),s&&(x.orient("left").tickFormat($.y.format).innerTickSize(-(y.innerWidth+N+T)).outerTickSize(0).tickPadding(A+N+T).scale(g.y.scale),$.y.tick.interval&&x.ticks($.y.tick.interval,$.y.tick.step),d.attr("transform","translate("+(y.padding.left-N-T)+","+-y.top+")").call(x),d.select(".domain").attr("transform","translate("+(N+T)+",0)"),C&&(W=L.selectAll("g.axis-cap").data(g.y.scale.domain()),W.enter().append("g").attr("class",function(t,e){return"axis-cap "+(e?"axis-max":"axis-min")}).append("text"),W.exit().remove(),W.attr("transform",function(t){return"translate(0,"+(g.y.scale(t)-y.margin.top)+")"}).select("text").text(function(t){var e=$.y.format(t);return(""+e).match("NaN")?"":e}).attr("dy",".25em").attr("x",y.padding.left-x.tickPadding()).attr("text-anchor","end")))}}g.register({build:function(){void 0===s&&n(),o()},process:function(){s.length=0,N&&(d.selectAll(".tick text").each(function(t){s.push({el:this,val:t,position:this.getBoundingClientRect()})}),s.sort(function(t,e){var i=t.position.top-e.position.top;return i?i:t.position.left-e.position.left})),w&&(l=L.select(".axis-min text").node(),l&&(l=l.getBoundingClientRect()),c=L.select(".axis-max text").node(),c&&(c=c.getBoundingClientRect()))},finalize:function(){var e,i,a,r,n,o,d={};for(h.selectAll("line").remove(),r=0,n=s.length;n>r;r++)e=!0,i=s[r],a=i.position,w&&l&&(t(a,l)||t(a,c))?(i.el.setAttribute("class","collided"),e=!1):void 0===d.left?(d.left=a.left,d.right=a.right,d.width=a.width,d.top=a.top,d.bottom=a.bottom,d.height=a.height,i.el.setAttribute("class","")):w&&t(a,d)?(i.el.setAttribute("class","collided"),e=!1):(o=!1,a.left<d.left&&(d.left=a.left,o=!0),a.right>d.right&&(d.right=a.right,o=!0),o&&(d.width=d.right-d.left,o=!1),a.top<d.top&&(d.top=a.top,o=!0),a.bottom>d.bottom&&(d.bottom=a.bottom,o=!0),o&&(d.height=d.bottom-d.top),i.el.setAttribute("class",""))}},"axis-"+e.orient)},scope:{orient:"=vgraphAxis",adjust:"=axisAdjust",rotation:"=tickRotation"}}}]),angular.module("vgraph").directive("vgraphBar",["$compile","ComponentGenerator",function(t,e){"use strict";return{require:["^vgraphChart"],scope:{config:"=config"},link:function(i,a,r,n){function o(t,e,i){var a,r,n,o,s,d,h,m,p,g,x,v,y,$,b;for(s=e;i>s;s++)p=t[s],p&&(p.$els=[]);for(n=0,o=l.length;o>n;n++){for(h=l[n],b=l[n].$value,d=0,m=0,s=e,r=[];i>s;)p=t[s],p&&(d+=p[b],m++,g=p),s++;for(v=c.y.scale(d/m),y?a=f.append("rect").attr("height",x-v):(y=c.x.scale(t[e].$interval)+u,$=c.x.scale(g.$interval)-u-y,a=f.append("rect").attr("height",c.y.scale(c.model.y.minimum)-v)),a.attr("class","bar "+h.className).attr("x",y).attr("y",v).attr("width",$),a=a[0][0],s=e;i>s;s++)p=t[s],p&&(p.$els.push(a),p.$bar={center:(y+$)/2,top:d/m});x=v}}function s(a){var r,n,o;if(a)for(d3.select(d).selectAll("path").remove(),l=e.compileConfig(i,a,"line"),r=0,n=l.length;n>r;r++)o=l[r],o.$value="$"+o.name,r?(d.insertBefore(o.element,l[r-1].element),o.$bottom=l[r-1].$value,o.calc=e.makeLineCalc(c,o.$value,o.$bottom)):(d.appendChild(o.element),o.calc=e.makeLineCalc(c,o.$value)),t(o.element)(i)}var l,c=n[0],d=a[0],h=parseInt(r.minWidth),u=parseInt(r.padding),f=d3.select(d).append("g").attr("class","mount");i.$watchCollection("config",s),c.register({parse:function(t){var e,i,a,r,n,o,s,c,d,h;if(l&&l.length)for(e=0,i=t.length;i>e;e++){for(o=0,c=void 0,s=t[e],a=0,r=l.length;r>a&&void 0===c;a++)n=l[a].name,c=s[n],void 0!==c&&(void 0===d?(d=c,h=c):d>c&&(d=c));for(s["$"+n]=c,o=c;r>a;a++)n=l[a].name,c=s[n]||0,o+=c,s["$"+n]=o;s.$total=o,o>h&&(h=o)}return{min:d,max:h}},build:function(t){var e,i,a=0,r=c.x.scale(c.model.x.min.$interval),n=c.x.scale(c.model.x.max.$interval),s=n-r,l=u+h,d=s/l,m=t.length/d;for(f.selectAll("rect").remove(),e=0,i=t.length;i>e;e=Math.floor(a))a+=m,o(t,e,a)},finalize:function(t){var e,i,a;for(e=0,i=l.length;i>e;e++)a=l[e],a.$d3.attr("d",a.calc(t))}})}}}]),angular.module("vgraph").directive("vgraphChart",[function(){"use strict";function t(t,e){e&&(t.$mat=d3.select(e).insert("rect",":first-child"),t.$frame=d3.select(e).insert("rect",":first-child")),t.$mat&&(t.$mat.attr("class","mat").attr("width",t.innerWidth).attr("height",t.innerHeight).attr("transform","translate("+t.innerLeft+","+t.innerTop+")"),t.$frame.attr("class","frame").attr("width",t.width).attr("height",t.height).attr("transform","translate("+t.left+","+t.top+")"))}return{controller:function(e){var i=[],a=[],r=e.model,n=e.box,o=this;return this.register=function(t,e){i.push(t),a.push(e)},this.model=r,this.box=n,this.x={scale:r.x.scale(),calc:function(t){return o.x.scale(r.x.parse(t))},center:function(){return(o.x.calc(r.x.min)+o.x.calc(r.x.max))/2}},this.y={scale:r.y.scale(),calc:function(t){return o.y.scale(r.y.parse(t))},center:function(){return(o.y.calc(r.y.min)+o.y.calc(r.y.max))/2}},n.register(function(){t(n),r.adjust(!0)}),r.register(function(){var t,e,a,s,l,c,d;for(d=parseInt(r.filtered.length/n.innerWidth)||1,s=r.filtered.filter(function(t,e){return r.x.start===t||r.x.stop===t||e%d===0}),l=0,c=i.length;c>l;l++)i[l].parse&&(t=i[l].parse(s,r.filtered),t&&((!e&&0!==e||e>t.min)&&(e=t.min),(!a&&0!==a||a<t.max)&&(a=t.max)));for(r.adjustSettings&&r.adjustSettings(r.x.stop.$interval-r.x.start.$interval,a-e,r.filtered.$last-r.filtered.$first),r.y.top=a,r.y.bottom=e,r.y.padding&&(t=(a-e)*r.y.padding,a+=t,e-=t),r.y.minimum=e,r.y.maximum=a,o.x.scale.domain([r.x.start.$interval,r.x.stop.$interval]).range([n.innerLeft,n.innerRight]),o.y.scale.domain([e,a]).range([n.innerBottom,n.innerTop]),l=0,c=i.length;c>l;l++)i[l].build&&i[l].build(s,r.filtered,r.data);for(l=0,c=i.length;c>l;l++)i[l].process&&i[l].process(s,r.filtered,r.data);for(l=0,c=i.length;c>l;l++)i[l].finalize&&i[l].finalize(s,r.filtered,r.data)}),o},link:function(e,i){e.box.targetSvg(i),t(e.box,i[0]),e.$watch("model.loading",function(t){t?i.addClass("loading"):i.removeClass("loading")}),e.$watch("model.error",function(t){t?i.addClass("hasError"):i.removeClass("hasError")})},restrict:"A",scope:{box:"=vgraphChart",model:"=model"}}}]),angular.module("vgraph").directive("vgraphCompare",["$compile","ComponentGenerator",function(t,e){"use strict";return{require:["^vgraphChart"],scope:{config:"=config"},link:function(i,a,r,n){function o(a){var r;a&&a.length>1&&(d3.select(h).selectAll("path").remove(),r=e.compileConfig(i,a,"line"),s=r[0],s.calc=e.makeLineCalc(d,a[0].name),l=r[1],l.calc=e.makeLineCalc(d,a[1].name),c={$d3:d3.select(h).append("path").attr("class","fill "+a[0].className+"-"+a[1].className),calc:e.makeFillCalc(d,a[0].name,a[1].name)},h.appendChild(s.element),h.appendChild(l.element),t(s.element)(i),t(l.element)(i))}var s,l,c,d=n[0],h=a[0];i.$watchCollection("config",o),d.register({parse:function(t){var e,i,a,r,n,o,c;for(e=0,i=t.length;i>e;e++)a=t[e],r=a[s.name],n=a[l.name],a.$compare={middle:(r+n)/2,difference:Math.abs(r-n)},n>r?void 0===o?(o=r,c=n):(o>r&&(o=r),n>c&&(c=n)):void 0===o?(o=n,c=r):(o>n&&(o=n),r>c&&(c=r));return{min:o,max:c}},finalize:function(t){s.$d3.attr("d",s.calc(t)),l.$d3.attr("d",l.calc(t)),c.$d3.attr("d",c.calc(t))}})}}}]),angular.module("vgraph").directive("vgraphError",[function(){"use strict";return{require:["^vgraphChart"],link:function(t,e,i,a){var r=a[0],n=r.box,o=d3.select(e[0]).attr("class","error-view"),s=o.append("rect").attr("class","outline"),l=o.append("text");t.model=r.model,t.box=n,n.register(function(){s.attr("transform","translate("+n.innerLeft+","+n.innerTop+")").attr("width",n.innerWidth).attr("height",n.innerHeight);try{l.attr("text-anchor","middle").attr("x",n.center).attr("y",n.middle+l.node().getBBox().height/2)}catch(t){l.attr("text-anchor","middle").attr("x",n.center).attr("y",n.middle)}}),t.$watch("model.error",function(t){t?(o.attr("visibility","visible"),l.text(t)):o.attr("visibility","hidden")})}}}]),angular.module("vgraph").directive("vgraphFeed",["ComponentGenerator",function(t){"use strict";return t.generate("vgraphFeed",{restrict:"A"})}]),angular.module("vgraph").directive("vgraphFill",["ComponentGenerator",function(t){"use strict";return t.generate("vgraphFill",{link:function(e,i,a,r){var n=r[0],o=a.name,s=d3.select(i[0]).append("path").attr("class","fill plot-"+o),l=d3.svg.area().defined(function(t){var e=t[o];return!(isNaN(e)||null===e)}).x(function(t){return n.x.scale(t.$interval)}).y(function(t){return n.y.scale(t[o])}).y1(function(){return n.y.scale(void 0===e.fillTo?n.model.y.bottom:"object"==typeof e.fillTo?e.fillTo.$min:e.fillTo)});n.register({parse:function(e){return t.parseLimits(e,o)},finalize:function(t){s.attr("d",l(t))}})},scope:{data:"=vgraphFill",fillTo:"=fillTo",value:"=value",interval:"=interval",filter:"=filter"}})}]),angular.module("vgraph").directive("vgraphFocus",[function(){"use strict";return{require:["^vgraphChart"],link:function(t,e,i,a){var r=a[0],n=r.box,o=d3.select(e[0]),s=o.append("rect").attr("class","focus").attr("visibility","hidden");n.register(function(){s.attr("height",n.innerHeight).attr("y",n.innerTop)}),t.$watch("follow",function(t){var e,i,a;t&&void 0!==t.xDiff&&(e=Math.abs(t.xDiff),i=t.x0-e,a=t.x0+e,s.attr("visibility","visible"),i>n.innerLeft?s.attr("x",i):(i=n.innerLeft,s.attr("x",n.innerLeft)),a>n.innerRight?s.attr("width",n.innerRight-i):s.attr("width",a-i))}),t.$watch("stop",function(e){var i,a,o,l,c,d=r.model;e&&d.filtered&&(a=d.filtered.$first,i=d.filtered.$last-a,s.attr("visibility","hidden"),o=Math.abs(e.xDiff),o>5&&(l=e.x0-o,c=e.x0+o,l<n.innerLeft?l=0:l-=n.innerLeft,c>n.innerRight?c=n.innerWidth:c-=n.innerLeft,d.setPane({start:"="+(d.x.start.$x+l/n.innerWidth*(d.x.stop.$x-d.x.start.$x)),stop:"="+(d.x.start.$x+c/n.innerWidth*(d.x.stop.$x-d.x.start.$x))},{start:null,stop:null}),d.adjust(t)))})},scope:{follow:"=vgraphFocus",stop:"=loseFocus"}}}]),angular.module("vgraph").directive("vgraphIcon",["ComponentGenerator",function(t){"use strict";return t.generate("vgraphIcon",{link:function(e,i,a,r){var n,o,s,l=r[0],c=i[0],d=a.name,h=[],u=d3.select(c),f=parseInt(u.attr("width"),10),m=parseInt(u.attr("height"),10);for(c.removeAttribute("width"),c.removeAttribute("height"),n=0,o=c.childNodes.length;o>n;n++)1===c.childNodes[n].nodeType&&h.push(c.childNodes[n]);i.html(""),l.register({parse:function(e,i){return s={},t.parseLimits(i,d,function(t,e){s[t.$interval]=e})},build:function(){function t(){return this.appendChild(h[n].cloneNode())}var e,r,n,o;i.html(""),angular.forEach(s,function(i,s){var c;for(e=l.x.scale(s),r=l.y.scale(i),c=u.append("g"),n=0,o=h.length;o>n;n++)c.select(t);a.showUnder?c.attr("transform","translate("+(e-f/2)+","+r+")"):c.attr("transform","translate("+(e-f/2)+","+(r-m)+")")})}})}})}]),angular.module("vgraph").directive("vgraphIndicator",[function(){"use strict";return{require:["^vgraphChart"],scope:{model:"=model"},link:function(t,e,i,a){var r,n=a[0],o=i.vgraphIndicator,s=n.model,l=t.$eval(i.pointRadius)||3,c=t.$eval(i.outerRadius),d=d3.select(e[0]).attr("transform","translate(1000,1000)"),h=d.append("circle").attr("class","point inner").attr("r",l).attr("visibility","hidden"),u=d.append("circle").attr("class","point outer").attr("r",l).attr("visibility","hidden");c&&(r=function(){u.transition().duration(1e3).attr("r",c).transition().duration(1e3).attr("r",l).ease("sine").each("end",function(){setTimeout(function(){r()},3e3)})})(),n.register({finalize:function(){var t,e,i;s.plots[o]?(t=s.plots[o].x.max,s.point.isValid(t)&&t[o]?(e=n.x.scale(t.$interval),i=n.y.scale(t["$"+o]||t[o]),h.attr("visibility","visible"),u&&u.attr("visibility","visible"),d.transition().duration(s.transitionDuration).ease("linear").attr("transform","translate("+e+","+i+")")):(h.attr("visibility","hidden"),u&&u.attr("visibility","hidden"))):(h.attr("visibility","hidden"),u&&u.attr("visibility","hidden"))}})}}}]),angular.module("vgraph").directive("vgraphInteract",[function(){"use strict";function t(t,e,i,a){var r,n,o=0,s=t.length-1;if(a||t.sort(function(t,e){return i(t)-i(e)}),i(t[o])>=e)return{left:o,right:o};if(i(t[s])<=e)return{left:s,right:s};if(t.length){for(;s-o>1;)r=Math.floor((s+o)/2),n=i(t[r]),n===e?(s=r,o=r):n>e?s=r:o=r;return s!==r&&i(t[s])===e?{left:s,right:s}:o!==r&&i(t[o])===e?{left:o,right:o}:{left:o,right:s}}}function e(e,i){var a=t(e,i,function(t){return t.$interval},!0),r=i-e[a.left].$interval,n=e[a.right].$interval-i;return n>r?a.left:a.right}return{require:["^vgraphChart"],scope:{highlight:"=vgraphInteract",dragStart:"=?dBegin",dragPos:"=?dChange",dragStop:"=?dEnd"},link:function(t,i,a,r){function n(e,i){clearTimeout(c),t.$apply(function(){var a=d3.mouse(e);t.highlight.point&&$(t.highlight.point.$els).removeClass("active"),t.highlight.point=i,t.highlight.position={x:a[0],y:a[1]},i&&$(i.$els).addClass("active")})}function o(){c=setTimeout(function(){t.$apply(function(){t.highlight.point&&$(t.highlight.point.$els).removeClass("active"),t.highlight.point=null})},100)}var s,l,c,d=r[0],h=!1,u=d.model,f=d.box,m=d3.select(i[0]),p=m.append("rect").style("opacity","0").attr("class","focal").on("mousemove",function(){var t,i;h||(t=d.x.scale.invert(d3.mouse(this)[0]),i=e(s,t),n(this,s[i]))}).on("mouseout",function(t){h||o(this,t)});m.attr("class","interactive"),m.call(d3.behavior.drag().on("dragstart",function(){l=d3.mouse(i[0]),h=!0,o(),t.dragStart={x:l[0],y:l[1]},t.$apply()}).on("dragend",function(){var e=d3.mouse(i[0]);h=!1,t.dragStop={x0:l[0],y0:l[1],x1:e[0],x2:e[1],xDiff:e[0]-l[0],yDiff:e[1]-l[1]},t.$apply()}).on("drag",function(){var e=d3.mouse(i[0]);t.dragPos={x0:l[0],y0:l[1],x1:e[0],x2:e[1],xDiff:e[0]-l[0],yDiff:e[1]-l[1]},t.$apply()})),m.on("dblclick",function(){u.setPane({start:null,stop:null},{start:null,stop:null}),u.adjust()}),d.register({build:function(){},finalize:function(t){s=t,p.attr({x:f.innerLeft,y:f.innerTop,width:f.innerWidth,height:f.innerHeight})}}),t.highlight||(t.highlight={}),t.dragStart||(t.dragStart={}),t.dragPos||(t.dragPos={}),t.dragStop||(t.dragStop={})}}}]),angular.module("vgraph").directive("vgraphLeading",[function(){"use strict";return{require:["^vgraphChart"],scope:{config:"=config"},link:function(t,e,i,a){function r(t){var e,i,a;if(n={},s.selectAll("line").remove(),t)for(i=0,a=t.length;a>i;i++)e=t[i],n[e.name]=s.append("line").attr("class",e.className)}var n,o=a[0],s=d3.select(e[0]);t.$watchCollection("config",r),o.register({finalize:function(){var t,e,i=o.model,a=[];angular.forEach(n,function(e,r){i.plots[r]&&(t=i.plots[r].x.max,i.point.isValid(t)&&t[r]&&a.push({el:e,x:o.x.scale(t.$interval),y:o.y.scale(t["$"+r]||t[r])}))}),a.sort(function(t,e){return t.y-e.y}),angular.forEach(a,function(t){e&&e.el.attr("x1",e.x).attr("x2",t.x).attr("y1",e.y).attr("y2",t.y),e=t}),e?(s.style("visibility","visible"),e.el.attr("x1",e.x).attr("x2",e.x).attr("y1",e.y).attr("y2",o.box.innerBottom)):s.style("visibility","hidden")}})}}}]),angular.module("vgraph").directive("vgraphLine",["ComponentGenerator",function(t){"use strict";return t.generate("vgraphLine",{link:function(e,i,a,r){var n=r[0],o=a.name,s=d3.select(i[0]).append("path").attr("class","line plot-"+o),l=t.makeLineCalc(n,o);n.register({parse:function(e){return t.parseLimits(e,o)},finalize:function(t){var e;s.attr("d",l(t.filter(function(i,a){var r,n=e;return e=i[o],n!==e?!0:(r=t[a+1],!r||r[o]!==e)})))}})}})}]),angular.module("vgraph").directive("vgraphLoading",["$interval",function(t){"use strict";return{require:["^vgraphChart"],link:function(e,i,a,r){function n(){t.cancel(s),o(),s=t(o,4005)}function o(){u=!0,x.attr("x",function(){return l}).attr("width",function(){return 0}).transition().duration(1e3).attr("x",function(){return l}).attr("width",function(){return c}).ease("sine").transition().duration(1e3).attr("width",0).attr("x",function(){return d}).ease("sine").transition().duration(1e3).attr("width",function(){return c}).attr("x",function(){return l}).ease("sine").transition().duration(1e3).attr("x",function(){return l}).attr("width",0).ease("sine")}var s,l,c,d,h=r[0],u=!1,f=h.box,m=a.vgraphLoading,p=d3.select(i[0]).attr("class","loading-view"),g=p.append("rect").attr("height",20).attr("class","outline"),x=p.append("rect").attr("width",0).attr("height",20).attr("class","filling"),v=p.append("text").text(m);e.model=h.model,f.register(function(){l=f.innerLeft+f.innerWidth/5,c=3*f.innerWidth/5,d=l+c,x.attr("x",l).attr("y",f.middle-10),g.attr("x",l).attr("y",f.middle-10).attr("width",c);try{v.attr("text-anchor","middle").attr("x",f.center).attr("y",f.middle+v.node().getBBox().height/2-2);
}catch(t){v.attr("text-anchor","middle").attr("x",f.center).attr("y",f.middle)}u||n()}),e.$on("destroy",function(){t.cancel(s)}),e.$watch("model.loading",function(i){t.cancel(s),i&&e.box.ratio&&n()})}}}]),angular.module("vgraph").directive("vgraphMultiIndicator",["$compile",function(t){"use strict";return{scope:{config:"=config"},link:function(e,i,a){function r(i){var r,o,s,l,c,d,h,u=e.$eval(a.pointRadius)||3,f=e.$eval(a.outerRadius),m="";if(i){for(o=0,s=i.length;s>o;o++)h=i[o],d=h.name,l=h.className?h.className:"plot-"+d,m+='<g class="'+l+'" vgraph-indicator="'+d+'"'+(f?' outer-radius="'+f+'"':"")+' point-radius="'+u+'"></g>';for(d3.select(n).selectAll("g").remove(),c=(new DOMParser).parseFromString('<g xmlns="http://www.w3.org/2000/svg">'+m+"</g>","image/svg+xml").childNodes[0].childNodes;c.length;)r=c[0],n.appendChild(r),t(r)(e)}}var n=i[0];e.$watchCollection("config",r)}}}]),angular.module("vgraph").directive("vgraphMultiLine",["$compile","ComponentGenerator",function(t,e){"use strict";return{require:["^vgraphChart"],scope:{data:"=vgraphMultiLine",config:"=config"},link:function(i,a,r,n){function o(a){var r,n,o;if(l=[],a)for(d3.select(d).selectAll("path").remove(),s=e.compileConfig(i,a,"line"),r=0,n=s.length;n>r;r++)o=s[r],d.appendChild(o.element),o.calc=e.makeLineCalc(c,o.name),l.push(o.name),t(o.element)(i)}var s,l,c=n[0],d=a[0];i.$watchCollection("config",o),c.register({parse:function(t){return e.parseLimits(t,l)},finalize:function(t){var e,i,a;for(e=0,i=s.length;i>e;e++)a=s[e],a.$d3.attr("d",a.calc(t))}})}}}]),angular.module("vgraph").directive("vgraphMultiTooltip",["$compile",function(t){"use strict";return{scope:{config:"=config",formatter:"=textFormatter",data:"=vgraphMultiTooltip"},link:function(e,i,a){function r(i){var r,o,s,l,c,d,h,u="";if(i){for(o=0,s=i.length;s>o;o++)h=i[o],d=h.name,l=h.className?h.className:"plot-"+d,u+='<g class="'+l+'" vgraph-tooltip="data" name="'+d+'" text-formatter="formatter"'+(a.offseX?' offset-x="'+a.offsetX+'"':"")+(a.offseY?' offset-y="'+a.offsetY+'"':"")+"></g>";for(d3.select(n).selectAll("g").remove(),c=(new DOMParser).parseFromString('<g xmlns="http://www.w3.org/2000/svg">'+u+"</g>","image/svg+xml").childNodes[0].childNodes;c.length;)r=c[0],n.appendChild(r),t(r)(e)}}var n=i[0];e.$watchCollection("config",r)}}}]),angular.module("vgraph").directive("vgraphStack",["$compile","ComponentGenerator",function(t,e){"use strict";return{require:["^vgraphChart"],scope:{config:"=config"},link:function(i,a,r,n){function o(a){var r,n,o;if(a)for(d3.select(c).selectAll("path").remove(),s=e.compileConfig(i,a,"fill"),r=0,n=s.length;n>r;r++)o=s[r],r?(c.insertBefore(o.element,s[r-1].element),o.calc=e.makeFillCalc(l,"$"+o.name,"$"+s[r-1].name)):(c.appendChild(o.element),o.calc=e.makeFillCalc(l,"$"+o.name)),t(o.element)(i)}var s,l=n[0],c=a[0];i.$watchCollection("config",o),l.register({parse:function(t){var e,i,a,r,n,o,l,c,d,h;if(s&&s.length)for(e=0,i=t.length;i>e;e++){for(o=0,c=0,l=t[e],a=0,r=s.length;r>a&&0===c;a++)n=s[a].name,c=l[n],(c||0===c)&&(void 0===d?(d=c,h=c):d>c&&(d=c));for(l["$"+n]=c,o=c;r>a;a++)n=s[a].name,c=l[n]||0,o+=c,l["$"+n]=o;l.$total=o,o>h&&(h=o)}return{min:d,max:h}},finalize:function(t){var e,i,a;for(e=0,i=s.length;i>e;e++)a=s[e],a.$d3.attr("d",a.calc(t))}})}}}]),angular.module("vgraph").directive("vgraphTarget",[function(){"use strict";return{require:["^vgraphChart"],scope:{target:"=vgraphTarget",pointRadius:"=pointRadius",config:"=?config"},link:function(t,e,i,a){function r(t){var e,i;if(n={},t)for(e=0,i=t.length;i>e;e++)n[t[e].name]=t[e].className}var n,o=a[0],s=o.model,l=o.box,c=d3.select(e[0]).attr("class","target"),d=c.append("line").attr("class","focus").attr("x1",0).attr("x2",0),h=c.append("g");l.register(function(){d.attr("y1",l.innerTop).attr("y2",l.innerBottom)}),t.$watch("target.point",function(e){var a,r;if(e&&void 0===i.noDots){h.selectAll("circle.point").remove(),c.style("visibility","visible").attr("transform","translate( "+o.x.scale(e.$interval)+" , 0 )");for(a in s.plots)e[a]&&(r=n[a]||"plot-"+a,h.append("circle").attr("class","point "+r).attr("x",0).attr("cy",o.y.scale(e[a])).attr("r",t.$eval(i.pointRadius)||3))}else c.style("visibility","hidden")}),t.$watchCollection("config",r)}}}]),angular.module("vgraph").directive("vgraphTooltip",[function(){"use strict";return{require:["^vgraphChart"],scope:{formatter:"=textFormatter",data:"=vgraphTooltip",value:"=?value"},link:function(t,e,i,a){var r=a[0],n=i.name,o=r.model,s=t.formatter||function(t){return o.y.format(o.y.parse(t))},l=parseInt(i.offsetX)||0,c=parseInt(i.offsetY)||0,d=d3.select(e[0]).attr("class","tooltip"),h=d.append("polygon").attr("class","outline").attr("transform","translate(0,-15)"),u=d.append("text").style("line-height","20").style("font-size","16").attr("class","label");t.$watch("data.point",function(e){var i,a,f,m;e&&(i=t.value?t.value(e):e[n],void 0!==i&&(a=r.y.scale(i),f=r.x.scale(e.$interval)+l,u.text(s(i,e)),m=u.node().getComputedTextLength()+5,d.style("visibility","visible"),f+m+16<r.x.scale(o.x.stop.$interval)?(d.attr("transform","translate("+f+","+(a+c)+")"),u.attr("transform","translate(10,5)"),h.attr("points","0,15 10,0 "+(m+10)+",0 "+(m+10)+",30 10,30 0,15")):(d.attr("transform","translate("+(f-2*l-m-10)+","+(a+c)+")"),u.attr("transform","translate(5,5)"),h.attr("points","0,0 "+m+",0 "+(m+10)+",15 "+m+",30 0,30 0,0")))),void 0===i&&d.style("visibility","hidden")})}}}]),angular.module("vgraph").directive("vgraphZone",["ComponentGenerator",function(t){"use strict";return t.generate("vgraphZone",{link:function(t,e,i,a){var r=a[0],n=i.name,o=d3.select(e[0]).append("path").attr("class","line plot-"+n),s=d3.svg.area().defined(function(t){return t[n]===!0}).x(function(t){return r.x.scale(t.$interval)}).y(function(){return r.box.innerTop}).y1(function(){return r.box.innerBottom});r.register({finalize:function(t){o.attr("d",s(t))}})}})}]),angular.module("vgraph").directive("vgraphZoom",[function(){"use strict";return{require:["^vgraphChart"],link:function(t,e,i,a){function r(e){0===o&&s===h.innerWidth?(f=!1,v.attr("class","focus")):(f=!0,v.attr("class","focus zoomed")),0>o&&(o=0),s>h.innerWidth&&(s=h.innerWidth),o>s?o=s:o>s&&(s=o),p.attr("transform","translate("+o+",0)"),g.attr("transform","translate(-"+o+",0 )").attr("width",o),y.attr("transform","translate("+s+",0)"),$.attr("width",h.innerWidth-s),v.attr("transform","translate("+o+",0)").attr("width",s-o),e||t.$apply(function(){var e=t.model;e.setPane({start:"%"+o/h.innerWidth,stop:"%"+s/h.innerWidth},{start:null,stop:null}),e.adjust(t)})}var n,o,s,l,c,d=a[0],h=d.box,u=!1,f=!1,m=d3.select(e[0]),p=m.append("g").attr("class","left-control min-control"),g=p.append("rect").attr("class","shade"),x=p.append("g").attr("class","control"),v=m.append("rect").attr("class","focus"),y=m.append("g").attr("class","right-control max-control"),$=y.append("rect").attr("class","shade"),b=y.append("g").attr("class","control");x.append("path").attr("d","M-0.5,23.33A6,6 0 0 0 -6.5,29.33V40.66A6,6 0 0 0 -0.5,46.66ZM-2.5,31.33V38.66M-4.5,31.33V38.66").attr("transform","translate(0,-9)").attr("class","nub"),l=x.append("rect").attr("width","10").attr("transform","translate(-10,0)"),b.append("path").attr("d","M0.5,23.33A6,6 0 0 1 6.5,29.33V40.66A6,6 0 0 1 0.5,46.66ZM2.5,31.33V38.66M4.5,31.33V38.66").attr("transform","translate(0,-9)").attr("class","nub"),c=b.append("rect").attr("width","10"),t.box=h,l.call(d3.behavior.drag().on("dragstart",function(){u=!0}).on("dragend",function(){u=!1}).on("drag",function(){o=d3.mouse(e[0])[0],r()})),c.call(d3.behavior.drag().on("dragstart",function(){u=!0}).on("dragend",function(){u=!1}).on("drag",function(){s=d3.mouse(e[0])[0],r()})),v.call(d3.behavior.drag().on("dragstart",function(){n={mouse:d3.mouse(e[0])[0],minPos:o,maxPos:s,min:t.model.x.start.$x,max:t.model.x.stop.$x},u=!0}).on("dragend",function(){u=!1,f=!0}).on("drag",function(){var t=d3.mouse(e[0]),i=t[0]-n.mouse;f?(s=n.maxPos+i,o=n.minPos+i,r()):i>5&&(s=n.mouse+Math.abs(i),o=n.mouse-Math.abs(i),r(),f=!1)})),m.on("dblclick",function(){s=h.innerWidth,o=0,r()}),h.register(function(){m.attr("width",h.innerWidth).attr("height",h.innerHeight).attr("transform","translate("+h.innerLeft+","+h.innerTop+")"),g.attr("height",h.innerHeight),$.attr("height",h.innerHeight),l.attr("height",h.innerHeight),c.attr("height",h.innerHeight),v.attr("height",h.innerHeight)}),t.model.register(function(){var e,i,a,n=t.model;u||(e=n.x,i=void 0===t.min?e.$min:t.min,a=void 0===t.max?e.$max:t.max,o=(e.start.$x-i)/(a-i)*h.innerWidth,s=(e.stop.$x-i)/(a-i)*h.innerWidth,r(!0))})},scope:{model:"=vgraphZoom",min:"=zoomMin",max:"=zoomMax"}}}]),function(t){"use strict";var e=/\S+/g,i=/[\t\r\n\f]/g;t&&(t.fn.addClass=function(a){var r,n,o,s,l,c,d,h="string"==typeof a&&a,u=0,f=this.length;if(t.isFunction(a))return this.each(function(e){t(this).addClass(a.call(this,e,this.className))});if(h)for(r=(a||"").match(e)||[];f>u;u++)if(n=this[u],d="string"!=typeof n.className,o=1===n.nodeType&&(n.className?(" "+(d?n.getAttribute("class")||"":n.className)+" ").replace(i," "):" ")){for(l=0;s=r[l++];)o.indexOf(" "+s+" ")<0&&(o+=s+" ");c=t.trim(o),n.className!==c&&(d?n.setAttribute("class",c):n.className=c)}return this},t.fn.removeClass=function(a){var r,n,o,s,l,c,d,h=0===arguments.length||"string"==typeof a&&a,u=0,f=this.length;if(t.isFunction(a))return this.each(function(e){t(this).removeClass(a.call(this,e,this.className))});if(h)for(r=(a||"").match(e)||[];f>u;u++)if(n=this[u],d="string"!=typeof n.className,o=1===n.nodeType&&(n.className?(" "+(d?n.getAttribute("class")||"":n.className)+" ").replace(i," "):"")){for(l=0;s=r[l++];)for(;o.indexOf(" "+s+" ")>=0;)o=o.replace(" "+s+" "," ");c=a?t.trim(o):"",n.className!==c&&(d?n.setAttribute("class",c):n.className=c)}return this})}(jQuery);
//# sourceMappingURL=vgraph.min.js.map