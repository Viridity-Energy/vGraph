angular.module("vgraph",[]),angular.module("vgraph").factory("BoxModel",[function(){"use strict";function t(t,e){var r=e.padding,i=t.padding,a=e.margin,o=t.margin;o||(t.margin=o={top:0,right:0,bottom:0,left:0}),a&&(o.top=n(a.top,o.top),o.right=n(a.right,o.right),o.bottom=n(a.bottom,o.bottom),o.left=n(a.left,o.left)),i||(t.padding=i={top:0,right:0,bottom:0,left:0}),r&&(i.top=n(r.top,i.top),i.right=n(r.right,i.right),i.bottom=n(r.bottom,i.bottom),i.left=n(r.left,i.left)),t.outerWidth=n(e.outerWidth,t.outerWidth)||0,t.outerHeight=n(e.outerHeight,t.outerHeight)||0,t.top=o.top,t.bottom=t.outerHeight-o.bottom,t.left=o.left,t.right=t.outerWidth-o.right,t.center=(t.left+t.right)/2,t.middle=(t.top+t.bottom)/2,t.width=t.right-t.left,t.height=t.bottom-t.top,t.innerTop=t.top+i.top,t.innerBottom=t.bottom-i.bottom,t.innerLeft=t.left+i.left,t.innerRight=t.right-i.right,t.innerWidth=t.innerRight-t.innerLeft,t.innerHeight=t.innerBottom-t.innerTop,t.ratio=t.outerWidth+" x "+t.outerHeight}function e(e){this.registrations=[],t(this,e||{})}function n(t,e){return void 0!==t?parseInt(t):e}return e.prototype.register=function(t){this.ratio&&t(),this.registrations.push(t)},e.prototype.targetSvg=function(t){this.$element=t,this.resize()},e.prototype.resize=function(){var e,n,r=this.$element;if(r.attr("width",null).attr("height",null),r[0].style.cssText=null,t(this,{outerWidth:r.outerWidth(!0),outerHeight:r.outerHeight(!0),margin:{top:r.css("margin-top"),right:r.css("margin-right"),bottom:r.css("margin-bottom"),left:r.css("margin-left")},padding:{top:r.css("padding-top"),right:r.css("padding-right"),bottom:r.css("padding-bottom"),left:r.css("padding-left")}}),r.css("margin","0").css("padding","0").attr("width",this.outerWidth).attr("height",this.outerHeight).css({width:this.outerWidth+"px",height:this.outerHeight+"px"}),this.innerWidth&&this.innerHeight)for(e=0,n=this.registrations.length;n>e;e++)this.registrations[e]()},e}]),angular.module("vgraph").factory("ComponentGenerator",["DrawLine","DrawArea","DataFeed","DataLoader",function(t,e,n,r){"use strict";function i(t,e,n,r){var i,a,o,s=e.name;return r||(r="path"),t[s]=e,i=angular.isFunction(e.value)?s+".value":"'"+(e.value||s)+"'",a=angular.isFunction(e.interval)?s+".interval":"'"+(e.interval||"x")+"'",angular.isString(e.data)?(o=e.data,t[e.data]=t.$parent[e.data]):o=e.data?s+".data":"data","<"+r+' class="'+n+" "+e.className+'" vgraph-feed="'+o+'" name="'+s+'" value="'+i+'" interval="'+a+'" control="'+(e.control||"default")+'"'+(e.filter?' filter="'+e.filter+'"':"")+"></"+r+">"}function a(t){return null===t?!1:Number.isFinite?Number.isFinite(t)&&!Number.isNaN(t):isFinite(t)&&!isNaN(t)}var o={},s={require:["^vgraphChart"],scope:{data:"=_undefined_",value:"=?value",config:"=?config",explode:"=?explode",massage:"=?massage",interval:"=?interval"},link:function(t,e,i,a){function s(){var e=t.value,n=i.alias||e,r=t.interval;l={ref:{name:p},massage:t.massage},"string"==typeof r?l.parseInterval=function(t){return t[r]}:l.parseInterval=r,"string"==typeof e?l.parseValue=function(t){return void 0!==t[e]?t[n]:void 0}:l.parseValue=e}var l,c,h=i.control||"default",u=a[0].graph,d=u.views[h],f=d.dataModel,p=i.name;t.$watch("data",function(e){var i,a=n.create(e,t.massage);c&&c.$destroy(),i=o[a._$dfUid],i||(i=o[a._$dfUid]={}),c=i[h],c||(c=i[h]=new r(a,f),l&&c.addConf(l))}),t.$watch(function(){return l},function(t,e){e&&c.removeConf(e),t&&c.addConf(t)}),t.config?t.$watch("config",function(t){t.ref||(t.ref={name:p,view:h}),l=t}):(t.$watch("interval",s),t.$watch("value",s))}};return{isNumeric:a,generate:function(t,e){function n(){}var r;return n.prototype=s,r=new n,r.scope=angular.copy(r.scope),r.scope.data="="+t,angular.forEach(e,function(t,e){var n=r[e];n?angular.isFunction(n)?r[e]=function(){n.apply(this,arguments),t.apply(this,arguments)}:r[e]=angular.extend(n,t):r[e]=t}),r.preLink&&(r.link={pre:r.preLink,post:r.link}),r},makeDiffCalc:function(t,n,r,i){var o=new e;return r||(r=t),o.preParse=function(e){var o,s,l=e[t.name],c=e[r.name];return l&&(o=l[n]),c&&(s=c[i]),a(o)&&a(s)?{interval:(l._$interval+c._$interval)/2,y1:t.y.scale(o),y2:r.y.scale(s)}:void 0},o.parseInterval=function(t){return t.interval},o.parseValue1=function(t){return t.y1},o.parseValue2=function(t){return t.y2},function(t){return o.render(t).join("")}},makeAreaCalc:function(t,e){return d3.svg.area().defined(function(t){return a(t[e])}).x(function(t){return t._$interval}).y(function(n){return t.y.scale(n[e+"$Min"])}).y1(function(n){return t.y.scale(n[e+"$Max"])})},makeLineCalc:function(e,n){var r=new t;return r.preParse=function(t,e){var r=t[n];return a(r)?t:e&&void 0===r?(t[n]=e[n],t):null},r.parseValue=function(t){return e.y.scale(t[n])},r.parseInterval=function(t){return t._$interval},function(t){return r.render(t).join("")}},makeFillCalc:function(t,n,r){var i=new e;return i.preParse=function(e){var i,o;return i=e[n],o=r?e[r]:t.viewport.minValue,a(i)&&a(o)?{interval:e._$interval,y1:t.y.scale(i),y2:t.y.scale(o)}:void 0},i.parseInterval=function(t){return t.interval},i.parseValue1=function(t){return t.y1},i.parseValue2=function(t){return t.y2},function(t){return i.render(t).join("")}},decodeConfig:function(t,e,n){var r,a,o=[];if(angular.isArray(e))for(r=0,a=e.length;a>r;r++)o.push(i(t,e[r],n));else o.push(i(t,e,n));return o},compileConfig:function(t,e,n){var r,i,a,o,s,l;for(angular.isArray(s)||(s=[s]),a=this.decodeConfig(t,e,n),l=this.svgCompile(a.join("")),r=0,i=l.length;i>r;r++)s=e[r],o={name:s.name,className:s.className,element:l[r],$d3:d3.select(l[r]),$conf:s},a[r]=o;return a},svgCompile:function(t){return(new DOMParser).parseFromString('<g xmlns="http://www.w3.org/2000/svg">'+t+"</g>","image/svg+xml").childNodes[0].childNodes},parseStackedLimits:function(t,e){var n,r,i,a,o,s,l,c,h,u;if(e&&e.length)for(n=0,r=t.length;r>n;n++){for(u=0,s=void 0,o=t[n],h=e[0].name,s=o[h]||0,void 0===l?(l=s,c=s):l>s&&(l=s),o["$"+h]=s,u=s,i=1,a=e.length;a>i;i++)h=e[i].name,s=o[h]||0,u+=s,o["$"+h]=u;o.$total=u,u>c&&(c=u)}return{min:l,max:c}},parseSegmentedLimits:function(t,e,n,r){function i(t){t[e+"$Max"]=u,t[e+"$Min"]=h}var o,s,l,c,h,u,d={},f=[];if(r||(r=0),angular.isString(e)){for(n||(n=function(t,e){return e});r<t.length&&!a(n(t[r],t[r][e]));)r++;for(o=r,s=t.length;s>o;o++)l=t[o],c=n(l,l[e]),a(c)?(void 0===h?(h=c,u=c):h>c?h=c:c>u&&(u=c),f.push(l)):(f.forEach(i),d=this.parseSegmentedLimits(t,e,n,o+1),o=t.length);a(d.min)&&d.min<h&&(h=d.min),a(d.max)&&d.max>u&&(u=d.max)}else for(o=0,s=e.length;s>o;o++)c=this.parseSegmentedLimits(t,e[o],n),void 0===h?(h=c.min,u=c.max):(c.min<h&&(h=c.min),c.max>u&&(u=c.max));return{min:h,max:u}},parseLimits:function(t,e,n){var r,i,o,s,l,c;if(angular.isString(e))if(n)for(r=0,i=t.length;i>r;r++)o=t[r],s=n(o,o[e]),a(s)&&(void 0===l?(l=s,c=s):l>s?l=s:s>c&&(c=s));else for(r=0,i=t.length;i>r;r++)o=t[r],s=o[e],a(s)&&(void 0===l?(l=s,c=s):l>s?l=s:s>c&&(c=s));else for(r=0,i=e.length;i>r;r++)s=this.parseLimits(t,e[r]),void 0===l?(l=s.min,c=s.max):(s.min<l&&(l=s.min),s.max>c&&(c=s.max));return{min:l,max:c}}}}]),angular.module("vgraph").factory("DataCollection",["LinearModel",function(t){"use strict";function e(e){e instanceof t&&(e={"default":e}),this.models=e}return e.prototype.forEach=function(t,e){angular.forEach(this.models,function(n,r){t.call(e,n,r)})},e.prototype.reset=function(){angular.forEach(this.models,function(t){t.reset()})},e}]),angular.module("vgraph").factory("GraphModel",["$timeout","StatCollection","ViewModel","BoxModel","LinearModel","DataCollection",function(t,e,n,r,i,a){"use strict";function o(){this.$scripts={},this.$master=this.schedule=[]}function s(){return+new Date}function l(t){this.$vguid=++d,this.box=new r,this.models=[],this.views={},this.samples={},this.waiting={},this.registrations=[],this.loading=!0,this.message=null,this.$interface=t||{}}function c(t,e){var n,r,i,a,o;for(r=0,i=t.length;i>r;r++)for(n=t[r],a=0,o=n.length;o>a;a++)null!==n[a]&&(e[r].unshift(n[a]),a=o)}function h(t,e,n,r,i){var a,o=[],s=[];for(a=0;i>a;a++)s.push([]);return s.push([]),angular.forEach(t,function(t){var a=e[t.view],l=n[a.name];o.push(t.label),a.publishData(s,t,function(t){return Math.round((t.$x-l.data.min)/r*i)})}),{header:o,body:s}}o.prototype.startScript=function(t){t?this.$scripts[t]?(this.schedule=this.$scripts[t],this.schedule.length=0):this.schedule=this.$scripts[t]=[]:this.schedule=[]},o.prototype.endScript=function(){this.$master.push(this.schedule),this.schedule=this.$master},o.prototype.loop=function(t,e,n){this.schedule.push({start:0,stop:t.length,data:t,op:e,ctx:n})},o.prototype.func=function(t,e){this.schedule.push({op:t,ctx:e})},o.prototype.run=function(t){var e=this;this.$lock||(this.$lock=!0,setTimeout(function(){e.$eval(function(){e.$lock=!1},t)},5))},o.prototype.$eval=function(t,e){function n(){o.$eval(t,e)}var r,i,a,o=this,l=!0,c=s(),h=c+500;try{for(;(a=this.schedule.shift())&&l;){if(a.length)for(;a.length;)this.schedule.unshift(a.pop());else if("start"in a)for(r=a.start,i=a.stop;i>r;r++)a.op.call(a.ctx,a.data[r],r);else a.op.call(a.ctx);s()>h&&(l=!1,setTimeout(n,5))}}catch(u){console.log(u),e()}0===this.schedule.length&&t()};var u=new o,d=0;return l.prototype.register=function(t){this.registrations.push(t)},l.prototype.getPrimaryView=function(){return this.views[Object.keys(this.views)[0]]},l.prototype.publish=function(t,e){var n,r,i,a,o={},s={};return angular.forEach(t,function(t){var e=this.views[t.view];e&&!o[e.name]&&(o[e.name]=e)},this),angular.forEach(o,function(t){var e=t.publishStats(),r=e.data.max-e.data.min;s[t.name]=e,(!n||r>n)&&(n=r),(!i||e.step<i)&&(i=e.step)}),r=Math.ceil(n/i),a=h(t,o,s,n,r),e&&(e=h(e,o,s,n,r),c(e.body,a.body),a.header.unshift(e.header[0])),a.body.unshift(a.header),a.body},l.prototype.render=function(){var t,n=this,r=0,i=Object.keys(this.views).length,a=this.getPrimaryView(),o=new e;angular.forEach(this.views,function(t){t.parse()}),this.calcHook&&this.calcHook(),t=[],angular.forEach(this.views,function(e){e.hasData()&&(t.push(e),e.sampled.forEach(function(t){var n=e.x.scale(t.$interval);t._$interval=n,o.$setValue(Math.floor(n),e.name,t)}))}),r=t.length,u.startScript(this.$uid),i?r?(u.startScript(this.$uid),n.loading=!o.length,u.func(function(){n.unified=o,n.message=null}),o.length?(u.loop(t,function(t){t.build(o)}),u.loop(t,function(t){t.process(o)}),u.loop(t,function(t){t.finalize(o)}),u.loop(this.registrations,function(t){t(a.pane)}),u.func(function(){n.loading=!1,n.pristine=!0})):(u.loop(t,function(t){t.loading()}),u.func(function(){n.loading=!0,n.pristine=!1}))):this.loading?(u.loop(this.views,function(t){t.error()}),u.func(function(){n.pristine=!1})):(u.loop(this.views,function(t){t.error()}),u.func(function(){n.message="No Data Available",n.pristine=!1})):u.func(function(){n.loading=!0,n.pristine=!1}),u.func(function(){n.$interface.onRender&&n.$interface.onRender()}),u.endScript(),u.run(function(){n.pristine=!1,n.message="Unable to Render"})},l.prototype.scheduleRender=function(){this.nrTimeout||(this.nrTimeout=t(function(){this.render(this.waiting),this.waiting={},this.nrTimeout=null}.bind(this),30))},l.prototype.rerender=function(){this.scheduleRender(),this.waiting=this.views},l.prototype.needsRender=function(t){this.scheduleRender(),this.waiting[t.name]||(this.waiting[t.name]=t)},l.prototype.addDataCollection=function(t){t instanceof a?t=t.models:t instanceof i&&(t={"default":t}),angular.forEach(t,this.addDataModel,this)},l.prototype.addDataModel=function(t,e){var r=new n(this,e,t);this.views[r.name]=r,this.models.push(t),this.bounds&&r.pane.setBounds(this.bounds.x,this.bounds.y),this.pane&&r.pane.setPane(this.pane.x,this.pane.y),t.onError(function(t){t?(this.loading=!1,this.message=t):this.message=null}.bind(this))},l.prototype.setBounds=function(t,e,n){return this.bounds={x:t,y:e},n?this.views[n]&&this.views[n].pane.setBounds(t,e):angular.forEach(this.views,function(n){n.pane.setBounds(t,e)}),this},l.prototype.setPane=function(t,e,n){return this.pane={x:t,y:e},n?this.views[n]&&this.views[n].pane.setPane(t,e):angular.forEach(this.views,function(n){n.pane.setPane(t,e)}),this},l}]),angular.module("vgraph").factory("LinearModel",["StatCollection",function(t){"use strict";function e(t){t||(t={}),t.x||(t.x={}),t.y||(t.y={}),this.$dataProc=n(20,200,function(t){var e=t.registrations;e.forEach(function(t){t()})}),this.construct(),this.reset(t)}function n(t,e,n,r){function i(){var e=+new Date;e>s||e>o?(s=null,n.apply(r,a)):setTimeout(i,t)}var a,o,s;return function(){var n=+new Date;o=n+t,a=arguments,s||(s=n+e,setTimeout(i,t))}}var r=0;return e.prototype.construct=function(){var t=[];this.$modelId=r++,this.registrations=[],this.errorRegistrations=[],this.point={reset:function(t){t.$x=null,t.$y=null}},this.getLoaders=function(){return t},this.$follow=function(e){t.push(e)},this.$ignore=function(e){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.prototype.$ready=function(){var t,e,n=!1,r=this.getLoaders();for(t=0,e=r.length;e>t&&!n;t++)r[t].ready&&(n=!0);return n},e.prototype.reset=function(e){this.ready=!1,this.ratio=null,this.transitionDuration=30,this.data=new t,this.config(e||this),this.dataReady(!0)},e.prototype.config=function(t){this.x={massage:t.x.massage||null,padding:t.x.padding||0,scale:t.x.scale||function(){return d3.scale.linear()},parse:t.x.parse||function(t){return t.$interval},format:t.x.format||d3.format("03d"),tick:t.x.tick||{}},this.y={massage:t.y.massage||null,padding:t.y.padding||0,scale:t.y.scale||function(){return d3.scale.linear()},parse:t.y.parse||function(t,e){return void 0===t||null===t?null:t[e]},format:t.y.format||d3.format(",.2f"),tick:t.y.tick||{}}},e.prototype.onError=function(t){this.errorRegistrations.push(t)},e.prototype.setError=function(t){var e,n;for(e=0,n=this.errorRegistrations.length;n>e;e++)this.errorRegistrations[e](t)},e.prototype.getNode=function(t){return this.dataReady(),this.data.$getNode(t)},e.prototype.setValue=function(t,e,n){return this.dataReady(),this.data.$setValue(t,e,n)},e.prototype.removePlot=function(){},e.prototype.dataReady=function(t){var e=this.registrations;t?e.forEach(function(t){t()}):this.$dataProc(this)},e.prototype.register=function(t){this.registrations.push(t)},e.prototype.clean=function(){this.data.$sort()},e}]),angular.module("vgraph").factory("PaneModel",[function(){"use strict";function t(t){this.dataModel=t,this.x={},this.y={},this._bounds={},this._pane={}}return t.prototype.setBounds=function(t,e){return this._bounds.x=t,this._bounds.y=e,this},t.prototype.setPane=function(t,e){return this._pane.x=t,this._pane.y=e,this},t.prototype.isValid=function(t){var e;return this.filtered?(e=t.$interval,this.filtered.$minInterval<=e&&e<=this.filtered.$maxInterval):!1},t.prototype.filter=function(){var t,e,n,r,i,a,o=this.x,s=this.dataModel.data;if(s.length){if(this.dataModel.clean(),this._bounds.x?(e=this._bounds.x.min||s.$minInterval,n=this._bounds.x.max||s.$maxInterval,o.$min=e,o.$max=n):(e=o.$min||s.$minInterval,n=o.$max||s.$maxInterval),this.offset={},this._pane.x){if(r=this._pane.x,"number"==typeof r.start)i=s[r.start];else{if(r.start?"string"==typeof r.start&&("%"===r.start.charAt(0)?t=e+parseFloat(r.start.substring(1),10)*(n-e):"+"===r.start.charAt(0)?t=e+parseInt(r.start.substring(1),10):"="===r.start.charAt(0)&&(t=parseInt(r.start.substring(1),10))):t=e,void 0===t)throw"Start of pane not properly defined";i=t}if("number"==typeof r.stop)r.stop=s[r.stop];else{if(null===r.stop||void 0===r.stop?t=n:"string"==typeof r.stop&&("%"===r.stop.charAt(0)?t=e+parseFloat(r.stop.substring(1),10)*(n-e):"+"===r.stop.charAt(0)?t=e+parseInt(r.stop.substring(1),10):"="===r.stop.charAt(0)&&(t=parseInt(r.stop.substring(1),10))),void 0===t)throw"End of pane not properly defined";a=t}}else i=e,a=n;this.offset.$left=i,this.offset.left=(i-e)/(n-e),this.offset.$right=a,this.offset.right=(a-e)/(n-e),this.filtered=s.$filter(i,a),this.dataModel.fitToPane&&(this.filtered.$addNode(s.$makePoint(i)),this.filtered.$addNode(s.$makePoint(a)))}},t}]),angular.module("vgraph").factory("ViewModel",["PaneModel",function(t){"use strict";function e(e,n,r){var i,a,o=this;this.pane=new t(r),this.name=n,this.graph=e,this.components=[],this.dataModel=r,i={scale:r.x.scale(),calc:function(t){return i.scale(r.x.parse(t))},center:function(){return(i.calc(o.pane.filtered.$minInterval)+i.calc(o.pane.filtered.$maxInterval))/2}},this.x=i,a={scale:r.y.scale(),calc:function(t){return a.scale(r.y.parse(t))},center:function(){return(a.calc(o.pane.filtered.$minNode.$min)+a.calc(o.pane.filtered.$maxNode.$max))/2}},this.y=a,r.register(function(){e.needsRender(this)}.bind(this))}function n(t,e,n,r){for(;n>e;)t[e].push(r),e++}function r(t,e,r,i,a){var o,s,l,c,h=0;for(o=0,s=t.length;s>o;o++)l=t[o][e],void 0!==l&&null!==l&&(c=i(t[o]),c!==h&&n(r,h,c,null),a&&(l=a(l)),r[c].push(l),h=c+1);n(r,h,r.length,null)}return e.prototype.getPoint=function(t){var e=this.dataModel.data[t];return e?e:0>t?this.dataModel.data[0]:this.dataModel.data[this.dataModel.data.length]},e.prototype.getOffsetPoint=function(t){var e=Math.round(this.dataModel.data.length*t);return this.getPoint(e)},e.prototype.register=function(t){this.components.push(t)},e.prototype.hasData=function(){return this.pane.filtered&&this.pane.filtered.length>0},e.prototype.sample=function(){var t,e,n=this.graph.box,r=this.pane;r.filter(),e=r.filtered,e&&(t=parseInt(e.length/n.innerWidth)||1,this.sampled=e.$sample(t,!0))},e.prototype.parse=function(){var t,e,n,r,i=this.graph.box,a=this.pane,o=a.dataModel.data;this.sample(),r=this.sampled,r&&(this.components.forEach(function(n){var i;n.parse&&(i=n.parse(r,a.filtered,a.data),i&&(null!==i.min&&(!t&&0!==t||t>i.min)&&(t=i.min),null!==i.max&&(!e&&0!==e||e<i.max)&&(e=i.max)))}),this.dataModel.y.padding&&(n=e===t?t*this.dataModel.y.padding:(e-t)*this.dataModel.y.padding,e+=n,t-=n),this.viewport={maxValue:e,minValue:t,minInterval:r.$minInterval,maxInterval:r.$maxInterval},this.dataModel.adjustSettings&&this.dataModel.adjustSettings(r.$maxInterval-r.$minInterval,e-t,o.$maxInterval-o.$minInterval),this.x.scale.domain([r.$minInterval,r.$maxInterval]).range([i.innerLeft,i.innerRight]),this.y.scale.domain([t,e]).range([i.innerBottom,i.innerTop]))},e.prototype.build=function(t){var e=this.pane,n=this.sampled;this.components.forEach(function(r){r.build&&r.build(t,n,e.filtered,e.dataModel)})},e.prototype.process=function(t){var e=this.pane,n=this.sampled;this.components.forEach(function(r){r.process&&r.process(t,n,e.filtered,e.dataModel)})},e.prototype.finalize=function(t){var e=this.pane,n=this.sampled;this.components.forEach(function(r){r.finalize&&r.finalize(t,n,e.filtered,e.dataModel)})},e.prototype.loading=function(){this.components.forEach(function(t){t.loading&&t.loading()})},e.prototype.error=function(){this.components.forEach(function(t){t.error&&t.error()})},e.prototype.publishStats=function(){var t,e,n=this.dataModel.data,r=this.pane.x.$max||9007199254740991,i=n.length;for(t=1;i>t;t++)e=n[t].$x-n[t-1].$x,r>e&&(r=e);return{step:r,count:n.length,bound:{min:this.pane.x.$min,max:this.pane.x.$max},data:{min:this.dataModel.x.$min,max:this.dataModel.x.$max}}},e.prototype.publishData=function(t,e,n){r(this.dataModel.data,e.name,t,n,e.format)},e}]),angular.module("vgraph").factory("DataFeed",[function(){"use strict";function t(t,n){this.explode=n,this.setSource(t),this._$dfUid=e++}var e=1,n={};return t.create=function(e,r){var i;return e._$dfUid&&n[e._$dfUid]?i=n[e._$dfUid]:(i=new t(e,r),e._$dfUid=i._$dfUid,n[i._$dfUid]=i),i},t.prototype.setSource=function(t){var e=this,n=t.push;this.data=t,this._readPos=0,t.push=function(){n.apply(this,arguments),e.$push()},t.$ready=function(){e.$trigger("ready")},this.$push()},t.prototype.$on=function(t,e){var n=this;return this._$listeners||(this._$listeners={}),this._$listeners[t]||(this._$listeners[t]=[]),this._$listeners[t].push(e),function(){n._$listeners[t].splice(n._$listeners[t].indexOf(e),1)}},t.prototype.$trigger=function(t,e){var n,r,i;if(this._$listeners&&(n=this._$listeners[t]))for(r=0,i=n.length;i>r;r++)n[r](e)},t.prototype.$push=function(){var t=this;this._$push||(this._$push=setTimeout(function(){var e=t._readNext();for(e&&t.$trigger("ready");e;)t.$trigger("data",e),e=t._readNext();t._$push=null},0))},t.prototype._readAll=function(t){for(var e=this._read(0);e;)t(e),e=this._read(e.next)},t.prototype._readNext=function(){var t=this._read(this._readPos);return t&&(this._readPos=t.next),t},t.prototype._read=function(t){var e,n=this.data,r=this.explode;return!n.length||t>=n.length?null:r?(e=n[t],{points:r(e),next:t+1,ref:e}):{points:n,next:n.length}},t}]),angular.module("vgraph").factory("DataLoader",[function(){"use strict";function t(t,e){var n=this,r=[],i=this._process.bind(this),a=t.$on("ready",function(){n.ready=!0}),o=t.$on("data",function(t){var e,n,a,o;for(e=0,n=t.points.length;n>e;e++)for(a=0,o=r.length;o>a;a++)i(r[a],t.points[e],t.ref)});this.feed=t,this.confs=r,this.dataModel=e,e.$follow(this),this.$destroy=function(){e.$ignore(this),a(),o()}}var e={};return t.create=function(n,r,i){var a;return e[n._$dfUid]||(a=new t(n,r),e[n._$dfUid]=a),i&&a.addConf(i),a},t.unregister=function(){},t.prototype.addConf=function(t){var e=this._process.bind(this),n={name:t.ref.name,massage:t.massage,parseValue:t.parseValue,parseInterval:t.parseInterval};this.feed._readAll(function(t){var r,i,a=t.points;for(r=0,i=a.length;i>r;r++)e(n,a[r],t.ref)}),this.confs.push(n)},t.prototype.removeConf=function(t){var e=this.confs.indexOf(t);-1!==e&&this.confs.splice(e,1)},t.prototype._process=function(t,e,n){var r;(!t.isDefined||t.isDefined(e))&&(r=t.parseValue?this.dataModel.setValue(t.parseInterval(e),t.name,t.parseValue(e)):this.dataModel.getNode(t.parseInterval(e)),t.massage&&t.massage(r,e,n))},t}]),angular.module("vgraph").factory("DrawArea",["DrawBuilder",function(t){"use strict";function e(){}return e.prototype=new t,e.prototype.parseValue1=null,e.prototype.parseValue2=null,e.prototype.parseInterval=null,e.prototype.build=function(t){var e,n,r,i,a=[],o=[];for(e=0,n=t.length;n>e;e++)r=t[e],i=this.parseInterval(r),a.push(i+","+this.parseValue1(r)),o.unshift(i+","+this.parseValue2(r));return"M"+a.join("L")+"L"+o.join("L")+"Z"},e}]),angular.module("vgraph").factory("DrawBox",["DrawBuilder",function(t){"use strict";function e(){}return e.prototype=new t,e.prototype.parseValue=null,e.prototype.parseInterval=null,e.prototype.build=function(t){var e,n,r,i,a,o,s;for(e=0,n=t.length;n>e;e++)r=this.valueParse(t[e]),void 0===i?(i=r,a=n):i>r?i=r:r>a&&(a=r);return o=this.parseInterval(t[0]),s=this.parseInterval(t[t.length-1]),"M"+(o+","+a)+"L"+(s+","+a)+"L"+(s+","+i)+"L"+(o+","+i)+"LZ"},e}]),angular.module("vgraph").factory("DrawBuilder",[function(){"use strict";function t(){}return t.prototype.preParse=function(t){return t},t.prototype.parse=function(t){var e,n,r,i,a=[],o=[a],s=this.preParse.bind(this);for(e=0,n=t.length;n>e;e++)r=t[e],i=s(r,i),i?a.push(i):0!==a.length&&(a=[],o.push(a));return o},t.prototype.render=function(t){var e,n,r;for(t=this.parse(t),e=0,n=t.length;n>e;e++)r=t[e],t[e]=this.build(r);return t},t.prototype.build=function(){return"M0,0Z"},t}]),angular.module("vgraph").factory("DrawElement",[function(){"use strict";function t(t){return(new DOMParser).parseFromString('<g xmlns="http://www.w3.org/2000/svg">'+t+"</g>","image/svg+xml").childNodes[0].childNodes}function e(e,n,r){var i,a;"object"==typeof e?i=e:(a="<"+this._tag+' class="'+n.className+'"></'+this._tag+">",i=r?t("<g>"+a+"</g>")[0]:t(a)[0]),this.getNode=function(){return i}}return e.svgCompile=t,e.prototype.build=function(t){var e,n,r,i=this.getNode();if("g"===i.tagName){if(r=i.childNodes,r.length>t.length)for(;r.length>t.length;)i.removeChild(r.pop());else if(r.length<t.length)for(;i.childNodes.length<t.length;)i.appendChild(r[0].cloneNode());for(r=i.childNodes,e=0,n=t.length;n>e;e++)r[e].setAttribute("d",t[e])}else i.setAttribute("d",t.join(""))},e}]),angular.module("vgraph").factory("DrawLine",["DrawBuilder",function(t){"use strict";function e(){}return e.prototype=new t,e.prototype.parseValue=null,e.prototype.parseInterval=null,e.prototype.build=function(t){var e,n,r;for(e=0,n=t.length;n>e;e++)r=t[e],t[e]=this.parseInterval(r)+","+this.parseValue(r);return"M"+t.join("L")},e}]),angular.module("vgraph").factory("StatCollection",[function(){"use strict";function t(t,e,n,r){var i,a,o,s=0,l=t.length-1;if(o=t.get?function(e){return t.get(e)}:function(e){return t[e]},r||t.sort(function(t,e){return n(t)-n(e)}),n(o(s))>=e)return{left:s,right:s};if(n(o(l))<=e)return{left:l,right:l};if(t.length){for(;l-s>1;)i=Math.floor((l+s)/2),a=n(o(i)),a===e?(l=i,s=i):a>e?l=i:s=i;return l!==i&&n(o(l))===e?{left:l,right:l}:s!==i&&n(o(s))===e?{left:s,right:s}:{left:s,right:l}}}function e(){}function n(t){this._fullStat=t,this.$index={},this.$dirty=!1}function r(t){return null!==t&&void 0!==t&&"object"!=typeof t}function i(t){var e={};return Object.keys(t).filter(function(t){"$"!==t.charAt(0)&&"_"!==t.charAt(0)&&(e[t]={})}),e}return e.create=function(){return new e},e.prototype.$addValue=function(t,e){r(e)&&(void 0===this.$min?(this.$min=e,this.$max=e):e<this.$min?this.$min=e:e>this.$max&&(this.$max=e)),this[t]=e},e.prototype.$mimic=function(t){var e,n,r,i=Object.keys(t);for(e=0,n=i.length;n>e;e++)r=i[e],this[r]=t[r]},n.prototype=[],n.prototype._registerNode=function(t,e){e.$interval=t,this.$index[t]=e,void 0===this.$minInterval?(this.$minInterval=t,this.$maxInterval=t,this.push(e)):t<this.$minInterval?(this.$minInterval=t,this.unshift(e)):t>this.$maxInterval?(this.$maxInterval=t,this.push(e)):(this.$dirty=!0,this.push(e))},n.prototype._registerValue=function(t,e){r(e)&&(void 0===this.$minNode?(this.$minNode=t,this.$maxNode=t):this.$minNode.$min>e?this.$minNode=t:this.$maxNode.$max<e&&(this.$maxNode=t))},n.prototype._registerStats=function(t,e,n){r(n)&&(void 0===t.$minInterval?(t.$minInterval=e,t.$maxInterval=e):e<t.$minInterval?t.$minInterval=e:e>t.$maxInterval&&(t.$maxInterval=e))},n.prototype._resetMin=function(){var t,e,n,r=this[0];for(t=1,e=this.length;e>t;t++)n=this[t],n.$min<r.$min&&(r=n);this.$minNode=r},n.prototype._restatMin=function(t){var e,n=0,i=this.$fields[t];this.$sort();do e=this[n],n++;while(e&&!r(e[t]));e?i.$minInterval=e.$interval:i.$minInterval=void 0},n.prototype._resetMax=function(){var t,e,n,r=this[0];for(t=1,e=this.length;e>t;t++)n=this[t],n.$max>r.$max&&(r=n);this.$maxNode=r},n.prototype._restatMax=function(t){var e,n=this.length-1,i=this.$fields[t];this.$sort();do e=this[n],n--;while(e&&!r(e[t]));e?i.$maxInterval=e.$interval:i.$maxInterval=void 0},n.prototype._statNode=function(t){var e=this,n=this.$fields;Object.keys(n).forEach(function(i){var a=t[i],o=n[i];r(a)?e._registerStats(o,t.$interval,a):(o.$minInterval===t.$interval&&e._restatMin(i),o.$maxInterval===t.$interval&&e._restatMax(i))})},n.prototype.$getNode=function(t){var n=+t,r=this.$index[n];if(isNaN(n))throw new Error("interval must be a number, not: "+t+" that becomes "+n);return r||(r=new e,this._registerNode(t,r)),r},n.prototype.$setValue=function(t,e,n){var r=this.$getNode(t);return this.$fields||(this.$fields={}),this.$fields[e]||(this.$fields[e]={}),r[e]=n,this._fullStat&&this._registerStats(this.$fields[e],t,n),this._registerValue(r,n),r},n.prototype._copyFields=function(){var t={};return Object.keys(this.$fields).forEach(function(e){t[e]={}}),t},n.prototype.$addNode=function(t,e){var n;if(e||(e=t,t=e.$interval),n=this.$index[t],this.$fields||(this.$fields=i(n)),n){if(n===e)return;n.$mimic(e),this._fullStat&&(n===this.$minNode&&this._resetMin(),n===this.$maxNode&&this._resetMax(),this._statNode(n))}else this._registerNode(t,e),this._fullStat&&(void 0!==e.$min&&this._registerValue(e,e.$min),void 0!==e.$max&&this._registerValue(e,e.$max),this._statNode(e))},n.prototype.$pos=function(e){var n;return this.$sort(),n=t(this,e,function(t){return t.$interval},!0)},n.prototype.$getClosestPair=function(t){var e=this.$pos(t);return{left:this[e.left],right:this[e.right]}},n.prototype.$getClosest=function(t){var e,n,r=this.$getClosestPair(t);return e=t-r.left.$interval,n=r.right.$interval-t,n>e?r.left:r.right},n.prototype.$sort=function(){this.$dirty&&(this.$dirty=!1,this.sort(function(t,e){return t.$interval-e.$interval}))},n.prototype.$makePoint=function(t){var e,n,r,i,a,o,s=this.$getClosestPair(t),l={},c=Object.keys(this.$fields);if(s.left!==s.right)for(i=(t-s.left.$interval)/(s.right.$interval-s.left.$interval),e=0,n=c.length;n>e;e++)r=c[e],a=s.left[r],o=s.right[r],void 0!==o&&null!==o&&void 0!==a&&null!==a&&(l[r]=a+(o-a)*i);return l.$interval=t,l},n.prototype.$makeNode=function(t){this.$addNode(this.$makePoint(t))},n.prototype.$filter=function(t,e,r){var i,a=-1,o=new n(r);o.$fields=this._copyFields(),this.$sort();do a++,i=this[a];while(i&&i.$interval<t);for(;i&&i.$interval<=e;)o.$addNode(i),a++,i=this[a];return o},n.prototype.$sample=function(t,e){var r,i,a;if(1===t&&e===this._fullStat)return this;if(this.length){for(a=new n(e),a.$fields=this._copyFields(),r=0,i=this.length;i>r;r++)r%t===0&&a.$addNode(this[r]);return a.$addNode(this[i-1]),a}},n}]),angular.module("vgraph").directive("vgraphArea",["$compile","ComponentGenerator",function(t,e){"use strict";var n=0;return{require:["^vgraphChart"],scope:{data:"=vgraphArea",config:"=config"},link:function(r,i,a,o){function s(n){var i,a,o,s,h,f;if(c=[],n){for(d3.select(m).selectAll("path").remove();g.length;)g.pop().$destroy();for(h=e.compileConfig(r,n,"line"),p={},a=0,o=h.length;o>a;a++)f=h[a],s=d.views[f.$conf.control||u],p[s.name]||(p[s.name]=[],l(s)),p[s.name].push(f),m.appendChild(f.element),f.calc=e.makeAreaCalc(s,f.name),i=r.$new(),g.push(i),t(f.element)(i)}}function l(t){f[t.name]||(f[t.name]=t,t.register({parse:function(n){var r,i,a=[],o=p[t.name];if(o)for(r=0,i=o.length;i>r;r++)a.push(o[r].name);return e.parseSegmentedLimits(n,a)},finalize:function(e,n){var r,i,a,o=p[t.name];if(o)for(r=0,i=o.length;i>r;r++)a=o[r],a.$d3.attr("d",a.calc(n))}}))}var c,h,u=a.control||"default",d=o[0].graph,f={},p={},g=[],m=i[0],v=n++;m.$id=v,h=r.$watchCollection("config",s),r.$on("$destroy",function(){for(;g.length;)g.pop().$destroy();h()})}}}]),angular.module("vgraph").directive("vgraphAxis",[function(){"use strict";function t(t,e){return!(t.bottom<e.top||t.top>e.bottom||t.right<e.left||t.left>e.right)}return{scope:{orient:"=vgraphAxis",adjust:"=axisAdjust",rotation:"=tickRotation"},require:["^vgraphChart"],link:function(e,n,r,i){var a,o,s,l,c,h,u,d,f,p,g,m=r.control||"default",v=i[0].graph,$=v.views[m],y=d3.svg.axis(),x="axis",b=v.box,w=$.dataModel,k=0,C=null,_=!0,N=!1,I=parseInt(r.tickLength)||0,M=parseInt(r.tickPadding)||3,L=parseInt(r.tickMargin)||0,P=d3.select(n[0]);switch(P.attr("visibility","hidden"),h=P.append("g").attr("class","ticks"),p=P.append("g").attr("class","padding"),u=p.append("g").attr("class","tick-marks"),d=p.append("rect").attr("class","tick-margin"),g=P.append("g").attr("class","label-wrap"),r.tickRotation&&(C=parseInt(r.tickRotation,10)%360),r.labelOffset&&(k=e.$eval(r.labelOffset)),r.labelClean&&(_=e.$eval(r.labelClean)),r.labelEndpoints&&(N=e.$eval(r.labelEndpoints)),r.axisLabel&&(f=g.append("text").attr("class","axis-label label"),e.$parent.$watch(r.axisLabel,function(t){f.text(t)})),a=function(){r.tickMarks?(y.tickValues(e.$eval(r.tickMarks)),s=[]):r.tickCount?(y.ticks(e.$eval(r.tickCount)),s=[]):(y.ticks(10),s=[])},e.orient){case"top":o=function(){var t;if(P.attr("class",x+" x top").attr("transform","translate("+b.left+","+(b.top-I)+")").attr("width",b.width).attr("height",b.padding.top),f&&f.attr("text-anchor","middle").attr("x",b.width/2).attr("y",b.padding.top-k),L&&d.attr("height",L).attr("width",b.innerWidth).attr("x",0).attr("y",-L),u.attr("transform","translate(-"+b.margin.left+",0)"),s&&(y.orient("top").tickFormat(w.x.format).innerTickSize(-(b.innerHeight+I+L)).outerTickSize(0).tickPadding(M+I+L).scale($.x.scale),w.x.tick.interval&&y.ticks(w.x.tick.interval,w.x.tick.step),h.attr("transform","translate(-"+b.margin.left+","+b.padding.top+")").call(y),t=P.selectAll("g.axis-cap").data($.x.scale.domain()),N&&(t.enter().append("g").attr("class",function(t,e){
return"axis-cap "+(e?"axis-max":"axis-min")}).append("text"),t.exit().remove(),t.attr("transform",function(t){return"translate("+($.x.scale(t)-b.margin.left)+",0)"}).select("text").text(function(t){var e=w.x.format(t);return(""+e).match("NaN")?"":e}).attr("dy","-0.25em").attr("y",b.padding.top).attr("text-anchor","middle")),C)){if(null===h.select(".tick text")[0][0])return;h.selectAll(".tick text").attr("transform","translate(0,"+h.select(".tick text").attr("y")+") rotate("+C+",0,0)").attr("y","0").style("text-anchor",C%360>0?"end":"start"),t.select("text").attr("transform","rotate("+C+",0,0)").style("text-anchor",e.rotation%360>0?"end":"start")}};break;case"bottom":o=function(){var t;if(P.attr("class",x+" x bottom").attr("transform","translate("+b.left+","+b.innerBottom+")").attr("width",b.width).attr("height",b.padding.bottom),f&&f.attr("text-anchor","middle").attr("x",b.width/2).attr("y",b.padding.bottom+k),L&&d.attr("height",L).attr("width",b.innerWidth).attr("x",0).attr("y",0),u.attr("transform","translate(-"+b.margin.left+",0)"),s&&(y.orient("bottom").tickFormat(w.x.format).innerTickSize(b.innerHeight+I+L).outerTickSize(0).tickPadding(M+I+L).scale($.x.scale),w.x.tick.interval&&y.ticks(w.x.tick.interval,w.x.tick.step),h.attr("transform","translate(-"+b.margin.left+","+-b.innerHeight+")").call(y),t=P.selectAll("g.axis-cap").data($.x.scale.domain()),N&&(t.enter().append("g").attr("class",function(t,e){return"axis-cap "+(e?"axis-max":"axis-min")}).append("text"),t.exit().remove(),t.attr("transform",function(t){return"translate("+($.x.scale(t)-b.margin.left)+",0)"}).select("text").text(function(t){var e=w.x.format(t);return(""+e).match("NaN")?"":e}).attr("dy","1em").attr("y",0).attr("text-anchor","middle")),C)){if(null===h.select(".tick text")[0][0])return;h.selectAll(".tick text").attr("transform",function(){return"translate(0,"+d3.select(this).attr("y")+") rotate("+C+",0,0)"}).attr("y","0").style("text-anchor",C%360>0?"start":"end"),t.select("text").attr("transform","rotate("+C+",0,0)").style("text-anchor",e.rotation%360>0?"start":"end")}};break;case"right":o=function(){var t;P.attr("class",x+" y right").attr("transform","translate("+I+","+b.top+")").attr("width",b.padding.right).attr("height",b.height),g.attr("transform","translate("+(b.right-b.padding.right)+","+b.height+") rotate( 90 )"),f&&f.attr("text-anchor","middle").attr("x",-(b.height/2)).attr("y",-k),L&&d.attr("height",b.innerHeight).attr("width",L).attr("x",-L).attr("y",0),u.attr("transform","translate(-"+b.padding.right+","+(-b.top||0)+")"),s&&(y.orient("right").tickFormat(w.y.format).innerTickSize(-(b.innerWidth+I+L)).outerTickSize(0).tickPadding(M+I+L).scale($.y.scale),w.y.tick.interval&&y.ticks(w.y.tick.interval,w.y.tick.step),h.attr("transform","translate("+b.innerRight+","+(-b.top||0)+")"),h.call(y),h.select(".domain").attr("transform","translate("+(I+L)+",0)"),N&&(t=P.selectAll("g.axis-cap").data($.y.scale.domain()),t.enter().append("g").attr("class",function(t,e){return"axis-cap "+(e?"axis-max":"axis-min")}).append("text"),t.exit().remove(),t.attr("transform",function(t){return"translate(0,"+($.y.scale(t)-b.margin.top)+")"}).select("text").text(function(t){var e=w.y.format(t);return(""+e).match("NaN")?"":e}).attr("dy",".25em").attr("x",b.padding.left-y.tickPadding()).attr("text-anchor","end")))};break;case"left":o=function(){var t;P.attr("class",x+" y left").attr("transform","translate("+b.left+","+b.top+")").attr("width",b.padding.left).attr("height",b.height),g.attr("transform","translate("+b.padding.left+","+b.height+") rotate( -90 )"),f&&f.attr("text-anchor","middle").attr("x",b.height/2).attr("y",-k),L&&d.attr("height",b.innerHeight).attr("width",L).attr("x",-L).attr("y",0),u.attr("transform","translate("+b.padding.left+","+(-b.top||0)+")"),s&&(y.orient("left").tickFormat(w.y.format).innerTickSize(-(b.innerWidth+I+L)).outerTickSize(0).tickPadding(M+I+L).scale($.y.scale),w.y.tick.interval&&y.ticks(w.y.tick.interval,w.y.tick.step),h.attr("transform","translate("+(b.padding.left-I-L)+","+(-b.top||0)+")").call(y),h.select(".domain").attr("transform","translate("+(I+L)+",0)"),N&&(t=P.selectAll("g.axis-cap").data($.y.scale.domain()),t.enter().append("g").attr("class",function(t,e){return"axis-cap "+(e?"axis-max":"axis-min")}).append("text"),t.exit().remove(),t.attr("transform",function(t){return"translate(0,"+($.y.scale(t)-b.margin.top)+")"}).select("text").text(function(t){var e=w.y.format(t);return(""+e).match("NaN")?"":e}).attr("dy",".25em").attr("x",b.padding.left-y.tickPadding()).attr("text-anchor","end")))}}$.register({loading:function(){P.attr("visibility","hidden")},build:function(){void 0===s&&a(),o()},process:function(){s.length=0,I&&(h.selectAll(".tick text").each(function(t){s.push({el:this,val:t,position:this.getBoundingClientRect()})}),s.sort(function(t,e){var n=t.position.top-e.position.top;return n?n:t.position.left-e.position.left})),_&&(l=P.select(".axis-min text").node(),l&&(l=l.getBoundingClientRect()),c=P.select(".axis-max text").node(),c&&(c=c.getBoundingClientRect()))},finalize:function(e,n){var r,i,a,o,h,d,f={};if(!n.length)return void P.attr("visibility","hidden");for(P.attr("visibility",""),u.selectAll("line").remove(),o=0,h=s.length;h>o;o++)r=!0,i=s[o],a=i.position,_&&l&&(t(a,l)||t(a,c))?(i.el.setAttribute("class","collided"),r=!1):void 0===f.left?(f.left=a.left,f.right=a.right,f.width=a.width,f.top=a.top,f.bottom=a.bottom,f.height=a.height,i.el.setAttribute("class","")):_&&t(a,f)?(i.el.setAttribute("class","collided"),r=!1):(d=!1,a.left<f.left&&(f.left=a.left,d=!0),a.right>f.right&&(f.right=a.right,d=!0),d&&(f.width=f.right-f.left,d=!1),a.top<f.top&&(f.top=a.top,d=!0),a.bottom>f.bottom&&(f.bottom=a.bottom,d=!0),d&&(f.height=f.bottom-f.top),i.el.setAttribute("class",""))}},"axis-"+e.orient)}}}]),angular.module("vgraph").directive("vgraphBar",["$compile","ComponentGenerator",function(t,e){"use strict";return{require:["^vgraphChart"],scope:{data:"=?vgraphBar",config:"=config"},link:function(n,r,i,a){function o(r){var i,a,o,s;if(r){for(d3.select(f).selectAll("path").remove(),l=e.compileConfig(n,r,"line");d.length;)d.pop().$destroy();for(a=0,o=l.length;o>a;a++)s=l[a],s.$valueField="$"+s.name,a?(f.insertBefore(s.element,l[a-1].element),s.$bottom=l[a-1].$valueField):f.appendChild(s.element),s.calc=e.makeLineCalc(u,s.$valueField),i=n.$new(),d.push(i),t(s.element)(i)}}function s(t,e,n,r){var i,a,o,s,c,d,f,v,$,y,x,b,w,k,C,_;for(c=e;n>c;c++)$=t[c],$&&($.$els=[]);for(o=0,s=l.length;s>o;o++){for(f=l[o],_=l[o].$valueField,d=0,v=0,c=e,a=[];n>c;)$=t[c],$&&void 0!==$[_]&&(d+=$[_],v++,y=$),c++;if(d){for(b=u.y.scale(d/v),void 0===w&&(t[e]===y?(w=y._$interval-p/2,k=w+p):(w=t[e]._$interval+g,k=y._$interval-g),w<h.box.innerLeft?w=h.box.innerLeft:t[e-1]&&t[e-1]._$interval>w&&(w=t[e-1]._$interval+g),k>h.box.innerRight?k=h.box.innerRight:t[c]&&t[c]._$interval<k&&(k=t[c]._$interval-g),w>k&&(C=w,w=k,k=C),C=k-w),void 0===x?i=m.append("rect").attr("height",u.y.scale(r.y.minimum)-b):(i=m.append("rect"),x>b&&i.attr("height",x-b)),i.attr("class","bar "+f.className).attr("y",b).attr("x",w).attr("width",C),i=i[0][0],c=e;n>c;c++)$=t[c],$&&($.$els.push(i),$.$bar={center:(w+k)/2,top:d/v});x=b}}}var l,c=i.control||"default",h=a[0].graph,u=h.views[c],d=[],f=r[0],p=parseInt(i.minWidth||1),g=parseInt(i.padding||1),m=d3.select(f).append("g").attr("class","mount");n.$watchCollection("config",o),u.register({parse:function(t){return e.parseStackedLimits(t,l)},build:function(t,e){var n,r,i=0,a=u.x.scale(u.viewport.minInterval),o=u.x.scale(u.viewport.maxInterval),l=o-a,c=g+p,h=l/c,d=e.length/h;for(m.selectAll("rect").remove(),1>d&&(d=1),n=0,r=e.length;r>n;n=Math.floor(i))i+=d,s(e,n,i,t)},finalize:function(t,e){var n,r,i;for(n=0,r=l.length;r>n;n++)i=l[n],i.$d3.attr("d",i.calc(e))}})}}}]),angular.module("vgraph").directive("vgraphChart",[function(){"use strict";function t(t,e){e&&(t.$mat=d3.select(e).insert("rect",":first-child"),t.$frame=d3.select(e).insert("rect",":first-child")),t.$mat&&t.innerWidth&&(t.$mat.attr("class","mat").attr("width",t.innerWidth).attr("height",t.innerHeight).attr("transform","translate("+t.innerLeft+","+t.innerTop+")"),t.$frame.attr("class","frame").attr("width",t.width).attr("height",t.height).attr("transform","translate("+t.left+","+t.top+")"))}return{scope:{graph:"=vgraphChart",model:"=model"},controller:["$scope",function(e){var n=e.model,r=e.graph;this.graph=r,r.addDataCollection(n),r.box.register(function(){t(r.box),r.rerender()})}],require:["vgraphChart"],link:function(e,n,r,i){var a=i[0].graph;a.box.targetSvg(n),t(a.box,n[0]),e.$watch("model.loading",function(t){t?n.addClass("loading"):n.removeClass("loading")}),e.$watch("model.error",function(t){t?n.addClass("hasError"):n.removeClass("hasError")})},restrict:"A"}}]),angular.module("vgraph").directive("vgraphClassifier",["ComponentGenerator",function(t){"use strict";function e(t,e,n){var r,i;for(r=n.length-1;r>=0;r--)i=n[r],i.$els.length&&(e(i)?$(i.$els).addClass(t):$(i.$els).removeClass(t))}return t.generate("vgraphClassifier",{scope:{classes:"=classes"},preLink:function(t){t.loadPoint=function(t){var e=this.intervalParse(t),n=this.model.getPoint(e);n&&this.valueParse(t,n)}},link:function(t,n,r,i){var a=r.control||"default",o=i[0].graph.views[a];o.register({finalize:function(n,r){var i,a,o,s,l=t.classes,c=Object.keys(l);for(i=0,a=c.length;a>i;i++)o=c[i],s=l[o],e(o,s,r)}})}})}]),angular.module("vgraph").directive("vgraphCompare",["$compile","ComponentGenerator",function(t,e){"use strict";return{require:["^vgraphChart"],scope:{config:"=config"},link:function(t,n,r,i){function a(t){function n(){i&&a&&(o.$d3.attr("visibility","visible"),o.$d3.attr("d",o.calc(s.unified)),i=!1,a=!1)}function r(){o.$d3.attr("visibility","hidden")}var i=!1,a=!1,c=Object.keys(t),h=c[0],u=s.views[t[h]],d=c[1],f=s.views[t[d]];t&&2===c.length&&(o&&o.$d3.remove(),o={$d3:d3.select(l).append("path").attr("class","fill"),calc:e.makeDiffCalc(u,h,f,d)},u.register({loading:function(){i=!1,r()},error:function(){i=!1,r()},finalize:function(){i=!0,n()}}),f.register({loading:function(){a=!1,r()},error:function(){a=!1,r()},finalize:function(){a=!0,n()}}))}var o,s=i[0].graph,l=n[0];t.$watchCollection("config",a)}}}]),angular.module("vgraph").directive("vgraphFeed",["ComponentGenerator",function(t){"use strict";return t.generate("vgraphFeed",{restrict:"A"})}]),angular.module("vgraph").directive("vgraphFill",["$compile","ComponentGenerator",function(t,e){"use strict";return e.generate("vgraphFill",{scope:{data:"=vgraphFill",fillTo:"=fillTo",value:"=value",interval:"=interval",filter:"=filter"},link:function(n,r,i,a){var o,s=i.control||"default",l=a[0].graph,c=l.views[s],h=i.name,u=d3.select(r[0]).append("path").attr("class","fill plot-"+h),d=e.makeFillCalc(c,h,n.fillTo);"string"==typeof n.fillTo&&(o=e.svgCompile('<g vgraph-feed="data" name="'+n.fillTo+'" value="fillTo" interval="interval" control="'+s+'"></g>')[0],r[0].appendChild(o),t(o)(n)),c.register({parse:function(t,n){return e.parseLimits(n,h)},finalize:function(t,e){u.attr("d",d(e))}})}})}]),angular.module("vgraph").directive("vgraphFocus",[function(){"use strict";return{require:["^vgraphChart"],link:function(t,e,n,r){var i=r[0].graph,a=i.box,o=d3.select(e[0]),s=o.append("rect").attr("class","focus").attr("visibility","hidden");a.register(function(){s.attr("height",a.innerHeight).attr("y",a.innerTop)}),t.$watch("follow",function(t){var e,n,r;t&&void 0!==t.xDiff&&(e=Math.abs(t.xDiff),n=t.x0-e,r=t.x0+e,s.attr("visibility","visible"),n>a.innerLeft?s.attr("x",n):(n=a.innerLeft,s.attr("x",a.innerLeft)),r>a.innerRight?s.attr("width",a.innerRight-n):s.attr("width",r-n))}),t.$watch("stop",function(t){var e,n,r,o,l;t&&(s.attr("visibility","hidden"),e=Math.abs(t.xDiff),e>3&&(n=t.x0-e,r=t.x0+e,n<a.innerLeft?n=0:n-=a.innerLeft,r>a.innerRight?r=a.innerWidth:r-=a.innerLeft,o=i.getPrimaryView().pane.offset,l=a.innerWidth*o.right-a.innerWidth*o.left,i.setPane({start:"%"+(a.innerWidth*o.left+n/a.innerWidth*l)/a.innerWidth,stop:"%"+(a.innerWidth*o.right-(a.innerWidth-r)/a.innerWidth*l)/a.innerWidth},{start:null,stop:null}),i.rerender()))})},scope:{follow:"=vgraphFocus",stop:"=loseFocus"}}}]),angular.module("vgraph").directive("vgraphIcon",["ComponentGenerator",function(t){"use strict";return t.generate("vgraphIcon",{scope:{getValue:"=trueValue"},link:function(e,n,r,i){var a,o,s,l=r.control||"default",c=i[0].graph.views[l],h=n[0],u=r.name,d=[],f=d3.select(h),p=f.node().getBBox();for(void 0===r.value&&(e.value=u),a=0,o=h.childNodes.length;o>a;a++)1===h.childNodes[a].nodeType&&d.push(h.childNodes[a]);n.html(""),c.register({parse:function(e,n){return s=[],t.parseLimits(n,u,function(t,e){e&&s.push(t)})},build:function(){function t(){return this.appendChild(d[o].cloneNode(!0))}var i,a,o,l;n.html(""),angular.forEach(s,function(n){var s;for(i=n.$sampled._$interval,a=c.y.scale(e.getValue(n.$sampled)),s=f.append("g"),o=0,l=d.length;l>o;o++)s.select(t);r.showUnder?s.attr("transform","translate("+(i-p.width/2)+","+a+")"):s.attr("transform","translate("+(i-p.width/2)+","+(a-p.height)+")")})}})}})}]),angular.module("vgraph").directive("vgraphIndicator",[function(){"use strict";return{require:["^vgraphChart"],scope:{model:"=model"},link:function(t,e,n,r){function i(){d.attr("visibility","hidden")}var a,o=n.control||"default",s=r[0].graph.views[o],l=n.vgraphIndicator,c=s.dataModel,h=t.$eval(n.pointRadius)||3,u=t.$eval(n.outerRadius),d=d3.select(e[0]).attr("transform","translate(1000,1000)"),f=d.append("circle").attr("class","point inner").attr("r",h).attr("visibility","hidden"),p=d.append("circle").attr("class","point outer").attr("r",h).attr("visibility","hidden");u&&(a=function(){p.transition().duration(1e3).attr("r",u).transition().duration(1e3).attr("r",h).ease("sine").each("end",function(){setTimeout(function(){a()},3e3)})})(),s.register({error:i,loading:i,finalize:function(t,e){var n,r,i,a=e.$fields[l];a?(n=e.$index[a.$maxInterval],n&&n[l]?(r=n._$interval,i=s.y.scale(n["$"+l]||n[l]),f.attr("visibility","visible"),p&&p.attr("visibility","visible"),d.transition().duration(c.transitionDuration).ease("linear").attr("transform","translate("+r+","+i+")")):(f.attr("visibility","hidden"),p&&p.attr("visibility","hidden"))):(f.attr("visibility","hidden"),p&&p.attr("visibility","hidden"))}})}}}]),angular.module("vgraph").directive("vgraphInteract",[function(){"use strict";return{require:["^vgraphChart"],scope:{highlight:"=vgraphInteract",dragStart:"=?dBegin",dragPos:"=?dChange",dragStop:"=?dEnd"},link:function(t,e,n,r){function i(e,n,r){clearTimeout(s),t.$apply(function(){var i=d3.mouse(e);angular.forEach(t.highlight.point,function(t){$(t.$els).removeClass("active")}),t.highlight.point=r,t.highlight.offset=n,t.highlight.position={x:i[0],y:i[1]},angular.forEach(t.highlight.point,function(t){$(t.$els).addClass("active")})})}function a(){s=setTimeout(function(){t.$apply(function(){angular.forEach(t.highlight.point,function(t){$(t.$els).removeClass("active")}),t.highlight.point=null,t.highlight.closest=null,t.highlight.offset=null})},100)}var o,s,l=r[0].graph,c=!1,h=l.box,u=d3.select(e[0]),d=u.append("rect").style("opacity","0").attr("class","focal").on("mousemove",function(){var t=d3.mouse(this)[0];c||i(this,t,l.unified.$getClosest(t))}).on("mouseout",function(t){c||a(this,t)});u.attr("class","interactive"),u.call(d3.behavior.drag().on("dragstart",function(){o=d3.mouse(e[0]),c=!0,a(),t.dragStart={x:o[0],y:o[1]},t.$apply()}).on("dragend",function(){var n=d3.mouse(e[0]);c=!1,t.dragStop={x0:o[0],y0:o[1],x1:n[0],x2:n[1],xDiff:n[0]-o[0],yDiff:n[1]-o[1]},t.$apply()}).on("drag",function(){var n=d3.mouse(e[0]);t.dragPos={x0:o[0],y0:o[1],x1:n[0],x2:n[1],xDiff:n[0]-o[0],yDiff:n[1]-o[1]},t.$apply()})),u.on("dblclick",function(){l.setPane({start:null,stop:null},{start:null,stop:null}),l.rerender()}),angular.forEach(l.views,function(t){t.register({finalize:function(){d.attr({x:h.innerLeft,y:h.innerTop,width:h.innerWidth,height:h.innerHeight})}})}),t.highlight||(t.highlight={}),t.dragStart||(t.dragStart={}),t.dragPos||(t.dragPos={}),t.dragStop||(t.dragStop={})}}}]),angular.module("vgraph").directive("vgraphLeading",[function(){"use strict";return{require:["^vgraphChart"],scope:{config:"=config"},link:function(t,e,n,r){function i(t){var e,n,r;if(o={},h.selectAll("line").remove(),t)for(n=0,r=t.length;r>n;n++)e=t[n],o[e.name]=h.append("line").attr("class",e.className)}function a(){h.attr("visibility","hidden")}var o,s=n.control||"default",l=r[0].graph,c=l.views[s],h=d3.select(e[0]);t.$watchCollection("config",i),c.register({error:a,loading:a,finalize:function(t){var e,n,r=c.model,i=[];angular.forEach(o,function(n,a){r.plots[a]&&(e=r.plots[a].x.max,t.isValid(e)&&e[a]&&i.push({el:n,x:c.x.scale(e.$interval),y:c.y.scale(e["$"+a]||e[a])}))}),i.sort(function(t,e){return t.y-e.y}),angular.forEach(i,function(t){n&&n.el.attr("x1",n.x).attr("x2",t.x).attr("y1",n.y).attr("y2",t.y),n=t}),n?(h.attr("visibility","visible"),n.el.attr("x1",n.x).attr("x2",n.x).attr("y1",n.y).attr("y2",l.box.innerBottom)):h.attr("visibility","hidden")}})}}}]),angular.module("vgraph").directive("vgraphLine",["ComponentGenerator",function(t){"use strict";return t.generate("vgraphLine",{link:function(e,n,r,i){var a=r.control||"default",o=i[0].graph.views[a],s=r.name,l=d3.select(n[0]).append("path").attr("class","line plot-"+s),c=t.makeLineCalc(o,s);o.register({parse:function(e){return t.parseLimits(e,s)},finalize:function(t,e){l.attr("d",c(e))},publish:function(e,n,r,i){n.push(s),t.publish(e,s,r,i)}})}})}]),angular.module("vgraph").directive("vgraphLoading",["$interval",function(t){"use strict";return{require:["^vgraphChart"],link:function(e,n,r,i){function a(){!f&&d.loading&&(m.attr("visibility","visible"),f=!0,t.cancel(l),s(),l=t(s,4005))}function o(){m.attr("visibility","hidden"),f=!1,t.cancel(l)}function s(){$.attr("x",function(){return c}).attr("width",function(){return 0}).transition().duration(1e3).attr("x",function(){return c}).attr("width",function(){return h}).ease("sine").transition().duration(1e3).attr("width",0).attr("x",function(){return u}).ease("sine").transition().duration(1e3).attr("width",function(){return h}).attr("x",function(){return c}).ease("sine").transition().duration(1e3).attr("x",function(){return c}).attr("width",0).ease("sine")}var l,c,h,u,d=i[0].graph,f=!1,p=d.box,g=r.vgraphLoading||"Loading Data",m=d3.select(n[0]).attr("class","loading-view"),v=m.append("rect").attr("height",20).attr("class","outline"),$=m.append("rect").attr("width",0).attr("height",20).attr("class","filling"),y=m.append("text").text(g);p.register(function(){if(c=p.innerLeft+p.innerWidth/5,h=3*p.innerWidth/5,u=c+h,h){$.attr("x",c).attr("y",p.middle-10),v.attr("x",c).attr("y",p.middle-10).attr("width",h);try{y.attr("text-anchor","middle").attr("x",p.center).attr("y",p.middle+y.node().getBBox().height/2-2)}catch(t){y.attr("text-anchor","middle").attr("x",p.center).attr("y",p.middle)}a()}else o()}),e.$on("$destroy",function(){o()}),e.$watch(function(){return d.loading},function(t){o(),t&&p.ratio&&a()})}}}]),angular.module("vgraph").directive("vgraphMessage",[function(){"use strict";return{require:["^vgraphChart"],link:function(t,e,n,r){var i=r[0].graph,a=i.box,o=d3.select(e[0]).attr("class","error-view"),s=o.append("rect").attr("class","outline"),l=o.append("text");a.register(function(){if(a.innerHeight){s.attr("transform","translate("+a.innerLeft+","+a.innerTop+")").attr("width",a.innerWidth).attr("height",a.innerHeight);try{l.attr("text-anchor","middle").attr("x",a.center).attr("y",a.middle+l.node().getBBox().height/2)}catch(t){l.attr("text-anchor","middle").attr("x",a.center).attr("y",a.middle)}}}),t.$watch(function(){return i.message},function(t){t&&!i.loading?(o.attr("visibility","visible"),l.text(t)):o.attr("visibility","hidden")})}}}]),angular.module("vgraph").directive("vgraphMultiIndicator",["$compile",function(t){"use strict";return{scope:{config:"=config"},link:function(e,n,r){function i(n){var i,s,l,c,h,u,d,f,p=e.$eval(r.pointRadius)||3,g=e.$eval(r.outerRadius),m="";if(n){for(d3.select(o).selectAll("g").remove();a.length;)a.pop().$destroy();for(l=0,c=n.length;c>l;l++)f=n[l],d=f.name,h=f.className?f.className:"plot-"+d,m+='<g class="'+h+'" vgraph-indicator="'+d+'"'+(g?' outer-radius="'+g+'"':"")+' point-radius="'+p+'"></g>';for(u=(new DOMParser).parseFromString('<g xmlns="http://www.w3.org/2000/svg">'+m+"</g>","image/svg+xml").childNodes[0].childNodes;u.length;)s=u[0],o.appendChild(s),i=e.$new(),a.push(i),t(s)(i)}}var a=[],o=n[0];e.$watchCollection("config",i)}}}]),angular.module("vgraph").directive("vgraphMultiLine",["$compile","ComponentGenerator",function(t,e){"use strict";var n=0;return{require:["^vgraphChart"],scope:{data:"=vgraphMultiLine",config:"=config"},link:function(r,i,a,o){function s(n){var i,a,o,s,h,f;if(c=[],n){for(d3.select(m).selectAll("path").remove();g.length;)g.pop().$destroy();for(h=e.compileConfig(r,n,"line"),p={},a=0,o=h.length;o>a;a++)f=h[a],s=d.views[f.$conf.control||u],p[s.name]||(p[s.name]=[],l(s)),p[s.name].push(f),m.appendChild(f.element),f.calc=e.makeLineCalc(s,f.name),i=r.$new(),g.push(i),t(f.element)(i)}}function l(t){f[t.name]||(f[t.name]=t,t.register({parse:function(n){var r,i,a=[],o=p[t.name];if(o)for(r=0,i=o.length;i>r;r++)a.push(o[r].name);return e.parseLimits(n,a)},finalize:function(e,n){var r,i,a,o=p[t.name];if(o)for(r=0,i=o.length;i>r;r++)a=o[r],a.$d3.attr("d",a.calc(n))}}))}var c,h,u=a.control||"default",d=o[0].graph,f={},p={},g=[],m=i[0],v=n++;m.$id=v,h=r.$watchCollection("config",s),r.$on("$destroy",function(){for(;g.length;)g.pop().$destroy();h()})}}}]),angular.module("vgraph").directive("vgraphMultiTooltip",["$compile",function(t){"use strict";return{scope:{config:"=config",formatter:"=textFormatter",data:"=vgraphMultiTooltip"},link:function(e,n,r){function i(n){var i,s,l,c,h,u,d,f,p="";if(n){for(d3.select(o).selectAll("g").remove();a.length;)a.pop().$destroy();for(l=0,c=n.length;c>l;l++)f=n[l],d=f.name,h=f.className?f.className:"plot-"+d,p+='<g class="'+h+'" vgraph-tooltip="data" name="'+d+'" text-formatter="formatter"'+(r.offseX?' offset-x="'+r.offsetX+'"':"")+(r.offseY?' offset-y="'+r.offsetY+'"':"")+"></g>";for(u=(new DOMParser).parseFromString('<g xmlns="http://www.w3.org/2000/svg">'+p+"</g>","image/svg+xml").childNodes[0].childNodes;u.length;)s=u[0],o.appendChild(s),i=e.$new(),a.push(i),t(s)(i)}}var a=[],o=n[0];e.$watchCollection("config",i)}}}]),angular.module("vgraph").directive("vgraphStack",["$compile","ComponentGenerator",function(t,e){"use strict";return{require:["^vgraphChart"],scope:{config:"=config"},link:function(n,r,i,a){function o(r){var i,a,o,l;if(r){for(d3.select(d).selectAll("path").remove(),s=e.compileConfig(n,r,"fill");u.length;)u.pop().$destroy();for(a=0,o=s.length;o>a;a++)l=s[a],l.$valueField="$"+l.name,a?(d.insertBefore(l.element,s[a-1].element),l.$bottom=s[a-1].$valueField,l.calc=e.makeFillCalc(h,l.$valueField,l.$bottom)):(d.appendChild(l.element),l.calc=e.makeFillCalc(h,l.$valueField)),i=n.$new(),u.push(i),t(l.element)(i)}}var s,l=i.control||"default",c=a[0].graph,h=c.views[l],u=[],d=r[0];n.$watchCollection("config",o),h.register({parse:function(t){return e.parseStackedLimits(t,s)},finalize:function(t,e){var n,r,i;for(n=0,r=s.length;r>n;n++)i=s[n],i.$d3.attr("d",i.calc(e))}})}}}]),angular.module("vgraph").directive("vgraphTarget",[function(){"use strict";return{require:["^vgraphChart"],scope:{pointRadius:"=pointRadius",target:"=vgraphTarget",config:"=?config"},link:function(t,e,n,r){function i(t){var e,n,r={};if(t)for(e=0,n=t.length;n>e;e++)t[e]&&(r[t[e].name]=t[e].className);return r}function a(t){o=t,t?(h.style("visibility","visible").attr("transform","translate("+t+",0)"),angular.forEach(p,function(t){t&&t()})):h.style("visibility","hidden")}var o,s,l=r[0].graph,c=l.box,h=d3.select(e[0]).attr("class","target"),u=h.append("line").attr("class","focus").attr("x1",0).attr("x2",0),d=h.append("g"),f=n.type||"point",p={};n.offset?t.$watch("target.offset",a):t.$watch("target.point.$index",function(t){a(t)}),t.$watchCollection(function(){var e=n.control;try{e=t.$eval(n.control),angular.isString(e)&&(e=[e])}catch(r){}return e||(e=n.control?[n.control]:Object.keys(l.views)),e},function(e){angular.forEach(s,function(t){t()}),s=[],angular.forEach(e,function(e){var r,a=l.views[e],c=a.model;r=t.$watch('config["'+e+'"]',function(r){var s=i(r);p[e]=function(){var r,i,l=t.target[f][e];if(s&&l&&void 0===n.noDots){d.selectAll("circle.point."+e).remove();for(r in c.plots)l[r]&&(i=s[r]||"plot-"+r,d.append("circle").attr("class","point "+i+" "+e).attr("cx",n.offset?l._$interval-o:0).attr("cy",a.y.scale(l[r])).attr("r",t.$eval(n.pointRadius)||3))}else d.selectAll("circle.point."+e).remove()}}),s.push(function(){r(),p[e]=null})})}),c.register(function(){u.attr("y1",c.innerTop).attr("y2",c.innerBottom)})}}}]),angular.module("vgraph").directive("vgraphTooltip",[function(){"use strict";return{require:["^vgraphChart"],scope:{formatter:"=textFormatter",data:"=vgraphTooltip",value:"=?value",position:"=?yValue"},link:function(t,e,n,r){var i=n.control||"default",a=r[0].graph,o=a.views[i],s=n.name,l=t.formatter||function(t){var e=o.model;return e.y.format(e.y.parse(t))},c=parseInt(n.offsetX)||0,h=parseInt(n.offsetY)||0,u=d3.select(e[0]).attr("class","tooltip"),d=u.append("polygon").attr("class","outline").attr("transform","translate(0,-15)"),f=u.append("text").style("line-height","20").style("font-size","16").attr("class","label");t.$watch("data.point",function(e){var n,r,p,g,m;e&&(n=e[i],r=t.value?t.value(e):n[s],void 0!==r&&(p=t.position?t.position(e):o.y.scale(r),g=e.$index+c,f.text(l(r,n,e)),m=f.node().getComputedTextLength()+5,u.style("visibility","visible"),g+m+16<a.box.innerRight?(u.attr("transform","translate("+g+","+(p+h)+")"),f.attr("transform","translate(10,5)"),d.attr("points","0,15 10,0 "+(m+10)+",0 "+(m+10)+",30 10,30 0,15")):(u.attr("transform","translate("+(g-2*c-m-10)+","+(p+h)+")"),f.attr("transform","translate(5,5)"),d.attr("points","0,0 "+m+",0 "+(m+10)+",15 "+m+",30 0,30 0,0")))),void 0===r&&u.style("visibility","hidden")})}}}]),angular.module("vgraph").directive("vgraphZone",["ComponentGenerator",function(t){"use strict";return t.generate("vgraphZone",{link:function(t,e,n,r){var i=n.control||"default",a=r[0].graph,o=a.views[i],s=a.box,l=n.name,c=d3.select(e[0]).append("path").attr("class","line plot-"+l),h=d3.svg.area().defined(function(t){return t[l]===!0}).x(function(t){return o.x.scale(t.$interval)}).y(function(){return s.innerTop}).y1(function(){return s.innerBottom});o.register({finalize:function(t,e){c.attr("d",h(e))}})}})}]),angular.module("vgraph").directive("vgraphZoom",[function(){"use strict";return{scope:{target:"=vgraphZoom",min:"=zoomMin",max:"=zoomMax"},require:["^vgraphChart"],link:function(t,e,n,r){function i(e){0===o&&s===f.innerWidth?(m=!1,b.attr("class","focus")):(m=!0,b.attr("class","focus zoomed")),0>o&&(o=0),s>f.innerWidth&&(s=f.innerWidth),o>s?o=s:o>s&&(s=o),$.attr("transform","translate("+o+",0)"),y.attr("transform","translate(-"+o+",0 )").attr("width",o),w.attr("transform","translate("+s+",0)"),k.attr("width",f.innerWidth-s),b.attr("transform","translate("+o+",0)").attr("width",s-o),e||t.$apply(function(){p.setPane({start:"%"+o/f.innerWidth,stop:"%"+s/f.innerWidth},{start:null,stop:null}),p.rerender()})}var a,o,s,l,c,h,u,d=r[0].graph,f=d.box,p=t.target,g=!1,m=!1,v=d3.select(e[0]),$=v.append("g").attr("class","left-control min-control"),y=$.append("rect").attr("class","shade"),x=$.append("g").attr("class","control"),b=v.append("rect").attr("class","focus"),w=v.append("g").attr("class","right-control max-control"),k=w.append("rect").attr("class","shade"),C=w.append("g").attr("class","control");c=x.append("path").attr("d","M-0.5,23.33A6,6 0 0 0 -6.5,29.33V40.66A6,6 0 0 0 -0.5,46.66ZM-2.5,31.33V38.66M-4.5,31.33V38.66").attr("transform","translate(0,-9)").attr("class","nub"),l=x.append("rect").attr("width","10").attr("transform","translate(-10,0)"),u=C.append("path").attr("d","M0.5,23.33A6,6 0 0 1 6.5,29.33V40.66A6,6 0 0 1 0.5,46.66ZM2.5,31.33V38.66M4.5,31.33V38.66").attr("transform","translate(0,-9)").attr("class","nub"),h=C.append("rect").attr("width","10"),t.box=f,l.call(d3.behavior.drag().on("dragstart",function(){g=!0}).on("dragend",function(){g=!1}).on("drag",function(){o=d3.mouse(e[0])[0],i()})),h.call(d3.behavior.drag().on("dragstart",function(){g=!0}).on("dragend",function(){g=!1}).on("drag",function(){s=d3.mouse(e[0])[0],i()})),b.call(d3.behavior.drag().on("dragstart",function(){a={mouse:d3.mouse(e[0])[0],minPos:o,maxPos:s},g=!0}).on("dragend",function(){g=!1,m=!0}).on("drag",function(){var t=d3.mouse(e[0]),n=t[0]-a.mouse;m?(s=a.maxPos+n,o=a.minPos+n,i()):n>1&&(s=a.mouse+Math.abs(n),o=a.mouse-Math.abs(n),i(),m=!1)})),v.on("dblclick",function(){s=f.innerWidth,o=0,i()}),f.register(function(){v.attr("width",f.innerWidth).attr("height",f.innerHeight).attr("transform","translate("+f.innerLeft+","+f.innerTop+")"),u.attr("transform","translate(0,"+(f.innerHeight/2-30)+")"),c.attr("transform","translate(0,"+(f.innerHeight/2-30)+")"),y.attr("height",f.innerHeight),k.attr("height",f.innerHeight),l.attr("height",f.innerHeight),h.attr("height",f.innerHeight),b.attr("height",f.innerHeight)}),p.register(function(t){g||(t.offset?(o=t.offset.left*f.innerWidth,s=t.offset.right*f.innerWidth):(o=0,s=f.innerWidth),i(!0))})}}}]),function(t){"use strict";var e=/\S+/g,n=/[\t\r\n\f]/g;t&&(t.fn.addClass=function(r){var i,a,o,s,l,c,h,u="string"==typeof r&&r,d=0,f=this.length;if(t.isFunction(r))return this.each(function(e){t(this).addClass(r.call(this,e,this.className))});if(u)for(i=(r||"").match(e)||[];f>d;d++)if(a=this[d],h="string"!=typeof a.className,o=1===a.nodeType&&(a.className?(" "+(h?a.getAttribute("class")||"":a.className)+" ").replace(n," "):" ")){for(l=0;s=i[l++];)o.indexOf(" "+s+" ")<0&&(o+=s+" ");c=t.trim(o),a.className!==c&&(h?a.setAttribute("class",c):a.className=c)}return this},t.fn.removeClass=function(r){var i,a,o,s,l,c,h,u=0===arguments.length||"string"==typeof r&&r,d=0,f=this.length;if(t.isFunction(r))return this.each(function(e){t(this).removeClass(r.call(this,e,this.className))});if(u)for(i=(r||"").match(e)||[];f>d;d++)if(a=this[d],h="string"!=typeof a.className,o=1===a.nodeType&&(a.className?(" "+(h?a.getAttribute("class")||"":a.className)+" ").replace(n," "):"")){for(l=0;s=i[l++];)for(;o.indexOf(" "+s+" ")>=0;)o=o.replace(" "+s+" "," ");c=r?t.trim(o):"",a.className!==c&&(h?a.setAttribute("class",c):a.className=c)}return this})}(jQuery);
//# sourceMappingURL=vgraph.min.js.map