angular.module("vgraph",[]),angular.module("vgraph").factory("DomHelper",[function(){"use strict";function a(a){var c=b[a];return c||(c=new RegExp("(?:^|\\s)"+a+"(?!\\S)"),b[a]=c),c}var b={};return{bringForward:function(a){var b,c,d;for(b=0,c=a.length;c>b;b++)d=a[b].$element,d.parentNode&&d.parentNode.appendChild(d);return this},addClass:function(b,c){var d,e,f,g,h=a(c);for(d=0,e=b.length;e>d;d++)f=b[d].$element,g=f.getAttribute("class")||"",g.match(h)||f.setAttribute("class",g+" "+c);return this},removeClass:function(b,c){var d,e,f,g=a(c);for(d=0,e=b.length;e>d;d++)f=b[d].$element,f.setAttribute("class",(f.getAttribute("class")||"").replace(g,""));return this}}}]),angular.module("vgraph").factory("makeEventing",[function(){"use strict";return function(a){a.$on=function(a,b){var c=this;return this._$listeners||(this._$listeners={}),this._$listeners[a]||(this._$listeners[a]=[]),this._$listeners[a].push(b),function(){c._$listeners[a].splice(c._$listeners[a].indexOf(b),1)}},a.$subscribe=function(a){var b=this,c=[],d=Object.keys(a);return d.forEach(function(d){var e=a[d];c.push(b.$on(d,e))}),function(){c.forEach(function(a){a()})}},a.$trigger=function(a,b){var c,d,e;if(this._$listeners&&(c=this._$listeners[a]))for(d=0,e=c.length;e>d;d++)c[d](b)}}}]),angular.module("vgraph").factory("Hitbox",[function(){"use strict";function a(a,b,c,d,e){var f,g,h,i,j,k=[],l=[],m=[];for(this.xMin=a,this.xDiff=b-a,this.yMin=c,this.yDiff=d-c,this.count=e,f=0,g=e;g>f;f++)for(j=[],k.push(j),l.push([]),m.push([]),h=0,i=e;i>h;h++)j.push([]);this._index=k,this._xDex=l,this._yDex=m}function b(a,b,c,d){var e,f,g,h=[];for(e=0,f=a.length;f>e;e++)g=a[e],d(g)(b,c)&&h.push(g);return h}var c=0;a.prototype.$hashX=function(a){var b=(a-this.xMin)/this.xDiff*this.count|0;return 0>b?b=0:b>=this.count&&(b=this.count-1),b},a.prototype.$hashY=function(a){var b=(a-this.yMin)/this.yDiff*this.count|0;return 0>b?b=0:b>=this.count&&(b=this.count-1),b},a.prototype.add=function(a){var b,d,e,f,g,h,i=this._index;for(a.x1>a.x2&&(g=a.x1,a.x1=a.x2,a.x2=g),a.y1>a.y2&&(g=a.y1,a.y1=a.y2,a.y2=g),a.$uid=c++,b=this.$hashX(a.x1),d=this.$hashX(a.x2)+1,g=this.$hashY(a.y1),f=this.$hashY(a.y2)+1,e=g;f>e;e++)this._yDex[e].push(a);for(;d>b;b++)for(h=i[b],this._xDex[b].push(a),e=g;f>e;e++)h[e].push(a)};var d={intersect:function(a,b){return this.x1<=a&&this.x2>=a&&this.y1<=b&&this.y2>=b},intersectX:function(a){return this.x1<=a&&this.x2>=a},intersectY:function(a,b){return this.y1<=b&&this.y2>=b}};return a.prototype.checkHit=function(a,c){return b(this._index[this.$hashX(a)][this.$hashY(c)],a,c,function(a){return(a.intersect?a.intersect:d.intersect).bind(a)})},a.prototype.checkX=function(a){return b(this._xDex[this.$hashX(a)],a,null,function(a){return(a.intersectX?a.intersectX:d.intersectX).bind(a)})},a.prototype.checkY=function(a){return b(this._yDex[this.$hashY(a)],null,a,function(a){return(a.intersectY?a.intersectY:d.intersectY).bind(a)})},a}]),angular.module("vgraph").factory("Scheduler",[function(){"use strict";function a(){this.$scripts={},this.$master=this.schedule=[]}function b(){return+new Date}return a.prototype.startScript=function(a){a?this.$scripts[a]?(this.schedule=this.$scripts[a],this.schedule.length=0):this.schedule=this.$scripts[a]=[]:this.schedule=[]},a.prototype.endScript=function(a,b,c){this.schedule.push({$end:!0,always:a,success:b,failure:c}),this.$master.push(this.schedule),this.schedule=this.$master},a.prototype.loop=function(a,b,c){this.schedule.push({start:0,stop:a.length,data:a,op:b,ctx:c})},a.prototype.func=function(a,b){this.schedule.push({op:a,ctx:b})},a.prototype.run=function(){var a=this;this.$lock||(this.$lock=!0,setTimeout(function(){a.$eval()},5))},a.prototype.$eval=function(){function a(){f.$eval()}var c,d,e,f=this,g=!0,h=b(),i=h+500;try{for(;(e=this.schedule.shift())&&g;){if(e.length)for(;e.length;)this.schedule.unshift(e.pop());else if("start"in e)for(c=e.start,d=e.stop;d>c;c++)e.op.call(e.ctx,e.data[c],c);else e.$end?(e.success&&e.success(),e.always&&e.always()):e.op.call(e.ctx);b()>i&&(g=!1,setTimeout(a,5))}}catch(j){for(console.log(j),g=!0;(e=this.schedule.shift())&&g;)e.$end&&(e.failure&&e.failure(),e.always&&e.always(),a())}this.schedule.length||(this.$lock=!1)},a}]),angular.module("vgraph").factory("makeBlob",["svgColorize",function(a){"use strict";function b(a){return a.map(function(a){return'"'+a.join('","')+'"'}).join("\n")}function c(a){for(var b=atob(a.toDataURL("image/png").split(",")[1]),c=b.length,d=new Uint8Array(c),e=0;c>e;e++)d[e]=b.charCodeAt(e);return d}function d(d){var e,f,g=d.data,h=d.charset||"utf-8";return console.log(g,g instanceof Node),g instanceof Node?("svg"===g.tagName?(a(g),f="image/svg+xml"):"canvas"===g.tagName?(e=c(g),f="image/png"):f="text/html",e||(e=(new XMLSerializer).serializeToString(g))):g.length&&g[0]&&g[g.length-1]?(e=b(g),f="text/csv"):(e=JSON.stringify(g),f="text/json"),new Blob([e],{type:f+";charset="+h+";"})}return d}]),angular.module("vgraph").factory("svgColorize",[function(){"use strict";function a(a,b){Array.prototype.forEach.call(a,function(a){var c="";b.forEach(function(b){var d=document.defaultView.getComputedStyle(a,"").getPropertyValue(b);""!==d&&(c+=b+":"+d+";")}),a.setAttribute("style",c)})}function b(c){var d=b.settings;Object.keys(d).forEach(function(b){var e=c.getElementsByTagName(b);a(e,d[b])})}var c={path:["fill","stroke","stroke-width"],rect:["fill","stroke","opacity"],line:["stroke","stroke-width"],text:["text-anchor","font-size","color","font-family"],circle:["fill","stroke"]};return b.settings=c,b}]),angular.module("vgraph").factory("StatCalculations",[function(){"use strict";function a(a){return null===a?!1:Number.isFinite?Number.isFinite(a)&&!Number.isNaN(a):isFinite(a)&&!isNaN(a)}function b(a,b){var c=[];return a.forEach(function(a){c.push("$"+b+"$"+a.field)}),c}return{$resetCalcs:function(a){var b,c;for(b=0,c=a.length;c>b;b++)a[b].$reset()},$getFields:function(a){var b,c,d=[];for(b=0,c=a.length;c>b;b++)d.push(a[b].field);return d},$setFields:function(a,b){var c,d;for(c=0,d=a.length;d>c;c++)a[c].field=b[c]},stack:function(a){var c,d,e,f,g,h,i,j,k,l=b(a,"stack"),m=this.indexs(a);for(f=a.length,c=0,d=m.length;d>c;c++)for(h=0,i=m[c],e=0;f>e;e++)j=a[e],k=j.$getNode(i),g=j.getValue(k)||0,h+=g,k[l[e]]=h;for(e=0;f>e;e++)a[e].field=l[e];return l},limits:function(b){var c,d,e,f,g;if(angular.isArray(b))for(c=0,d=b.length;d>c;c++)e=this.limits(b[c]),void 0===f?(f=e.min,g=e.max):(e.min<f&&(f=e.min),e.max>g&&(g=e.max));else b&&b.getValue&&b.$eachNode(function(c){e=+b.getValue(c),a(e)&&(void 0===f?(f=e,g=e):f>e?f=e:e>g&&(g=e))});return{min:f,max:g}},indexs:function(a){var b,c={};return 1===a.length?b=a[0].$getIndexs():(b=[],a.forEach(function(a){b=b.concat(a.$getIndexs())}),b=b.filter(function(a){return c[a]?void 0:(c[a]=!0,a)})),b}}}]),angular.module("vgraph").factory("CalculationsCompile",[function(){"use strict";function a(a,b){return b?a?function(c){a(c),b(c)}:b:a}return function(b){var c,d,e,f,g;return b.forEach(function(b){angular.isFunction(b)?e=a(e,b):(d=a(d,b.prep),e=a(e,b.calc),f=a(f,b.reset),g=a(g,b.finalize))}),c=function(a){var b,c;if(e)for(b=0,c=a.length;c>b;b++)e(a[b]);g&&g(a.$stats)},c.$reset=function(a){f&&f(a.$stats)},c.$init=function(a){d&&d(a.$stats)},c}}]),angular.module("vgraph").factory("CalculationsExtremes",[function(){"use strict";function a(a){return function(b,c,d){var e,f;return{prep:function(){f=[]},reset:function(){f.forEach(function(a){a.node[d]=!1})},calc:function(d){var g=c(d);if(f.length<b)f.push({value:g,node:d}),f.length===b&&f.sort(function(a,b){return a.value-b.value});else if(a(g,f[0].value))if(f.shift(),a(f[0].value,g))f.unshift({value:g,node:d});else if(a(g,f[f.length-1].value))f.push({value:g,node:d});else for(e=f.length-2;e>=0;e--)a(g,f[e].value)&&(f.splice(e+1,0,{value:g,node:d}),e=0)},finalize:function(){f.forEach(function(a){a.node[d]=!0})}}}}return{maximum:a(function(a,b){return a>b}),minimum:a(function(a,b){return b>a})}}]),angular.module("vgraph").factory("CalculationsPercentiles",[function(){"use strict";return function(a,b,c){var d;return{prep:function(){d=[]},calc:function(a){d.push(b(a))},finalize:function(b){var e=Math.round(d.length*(a/100));d.sort(function(a,b){return a-b}),b[c]=d[e]}}}}]),angular.module("vgraph").factory("ComponentBox",["makeEventing",function(a){"use strict";function b(a,b){var c=b.padding,e=a.padding,f=b.margin,g=a.margin;g||(a.margin=g={top:0,right:0,bottom:0,left:0}),f&&(g.top=d(f.top,g.top),g.right=d(f.right,g.right),g.bottom=d(f.bottom,g.bottom),g.left=d(f.left,g.left)),e||(a.padding=e={top:0,right:0,bottom:0,left:0}),c&&(e.top=d(c.top,e.top),e.right=d(c.right,e.right),e.bottom=d(c.bottom,e.bottom),e.left=d(c.left,e.left)),a.outer||(a.outer={left:0,top:0}),a.outer.width=d(b.outer.width,a.outer.width)||0,a.outer.right=a.outer.width,a.outer.height=d(b.outer.height,a.outer.height)||0,a.outer.bottom=a.outer.height,a.top=g.top,a.bottom=a.outer.height-g.bottom,a.left=g.left,a.right=a.outer.width-g.right,a.width=a.right-a.left,a.height=a.bottom-a.top,a.center=(a.left+a.right)/2,a.middle=(a.top+a.bottom)/2,a.inner={top:a.top+e.top,bottom:a.bottom-e.bottom,left:a.left+e.left,right:a.right-e.right},a.inner.width=a.inner.right-a.inner.left,a.inner.height=a.inner.bottom-a.inner.top,a.ratio=a.outer.width+" x "+a.outer.height}function c(a){b(this,a||{outer:{}})}function d(a,b){return void 0!==a?parseInt(a):b}return a(c.prototype),c.prototype.targetSvg=function(a){this.$element=jQuery(a),this.resize()},c.prototype.resize=function(){var a=this.$element;a.attr("width",null).attr("height",null),a[0].style.cssText=null,b(this,{outer:{width:a.outerWidth(!0),height:a.outerHeight(!0)},margin:{top:a.css("margin-top"),right:a.css("margin-right"),bottom:a.css("margin-bottom"),left:a.css("margin-left")},padding:{top:a.css("padding-top"),right:a.css("padding-right"),bottom:a.css("padding-bottom"),left:a.css("padding-left")}}),a.css("margin","0").css("padding","0").attr("width",this.outer.width).attr("height",this.outer.height).css({width:this.outer.width+"px",height:this.outer.height+"px"}),this.inner.width&&this.inner.height&&this.$trigger("resize")},c}]),angular.module("vgraph").factory("ComponentChart",["$timeout","ComponentView","ComponentPage","ComponentBox","DataCollection","makeEventing","Scheduler","Hitbox","DomHelper",function(a,b,c,d,e,f,g,h,i){"use strict";function j(){var a=this;this.$vguid=++p,this.box=new d,this.views={},this.models=[],this.waiting={},this.references={},this.components=[],this.pristine=!1,this.loading=!0,this.message=null,this.$on("focus",function(b){b?a.highlightOn(b):a.highlightOff()})}function k(a){var b,c;a.forEach(function(a){var d=a.viewport;(void 0===b||b>d.minValue)&&(b=d.minValue),(void 0===c||c<d.maxValue)&&(c=d.maxValue)}),a.forEach(function(a){a.setViewportValues(b,c)})}function l(a){var b,c;a.forEach(function(a){var d=a.viewport;(void 0===b||b>d.minInterval)&&(b=d.minInterval),(void 0===c||c<d.maxInterval)&&(c=d.maxInterval)}),a.forEach(function(a){a.setViewportIntervals(b,c)})}function m(a){for(var b=0,c=[];a>b;)c.push([]),b++;return c}function n(a){var b,c;for(b=0,c=a.length;c>b;b++)a[b].push(null)}var o=new g,p=1;f(j.prototype),j.defaultView="default",j.prototype.reset=function(){this.settings={}},j.prototype.configure=function(a,c){var d,e=this.addView.bind(this);c||(c={}),this.reset(),this.settings.fitToPane=c.fitToPane,this.settings.adjustSettings=c.adjustSettings,this.page=a,this.zoom=a.getZoom(c.zoom),this.normalizeY=c.normalizeY,this.normalizeX=c.normalizeX,this.settings.x=b.parseSettingsX(c.x,this.settings.x),this.settings.y=b.parseSettingsY(c.y,this.settings.y),this.settings.x.scale=c.x?c.x.scale:null,this.settings.y.scale=c.y?c.y.scale:null,d=c.views,d?angular.isFunction(d)&&(d=d()):(d={},d[j.defaultView]={}),angular.forEach(d,e),c.onLoad&&c.onLoad(this),this.zoom.$on("update",this.rerender.bind(this))};var q=0;return j.prototype.getReference=function(a){var b,c;return c=angular.isString(a)?a:a.name,b=this.references[c],b||(b={$uid:q++,name:c,className:a.className?a.className:"node-"+c},this.references[c]=b),b},j.prototype.compileReference=function(a){var b;if("object"!=typeof a)return null;if(b=this.getReference(a),b.field=void 0===a.field?b.name:a.field,a.pointAs&&(b.pointAs=a.pointAs),b._field=b.field,b.$reset=function(){b.field=b._field},void 0===a.getValue?b.getValue=function(a){return a?a[b.field]:void 0}:a.getValue&&(b.getValue=function(b){return a.getValue(b,this.$view.normalizer.$stats)}),void 0===a.view?a.view=j.defaultView:a.view&&(a.view=a.view),a.view)b.view=a.view,b.$view=this.getView(a.view),b.$getNode=function(a){return this.$view.normalizer.$getNode(a)},b.$getClosest=function(a){return this.$view.normalizer.$getClosest(a,"$x")},b.$getValue=function(a){var b=this.$view.normalizer.$getNode(a);return b?this.getValue(b):void 0},b.$eachNode=function(a){this.$view.normalizer.$sort().forEach(a)},b.$getIndexs=function(){return this.$view.normalizer.$getIndexs()};else if(a.$getValue)b.$getValue=a.$getValue;else if(!b.$getValue)throw new Error("drawer reference requires view or $getValue");return a.isValid&&(b.isValid=a.isValid),a.classExtend&&(b.classExtend=a.classExtend),a.normalizerMap&&(b.normalizerMap=a.normalizerMap),a.requirements&&(b.requirements=a.requirements),a.normalizerFinalize&&(b.normalizerFinalize=a.normalizerFinalize),a.classify&&(b.classify=a.classify),a.mergeParsed&&(b.mergeParsed=a.mergeParsed),b},j.prototype.render=function(){var a,b=this,c=[],d=!1,e=0;this.$trigger("render");try{angular.forEach(this.views,function(b,c){a=c,b.parse()}),angular.forEach(this.views,function(b,e){a=e,b.hasData()?(c.push(b),d=!0):b.isReady()&&(d=!0)}),this.normalizeY&&k(c),this.normalizeX&&l(c)}catch(f){console.log("---parsing error---","view:"+a),console.log(f),console.log(f.stack)}e=c.length,this.loading=!d,o.startScript(this.$vguid),this.configureHitarea(),this.loading?(b.$trigger("loading"),o.func(function(){b.loading=!0,b.pristine=!1})):e?(o.func(function(){b.message=null}),o.loop(this.components,function(a){a.build&&a.build()}),o.loop(c,function(a){a.build()}),o.loop(this.components,function(a){a.process&&a.process()}),o.loop(c,function(a){a.process()}),o.loop(this.components,function(a){a.finalize&&a.finalize()}),o.loop(c,function(a){a.finalize(),b.$trigger("publish:"+a.$name,a.normalizer)}),o.func(function(){b.loading=!1,b.pristine=!0})):(b.$trigger("error"),o.func(function(){b.message="No Data Available",b.pristine=!1})),o.endScript(function(){b.rendered=!0,b.$trigger("done")},function(){b.$trigger("success",c[0])},function(){b.pristine=!1,b.message="Unable to Render",b.$trigger("error")}),o.run()},j.prototype.scheduleRender=function(b){var c=this;this.nrTimeout||(this.nrTimeout=a(function(){c.render(c.waiting,b),c.waiting={},c.nrTimeout=null},30))},j.prototype.rerender=function(a){this.rendered&&(this.scheduleRender(a),this.waiting=this.views)},j.prototype.needsRender=function(a,b){this.scheduleRender(b),this.waiting[a.name]||(this.waiting[a.name]=a)},j.prototype.getView=function(a){var c=this.views[a];return c||(c=new b,this.views[a]=c),c},j.prototype.addView=function(a,b){var c=this,d=this.settings,e=this.getView(b);e.configure(a,d,this.box,this.page,this.zoom),e.$name=b,e.manager.register(function(){c.needsRender(e)}),e.manager.onError(function(a){c.error(a)})},j.prototype.error=function(a){a?(this.loading=!1,this.message=a):this.message=null,this.$trigger("error")},j.prototype.registerComponent=function(a){this.components.push(a)},j.prototype.configureHitarea=function(){var a=this.box;this.hitbox=new h(a.left,a.right,a.top,a.bottom,10)},j.prototype.addHitbox=function(a,b){a.$element=b,this.hitbox.add(a)},j.prototype.highlightElements=function(a,b){var c=this.hitbox.checkX(a),d=this.hitbox.checkY(b),e=this.hitbox.checkHit(a,b);this.unlightElements(),i.addClass(c,"highlight-vertical").bringForward(c),i.addClass(d,"highlight-horizontal"),i.addClass(e,"highlight"),this.$trigger("publish:focus",e),this._activeElements={vertical:c,horizontal:d,intersections:e}},j.prototype.unlightElements=function(){var a=this._activeElements;a&&(i.removeClass(a.vertical,"highlight-vertical"),i.removeClass(a.horizontal,"highlight-horizontal"),i.removeClass(a.intersections,"highlight"))},j.prototype.highlightOn=function(a){var b=0,c=0,d={},e=this.references;angular.forEach(this.views,function(e,f){var g;e.components.length&&(d[f]=e.getPoint(a.x),g=d[f].$x,void 0!==g&&(c++,b+=g))}),d.$pos=b/c,d.pos=a,Object.keys(this.references).forEach(function(b){var c=e[b];c.pointAs&&(d[c.pointAs]=c.getValue(c.$getClosest(a.x)))}),this.$trigger("focus-point",d),this.$trigger("highlight",d),this.highlightElements(a.x,a.y)},j.prototype.highlightOff=function(){this.$trigger("publish:focus",null),this.$trigger("highlight",null),this.unlightElements()},j.prototype["export"]=function(a){var b,c,d,e=a.map(function(a){return a.title}),f=this.getReference.bind(this);return a.forEach(function(a){var c;a.$link=f(a.reference),a.$view=a.$link.$view,c=a.$view.getBounds(),a.$bounds=c,b?(b<c.max-c.min&&(b=c.max-c.min),d>c.interval&&(d=c.interval)):(b=c.max-c.min,d=c.interval)}),c=m(Math.ceil(b/d)),a.forEach(function(a){var d,e,f,g=a.$bounds.min,h=g+b,i=a.$bounds.interval;for(f=c[0].length,n(c),d=g;h>=d;d+=i)e=a.$view.manager.data.$getNode(d),e&&(e=e[a.field?a.field:a.reference],a.format&&(e=a.format(e)),c[Math.floor((d-g)/(h-g)*b+.5)][f]=e)}),c.unshift(e),c},j}]),angular.module("vgraph").factory("ComponentElement",["StatCalculations",function(a){"use strict";function b(a){return(new DOMParser).parseFromString('<g xmlns="http://www.w3.org/2000/svg">'+a+"</g>","image/svg+xml").childNodes[0].childNodes}function c(a,b,c){var d,e,f,g=a.element;for(g.innerHTML="",d=c.length-1;-1!==d;d--)f=b[d],e=c[d],a.drawer.getHitbox&&a.chart.addHitbox(a.drawer.getHitbox(f),e),g.appendChild(e),a.onAppend&&a.onAppend(e,f)}function d(){this.children=null}return d.svgCompile=b,d.prototype.setChart=function(a,b){this.chart=a,this.publish=b},d.prototype.setElement=function(a){this.element=a},d.prototype.setDrawer=function(a){var b=[],c=a.getReferences();this.drawer=a,c.forEach(function(a){a&&b.push(a)}),this.references=b},d.prototype.parse=function(){return a.limits(this.references)},d.prototype.build=function(){var d=this.drawer,e=a.indexs(this.references),f=d.makeSets(e);this.publish&&this.chart.$trigger("publish:"+this.publish,f),this.prepBuild&&this.prepBuild(f),"g"===this.element.tagName?c(this,f,b(this.make(f,d.makeElement.bind(d)).join(""))):this.element.setAttribute("d",this.make(f,d.makePath.bind(d)).join(""))},d.prototype.register=function(){},d.prototype.make=function(a,b){var c,d,e,f=[];for(c=0,d=a.length;d>c;c++)e=b(a[c]),e&&f.push(e);return f},d}]),angular.module("vgraph").factory("ComponentPage",["DataFeed","DataLoader","DataManager","ComponentZoom",function(a,b,c,d){"use strict";function e(){this.$$pageUid=f++,this.charts={},this.zooms={}}var f=1;return e.defaultManager="default",e.defaultZoom="default",e.prototype.reset=function(){var a=this.zooms,b=this.feed,c=this.loaders,d=this.managers;Object.keys(a).forEach(function(b){a[b].reset()}),c&&Object.keys(c).forEach(function(a){var b=c[a];Object.keys(b).forEach(function(a){b[a].$destroy()})}),this.loaders={},b&&Object.keys(b).forEach(function(a){b[a].$destroy()}),this.feeds={},d&&Object.keys(d).forEach(function(a){d[a].$destroy()}),this.managers={}},e.prototype.configure=function(a){var b,c,d,e,f,g;if(this.reset(),angular.isArray(a))for(b=0,c=a.length;c>b;b++)this.addFeed(a[b]);else{if(a.managers)for(e=Object.keys(a.managers),b=0,c=e.length;c>b;b++)d=e[b],f=a.managers[d],g=this.getManager(d),f.fill&&g.fillPoints(f.fill),f.calculations&&g.setCalculations(f.calculations);if(a.feeds)for(b=0,c=a.feeds.length;c>b;b++)this.addFeed(a.feeds[b])}},e.prototype.addFeed=function(c){var d,f,g,h,i=c.src||[];return c.manager||(c.manager=e.defaultManager),h=c.manager,i._$feedUid?d=this.feeds[i._$feedUid]:(d=new a(i,c.explode),this.feeds[d.$$feedUid]=d,i._$feedUid=d.$$feedUid),g=this.getManager(h),this.loaders[d.$$feedUid]||(this.loaders[d.$$feedUid]={}),f=this.loaders[d.$$feedUid][g.$$managerUid],f||(f=new b(d,g),this.loaders[d.$$feedUid][g.$$managerUid]=f),f.addConfig(c),i},e.prototype.getManager=function(a){var b=a||e.defaultManager,d=this.managers[b];return d||(d=new c,this.managers[b]=d),d},e.prototype.setChart=function(a,b){this.charts[a]=b},e.prototype.getChart=function(a){return this.charts[a]},e.prototype.getZoom=function(a){var b=a||e.defaultManager,c=this.zooms[b];return c||(c=new d,this.zooms[b]=c),c},e}]),angular.module("vgraph").factory("ComponentPane",[function(){"use strict";function a(a,b,c){this.x=b,this.y=c,this.fitToPane=a||!1,this._pane={},this._bounds={},b||(b={}),c||(c={}),this.setBounds({min:b.min,max:b.max},{min:c.min,max:c.max})}return a.prototype.setBounds=function(a,b){return this._bounds.x=a,this._bounds.y=b,this},a.prototype.setPane=function(a,b){return this._pane.x=a,this._pane.y=b,this},a.prototype.filter=function(a,b){var c,d,e,f,g,h,i=this.x,j=a.data;return j.length&&(a.clean(),c=this._bounds.x.min||j.$minIndex,d=this._bounds.x.max||j.$maxIndex,i.$min=c,i.$max=d,this._pane.x&&this._pane.x.max?(e=this._pane.x,g=c+e.min*(d-c),h=c+e.max*(d-c)):(g=c,h=d),b.$left=g,b.left=(g-c)/(d-c),b.$right=h,b.right=(h-c)/(d-c),f=j.$slice(g,h),this.fitToPane&&j.length>1&&(g>j.$minIndex&&f.$addNode(g,a.$makePoint(g),!0),h<j.$maxIndex&&f.$addNode(a.$makePoint(h))),f.$sort()),f},a}]),angular.module("vgraph").factory("ComponentView",["ComponentPane","DataNormalizer","CalculationsCompile",function(a,b,c){"use strict";function d(){this.$vgvid=g++,this.components=[],this.references=[]}function e(a,b){return b||(b={}),void 0!==a.min&&(b.min=a.min),void 0!==a.max&&(b.max=a.max),a.scale?b.scale=a.scale():b.scale||(b.scale=d3.scale.linear()),a.format?b.format=a.format:b.scale||(b.format=function(a){return a}),a.padding&&(b.padding=a.padding),a.tick&&(b.tick=a.tick),b}function f(a,b){a.normalizerMap&&b.addPropertyMap(a.normalizerMap),a.requirements?a.requirements.forEach(function(a){b.addPropertyCopy(a)}):null!==a.requirements&&b.addPropertyCopy(a.field),a.normalizerFinalize&&b.addPropertyFinalize(a.normalizerFinalize)}var g=1;return d.parseSettingsX=function(a,b){return a||(a={}),b=e(a,b),void 0!==a.minPane&&(b.minPane=a.minPane),void 0!==a.maxPane&&(b.maxPane=a.maxPane),void 0!==a.interval&&(b.interval=a.interval),b},d.parseSettingsY=function(a,b){return a||(a={}),e(a,b)},d.prototype.getBounds=function(){var a,b,c,d,e,f,g=this.manager.data;if(g.$sort(),this.x.interval)f=this.x.interval;else for(e=g[1]._$index,f=e-g[0]._$index,a=2,b=g.length;b>a;a++)c=g[a]._$index,d=c-e,f>d&&(f=d),e=c;return{min:void 0!==this.x.min?this.x.min:g[0]._$index,max:void 0!==this.x.max?this.x.max:g[g.length-1]._$index,interval:f}},d.prototype.configure=function(e,g,h,i,j){var k,l=this.references,m=Object.keys(this.references);this.x=d.parseSettingsX(g.x,this.x),d.parseSettingsX(e.x,this.x),this.y=d.parseSettingsY(g.y,this.y),d.parseSettingsY(e.y,this.y),this.box=h,this.manager=i.getManager(e.manager),this.normalizer=k=e.normalizer||new b(function(a){return Math.round(a)}),e.calculations&&(this.calculations=c(e.calculations)),m.forEach(function(a){f(l[a],k)}),this.adjustSettings=g.adjustSettings,this.pane=new a(g.fitToPane,this.x,this.y),this.x.max&&this.pane.setBounds({min:this.x.min,max:this.x.max}),this.pane.setPane({min:j.left,max:j.right}),j.$on("update",this.pane.setPane.bind(this.pane))},d.prototype.registerComponent=function(a){var b=this.normalizer,c=this.references;this.components.push(a),a.references&&a.references.forEach(function(a){c[a.name]||(c[a.name]=a,b&&f(a,b))})},d.prototype.isReady=function(){return this.manager&&this.manager.ready},d.prototype.hasData=function(){return this.isReady()&&this.manager.data.length},d.prototype._sample=function(){this.offset={},this.filtered=this.pane.filter(this.manager,this.offset)},d.prototype.isLeading=function(){return this.viewport&&this.viewport.maxInterval>this.filtered.$maxIndex},d.prototype.getLeading=function(){return this.normalizer[this.normalizer.length-1]},d.prototype.setViewportValues=function(a,b){var c,d=this.box;this.y.padding&&(c=b===a?a*this.y.padding:(b-a)*this.y.padding,b+=c,a-=c),this.viewport.minValue=a,this.viewport.maxValue=b,this.y.scale.domain([a,b]).range([d.inner.bottom,d.inner.top])},d.prototype.setViewportIntervals=function(a,b){var c=this.box,d=this.x.scale;this.viewport.minInterval=a,this.viewport.maxInterval=b,d.domain([a,b]).range([c.inner.left,c.inner.right])},d.prototype.parse=function(){var a,b,c,d;this.manager&&(c=this.manager.data,d=this.x.scale,this._sample(),this.filtered&&(this.viewport||(this.viewport={}),this.setViewportIntervals(this.offset.$left,this.offset.$right),this.normalizer.$reindex(this.filtered,d),this.calculations&&(this.calculations.$init(this.normalizer),this.calculations(this.normalizer)),this.components.forEach(function(c){var d;c.parse&&(d=c.parse(),d&&((d.min||0===d.min)&&(!a&&0!==a||a>d.min)&&(a=d.min),(d.max||0===d.max)&&(!b&&0!==b||b<d.max)&&(b=d.max)))}),void 0!==a&&(this.setViewportValues(a,b),this.adjustSettings&&this.adjustSettings(this.x,this.filtered.$maxIndex-this.filtered.$minIndex,b-a,c.$maxIndex-c.$minIndex))))},d.prototype.build=function(){this.components.forEach(function(a){a.build&&a.build()})},d.prototype.process=function(){this.components.forEach(function(a){a.process&&a.process()})},d.prototype.finalize=function(){this.components.forEach(function(a){a.finalize&&a.finalize()})},d.prototype.getPoint=function(a){return this.normalizer.$getClosest(a,"$x")},d}]),angular.module("vgraph").factory("ComponentZoom",["makeEventing",function(a){"use strict";function b(){this.reset()}return a(b.prototype),b.prototype.setRatio=function(a,b,c,d){a>b?(this.left=b,this.right=a):(this.left=a,this.right=b),d&&(c>d?(this.top=c,this.bottom=d):(this.top=d,this.bottom=c)),this.$trigger("update",{min:this.left,max:this.right},{min:this.bottom,max:this.top})},b.prototype.reset=function(){this.left=0,this.right=1,this.bottom=0,this.top=1},b}]),angular.module("vgraph").factory("DataBucketer",[function(){"use strict";function a(a,b){this._hasher=a,this._factory=b||function(){return[]},this.$reset()}return a.prototype=[],a.prototype.push=function(a){var b=this._insert(a);b&&Array.prototype.push.call(this,b)},a.prototype.unshift=function(a){var b=this._insert(a);b&&Array.prototype.unshift.call(this,b)},a.prototype._insert=function(a){var b=!1,c=this._hasher(a),d=this._$index[c];return d?void d.push(a):(b=!0,d=this._factory(c),this._$index[c]=d,this._$indexs.push(c),d.push(a),d)},a.prototype.$reset=function(){this.length=0,this._$index={},this._$indexs=[]},a.prototype.$getIndexs=function(){return this._$indexs},a.prototype.$getBucket=function(a){return this._$index[a]},a}]),angular.module("vgraph").factory("DataCollection",[function(){"use strict";function a(a,b,c,d){var e,f,g=0,h=a.length-1;if(d||a.sort(function(a,b){return c(a)-c(b)}),c(a[g])>=b)return{left:g,right:g};if(c(a[h])<=b)return{left:h,right:h};if(a.length){for(;h-g>1;)e=Math.floor((h+g)/2),f=c(a[e]),f===b?(h=e,g=e):f>b?h=e:g=e;return h!==e&&c(a[h])===b?{left:h,right:h}:g!==e&&c(a[g])===b?{left:g,right:g}:{left:g,right:h}}}function b(a){return null!==a&&void 0!==a&&"object"!=typeof a}function c(){this.$reset()}function d(a){return a||0===a}return c.prototype=[],c.isNumeric=b,c.isValid=d,c.prototype.$reset=function(){this.length=0,this.$dirty=!1,this.$stats={},this._$index={},this._$indexs=[]},c.prototype.addPropertyCopy=function(a){var b,c;this._copyProperties?(b=this._copyProperties,this._copyProperties=function(c,d){d[a]=c[a],b(c,d)},c=this._hasValue,this._hasValue=function(b){return d(b[a])?!0:c(b)}):(this._copyProperties=function(b,c){c[a]=b[a]},this._hasValue=function(b){return d(b[a])})},c.prototype.addPropertyMap=function(a){var b;this._mapProperties?(b=this._mapProperties,this._mapProperties=function(c,d){b(c,d),a(c,d)}):this._mapProperties=a},c.prototype._register=function(a,b,c){var d=+a;return this._$index[d]||(this._$indexs.push(d),this._$index[d]=b,c?(this.length&&d>this[0]._$index&&(this.$dirty=!0),this.unshift(b)):(this.length&&d<this[this.length-1]._$index&&(this.$dirty=!0),this.push(b)),(!this._hasValue||this._hasValue(b))&&(void 0===this.$minIndex?(this.$minIndex=d,this.$maxIndex=d):this.$maxIndex<d?this.$maxIndex=d:this.$minIndex>d&&(this.$minIndex=d)),b._$index=d),b},c.prototype._makeNode=function(a){var b=+a,c=this.$getNode(a);if(isNaN(b))throw new Error("index must be a number, not: "+a+" that becomes "+b);return c||(c={},this._register(b,c)),c},c.prototype.$getIndexs=function(){return this._$indexs},c.prototype.$getNode=function(a){return this._$index[a]},c.prototype._setValue=function(a,b,c){var e=a._$index;a.$setValue?a.$setValue(b,c):a[b]=c,d(c)&&(void 0===this.$minIndex?(this.$minIndex=e,this.$maxIndex=e):this.$maxIndex<e?this.$maxIndex=e:this.$minIndex>e&&(this.$minIndex=e))},c.prototype.$setValue=function(a,b,c){var d=this._makeNode(a);return this._setValue(d,b,c),d},c.prototype.$addNode=function(a,b,c){var d,e=+a;return d=this.$getNode(e),d?(d.$merge&&d.$merge(b),this._mapProperties&&this._mapProperties(b,d,e),this._copyProperties&&this._copyProperties(b,d,e)):(d=this.$makeNode?this.$makeNode(b):{},this._mapProperties&&this._mapProperties(b,d,e),this._copyProperties&&this._copyProperties(b,d,e),this._register(e,d,c)),d},c.prototype.$pos=function(b,c){var d;return c||(c="_$index"),this.$sort(),d=a(this,b,function(a){return a[c]},!0),d.field=c,d},c.prototype.$getClosestPair=function(a,b){var c=this.$pos(a,b);return{left:this[c.left],right:this[c.right],field:c.field}},c.prototype.$getClosest=function(a,b){var c,d,e=this.$getClosestPair(a,b);return c=a-e.left[e.field],d=e.right[e.field]-a,d>c?e.left:e.right},c.prototype.$sort=function(){return this.$dirty&&(this.sort(function(a,b){return a._$index-b._$index}),this.$dirty=!1),this},c.prototype.$slice=function(a,b){var d,e=-1,f=new c;this.$sort();do e++,d=this[e];while(d&&d._$index<a);for(;d&&d._$index<=b;)f.push(d),f._$index[d._$index]=d,f._$indexs.push(d._$index),e++,d=this[e];return f.$minIndex=f[0]._$index,f.$maxIndex=f[f.length-1]._$index,f.$dirty=!1,f.$stats=Object.create(this.$stats),f.$parent=this,f},c}]),angular.module("vgraph").factory("DataFeed",["makeEventing",function(a){"use strict";function b(a,b){this.explode=b,this.setSource(a),this.$$feedUid=c++}var c=1;return b.prototype.setSource=function(a){var b=this,c=a.push;this.data=a,this._readPos=0,a.push=function(){c.apply(this,arguments),b.$push()},a.$ready=function(){b.$trigger("ready")},a.$error=function(a){b.$trigger("error",a)},a.$reset=function(){b.$trigger("reset"),b._readPos=0,b.data.length=0},this.$push(),this.$destroy=function(){delete b.data,a.push=c}},a(b.prototype),b.prototype.$push=function(){var a=this;this._$push||(this._$push=setTimeout(function(){var b=a._readNext();for(b&&a.$trigger("ready");b;)a.$trigger("data",b),b=a._readNext();a._$push=null},5))},b.prototype._readAll=function(a){for(var b=this._read(0);b;)a(b),b=this._read(b.next)},b.prototype._readNext=function(){var a=this._read(this._readPos);return a&&(this._readPos=a.next),a},b.prototype._read=function(a){var b,c=this.data,d=this.explode;return!c.length||a>=c.length?null:d?(b=c[a],{points:d(b),next:a+1,ref:b}):{points:c.slice(a),next:c.length}},b}]),angular.module("vgraph").factory("DataLoader",[function(){"use strict";function a(a,c){var d=this,e=[],f=this._process.bind(this),g=a.$on("ready",function(){d.ready=!0}),h=a.$on("data",function(a){var b,c,d,g;for(b=0,c=a.points.length;c>b;b++)for(d=0,g=e.length;g>d;d++)f(e[d],a.points[b])}),i=a.$on("error",function(a){c.setError(a)}),j=a.$on("reset",function(){c.reset(),d.ready=!1});this.$$loaderUid=b++,this.feed=a,this.confs=e,this.dataManager=c,c.$follow(this),this.$destroy=function(){c.$ignore(this),i(),j(),g(),h()}}var b=1;return a.prototype.addConfig=function(a){var b,c=this._process.bind(this);Object.keys(a.readings).forEach(function(c){var d=b,e=a.readings[c];
b=d?function(a,b,f){var g=b[c];d(a,b,f),void 0!==g&&f.setValue(a,e,g)}:function(a,b,d){var f=b[c];void 0!==f&&d.setValue(a,e,f)}}),a.reader=b,a.parseInterval||(a.parseInterval=function(b){return+b[a.interval]}),this.feed._readAll(function(b){var d,e,f=b.points;for(d=0,e=f.length;e>d;d++)c(a,f[d])}),this.confs.push(a)},a.prototype.removeConf=function(){},a.prototype._process=function(a,b){var c;if(!a.isDefined||a.isDefined(b))try{c=a.parseInterval(b),a.reader(c,b,this.dataManager)}catch(d){console.log("failed to load",b,c),console.log("conf:",a),console.log(d)}},a}]),angular.module("vgraph").factory("DataManager",["DataCollection","CalculationsCompile",function(a,b){"use strict";function c(){var a=[];this.registrations=[],this.errorRegistrations=[],this.$$managerUid=e++,this.$dataProc=d(20,200,function(a){a.calculations&&(a.calculations.$reset(a.data),a.calculations(a.data)),a.registrations.forEach(function(a){a()})}),this.getLoaders=function(){return a},this.$follow=function(b){a.push(b)},this.$ignore=function(b){var c=a.indexOf(b);-1!==c&&a.splice(c,1)},this.reset()}function d(a,b,c,d){function e(){var b=+new Date;b>h||b>g?(h=null,c.apply(d,f)):setTimeout(e,a)}var f,g,h;return function(){var c=+new Date;g=c+a,f=arguments,h||(h=c+b,setTimeout(e,a))}}var e=1;return c.prototype.$destroy=function(){this.reset()},c.prototype.reset=function(){this.data=new a,this.ready=!1,this.dataReady(!0)},c.prototype.fillPoints=function(a){var b,c,d=a.prototype;for(this.filling=a,d||(d={}),b=a.start,c=a.stop+a.interval;c>b;b+=a.interval)this.data._register(b,Object.create(d))},c.prototype.setCalculations=function(a){this.calculations=b(a),this.calculations.$init(a)},c.prototype.setValue=function(a,b,c){return this.filling&&(a<this.filling.min||a>this.filling.max||(a-this.filling.min)%this.filling.interval!==0)?void 0:(this.dataReady(),this.ready||!c&&0!==c||(this.ready=!0),this.data.$setValue(a,b,c))},c.prototype.dataReady=function(a){var b=this.registrations;a?b.forEach(function(a){a()}):this.$dataProc(this)},c.prototype.onError=function(a){this.errorRegistrations.push(a)},c.prototype.setError=function(a){var b,c;for(b=0,c=this.errorRegistrations.length;c>b;b++)this.errorRegistrations[b](a)},c.prototype.getNode=function(a){return this.dataReady(),this.data.$getNode(a)},c.prototype.removePlot=function(){},c.prototype.register=function(a){this.registrations.push(a)},c.prototype.clean=function(){this.data.$sort()},c.prototype.$makePoint=function(a){var b,c,d,e,f=this.data.$pos(a,"_$index");return f.right===f.left?this.data[f.right]:(b=this.data[f.right],c=this.data[f.left],d={},e=(a-c._$index)/(b._$index-c._$index),Object.keys(b).forEach(function(a){var f=c[a],g=b[a];void 0!==f&&null!==f&&void 0!==g&&null!==g&&(d[a]=f+(g-f)*e)}),d.$faux=!0,d._$index=a,d)},c}]),angular.module("vgraph").factory("DataNormalizer",["DataCollection",function(a){"use strict";function b(b){this.$modelUid=c++,this.$grouper=b,a.call(this),this._finalizeProperties=function(a){a.$x=a.$x/a.$count}}var c=1;return b.prototype=new a,b.prototype.addPropertyFinalize=function(a){var b=this._finalizeProperties;this._finalizeProperties=function(c){b(c),a(c)}},b.prototype.$latestNode=function(b){for(var c,d=this.length-1;d;){if(c=this[d],a.isValid(c[b]))return c;d--}},b.prototype.$reindex=function(a,b){var c,d,e,f,g,h,i,j=this.$grouper;for(this.$reset(),a.$sort(),c=0,d=a.length;d>c;c++)g=a[c],h=g._$index,i=b(g._$index),f=j(i),e=this.$addNode(f,g),void 0===e.$minIndex?(e.$x=i,e.$minIndex=h,e.$xMin=i,e.$maxIndex=h,e.$xMax=i,e.$count=1):(e.$x+=i,e.$maxIndex=h,e.$xMax=i,e.$count++);for(c=0,d=this.length;d>c;c++)g=this[c],g.$avgIndex=(g.$minIndex+g.$maxIndex)/2,this._finalizeProperties(g);this.$stats=Object.create(a.$stats),this.$parent=a},b}]),angular.module("vgraph").factory("DrawBar",["DrawLinear",function(a){"use strict";function b(a,b,c){this.width=c,this.top=a,b?(this.bottom=b,this.references=[a,b]):(this.bottom=a,this.references=[a])}function c(a,b,c,d,e){var f;return a>b&&(f=a,a=b,b=f),c>d&&(f=c,c=d,d=f),void 0===e.x1?(e.x1=a,e.x2=b,e.y1=c,e.y2=d):(e.x1>a&&(e.x1=a),b>e.x2&&(e.x2=b),e.y1>c&&(e.y1=c),d>e.y2&&(e.y2=d)),e}var d=a.isNumeric;return b.prototype=new a,b.prototype.makeSet=function(){return{}},b.prototype.isValidSet=function(a){return void 0!==a.x1},b.prototype.parse=function(a){var b,c,e,f,g,h,i=this.top.$getNode(a);return e=this.top.getValue(i),f=this.bottom!==this.top?this.bottom.$getValue(a):this.bottom.$view.viewport.minValue,h=this.width?parseInt(this.width,10)/2:3,d(e)&&d(f)&&e!==f&&(b=i.$x-h,c=i.$x+h,g={$classify:this.top.classify?this.top.classify(i,this.bottom.$getNode(a)):null,x1:b<i.$xMin?b:i.$xMin,x2:c>i.$xMax?i.$xMax:c,y1:e,y2:f}),g},b.prototype.mergeParsed=function(a,b){var d=a.x1,e=a.x2,f=a.y1,g=a.y2;return null!==f&&null!==g&&(f=void 0===f?b.y1:this.top.$view.y.scale(f),g=void 0===g?b.y2:this.bottom.$view.y.scale(g),c(d,e,f,g,b)),0},b.prototype.makePath=function(a){return a?"M"+(a.x1+","+a.y1)+"L"+(a.x2+","+a.y1)+"L"+(a.x2+","+a.y2)+"L"+(a.x1+","+a.y2)+"Z":void 0},b.prototype.makeElement=function(a){var b="";return a?(a.$classify&&(b=Object.keys(a.$classify).join(" ")),'<rect class="'+b+'" x="'+a.x1+'" y="'+a.y1+'" width="'+(a.x2-a.x1)+'" height="'+(a.y2-a.y1)+'"/>'):void 0},b.prototype.getHitbox=function(a){return a},b}]),angular.module("vgraph").factory("DrawBox",["DrawBar",function(a){"use strict";function b(a){this.top=a,this.bottom=a,this.references=[a]}return b.prototype=new a,b.prototype.parse=function(a){var b,c,d=this.top.$getNode(a);return this.top.isValid(d)?(this.top.getValue?(c=this.top.getValue(d),b={x1:d.$x,x2:d.$x,y1:c,y2:c}):b={x1:d.$x,x2:d.$x,y1:this.top.$view.viewport.minValue,y2:this.top.$view.viewport.maxValue},b.$classify=this.top.classify?this.top.classify(d):null,b):void 0},b.prototype.mergeParsed=function(b,c){return!b.y1&&0!==b.y1||!b.y2&&0!==b.y2?0:(a.prototype.mergeParsed.call(this,b,c),-1)},b}]),angular.module("vgraph").factory("DrawDots",["DrawLinear",function(a){"use strict";function b(a,b){this.ref=a,this.radius=b,this.references=[a]}return b.prototype=new a,b.prototype.makeSet=function(){return{}},b.prototype.parse=function(a){var b=this.ref.$getNode(a),c=this.ref.getValue(b);return c||0===c?{$classify:this.ref.classify?this.ref.classify(b):null,x:b.$x,y:c}:void 0},b.prototype.mergeParsed=function(a,b){return b.x=a.x,b.y=this.ref.$view.y.scale(a.y),0},b.prototype.makePath=function(a){var b=this.radius,c=2*b;return void 0!==a.x?"M"+a.x+" "+a.y+"m -"+b+", 0a "+b+","+b+" 0 1,1 "+c+",0a "+b+","+b+" 0 1,1 -"+c+",0":void 0},b.prototype.makeElement=function(a){var b="";return void 0!==a.x?(a.$classify&&(b=Object.keys(a.$classify).join(" ")),'<circle class="'+b+'" cx="'+a.x+'" cy="'+a.y+'" r="'+this.radius+'"/>'):void 0},b.prototype.getHitbox=function(a){var b=this.radius;return{x1:a.x-b,x2:a.x+b,y1:a.y-b,y2:a.y+b,intersect:function(c,d){return Math.sqrt(Math.pow(a.x-c,2)+Math.pow(a.y-d,2))<=b}}},b}]),angular.module("vgraph").factory("DrawFill",["DrawLinear",function(a){"use strict";function b(a,b){this.top=a,b?(this.bottom=b,this.references=[a,b]):(this.bottom=a,this.references=[a])}var c=a.isNumeric;return b.prototype=new a,b.prototype.parse=function(a){var b,d,e=this.top.$getNode(a);return b=this.top.getValue(e),d=2===this.references.length?this.bottom.$getValue(a):this.bottom.$view.viewport.minValue,c(b)&&c(d)?{$classify:this.top.classify?this.top.classify(e,this.bottom.$getNode(a)):null,x:e.$x,y1:b,y2:d}:void 0},b.prototype.mergeParsed=function(b,c){var d=b.x,e=b.y1,f=b.y2,g=c[c.length-1];return a.isNumeric(e)&&a.isNumeric(f)?(c.push({x:d,y1:this.top.$view.y.scale(e),y2:this.bottom.$view.y.scale(f)}),-1):g&&null!==e&&null!==f?(e=void 0===e?g.y1:this.top.$view.y.scale(e),f=void 0===f&&g?g.y2:this.bottom.$view.y.scale(f),c.push({x:d,y1:e,y2:f}),-1):0},b.prototype.makePath=function(a){var b,c,d,e=[],f=[];if(a.length){for(b=0,c=a.length;c>b;b++)d=a[b],e.push(d.x+","+d.y1),f.unshift(d.x+","+d.y2);return"M"+e.join("L")+"L"+f.join("L")+"Z"}},b.prototype.makeElement=function(a){var b="";return a.length?(a.$classify&&(b=Object.keys(a.$classify).join(" ")),'<path class="'+b+'" d="'+this.makePath(a)+'"></path>'):void 0},b}]),angular.module("vgraph").factory("DrawHeatmap",["DataBucketer",function(a){"use strict";function b(b,c,d,e,f){var g,h;this.area=c,this.templates=d,this.references=[b],f||(g=Object.keys(e),f={x:g[0],y:g[1]}),this.bucketer=h=new a(e[f.x],function(){return new a(e[f.y])})}return b.prototype.getReferences=function(){return this.references},b.prototype.makeSets=function(a){var b,c,d,e,f,g,h,i,j=this.references[0],k=[],l=[],m=this.area,n=this.bucketer;return n.$reset(),a.forEach(function(a){n.push(j.$getNode(a))}),this.labels||(this.labels={}),this.labels.x?h=this.labels.x:(h={},n.$getIndexs().forEach(function(a){h[a]=a})),this.labels.y?i=this.labels.y:(i={},n.forEach(function(a){a.$getIndexs().forEach(function(a){i[a]=a})})),f=Object.keys(h).length+1,g=Object.keys(i).length+1,d=(m.x2-m.x1)/f,e=(m.y2-m.y1)/g,b=m.x1+d,Object.keys(h).forEach(function(a){var c=b+d;k.push({type:"x",x1:b,x2:c,y1:m.y1,y2:m.y1+e,width:d,height:e,text:h[a]}),b=c}),c=m.y1+e,Object.keys(i).forEach(function(a){var b=c+e;k.push({type:"y",x1:m.x1,x2:m.x1+d,y1:c,y2:b,width:d,height:e,text:i[a]}),c=b}),b=m.x1+d,Object.keys(h).forEach(function(a){var f=[],g=b+d;l.push(f),c=m.y1+e,Object.keys(i).forEach(function(h){var i=c+e,j=n.$getBucket(a).$getBucket(h);f.push(j),k.push({type:"cell",x1:b,x2:g,y1:c,y2:i,data:j,width:d,height:e}),c=i}),b=g}),k.$grid=l,k},b.prototype.makePath=function(a){return a?"M"+(a.x1+","+a.y1)+"L"+(a.x2+","+a.y1)+"L"+(a.x2+","+a.y2)+"L"+(a.x1+","+a.y2)+"Z":void 0},b.prototype.makeElement=function(a){var b,c="";return a?(a.$classify&&(c=Object.keys(a.$classify).join(" ")),a.$className&&(c+=" "+a.$className),"cell"===a.type?(b=this.templates.cell,c+=" bucket"):(b="x"===a.type?this.templates.xHeading:this.templates.yHeading,c+=" heading axis-"+a.type),'<g class="'+c+'" transform="translate('+a.x1+","+a.y1+')"><rect x="0" y="0'+(a.$color?'" style="fill:'+a.$color:"")+'" width="'+(a.x2-a.x1)+'" height="'+(a.y2-a.y1)+'"/>'+b+"</g>"):void 0},b.prototype.getHitbox=function(a){return a},b}]),angular.module("vgraph").factory("DrawIcon",["DrawBox",function(a){"use strict";function b(a,b,c){this.top=a,this.bottom=a,this.references=[a],this.box=b,this.template=c}return b.prototype=new a,b.prototype.makeElement=function(a){var b,c;return a?(b=(a.x1+a.x2-this.box.width)/2,c=(a.y1+a.y2-this.box.height)/2,'<g transform="translate('+b+","+c+')">'+this.template+"</g>"):void 0},b}]),angular.module("vgraph").factory("DrawLine",["DrawLinear",function(a){"use strict";function b(a){var b=this.mergeParsed;this.ref=a,this.references=[a],a.mergeParsed&&(this.mergeParsed=function(c,d){return a.mergeParsed.call(this,c,d,b)})}function c(a,b){for(var c,d=b-1,e=a[b];a[d].$faux;)d--;for(c=(e.y-a[d].y)/(d-b),b-=1;b>d;b--)a[b].y=a[b+1].y+c;return d}var d=a.isNumeric;return b.prototype=new a,b.prototype.parse=function(a){var b=this.ref.$getNode(a);return{$classify:this.ref.classify?this.ref.classify(b):null,x:b.$x,y:this.ref.getValue(b)}},b.prototype.mergeParsed=function(a,b){var c=a.x,e=a.y,f=b[b.length-1];return d(e)?(b.push({x:c,y:this.ref.$view.y.scale(e)}),-1):f&&void 0===e?(b.push({$faux:!0,x:c,y:f.y}),-1):0},b.prototype.finalizeSet=function(a){for(var b;a[a.length-1].$faux;)a.pop();for(b=a.length-1;b>-1;b--)a[b].$faux&&(b=c(a,b+1));return a},b.prototype.makePath=function(a){var b,c,d,e=[];if(a.length){for(b=0,c=a.length;c>b;b++)d=a[b],e.push(d.x+","+d.y);return"M"+e.join("L")}},b.prototype.makeElement=function(a){var b="";return a.length?(a.$classify&&(b=Object.keys(a.$classify).join(" ")),'<path class="'+b+'" d="'+this.makePath(a)+'"></path>'):void 0},b}]),angular.module("vgraph").factory("DrawLinear",[function(){"use strict";function a(){this.references=[]}return a.isNumeric=function(a){return null===a?!1:Number.isFinite?Number.isFinite(a)&&!Number.isNaN(a):isFinite(a)&&!isNaN(a)},a.prototype.getReferences=function(){return this.references},a.prototype.parse=function(a){return a},a.prototype.makeSet=function(){return[]},a.prototype.mergeParsed=function(a,b){return a?(b.push(b),!1):!0},a.prototype.isValidSet=function(a){return 0!==a.length},a.prototype.finalizeSet=function(a){return a},a.prototype.makeSets=function(a){function b(){g=h.mergeParsed(f,i),1!==g&&f.$classify&&(i.$classify||(i.$classify={}),Object.keys(f.$classify).forEach(function(a){i.$classify[a]=!0}))}var c,d,e,f,g,h=this,i=this.makeSet(),j=[];for(c=0,d=a.length;d>c;c++)e=a[c],f=this.parse(e),f?b():g=0,g>-1&&(this.isValidSet(i)&&j.push(this.finalizeSet(i)),i=this.makeSet(),g&&b());return this.isValidSet(i)&&j.push(this.finalizeSet(i)),j},a.prototype.makeElement=function(a){return console.log("makeElement",a),"<text>Element not overriden</text>"},a.prototype.makePath=function(a){return console.log("makePath",a),"M0,0Z"},a}]),angular.module("vgraph").factory("DrawPie",[function(){"use strict";function a(a,b,c,d){var e=(d-90)*Math.PI/180;return{x:a+c*Math.cos(e),y:b+c*Math.sin(e)}}function b(a,b,c,d,e,f){var g=f?"1":"0";return"M"+a+","+b+"L"+d.x+","+d.y+"A"+c+","+c+" 0 "+g+" 0 "+e.x+","+e.y+"Z"}function c(a,b,c){function d(b,d){var e=c(b,d);return void 0!==e?{bucket:a,value:e}:void 0}return b?function(a,c){return d(a,c)||b(a,c)}:d}function d(a,b,d){var e;this.area=d,this.buckets=Object.keys(b),this.references=[a],this.buckets.forEach(function(a){e=c(a,e,b[a])}),this.parse=function(b){var c=a.$getNode(b);return e(c,a.getValue(c))}}function e(a,b,c){return a>b&&a>c?a:b>c?b:c}function f(a,b,c){return b>a&&c>a?a:c>b?b:c}function g(a,b,c,d,g,h,i){var j=a,k=a,l=b,m=b;return(0===g||360===i)&&(l=b-c),90>=g&&i>=90&&(k=a+c),180>g&&i>=180&&(m=b+c),270>=g&&i>=270&&(j=a-c),{minX:f(j,d.x,h.x),maxX:e(k,d.x,h.x),minY:f(l,d.y,h.y),maxY:e(m,d.y,h.y)}}return d.prototype.getReferences=function(){return this.references},d.prototype.makeSets=function(a){var b,c,d,e=[],f=0,g={};for(b=0,c=a.length;c>b;b++)d=this.parse(a[b]),d&&(g[d.bucket]?g[d.bucket]+=d.value:g[d.bucket]=d.value);return Object.keys(g).forEach(function(a){var b=f,c=g[a];f+=c,e.push({value:c,bucket:a,start:b,stop:f})}),e.forEach(function(a){a.total=f}),e},d.prototype.makePath=function(c){var d=this.area.x||0,e=this.area.y||0,f=this.area.radius||1,g=c.start/c.total*360,h=c.stop/c.total*360,i=a(d,e,f,h),j=a(d,e,f,g),k=h-g>180;return c.value?(c.$start=i,c.$startAngle=g,c.$stop=j,c.$stopAngle=h,b(d,e,f,i,j,k)):void 0},d.prototype.makeElement=function(a){var b=a.bucket;return a.value?'<path class="slice '+b+'" d="'+this.makePath(a)+'"/>':void 0},d.prototype.getHitbox=function(a){var b=this.area.x||0,c=this.area.y||0,d=a.$startAngle,e=a.$stopAngle,f=this.area.radius||1,h=g(b,c,f,a.$start,d,a.$stop,e);return a.x1=h.minX,a.x2=h.maxX,a.y1=h.minY,a.y2=h.maxY,a.intersect=function(a,g){var h,i=a-b,j=g-c;return Math.sqrt(Math.pow(i,2)+Math.pow(j,2))<=f?(h=180*Math.atan(j/i)/Math.PI,h=a===b?c>g?0:180:g===c?b>a?270:90:a>b?c>g?90+h:90+h:270+h,h>=d&&e>=h):!1},a},d}]),angular.module("vgraph").directive("vgraphAxis",[function(){"use strict";function a(a,b){return!(a.bottom<b.top||a.top>b.bottom||a.right<b.left||a.left>b.right)}return{scope:{orient:"=vgraphAxis",adjust:"=axisAdjust",rotation:"=tickRotation"},require:["^vgraphChart"],link:function(b,c,d,e){function f(){D.attr("visibility","hidden")}var g,h,i,j,k,l,m,n,o,p,q,r=e[0],s=r.getView(d.view||"default"),t=r.box,u=d3.svg.axis(),v="axis",w=0,x=null,y=!0,z=!1,A=parseInt(d.tickLength)||0,B=parseInt(d.tickPadding)||3,C=parseInt(d.tickMargin)||0,D=d3.select(c[0]);switch(D.attr("visibility","hidden"),l=D.append("g").attr("class","ticks"),p=D.append("g").attr("class","padding"),m=p.append("g").attr("class","tick-marks"),n=p.append("rect").attr("class","tick-margin"),q=D.append("g").attr("class","label-wrap"),d.tickRotation&&(x=parseInt(d.tickRotation,10)%360),d.labelOffset&&(w=b.$eval(d.labelOffset)),d.labelClean&&(y=b.$eval(d.labelClean)),d.labelEndpoints&&(z=b.$eval(d.labelEndpoints)),d.axisLabel&&(o=q.append("text").attr("class","axis-label label"),b.$parent.$watch(d.axisLabel,function(a){o.text(a)})),h=function(){d.tickMarks?(u.tickValues(b.$eval(d.tickMarks)),k=[]):d.tickCount?(u.ticks(b.$eval(d.tickCount)),k=[]):(u.ticks(10),k=[])},b.orient){case"top":g=function(){var a;if(D.attr("class",v+" x top").attr("transform","translate("+t.left+","+(t.top-A)+")").attr("width",t.width).attr("height",t.padding.top),o&&o.attr("text-anchor","middle").attr("x",t.width/2).attr("y",t.padding.top-w),C&&n.attr("height",C).attr("width",t.inner.width).attr("x",0).attr("y",-C),m.attr("transform","translate(-"+t.margin.left+",0)"),k&&(u.orient("top").tickFormat(s.x.format).innerTickSize(-(t.inner.height+A+C)).outerTickSize(0).tickPadding(B+A+C).scale(s.x.scale),s.x.tick&&u.ticks(s.x.tick.interval,s.x.tick.step),l.attr("transform","translate(-"+t.margin.left+","+t.padding.top+")").call(u),a=D.selectAll("g.axis-cap").data(s.x.scale.domain()),z&&(a.enter().append("g").attr("class",function(a,b){return"axis-cap "+(b?"axis-max":"axis-min")}).append("text"),a.exit().remove(),a.attr("transform",function(a){return"translate("+(s.x.scale(a)-t.margin.left)+",0)"}).select("text").text(function(a){var b=s.x.format(a);return(""+b).match("NaN")?"":b}).attr("dy","-0.25em").attr("y",t.padding.top).attr("text-anchor","middle")),x)){if(null===l.select(".tick text")[0][0])return;l.selectAll(".tick text").attr("transform","translate(0,"+l.select(".tick text").attr("y")+") rotate("+x+",0,0)").attr("y","0").style("text-anchor",x%360>0?"end":"start"),a.select("text").attr("transform","rotate("+x+",0,0)").style("text-anchor",b.rotation%360>0?"end":"start")}};break;case"bottom":g=function(){var a;if(D.attr("class",v+" x bottom").attr("transform","translate("+t.left+","+t.inner.bottom+")").attr("width",t.width).attr("height",t.padding.bottom),o&&o.attr("text-anchor","middle").attr("x",t.width/2).attr("y",t.padding.bottom+w),C&&n.attr("height",C).attr("width",t.inner.width).attr("x",0).attr("y",0),m.attr("transform","translate(-"+t.margin.left+",0)"),k&&(u.orient("bottom").tickFormat(s.x.format).innerTickSize(t.inner.height+A+C).outerTickSize(0).tickPadding(B+A+C).scale(s.x.scale),s.x.tick&&u.ticks(s.x.tick.interval,s.x.tick.step),l.attr("transform","translate(-"+t.margin.left+","+-t.inner.height+")").call(u),a=D.selectAll("g.axis-cap").data(s.x.scale.domain()),z&&(a.enter().append("g").attr("class",function(a,b){return"axis-cap "+(b?"axis-max":"axis-min")}).append("text"),a.exit().remove(),a.attr("transform",function(a){return"translate("+(s.x.scale(a)-t.margin.left)+",0)"}).select("text").text(function(a){var b=s.x.format(a);return(""+b).match("NaN")?"":b}).attr("dy","1em").attr("y",0).attr("text-anchor","middle")),x)){if(null===l.select(".tick text")[0][0])return;l.selectAll(".tick text").attr("transform",function(){return"translate(0,"+d3.select(this).attr("y")+") rotate("+x+",0,0)"}).attr("y","0").style("text-anchor",x%360>0?"start":"end"),a.select("text").attr("transform","rotate("+x+",0,0)").style("text-anchor",b.rotation%360>0?"start":"end")}};break;case"right":g=function(){var a;D.attr("class",v+" y right").attr("transform","translate("+A+","+t.top+")").attr("width",t.padding.right).attr("height",t.height),q.attr("transform","translate("+(t.right-t.padding.right)+","+t.height+") rotate( 90 )"),o&&o.attr("text-anchor","middle").attr("x",-(t.height/2)).attr("y",-w),C&&n.attr("height",t.inner.height).attr("width",C).attr("x",-C).attr("y",0),m.attr("transform","translate(-"+t.padding.right+","+(-t.top||0)+")"),k&&(u.orient("right").tickFormat(s.y.format).innerTickSize(-(t.inner.width+A+C)).outerTickSize(0).tickPadding(B+A+C).scale(s.y.scale),s.y.tick&&u.ticks(s.y.tick.interval,s.y.tick.step),l.attr("transform","translate("+t.inner.right+","+(-t.top||0)+")"),l.call(u),l.select(".domain").attr("transform","translate("+(A+C)+",0)"),z&&(a=D.selectAll("g.axis-cap").data(s.y.scale.domain()),a.enter().append("g").attr("class",function(a,b){return"axis-cap "+(b?"axis-max":"axis-min")}).append("text"),a.exit().remove(),a.attr("transform",function(a){return"translate(0,"+(s.y.scale(a)-t.margin.top)+")"}).select("text").text(function(a){var b=s.y.format(a);return(""+b).match("NaN")?"":b}).attr("dy",".25em").attr("x",t.padding.left-u.tickPadding()).attr("text-anchor","end")))};break;case"left":g=function(){var a;D.attr("class",v+" y left").attr("transform","translate("+t.left+","+t.top+")").attr("width",t.padding.left).attr("height",t.height),q.attr("transform","translate("+t.padding.left+","+t.height+") rotate( -90 )"),o&&o.attr("text-anchor","middle").attr("x",t.height/2).attr("y",-w),C&&n.attr("height",t.inner.height).attr("width",C).attr("x",-C).attr("y",0),m.attr("transform","translate("+t.padding.left+","+(-t.top||0)+")"),k&&(u.orient("left").tickFormat(s.y.format).innerTickSize(-(t.inner.width+A+C)).outerTickSize(0).tickPadding(B+A+C).scale(s.y.scale),s.y.tick&&u.ticks(s.y.tick.interval,s.y.tick.step),l.attr("transform","translate("+(t.padding.left-A-C)+","+(-t.top||0)+")").call(u),l.select(".domain").attr("transform","translate("+(A+C)+",0)"),z&&(a=D.selectAll("g.axis-cap").data(s.y.scale.domain()),a.enter().append("g").attr("class",function(a,b){return"axis-cap "+(b?"axis-max":"axis-min")}).append("text"),a.exit().remove(),a.attr("transform",function(a){return"translate(0,"+(s.y.scale(a)-t.margin.top)+")"}).select("text").text(function(a){var b=s.y.format(a);return(""+b).match("NaN")?"":b}).attr("dy",".25em").attr("x",t.padding.left-u.tickPadding()).attr("text-anchor","end")))}}b.$on("$destroy",r.$subscribe({error:f,loading:f})),r.registerComponent({build:function(){void 0===k&&h(),g()},process:function(){k.length=0,A&&(l.selectAll(".tick text").each(function(a){k.push({el:this,val:a,position:this.getBoundingClientRect()})}),k.sort(function(a,b){var c=a.position.top-b.position.top;return c?c:a.position.left-b.position.left})),y&&(i=D.select(".axis-min text").node(),i&&(i=i.getBoundingClientRect()),j=D.select(".axis-max text").node(),j&&(j=j.getBoundingClientRect()))},finalize:function(){var b,c,d,e,f,g,h=s.filtered,l={};if(!h||!h.length)return void D.attr("visibility","hidden");for(D.attr("visibility",""),m.selectAll("line").remove(),e=0,f=k.length;f>e;e++)b=!0,c=k[e],d=c.position,y&&i&&(a(d,i)||a(d,j))?(c.el.setAttribute("class","collided"),b=!1):void 0===l.left?(l.left=d.left,l.right=d.right,l.width=d.width,l.top=d.top,l.bottom=d.bottom,l.height=d.height,c.el.setAttribute("class","")):y&&a(d,l)?(c.el.setAttribute("class","collided"),b=!1):(g=!1,d.left<l.left&&(l.left=d.left,g=!0),d.right>l.right&&(l.right=d.right,g=!0),g&&(l.width=l.right-l.left,g=!1),d.top<l.top&&(l.top=d.top,g=!0),d.bottom>l.bottom&&(l.bottom=d.bottom,g=!0),g&&(l.height=l.bottom-l.top),c.el.setAttribute("class",""))}},"axis-"+b.orient)}}}]),angular.module("vgraph").directive("vgraphBar",["DrawBar","ComponentElement",function(a,b){"use strict";return{scope:{config:"=vgraphBar",pair:"=?pair"},require:["^vgraphChart","vgraphBar"],controller:b,link:function(b,c,d,e){var f=c[0],g=e[0],h=e[1],i="bar ";h.setChart(g),h.setElement(f),b.$watch("config",function(c){var e=g.compileReference(c),j=g.compileReference(b.pair);e&&(h.setDrawer(new a(e,j,d.width)),e.classExtend&&(i+=e.classExtend+" "),i+=d.className||e.className,f.setAttribute("class",i),e.$view.registerComponent(h))})}}}]),angular.module("vgraph").directive("vgraphBox",["DrawBox","ComponentElement",function(a,b){"use strict";return{scope:{config:"=vgraphBox"},require:["^vgraphChart","vgraphBox"],controller:b,link:function(b,c,d,e){var f=c[0],g=e[0],h=e[1],i="box ";h.setChart(g),h.setElement(f),b.$watch("config",function(b){var c=g.compileReference(b);c&&(h.setDrawer(new a(c)),c.classExtend&&(i+=c.classExtend+" "),i+=d.className||c.className,f.setAttribute("class",i),c.$view.registerComponent(h))})}}}]),angular.module("vgraph").directive("vgraphChart",["ComponentChart",function(a){"use strict";function b(a){a.$mat&&a.inner.width&&(a.$mat.attr("class","mat").attr("width",a.inner.width).attr("height",a.inner.height).attr("transform","translate("+a.inner.left+","+a.inner.top+")"),a.$frame.attr("class","frame").attr("width",a.width).attr("height",a.height).attr("transform","translate("+a.left+","+a.top+")"))}return{scope:{settings:"=vgraphChart","interface":"=?interface"},controller:a,require:["vgraphChart","^vgraphPage"],link:function(a,c,d,e){var f,g=e[1],h=e[0],i=h.box;f="svg"===c[0].tagName?c[0]:c.find("svg")[0],h.$root=c[0],h.$svg=f,i.$on("resize",function(){b(i),h.rerender(function(){a.$apply()})}),i.targetSvg(f),i.$mat=d3.select(f).insert("rect",":first-child"),i.$frame=d3.select(f).insert("rect",":first-child"),b(i),a.$watch("settings",function(a){h.configure(g,a)}),a["interface"]&&(a["interface"].resize=i.resize.bind(i),a["interface"].error=h.error.bind(h)),d.name&&g.setChart(d.name,h)},restrict:"A"}}]),angular.module("vgraph").directive("vgraphCompare",["$compile","ComponentElement",function(a,b){"use strict";return{scope:{config1:"=config1",config2:"=config2"},require:["^vgraphChart"],link:function(c,d,e,f){var g,h=f[0],i=h.getReference(c.config1),j=h.getReference(c.config2),k=b.svgCompile('<g><path vgraph-line="config1" pair="config2" class-name="'+(e.className||"")+'"></path></g>')[0];d[0].appendChild(k),a(k)(c),g=h.$on("focus-point",function(a){var b=a[i.view],c=a[j.view],d=i.$view,f=j.$view,g=i.getValue(b),h=j.getValue(c);a[e.reference||"compare"]={value:Math.abs(g-h),y:(d.y.scale(g)+f.y.scale(h))/2,x:(b.$x+c.$x)/2}}),c.$on("$destroy",g)}}}]),angular.module("vgraph").directive("vgraphDots",["DrawDots","ComponentElement",function(a,b){"use strict";return{scope:{config:"=vgraphDots"},require:["^vgraphChart","vgraphDots"],controller:b,link:function(b,c,d,e){var f,g=c[0],h=e[0],i=e[1];i.setChart(h),i.setElement(g),b.$watch("config",function(b){var c=h.compileReference(b);c&&(i.setDrawer(new a(c,d.radius?parseInt(d.Radius,10):5)),f="point ",c.classExtend&&(f+=c.classExtend+" "),f+=d.className||c.className,g.setAttribute("class",f),c.$view.registerComponent(i))})}}}]),angular.module("vgraph").directive("vgraphExport",["makeBlob",function(a){"use strict";return{require:["^vgraphChart"],scope:{labels:"=?labels",exports:"=vgraphExport",options:"=?options",selected:"=?selected"},template:'<select ng-model="selected" ng-options="opt as (labels[opt] || opt) for opt in options"></select><a ng-click="process( exports[selected] )"><span>Export</span></a>',link:function(b,c,d,e){b.options||(b.options=Object.keys(b.exports)),b.selected||(b.selected=b.options[0]),b.process=function(b){var c=b(e[0]),d=a(c),f=document.createElement("a");f.setAttribute("href",window.URL.createObjectURL(d)),f.setAttribute("download",c.name),f.setAttribute("target","_blank"),document.getElementsByTagName("body")[0].appendChild(f),setTimeout(function(){f.click(),document.getElementsByTagName("body")[0].removeChild(f)},5)}}}}]),angular.module("vgraph").directive("vgraphFocus",[function(){"use strict";return{require:["^vgraphChart"],link:function(a,b,c,d){var e=d[0],f=e.box,g=d3.select(b[0]),h=g.append("rect").attr("class","focus").attr("visibility","hidden");f.$on("resize",function(){h.attr("height",f.inner.height).attr("y",f.inner.top)}),e.$on("drag",function(a){var b,c,d;a&&void 0!==a.xDiff&&(b=Math.abs(a.xDiff),c=a.x0-b,d=a.x0+b,h.attr("visibility","visible"),c>f.inner.left?h.attr("x",c):(c=f.inner.left,h.attr("x",f.inner.left)),d>f.inner.right?h.attr("width",f.inner.right-c):h.attr("width",d-c))}),e.$on("drag-stop",function(a){var b,c,d,g,i;a&&(h.attr("visibility","hidden"),b=Math.abs(a.xDiff),b>3&&(c=a.x0-b,d=a.x0+b,c<f.inner.left?c=0:c-=f.inner.left,d>f.inner.right?d=f.inner.width:d-=f.inner.left,g=e.views[Object.keys(e.views)[0]].offset,i=f.inner.width*g.right-f.inner.width*g.left,e.zoom.setRatio((f.inner.width*g.left+c/f.inner.width*i)/f.inner.width,(f.inner.width*g.right-(f.inner.width-d)/f.inner.width*i)/f.inner.width)))})},scope:{follow:"=vgraphFocus",stop:"=loseFocus"}}}]),angular.module("vgraph").directive("vgraphHeatmap",["$compile","DrawHeatmap","ComponentElement",function(a,b,c){"use strict";return{scope:{config:"=vgraphHeatmap",indexs:"=indexs",calculate:"=calculator"},require:["^vgraphChart","vgraphHeatmap"],controller:c,link:function(c,d,e,f){function g(){j.x1=m.inner.left,j.x2=m.inner.right,j.y1=m.inner.top,j.y2=m.inner.bottom}var h,i=d[0],j={},k=f[0],l=f[1],m=k.box,n="heatmap ",o=[],p={cell:i.getElementsByTagName("cell")[0].innerHTML.replace(/ng-binding/g,""),xHeading:i.getElementsByTagName("x-heading")[0].innerHTML.replace(/ng-binding/g,""),yHeading:i.getElementsByTagName("y-heading")[0].innerHTML.replace(/ng-binding/g,"")};i.innerHTML="",l.setChart(k,e.publish),l.setElement(i),g(),m.$on("resize",g),l.prepBuild=function(a){o.forEach(function(a){a.$destroy()}),o=[],c.calculate&&c.calculate(a)},l.onAppend=function(b,d){var e=c.$parent.$new();e.content=d,o.push(e),a(b)(e),e.$digest()},c.$watch("config",function(a){var d=k.compileReference(a);d&&(h=new b(d,j,p,c.indexs),l.setDrawer(h),d.classExtend&&(n+=d.classExtend+" "),n+=e.className||d.className,i.setAttribute("class",n),d.$view.registerComponent(l))})}}}]),angular.module("vgraph").directive("vgraphHighlight",[function(){"use strict";return{require:["^vgraphChart"],scope:!0,link:function(a,b,c,d){d[0].$on("highlight",function(b){a[c.vgraphHighlight]=b,a.$digest()})}}}]),angular.module("vgraph").directive("vgraphIcon",["DrawIcon","ComponentElement",function(a,b){"use strict";return{scope:{config:"=vgraphIcon"},require:["^vgraphChart","vgraphIcon"],controller:b,link:function(b,c,d,e){var f=c[0],g=d3.select(f),h=g.node().getBBox(),i=e[0],j=e[1],k=f.innerHTML,l="icon ",m=j.parse;j.parse=function(a){var b=m.call(this,a),c=h.height/2;return b.min-=c,b.max+=c,b},f.innerHTML="",j.setChart(i),j.setElement(f),b.$watch("config",function(b){var c=i.compileReference(b);c&&(j.setDrawer(new a(c,h,k)),c.classExtend&&(l+=c.classExtend+" "),l+=d.className||c.className,f.setAttribute("class",l),c.$view.registerComponent(j))})}}}]),angular.module("vgraph").directive("vgraphIndicator",[function(){"use strict";return{require:["^vgraphChart"],scope:{config:"=?vgraphIndicator"},link:function(a,b,c,d){function e(){k.attr("visibility","hidden")}var f,g,h=d[0],i=a.$eval(c.pointRadius)||3,j=a.$eval(c.outerRadius),k=d3.select(b[0]).attr("transform","translate(1000,1000)").attr("visibility","hidden"),l=k.append("circle").attr("r",i),m=k.append("circle").attr("r",i);a.$watch("config",function(a){a&&(f=h.getReference(a),l.attr("class","point inner "+f.className),m.attr("class","line outer "+f.className),j&&(g=function(){m.transition().duration(1e3).attr("r",j).transition().duration(1e3).attr("r",i).ease("sine").each("end",function(){setTimeout(function(){g()},3e3)})})())}),a.$on("$destroy",h.$subscribe({error:e,loading:e})),h.registerComponent({finalize:function(){var a,b,c=f.$view,d=c.getLeading(),g=f.getValue(d);g&&c.isLeading()?(a=d.$x,b=c.y.scale(g),a&&b&&(k.attr("transform","translate("+a+","+b+")"),k.attr("visibility","visible"))):e()}})}}}]),angular.module("vgraph").directive("vgraphInteract",[function(){"use strict";return{require:["^vgraphChart"],link:function(a,b,c,d){var e,f,g=d[0],h=!1,i=g.box,j=d3.select(b[0]),k=j.append("rect").style("opacity","0").attr("class","focal").on("mousemove",function(){var a=d3.mouse(this);h||(clearTimeout(f),g.$trigger("focus",{x:a[0],y:a[1]}))}).on("mouseout",function(){h||(f=setTimeout(function(){g.$trigger("focus",null)},100))});j.attr("class","interactive"),j.call(d3.behavior.drag().on("dragstart",function(){e=d3.mouse(b[0]),h=!0,g.$trigger("focus",null),g.$trigger("drag-start",{x:e[0],y:e[1]})}).on("dragend",function(){var a=d3.mouse(b[0]);h=!1,g.$trigger("drag-stop",{x0:e[0],y0:e[1],x1:a[0],x2:a[1],xDiff:a[0]-e[0],yDiff:a[1]-e[1]})}).on("drag",function(){var a=d3.mouse(b[0]);g.$trigger("drag",{x0:e[0],y0:e[1],x1:a[0],x2:a[1],xDiff:a[0]-e[0],yDiff:a[1]-e[1]})})),j.on("dblclick",function(){g.setPane({start:null,stop:null},{start:null,stop:null}),g.rerender()
}),g.registerComponent({finalize:function(){k.attr({x:i.inner.left,y:i.inner.top,width:i.inner.width,height:i.inner.height})}})}}}]),angular.module("vgraph").directive("vgraphLabel",[function(){"use strict";return{require:["^vgraphChart"],link:function(a,b,c,d){var e=d[0];e.box.$on("resize",function(){var a,d,f;f="inner"===c.vgraphLabel?e.box.inner:"padding"===c.vgraphLabel?e.box:e.box.outer,a="left"===c.x?f.left:"right"===c.x?f.right:e.box.center,d="top"===c.y?f.top:"bottom"===c.y?f.bottom:e.box.middle,b[0].setAttribute("transform","translate("+a+","+d+")")})}}}]),angular.module("vgraph").directive("vgraphLeading",[function(){"use strict";return{require:["^vgraphChart"],scope:{config:"=vgraphLeading"},link:function(a,b,c,d){function e(a){var b,c,d;if(h={},j.selectAll("line").remove(),g=[],a)for(c=0,d=a.length;d>c;c++)b=i.getReference(a[c]),g.push(b),h[b.name]=j.append("line").attr("class","line "+b.className)}function f(){j.attr("visibility","hidden")}var g,h,i=d[0],j=d3.select(b[0]);a.$watchCollection("config",e),a.$on("$destroy",i.$subscribe({error:f,loading:f})),i.registerComponent({finalize:function(){var a,b=!0,c=[];angular.forEach(g,function(a){var d=a.$view.normalizer,e=d.$latestNode(a.field),f=a.getValue(e);e&&a.$view.isLeading()?c.push({el:h[a.name],x:e.$x,y:a.$view.y.scale(f)}):(h[a.name].attr("visibility","hidden"),b=!1)}),c.sort(function(a,b){return a.y-b.y}),angular.forEach(c,function(b){a&&a.el.attr("visibility","visible").attr("x1",a.x).attr("x2",b.x).attr("y1",a.y).attr("y2",b.y),a=b}),a&&b?(j.attr("visibility","visible"),a.el.attr("visibility","visible").attr("x1",a.x).attr("x2",a.x).attr("y1",a.y).attr("y2",i.box.inner.bottom)):f()}})}}}]),angular.module("vgraph").directive("vgraphLine",["DrawLine","DrawFill","ComponentElement",function(a,b,c){"use strict";return{scope:{config:"=vgraphLine",pair:"=?pair"},require:["^vgraphChart","vgraphLine"],controller:c,link:function(c,d,e,f){var g,h=d[0],i=f[0],j=f[1];j.setChart(h),j.setElement(h),c.$watch("config",function(d){var f,k=i.compileReference(d);k&&(e.pair?(f=i.compileReference(c.pair),g="fill ",j.setDrawer(new b(k,f))):(g="line ",j.setDrawer(new a(k))),k.classExtend&&(g+=k.classExtend+" "),g+=e.className||k.className,h.setAttribute("class",g),k.$view.registerComponent(j))})}}}]),angular.module("vgraph").directive("vgraphLoading",["$interval",function(a){"use strict";return{require:["^vgraphChart"],link:function(b,c,d,e){function f(){!o&&n.loading&&(r.attr("visibility","visible"),o=!0,a.cancel(j),h(),j=a(h,4005))}function g(){r.attr("visibility","hidden"),o=!1,a.cancel(j)}function h(){t.attr("x",function(){return k}).attr("width",function(){return 0}).transition().duration(1e3).attr("x",function(){return k}).attr("width",function(){return l}).ease("sine").transition().duration(1e3).attr("width",0).attr("x",function(){return m}).ease("sine").transition().duration(1e3).attr("width",function(){return l}).attr("x",function(){return k}).ease("sine").transition().duration(1e3).attr("x",function(){return k}).attr("width",0).ease("sine")}var i,j,k,l,m,n=e[0],o=!1,p=n.box,q=d.vgraphLoading||"Loading Data",r=d3.select(c[0]).attr("class","loading-view"),s=r.append("rect").attr("height",20).attr("class","outline"),t=r.append("rect").attr("width",0).attr("height",20).attr("class","filling"),u=r.append("text").text(q);p.$on("resize",function(){if(k=p.inner.left+p.inner.width/5,l=3*p.inner.width/5,m=k+l,l){t.attr("x",k).attr("y",p.middle-10),s.attr("x",k).attr("y",p.middle-10).attr("width",l);try{u.attr("text-anchor","middle").attr("x",p.center).attr("y",p.middle+u.node().getBBox().height/2-2)}catch(a){u.attr("text-anchor","middle").attr("x",p.center).attr("y",p.middle)}f()}else g()}),f(),i=n.$subscribe({done:function(){g(),n.loading&&p.ratio&&f()},error:g}),b.$on("$destroy",function(){g(),i()})}}}]),angular.module("vgraph").directive("vgraphMessage",[function(){"use strict";return{require:["^vgraphChart"],link:function(a,b,c,d){var e,f=d[0],g=f.box,h=d3.select(b[0]).attr("class","error-view"),i=h.append("rect").attr("class","outline"),j=h.append("text");h.attr("visibility","hidden"),g.$on("resize",function(){if(g.inner.height){i.attr("transform","translate("+g.inner.left+","+g.inner.top+")").attr("width",g.inner.width).attr("height",g.inner.height);try{j.attr("text-anchor","middle").attr("x",g.center).attr("y",g.middle+j.node().getBBox().height/2)}catch(a){j.attr("text-anchor","middle").attr("x",g.center).attr("y",g.middle)}}}),e=f.$subscribe({error:function(){var a=f.message;a&&!f.loading&&(h.attr("visibility","visible"),j.text(a))},done:function(){h.attr("visibility","hidden")}})}}}]),angular.module("vgraph").directive("vgraphPage",["ComponentPage",function(a){"use strict";return{restrict:"A",scope:{settings:"=vgraphPage"},controller:a,require:["vgraphPage"],link:function(a,b,c,d){var e=d[0];a.$watch("settings",function(a){e.configure(a)})}}}]),angular.module("vgraph").directive("vgraphPie",["DrawPie","ComponentElement",function(a,b){"use strict";return{scope:{config:"=vgraphPie",buckets:"=buckets"},require:["^vgraphChart","vgraphPie"],controller:b,link:function(b,c,d,e){function f(){h.radius=(j.inner.width<j.inner.height?j.inner.width:j.inner.height)/2,h.x=j.inner.left+j.inner.width/2,h.y=j.inner.top+j.inner.height/2}var g=c[0],h={},i=e[0],j=i.box,k=e[1],l="pie ";k.setChart(i,d.publish),k.setElement(g),f(),j.$on("resize",f),b.$watch("config",function(c){var e=i.compileReference(c);e&&(k.setDrawer(new a(e,b.buckets,h)),e.classExtend&&(l+=e.classExtend+" "),l+=d.className||e.className,g.setAttribute("class",l),e.$view.registerComponent(k))})}}}]),angular.module("vgraph").directive("vgraphPublish",[function(){"use strict";return{require:["^vgraphChart"],scope:!0,link:function(a,b,c,d){var e=a.$eval(c.vgraphPublish);Object.keys(e).forEach(function(b){d[0].$on("publish:"+b,function(c){a[e[b]]=c,a.$digest()})})}}}]),angular.module("vgraph").directive("vgraphStack",["$compile","ComponentElement","StatCalculations","ComponentChart",function(a,b,c,d){"use strict";return{require:["^vgraphChart"],scope:{config:"=vgraphStack",feed:"=?feed"},link:function(e,f,g,h){function i(a){var b,c,d,e={};for(k=[],b=0,c=a.length;c>b;b++)d=p.getReference(a[b]),d.pair=e,e=d,k.push(d)}function j(c){var d,g,h,j;if(c&&(i(c),o)){for(d3.select(f[0]).selectAll("g").remove(),m&&m.$destroy(),h="",d=0,g=k.length;g>d;d++)h+="<g "+o+'="config['+d+']"></g>';for(j=b.svgCompile(h),d=0,g=j.length;g>d;d++)f[0].appendChild(j[d]);m=e.$new(),a(j)(m)}}var k,l,m,n=g.view||d.defaultView,o=g.childTag,p=h[0],q=p.getView(n);e.$watchCollection("config",j),l=e.$watchCollection("config",j),e.$on("$destroy",function(){m&&m.$destroy(),l()}),q.registerComponent({parse:function(){k&&(c.$resetCalcs(k),c.stack(k))}})}}}]),angular.module("vgraph").directive("vgraphStatus",[function(){"use strict";return{require:["^vgraphChart"],scope:!0,link:function(a,b,c,d){function e(){a[c.vgraphStatus]={message:f.message,loading:f.loading,pristine:f.pristine},a.$digest()}var f=d[0];f.$subscribe({done:e,error:e})}}}]),angular.module("vgraph").directive("vgraphTarget",[function(){"use strict";return{require:["^vgraphChart"],scope:{pointRadius:"=pointRadius",config:"=vgraphTarget"},link:function(a,b,c,d){function e(b){b?(g=b.pos.x,j.style("visibility","visible").attr("transform","translate("+g+",0)"),void 0===c.noDots&&angular.forEach(f,function(d){var e,f=d.$view,h=b[d.view],i=d.className,j=d.getValue(h);void 0!==j&&null!==j?(e=l.selectAll("circle.point."+i),e[0].length||(e=l.append("circle").attr("class","point "+i+" "+d.classExtend)),e.attr("cx",h.$x-g).attr("cy",f.y.scale(j)).attr("r",a.$eval(c.pointRadius)||3)):l.selectAll("circle.point."+i).remove()})):j.style("visibility","hidden")}var f,g,h=d[0],i=h.box,j=d3.select(b[0]).attr("class","target"),k=j.append("line").attr("class","focus").attr("x1",0).attr("x2",0),l=j.append("g");j.style("visibility","hidden"),h.$on("highlight",e),i.$on("resize",function(){k.attr("y1",i.inner.top).attr("y2",i.inner.bottom)}),a.$watchCollection("config",function(a){var b,c;if(f=[],a)for(b=0,c=a.length;c>b;b++)a[b]&&f.push(h.getReference(a[b]))})}}}]),angular.module("vgraph").directive("vgraphTooltip",[function(){"use strict";function a(a,c,d){var e=c.config;return d.reference?{formatter:function(a){return a[d.reference].value},xParse:function(a){return a[d.reference].x},yParse:function(a){return a[d.reference].y}}:e.formatter?e:b(a,e)}function b(a,b){var c=a.getReference(b);return{formatter:function(a){return c.getValue(a[c.view])},xParse:function(a){return a[c.view].$x},yParse:function(a){return c.$view.y.scale(c.getValue(a[c.view]))}}}return{require:["^vgraphChart"],scope:{config:"=?vgraphTooltip"},link:function(b,c,d,e){var f=e[0],g=a(f,b,d),h=parseInt(d.offsetX)||0,i=parseInt(d.offsetY)||0,j=d3.select(c[0]).attr("class","tooltip"),k=j.append("polygon").attr("class","outline").attr("transform","translate(0,-15)"),l=j.append("text").style("line-height","20").style("font-size","16").attr("class","label");f.$on("highlight",function(a){var b,c,d,e;a&&(d=g.yParse(a)),void 0!==d?(b=d+i,c=g.xParse(a)+h,l.text(g.formatter(a)),e=l.node().getComputedTextLength()+5,j.style("visibility","visible"),c+e+16<f.box.inner.right?(j.attr("transform","translate("+c+","+b+")"),l.attr("transform","translate(10,5)"),k.attr("points","0,15 10,0 "+(e+10)+",0 "+(e+10)+",30 10,30 0,15")):(j.attr("transform","translate("+(c-2*h-e-10)+","+b+")"),l.attr("transform","translate(5,5)"),k.attr("points","0,0 "+e+",0 "+(e+10)+",15 "+e+",30 0,30 0,0"))):j.style("visibility","hidden")})}}}]),angular.module("vgraph").directive("vgraphZoom",[function(){"use strict";return{scope:{min:"=zoomMin",max:"=zoomMax"},require:["^vgraphChart","^vgraphPage"],link:function(a,b,c,d){function e(a){0===h&&i===p.inner.width?(s=!1,x.attr("class","focus")):(s=!0,x.attr("class","focus zoomed")),0>h&&(h=0),i>p.inner.width&&(i=p.inner.width),h>i?h=i:h>i&&(i=h),u.attr("transform","translate("+h+",0)"),v.attr("transform","translate(-"+h+",0 )").attr("width",h),y.attr("transform","translate("+i+",0)"),z.attr("width",p.inner.width-i),x.attr("transform","translate("+h+",0)").attr("width",i-h),a&&q.setRatio(h/p.inner.width,i/p.inner.width)}function f(){r||(h=q.left*p.inner.width,i=q.right*p.inner.width,e())}var g,h,i,j,k,l,m,n=d[0],o=d[1],p=n.box,q=o.getZoom(c.vgraphZoom),r=!1,s=!1,t=d3.select(b[0]),u=t.append("g").attr("class","left-control min-control"),v=u.append("rect").attr("class","shade"),w=u.append("g").attr("class","control"),x=t.append("rect").attr("class","focus"),y=t.append("g").attr("class","right-control max-control"),z=y.append("rect").attr("class","shade"),A=y.append("g").attr("class","control");k=w.append("path").attr("d","M-0.5,23.33A6,6 0 0 0 -6.5,29.33V40.66A6,6 0 0 0 -0.5,46.66ZM-2.5,31.33V38.66M-4.5,31.33V38.66").attr("transform","translate(0,-9)").attr("class","nub"),j=w.append("rect").attr("width","10").attr("transform","translate(-10,0)"),m=A.append("path").attr("d","M0.5,23.33A6,6 0 0 1 6.5,29.33V40.66A6,6 0 0 1 0.5,46.66ZM2.5,31.33V38.66M4.5,31.33V38.66").attr("transform","translate(0,-9)").attr("class","nub"),l=A.append("rect").attr("width","10"),a.box=p,j.call(d3.behavior.drag().on("dragstart",function(){r=!0}).on("dragend",function(){r=!1}).on("drag",function(){h=d3.mouse(b[0])[0],e(!0)})),l.call(d3.behavior.drag().on("dragstart",function(){r=!0}).on("dragend",function(){r=!1}).on("drag",function(){i=d3.mouse(b[0])[0],e(!0)})),x.call(d3.behavior.drag().on("dragstart",function(){g={mouse:d3.mouse(b[0])[0],minPos:h,maxPos:i},r=!0}).on("dragend",function(){r=!1,s=!0}).on("drag",function(){var a=d3.mouse(b[0]),c=a[0]-g.mouse;s?(i=g.maxPos+c,h=g.minPos+c,e(!0)):c>1&&(i=g.mouse+Math.abs(c),h=g.mouse-Math.abs(c),e(!0),s=!1)})),t.on("dblclick",function(){i=p.inner.width,h=0,e(!0)}),p.$on("resize",function(){t.attr("width",p.inner.width).attr("height",p.inner.height).attr("transform","translate("+p.inner.left+","+p.inner.top+")"),m.attr("transform","translate(0,"+(p.inner.height/2-30)+")"),k.attr("transform","translate(0,"+(p.inner.height/2-30)+")"),v.attr("height",p.inner.height),z.attr("height",p.inner.height),j.attr("height",p.inner.height),l.attr("height",p.inner.height),x.attr("height",p.inner.height),f()}),q.$on("update",f),f()}}}]),function(a){"use strict";var b=/\S+/g,c=/[\t\r\n\f]/g;a&&(a.fn.addClass=function(d){var e,f,g,h,i,j,k,l="string"==typeof d&&d,m=0,n=this.length;if(a.isFunction(d))return this.each(function(b){a(this).addClass(d.call(this,b,this.className))});if(l)for(e=(d||"").match(b)||[];n>m;m++)if(f=this[m],k="string"!=typeof f.className,g=1===f.nodeType&&(f.className?(" "+(k?f.getAttribute("class")||"":f.className)+" ").replace(c," "):" ")){for(i=0;h=e[i++];)g.indexOf(" "+h+" ")<0&&(g+=h+" ");j=a.trim(g),f.className!==j&&(k?f.setAttribute("class",j):f.className=j)}return this},a.fn.removeClass=function(d){var e,f,g,h,i,j,k,l=0===arguments.length||"string"==typeof d&&d,m=0,n=this.length;if(a.isFunction(d))return this.each(function(b){a(this).removeClass(d.call(this,b,this.className))});if(l)for(e=(d||"").match(b)||[];n>m;m++)if(f=this[m],k="string"!=typeof f.className,g=1===f.nodeType&&(f.className?(" "+(k?f.getAttribute("class")||"":f.className)+" ").replace(c," "):"")){for(i=0;h=e[i++];)for(;g.indexOf(" "+h+" ")>=0;)g=g.replace(" "+h+" "," ");j=d?a.trim(g):"",f.className!==j&&(k?f.setAttribute("class",j):f.className=j)}return this})}(jQuery);
//# sourceMappingURL=vgraph.min.js.map