angular.module("vgraph",[]),angular.module("vgraph").factory("BoxModel",[function(){"use strict";function t(t,e){var n=e.padding,a=t.padding,r=e.margin,o=t.margin;o||(t.margin=o={top:0,right:0,bottom:0,left:0}),r&&(o.top=i(r.top,o.top),o.right=i(r.right,o.right),o.bottom=i(r.bottom,o.bottom),o.left=i(r.left,o.left)),a||(t.padding=a={top:0,right:0,bottom:0,left:0}),n&&(a.top=i(n.top,a.top),a.right=i(n.right,a.right),a.bottom=i(n.bottom,a.bottom),a.left=i(n.left,a.left)),t.outerWidth=i(e.outerWidth,t.outerWidth)||0,t.outerHeight=i(e.outerHeight,t.outerHeight)||0,t.top=o.top,t.bottom=t.outerHeight-o.bottom,t.left=o.left,t.right=t.outerWidth-o.right,t.center=(t.left+t.right)/2,t.middle=(t.top+t.bottom)/2,t.width=t.right-t.left,t.height=t.bottom-t.top,t.innerTop=t.top+a.top,t.innerBottom=t.bottom-a.bottom,t.innerLeft=t.left+a.left,t.innerRight=t.right-a.right,t.innerWidth=t.innerRight-t.innerLeft,t.innerHeight=t.innerBottom-t.innerTop,t.ratio=t.outerWidth+" x "+t.outerHeight}function e(e){this.registrations=[],t(this,e||{})}function i(t,e){return void 0!==t?parseInt(t):e}return e.prototype.register=function(t){this.ratio&&t(),this.registrations.push(t)},e.prototype.targetSvg=function(t){this.$element=t,this.resize()},e.prototype.resize=function(){var e,i,n=this.$element;if(n.attr("width",null).attr("height",null),n[0].style.cssText=null,t(this,{outerWidth:n.outerWidth(!0),outerHeight:n.outerHeight(!0),margin:{top:n.css("margin-top"),right:n.css("margin-right"),bottom:n.css("margin-bottom"),left:n.css("margin-left")},padding:{top:n.css("padding-top"),right:n.css("padding-right"),bottom:n.css("padding-bottom"),left:n.css("padding-left")}}),n.css("margin","0").css("padding","0").attr("width",this.outerWidth).attr("height",this.outerHeight).css({width:this.outerWidth+"px",height:this.outerHeight+"px"}),this.innerWidth&&this.innerHeight)for(e=0,i=this.registrations.length;i>e;e++)this.registrations[e]()},e}]),angular.module("vgraph").factory("ComponentGenerator",["$timeout",function(t){"use strict";function e(t,e,i){var n,a;if(t)if(t.forEach)t.forEach(e,i);else if(t.length)for(n=0,a=t.length;a>n;n++)e.call(i,t[n],n)}function i(t,e,i,n){var a,r,o,s=e.name;return n||(n="path"),t[s]=e,a=angular.isFunction(e.value)?s+".value":"'"+(e.value||s)+"'",r=angular.isFunction(e.interval)?s+".interval":"'"+(e.interval||"x")+"'",angular.isString(e.data)?(o=e.data,t[e.data]=t.$parent[e.data]):o=e.data?s+".data":"data","<"+n+' class="'+i+" "+e.className+'" vgraph-feed="'+o+'" name="'+s+'" value="'+a+'" interval="'+r+'" control="'+(e.control||"default")+'"'+(e.filter?' filter="'+e.filter+'"':"")+"></"+n+">"}function n(t){return null===t?!1:Number.isFinite?Number.isFinite(t)&&!Number.isNaN(t):isFinite(t)&&!isNaN(t)}var a={require:["^vgraphChart"],link:function(e,i,n,a){function r(){l||(l=t(function(){o(),l=null},30))}function o(){var t,i;if(e.data&&f.valueParse&&!e.data.$loading){for(h.loading=!1,e.data._lastRead||(e.data._lastRead={}),t=e.data._lastRead[g]||0,i=e.data.length;i>t;t++)e.loadPoint(e.data[t]);e.data._lastRead[g]=i}}var s,l,c=n.control||"default",h=a[0].graph,u=h.views[c],d=u.model,f={model:d},p=n.name,g=p+h.$uid,m=[],v=parseInt(n.memory,10)||10;h.loading=!0,e.$watch("interval",function(t){"string"==typeof t?f.intervalParse=function(e){return e[t]}:f.intervalParse=t}),e.$watch("extra",function(t){f.extraParse=t}),e.$watch("filter",function(t){f.filterParse=t}),e.$watch("value",function(t){"string"==typeof t?(s=n.alias||t,f.valueParse=function(e){return void 0!==e[t]?e[s]:void 0}):f.valueParse=t,r()}),e.$watch("data",r),e.$watch("data.$loading",r),e.$watch("data.length",r),e.loadPoint?e.loadPoint=e.loadPoint.bind(f):e.loadPoint=function(t){var e,i=this.valueParse(t);this.filterParse?(m.length>v&&m.shift(),m.push(i),e=this.model.addPoint(p,this.intervalParse(t),this.filterParse(i,m))):isNaN(i)&&null!==i&&void 0!==i||(e=this.model.addPoint(p,this.intervalParse(t),i)),this.extraParse&&e&&this.extraParse(t,e)}.bind(f),h.rerender()},scope:{data:"=_undefined_",value:"=?value",interval:"=?interval",filter:"=?filter",extra:"=?extra"}};return{generate:function(t,e){function i(){}var n;return i.prototype=a,n=new i,n.scope=angular.copy(n.scope),n.scope.data="="+t,angular.forEach(e,function(t,e){var i=n[e];i?angular.isFunction(i)?n[e]=function(){i.apply(this,arguments),t.apply(this,arguments)}:n[e]=angular.extend(i,t):n[e]=t}),n.preLink&&(n.link={pre:n.preLink,post:n.link}),n},makeLineCalc:function(t,e){var i,a,r=d3.svg.line().interpolate("linear").defined(function(t){var a=t[e];return n(a)?(i=!0,!0):void 0===a&&i?!0:(i=!1,!1)}).x(function(e){return t.x.scale(e.$interval)}).y(function(i){var n=i[e];return void 0!==n&&(a=t.y.scale(i[e])),a});return function(){return i=!1,a=!1,r.apply(this,arguments)}},makeFillCalc:function(t,e,i,a,r){return i||(i=t),d3.svg.area().defined(function(o){var s=o[t.name]?o[t.name][e]:null,l=!a||o[i.name]&&n(o[i.name][a]);return n(s)&&l?(r&&a&&r(o,o[t.name][e],o[i.name][a]),!0):!1}).x(function(e){return t.x.scale(e[t.name].$interval)}).y(function(i){return t.y.scale(i[t.name][e])}).y1(function(t){return i.y.scale(a?t[i.name][a]:i.model.y.minimum)})},makeMyFillCalc:function(t,i,a,r,o){function s(e){var o=e[t.name]?e[t.name][i]:null,s=!r||e[a.name]&&n(e[a.name][r]);return n(o)&&s?!0:!1}function l(e){return e[t.name]._$interval}function c(e){return e[t.name][i]}function h(e){return t.y.scale(e)}function u(t){return r&&t[a.name][r]?t[a.name][r]:a.pane.y.minimum}function d(t){return a.y.scale(t)}return a||(a=t),function(t){function i(){n.push("M",r.join("L"),"L",a.reverse().join("L"),"Z")}var n=[],a=[],r=[];return e(t,function(t){var e,n,f,p,g;s(t)?(n=c(t),f=u(t),p=h(n),g=h(f),e=l(t),o&&o(t,n,f,p,g,e),a.push(e+","+h(n)),r.push(e+","+d(f))):a.length&&(i(),a=[],r=[])}),a.length&&i(),n.length?n.join(""):null}},decodeConfig:function(t,e,n){var a,r,o=[];if(angular.isArray(e))for(a=0,r=e.length;r>a;a++)o.push(i(t,e[a],n));else o.push(i(t,e,n));return o},compileConfig:function(t,e,i){var n,a,r,o;for(angular.isArray(e)||(e=[e]),r=this.decodeConfig(t,e,i),o=this.svgCompile(r.join("")),n=0,a=o.length;a>n;n++)r[n]={name:e[n].name,className:e[n].className,element:o[n],$d3:d3.select(o[n]),$conf:e[n]};return r},svgCompile:function(t){return(new DOMParser).parseFromString('<g xmlns="http://www.w3.org/2000/svg">'+t+"</g>","image/svg+xml").childNodes[0].childNodes},parseStackedLimits:function(t,e){var i,n,a,r,o,s,l,c,h,u;if(e&&e.length)for(i=0,n=t.length;n>i;i++){for(s=0,c=void 0,l=t[i],o=e[0].name,c=l[o]||0,void 0===h?(h=c,u=c):h>c&&(h=c),l["$"+o]=c,s=c,a=1,r=e.length;r>a;a++)o=e[a].name,c=l[o]||0,s+=c,l["$"+o]=s;l.$total=s,s>u&&(u=s)}return{min:h,max:u}},parseLimits:function(t,e,i){var a,r,o,s,l,c;if(angular.isString(e))if(i)for(a=0,r=t.length;r>a;a++)o=t[a],s=i(o,o[e]),n(s)&&(void 0===l?(l=s,c=s):l>s?l=s:s>c&&(c=s));else for(a=0,r=t.length;r>a;a++)o=t[a],s=o[e],n(s)&&(void 0===l?(l=s,c=s):l>s?l=s:s>c&&(c=s));else for(a=0,r=e.length;r>a;a++)s=this.parseLimits(t,e[a]),void 0===l?(l=s.min,c=s.max):(s.min<l&&(l=s.min),s.max>c&&(c=s.max));return{min:l,max:c}}}}]),angular.module("vgraph").factory("DataCollection",["LinearModel",function(t){"use strict";function e(e){e instanceof t&&(e={"default":e}),this.models=e}return e.prototype.forEach=function(t,e){angular.forEach(this.models,function(i,n){t.call(e,i,n)})},e.prototype.reset=function(){angular.forEach(this.models,function(t){t.reset()})},e}]),angular.module("vgraph").factory("GraphModel",["$timeout","ViewModel","BoxModel","LinearModel","DataCollection",function(t,e,i,n,a){"use strict";function r(){this.$scripts={},this.$master=this.schedule=[]}function o(){return+new Date}function s(){this.index=[],this.hash={},this.$dirty=!1}function l(t){this.$uid=++d,this.box=new i,this.models=[],this.views={},this.samples={},this.waiting={},this.registrations=[],this.loading=!0,this.message=null,this.$interface=t||{}}function c(t,e){var i,n,a,r,o;for(n=0,a=t.length;a>n;n++)for(i=t[n],r=0,o=i.length;o>r;r++)null!==i[r]&&(e[n].unshift(i[r]),r=o)}function h(t,e,i,n,a){var r,o=[],s=[];for(r=0;a>r;r++)s.push([]);return s.push([]),angular.forEach(t,function(t){var r=e[t.view],l=i[r.name];o.push(t.label),r.publishData(s,t,function(t){return Math.round((t.$x-l.data.min)/n*a)})}),{header:o,body:s}}r.prototype.startScript=function(t){t?this.$scripts[t]?(this.schedule=this.$scripts[t],this.schedule.length=0):this.schedule=this.$scripts[t]=[]:this.schedule=[]},r.prototype.endScript=function(){this.$master.push(this.schedule),this.schedule=this.$master},r.prototype.loop=function(t,e,i){this.schedule.push({start:0,stop:t.length,data:t,op:e,ctx:i})},r.prototype.func=function(t,e){this.schedule.push({op:t,ctx:e})},r.prototype.run=function(){var t=this;this.$lock||(this.$lock=!0,setTimeout(function(){t.$eval(function(){t.$lock=!1})},5))},r.prototype.$eval=function(t){function e(){r.$eval(t)}for(var i,n,a,r=this,s=!0,l=o(),c=l+500;(a=this.schedule.shift())&&s;){if(a.length)for(;a.length;)this.schedule.unshift(a.pop());else if("start"in a)for(i=a.start,n=a.stop;n>i;i++)a.op.call(a.ctx,a.data[i],i);else a.op.call(a.ctx);o()>c&&(s=!1,setTimeout(e,5))}0===this.schedule.length&&t()};var u=new r;s.prototype.addIndex=function(t,e){return this.hash[t]||(this.hash[t]={$index:t,$meta:e},this.index[this.index.length-1]>t&&(this.$dirty=!0),this.index.push(t),this.length=this.index.length),this.hash[t]},s.prototype.getClosest=function(t){var i,n,a,r,o;return this.length?(this.sort(),i=e.bisect(this,t,function(t){return t.$index},!0),r=this.get(i.left),o=this.get(i.right),n=t-r.$index,a=o.$index-t,a>n?r:o):void 0},s.prototype.get=function(t){return this.hash[this.index[t]]},s.prototype.sort=function(){this.$dirty&&(this.$dirty=!1,this.index.sort(function(t,e){return t-e}))},s.prototype.forEach=function(t,e){var i,n;for(this.sort(),i=0,n=this.index.length;n>i;i++)t.call(e,this.hash[this.index[i]])};var d=0;return l.prototype.register=function(t){this.registrations.push(t)},l.prototype.getPrimaryView=function(){return this.views[Object.keys(this.views)[0]]},l.prototype.publish=function(t,e){var i,n,a,r,o={},s={};return angular.forEach(t,function(t){var e=this.views[t.view];e&&!o[e.name]&&(o[e.name]=e)},this),angular.forEach(o,function(t){var e=t.publishStats(),n=e.data.max-e.data.min;s[t.name]=e,(!i||n>i)&&(i=n),(!a||e.step<a)&&(a=e.step)}),n=Math.ceil(i/a),r=h(t,o,s,i,n),e&&(e=h(e,o,s,i,n),c(e.body,r.body),r.header.unshift(e.header[0])),r.body.unshift(r.header),r.body},l.prototype.render=function(t){var e=this,i=0,n=Object.keys(this.views).length,a=this.getPrimaryView(),r=new s;angular.forEach(this.views,function(t){t.calcBounds()}),this.calcHook&&this.calcHook(),t=[],this.empty=[],angular.forEach(this.views,function(e){e.calcScales(r),e.hasData()?t.push(e):this.empty.push(e)},this),i=Object.keys(t).length,n?i?(u.startScript(this.$uid),e.loading=!r.length,u.func(function(){e.unified=r,e.message=null}),this.loading?u.loop(t,function(t){t.loading()}):(u.loop(t,function(t){t.build()}),u.loop(t,function(t){t.process()}),u.loop(t,function(t){t.finalize()}),u.loop(this.registrations,function(t){t(a.pane)})),u.func(function(){e.$interface.onRender&&e.$interface.onRender()}),u.endScript(),u.run()):this.loading||(this.message="No Data Available"):this.loading=!0},l.prototype.scheduleRender=function(){this.nrTimeout||(this.nrTimeout=t(function(){this.render(this.waiting),this.waiting={},this.nrTimeout=null}.bind(this),30))},l.prototype.rerender=function(){this.scheduleRender(),this.waiting=this.views},l.prototype.needsRender=function(t){this.scheduleRender(),this.waiting[t.name]||(this.waiting[t.name]=t)},l.prototype.addDataCollection=function(t){t instanceof a?t=t.models:t instanceof n&&(t={"default":t}),angular.forEach(t,this.addDataModel,this)},l.prototype.addDataModel=function(t,i){var n=new e(this,i,t);this.views[n.name]=n,this.models.push(t),this.bounds&&n.pane.setBounds(this.bounds.x,this.bounds.y),this.pane&&n.pane.setPane(this.pane.x,this.pane.y),t.onError(function(t){t?(this.loading=!1,this.message=t):this.message=null}.bind(this))},l.prototype.setBounds=function(t,e,i){return this.bounds={x:t,y:e},i?this.views[i]&&this.views[i].pane.setBounds(t,e):angular.forEach(this.views,function(i){i.pane.setBounds(t,e)}),this},l.prototype.setPane=function(t,e,i){return this.pane={x:t,y:e},i?this.views[i]&&this.views[i].pane.setPane(t,e):angular.forEach(this.views,function(i){i.pane.setPane(t,e)}),this},l}]),angular.module("vgraph").factory("LinearModel",[function(){"use strict";function t(t){t||(t={}),t.x||(t.x={}),t.y||(t.y={}),this.$dataProc=e(20,200,function(t){var e=t.registrations;e.forEach(function(t){t()})}),this.data=[],this.construct(),this.reset(t)}function e(t,e,i,n){function a(){var e=+new Date;e>s||e>o?(s=null,i.apply(n,r)):setTimeout(a,t)}var r,o,s;return function(){var i=+new Date;o=i+t,r=arguments,s||(s=i+e,setTimeout(a,t))}}var i=0;return t.prototype.construct=function(){this.$modelId=i++,this.registrations=[],this.errorRegistrations=[],this.point={reset:function(t){t.$x=null,t.$y=null}}},t.prototype.reset=function(t){this.data.length=0,this.lookUp={},this.plots={},this.plotNames=[],this.filtered=null,this.needSort=!1,this.ratio=null,this.transitionDuration=30,this.config(t||this),this.dataReady(!0)},t.prototype.config=function(t){var e=this;this.x={$min:null,$max:null,massage:t.x.massage||null,padding:t.x.padding||0,scale:t.x.scale||function(){return d3.scale.linear()},disp:t.x.display||function(t){return t.$interval},simplify:t.x.simplify||function(t){return t.$x},parse:t.x.parse||function(t){return t.$interval},format:t.x.format||d3.format("03d"),tick:t.x.tick||{}},this.y={$min:null,$max:null,massage:t.y.massage||null,padding:t.y.padding||0,scale:t.y.scale||function(){return d3.scale.linear()},disp:t.y.display||function(t,i){return e.y.parse(t,i)},simplify:t.y.simplify||function(t){return e.y.parse(t)},parse:t.y.parse||function(t,e){return void 0===t||null===t?null:t[e]},format:t.y.format||d3.format(",.2f"),tick:t.y.tick||{}}},t.prototype.makeInterval=function(t){return t},t.prototype.onError=function(t){this.errorRegistrations.push(t)},t.prototype.setError=function(t){var e,i;for(e=0,i=this.errorRegistrations.length;i>e;e++)this.errorRegistrations[e](t)},t.prototype.getPoint=function(t){var e,i=this.data;return this.x.massage&&(t=this.x.massage(t)),t||0===t?(t=+t,e=this.lookUp[t],e||(e={$interval:this.makeInterval(t),$x:t},this.lookUp[t]=e,i.length&&i[i.length-1].$x>t&&(this.needSort=!0),i.push(e)),e):void 0},t.prototype.addPoint=function(t,e,i){var n,a=this.getPoint(e),r=parseFloat(i);if(a)return e=a.$x,this.y.massage&&(i=this.y.massage(i)),void 0===a.$max?isFinite(r)&&(a.$min=r,a.$max=r):isFinite(r)&&((void 0===a.$min||r<a.$min)&&(a.$min=r),(void 0===a.$max||r>a.$max)&&(a.$max=r)),this.x.min||(this.x.min=a,this.x.max=a),n=this.plots[t],n?n.x.max.$x<a.$x?(n.x.max=a,this.x.max.$x<a.$x&&(this.x.max=a)):n.x.min.$x>a.$x&&(n.x.min=a,a.$x<this.x.min.$x&&(this.x.min=a)):(this.plots[t]=n={x:{min:a,max:a}},this.x.max.$x<a.$x?this.x.max=a:a.$x<this.x.min.$x&&(this.x.min=a)),a[t]=i,this.dataReady(),a},t.prototype.fillPoints=function(t,e,i,n){var a,r;for(a=t;e>=a;a+=i)r=this.getPoint(a),void 0===r[n]&&this.addPoint(n,a,null)},t.prototype.addPlot=function(t,e,i,n){var a,r,o;if(!this.plots[t])for(a=0,r=e.length;r>a;a++)o=e[a],this.addPoint(t,i(o),n(o))},t.prototype.removePlot=function(t){var e,i,n,a,r,o,s,l,c=this.plots[t];if(c){for(delete this.plots[t],s=Object.keys(this.plots),e=0,i=this.data.length;i>e;e++){if(l=this.data[e],l.$max===l[t]){for(r=void 0,n=0,a=s.length;a>n;n++)o=l[s[n]],"number"==typeof o&&(void 0===r||o>r)&&(r=o);l.$max=r}if(l.$min===l[t]){for(r=void 0,n=0,a=s.length;a>n;n++)o=l[s[n]],"number"==typeof o&&(void 0===r||r>o)&&(r=o);l.$min=r}l[t]=null}if(this.x.min=null,this.x.max=null,this.y.min=null,this.y.max=null,s.length&&this.plots[s[0]]&&this.plots[s[0]].x&&this.plots[s[0]].y)for(this.x.min=this.plots[s[0]].x.min,this.x.max=this.plots[s[0]].x.max,this.y.min=this.plots[s[0]].y.min,this.y.max=this.plots[s[0]].y.max,e=1,i=s.length;i>e;e++)o=s[e],l=this.plots[o],l.min&&l.min.$x<this.x.min.$x?this.x.min=l.min:l.max&&this.x.max.$x<l.max.$x&&(this.x.max=l.max),l.min&&l.min.$min<this.y.min.$min?this.y.min=l.min:l.max&&this.y.max.$max<l.max.$max&&(this.y.max=l.max)}},t.prototype.dataReady=function(t){var e=this.registrations;t?e.forEach(function(t){t()}):this.$dataProc(this)},t.prototype.findExtemesY=function(t){var e,i,n,a,r;for(i=0,n=t.length;n>i;i++)e=t[i],(e.$min||0===e.$min)&&(void 0===a?a=e:e.$min<a.$min&&(a=e)),(e.$max||0===e.$max)&&(void 0===r?r=e:e.$max>r.$max&&(r=e));return{min:a,max:r}},t.prototype.register=function(t){this.registrations.push(t)},t.prototype.clean=function(){var t=this.x;this.needSort&&this.data.sort(function(t,e){return t.$x-e.$x}),t.min&&(t.$min=t.min.$x,t.$max=t.max.$x)},t}]),angular.module("vgraph").factory("PaneModel",[function(){"use strict";function t(t){this.dataModel=t,this.x={},this.y={},this._bounds={},this._pane={}}return t.prototype.setBounds=function(t,e){return this._bounds.x=t,this._bounds.y=e,this},t.prototype.setPane=function(t,e){return this._pane.x=t,this._pane.y=e,this},t.prototype.isValid=function(t){var e;return void 0===this.x.start?!0:(e=t.$x,this.x.start.$x<=e&&e<=this.x.stop.$x)},t.prototype.adjust=function(t){var e,i,n,a,r,o,s=this.dataModel.data,l=this.dataModel.x,c=this.x;if(s.length){if(this.dataModel.clean(),this._bounds.x?(r=this._bounds.x.min||l.$min,o=this._bounds.x.max||l.$max,c.$min=r,c.$max=o,this._bounds.x=null):(r=c.$min||l.$min,o=c.$max||l.$max),this._pane.x){if(a=this._pane.x,this.offset={},"number"==typeof a.start)c.start=s[a.start];else{if(a.start?"string"==typeof a.start&&("%"===a.start.charAt(0)?e=r+parseFloat(a.start.substring(1),10)*(o-r):"+"===a.start.charAt(0)?e=r+parseInt(a.start.substring(1),10):"="===a.start.charAt(0)&&(e=parseInt(a.start.substring(1),10))):e=r,void 0===e)throw"Start of pane not properly defined";c.start=t.makePoint(e,l.$min,l.$max,this.dataModel.makeInterval)}if(this.offset.$left=c.start.$x,this.offset.left=(c.start.$x-r)/(o-r),"number"==typeof a.stop)a.stop=s[a.stop];else{if(null===a.stop||void 0===a.stop?e=o:"string"==typeof a.stop&&("%"===a.stop.charAt(0)?e=r+parseFloat(a.stop.substring(1),10)*(o-r):"+"===a.stop.charAt(0)?e=r+parseInt(a.stop.substring(1),10):"="===a.stop.charAt(0)&&(e=parseInt(a.stop.substring(1),10))),void 0===e)throw"End of pane not properly defined";c.stop=t.makePoint(e,l.min.$x,l.max.$x,this.dataModel.makeInterval)}this.offset.$right=c.stop.$x,this.offset.right=(c.stop.$x-r)/(o-r)}else c.start||(c.start=t.makePoint(r,l.$min,l.$max,this.dataModel.makeInterval),c.stop=t.makePoint(o,l.min.$x,l.max.$x,this.dataModel.makeInterval));this.data=s,this.filtered=s.filter(function(t,e){var a=t.$x;return c.start.$x<=a&&a<=c.stop.$x?(i?n=e:i=e,t.$inPane=!0,!0):(t.$inPane=!1,!1)}),this.filtered.$first=i,this.filtered.$last=n,this.dataModel.fitToPane&&(c.start.$faux&&this.filtered.unshift(c.start),c.stop.$faux&&this.filtered.push(c.stop)),this.x.min=this.dataModel.x.min,this.x.max=this.dataModel.x.max,this.y={start:this.dataModel.y.start,stop:this.dataModel.y.stop,padding:this.dataModel.y.padding}}else this.filtered=[]},t}]),angular.module("vgraph").factory("ViewModel",["PaneModel",function(t){"use strict";function e(t,e,i,n){var a,r,o,s=0,l=t.length-1;if(o=t.get?function(e){return t.get(e)}:function(e){return t[e]},n||t.sort(function(t,e){return i(t)-i(e)}),i(o(s))>=e)return{left:s,right:s};if(i(o(l))<=e)return{left:l,right:l};if(t.length){for(;l-s>1;)a=Math.floor((l+s)/2),r=i(o(a)),r===e?(l=a,s=a):r>e?l=a:s=a;return l!==a&&i(o(l))===e?{left:l,right:l}:s!==a&&i(o(s))===e?{left:s,right:s}:{left:s,right:l}}}function i(t,i){return e(t,i,function(t){return t.$interval},!0)}function n(t,e){var n,a,r;return t.length?(n=i(t,e),a=e-t[n.left].$interval,r=t[n.right].$interval-e,t[r>a?n.left:n.right]):void 0}function a(e,i,n){var a,r,o=this;this.pane=new t(n),this.components=[],this.name=i,this.model=n,this.graph=e,a={scale:n.x.scale(),calc:function(t){return a.scale(n.x.parse(t))},center:function(){return(a.calc(o.pane.x.min)+a.calc(o.pane.x.max))/2}},this.x=a,r={scale:n.y.scale(),calc:function(t){return r.scale(n.y.parse(t))},center:function(){return(r.calc(o.pane.y.min)+r.calc(o.pane.y.max))/2}},this.y=r,n.register(function(){e.needsRender(this)}.bind(this))}function r(t,e,i,n){for(;i>e;)t[e].push(n),e++}function o(t,e,i,n,a){var o,s,l,c,h=0;for(o=0,s=t.length;s>o;o++)l=t[o][e],void 0!==l&&null!==l&&(c=n(t[o]),c!==h&&r(i,h,c,null),a&&(l=a(l)),i[c].push(l),h=c+1);r(i,h,i.length,null)}return a.bisect=e,a.prototype.getPoint=function(t){return this.model.data[t]?this.model.data[t]:0>t?this.model.data[0]:this.model.data[this.model.data.length]},a.prototype.getOffsetPoint=function(t){var e=Math.round(this.model.data.length*t);return this.getPoint(e)},a.prototype.makePoint=function(t,e,n,a){var r,o,s,l,c,h=this.model.data;if(t>e&&n>t){if(r=i(h,t),r.right===r.left)return h[r.right];o=h[r.right],s=h[r.left],l={},c=(t-s.$x)/(o.$x-s.$x),Object.keys(o).forEach(function(t){var e=s[t],i=o[t];void 0!==e&&null!==e&&void 0!==i&&null!==i&&(l[t]=e+(i-e)*c)}),l.$faux=!0}else l={$x:t};return l.$interval=a?a(l.$x):l.$x,l},a.prototype.getClosest=function(t,e){return n(e||this.model.data,t)},a.prototype.getSampledClosest=function(t){return this.getClosest(t,this.sampledData)},a.prototype.register=function(t){this.components.push(t)},a.prototype.hasData=function(){var t=this.pane.y.minimum,e=this.pane.y.maximum;return(t||0===t)&&(e||0===e)},a.prototype.calcBounds=function(){var t,e,i,n,a,r=this.graph.box,o=this.pane;o.adjust(this),e=parseInt(o.filtered.length/r.innerWidth)||1,a=o.filtered.filter(function(i,n){return o.x.start===i||o.x.stop===i||n%e===0?(t=i,i.$sampled=i,!0):(i.$sampled=t,!1)}),this.graph.samples[this.name]=a,this.components.forEach(function(t){var e;t.parse&&(e=t.parse(a,o.filtered),e&&(null!==e.min&&(!i&&0!==i||i>e.min)&&(i=e.min),null!==e.max&&(!n&&0!==n||n<e.max)&&(n=e.max)))}),o.y.top=n,o.y.bottom=i,o.y.minimum=i,o.y.maximum=n,this.sampledData=a},a.prototype.calcScales=function(t){var e,i=this.pane,n=this.graph.box,a=i.y.minimum,r=i.y.maximum;i.y.padding&&(e=r===a?a*i.y.padding:(r-a)*i.y.padding,r+=e,a-=e,i.y.minimum=a,i.y.maximum=r),i.x.start?(this.model.adjustSettings&&this.model.adjustSettings(i.x.stop.$interval-i.x.start.$interval,r-a,i.filtered.$last-i.filtered.$first),this.x.scale.domain([i.x.start.$interval,i.x.stop.$interval]).range([n.innerLeft,n.innerRight]),this.y.scale.domain([a,r]).range([n.innerBottom,n.innerTop]),this.sampledData.forEach(function(e){var i=this.x.scale(e.$interval);e._$interval=i,t.addIndex(Math.floor(i),e.$interval)[this.name]=e},this)):this.sampledData=[]},a.prototype.build=function(){var t=this.pane,e=this.sampledData;this.components.forEach(function(i){i.build&&i.build(t,e,t.filtered,t.data)})},a.prototype.process=function(){var t=this.pane,e=this.sampledData;this.components.forEach(function(i){i.process&&i.process(t,e,t.filtered,t.data)})},a.prototype.finalize=function(){var t=this.pane,e=this.sampledData;this.components.forEach(function(i){i.finalize&&i.finalize(t,e,t.filtered,t.data)})},a.prototype.loading=function(){this.components.forEach(function(t){t.loading&&t.loading()})},a.prototype.publishStats=function(){var t,e,i=this.model.data,n=this.pane.x.$max||9007199254740991,a=i.length;for(t=1;a>t;t++)e=i[t].$x-i[t-1].$x,n>e&&(n=e);return{step:n,count:i.length,bound:{min:this.pane.x.$min,max:this.pane.x.$max},data:{min:this.model.x.$min,max:this.model.x.$max}}},a.prototype.publishData=function(t,e,i){o(this.model.data,e.name,t,i,e.format)},a}]),angular.module("vgraph").directive("vgraphAxis",[function(){"use strict";function t(t,e){return!(t.bottom<e.top||t.top>e.bottom||t.right<e.left||t.left>e.right)}return{scope:{orient:"=vgraphAxis",adjust:"=axisAdjust",rotation:"=tickRotation"},require:["^vgraphChart"],link:function(e,i,n,a){var r,o,s,l,c,h,u,d,f,p,g,m=n.control||"default",v=a[0].graph,x=v.views[m],y=d3.svg.axis(),$="axis",b=v.box,w=x.model,k=0,C=null,P=!0,M=!1,N=parseInt(n.tickLength)||0,L=parseInt(n.tickPadding)||3,T=parseInt(n.tickMargin)||0,E=d3.select(i[0]);switch(E.attr("visibility","hidden"),h=E.append("g").attr("class","ticks"),p=E.append("g").attr("class","padding"),u=p.append("g").attr("class","tick-marks"),d=p.append("rect").attr("class","tick-margin"),g=E.append("g").attr("class","label-wrap"),n.tickRotation&&(C=parseInt(n.tickRotation,10)%360),n.labelOffset&&(k=e.$eval(n.labelOffset)),n.labelClean&&(P=e.$eval(n.labelClean)),n.labelEndpoints&&(M=e.$eval(n.labelEndpoints)),n.axisLabel&&(f=g.append("text").attr("class","axis-label label"),e.$parent.$watch(n.axisLabel,function(t){f.text(t)})),r=function(){n.tickMarks?(y.tickValues(e.$eval(n.tickMarks)),s=[]):n.tickCount?(y.ticks(e.$eval(n.tickCount)),s=[]):(y.ticks(10),s=[])},e.orient){case"top":o=function(){var t;E.attr("class",$+" x top").attr("transform","translate("+b.left+","+(b.top-N)+")").attr("width",b.width).attr("height",b.padding.top),f&&f.attr("text-anchor","middle").attr("x",b.width/2).attr("y",b.padding.top-k),T&&d.attr("height",T).attr("width",b.innerWidth).attr("x",0).attr("y",-T),u.attr("transform","translate(-"+b.margin.left+",0)"),s&&(y.orient("top").tickFormat(w.x.format).innerTickSize(-(b.innerHeight+N+T)).outerTickSize(0).tickPadding(L+N+T).scale(x.x.scale),w.x.tick.interval&&y.ticks(w.x.tick.interval,w.x.tick.step),h.attr("transform","translate(-"+b.margin.left+","+b.padding.top+")").call(y),t=E.selectAll("g.axis-cap").data(x.x.scale.domain()),M&&(t.enter().append("g").attr("class",function(t,e){return"axis-cap "+(e?"axis-max":"axis-min")}).append("text"),t.exit().remove(),t.attr("transform",function(t){return"translate("+(x.x.scale(t)-b.margin.left)+",0)"}).select("text").text(function(t){var e=w.x.format(t);return(""+e).match("NaN")?"":e}).attr("dy","-0.25em").attr("y",b.padding.top).attr("text-anchor","middle")),C&&(h.selectAll(".tick text").attr("transform","translate(0,"+h.select(".tick text").attr("y")+") rotate("+C+",0,0)").attr("y","0").style("text-anchor",C%360>0?"end":"start"),t.select("text").attr("transform","rotate("+C+",0,0)").style("text-anchor",e.rotation%360>0?"end":"start")))};break;case"bottom":o=function(){var t;E.attr("class",$+" x bottom").attr("transform","translate("+b.left+","+b.innerBottom+")").attr("width",b.width).attr("height",b.padding.bottom),f&&f.attr("text-anchor","middle").attr("x",b.width/2).attr("y",b.padding.bottom+k),T&&d.attr("height",T).attr("width",b.innerWidth).attr("x",0).attr("y",0),u.attr("transform","translate(-"+b.margin.left+",0)"),s&&(y.orient("bottom").tickFormat(w.x.format).innerTickSize(b.innerHeight+N+T).outerTickSize(0).tickPadding(L+N+T).scale(x.x.scale),w.x.tick.interval&&y.ticks(w.x.tick.interval,w.x.tick.step),h.attr("transform","translate(-"+b.margin.left+","+-b.innerHeight+")").call(y),t=E.selectAll("g.axis-cap").data(x.x.scale.domain()),M&&(t.enter().append("g").attr("class",function(t,e){return"axis-cap "+(e?"axis-max":"axis-min")}).append("text"),t.exit().remove(),t.attr("transform",function(t){return"translate("+(x.x.scale(t)-b.margin.left)+",0)"}).select("text").text(function(t){var e=w.x.format(t);return(""+e).match("NaN")?"":e}).attr("dy","1em").attr("y",0).attr("text-anchor","middle")),C&&(h.selectAll(".tick text").attr("transform",function(){return"translate(0,"+d3.select(this).attr("y")+") rotate("+C+",0,0)"}).attr("y","0").style("text-anchor",C%360>0?"start":"end"),t.select("text").attr("transform","rotate("+C+",0,0)").style("text-anchor",e.rotation%360>0?"start":"end")))};break;case"right":o=function(){var t;E.attr("class",$+" y right").attr("transform","translate("+N+","+b.top+")").attr("width",b.padding.right).attr("height",b.height),g.attr("transform","translate("+(b.right-b.padding.right)+","+b.height+") rotate( 90 )"),f&&f.attr("text-anchor","middle").attr("x",-(b.height/2)).attr("y",-k),T&&d.attr("height",b.innerHeight).attr("width",T).attr("x",-T).attr("y",0),u.attr("transform","translate(-"+b.padding.right+","+(-b.top||0)+")"),s&&(y.orient("right").tickFormat(w.y.format).innerTickSize(-(b.innerWidth+N+T)).outerTickSize(0).tickPadding(L+N+T).scale(x.y.scale),w.y.tick.interval&&y.ticks(w.y.tick.interval,w.y.tick.step),h.attr("transform","translate("+b.innerRight+","+(-b.top||0)+")"),h.call(y),h.select(".domain").attr("transform","translate("+(N+T)+",0)"),M&&(t=E.selectAll("g.axis-cap").data(x.y.scale.domain()),t.enter().append("g").attr("class",function(t,e){return"axis-cap "+(e?"axis-max":"axis-min")}).append("text"),t.exit().remove(),t.attr("transform",function(t){return"translate(0,"+(x.y.scale(t)-b.margin.top)+")"}).select("text").text(function(t){var e=w.y.format(t);return(""+e).match("NaN")?"":e}).attr("dy",".25em").attr("x",b.padding.left-y.tickPadding()).attr("text-anchor","end")))};break;case"left":o=function(){var t;E.attr("class",$+" y left").attr("transform","translate("+b.left+","+b.top+")").attr("width",b.padding.left).attr("height",b.height),g.attr("transform","translate("+b.padding.left+","+b.height+") rotate( -90 )"),f&&f.attr("text-anchor","middle").attr("x",b.height/2).attr("y",-k),T&&d.attr("height",b.innerHeight).attr("width",T).attr("x",-T).attr("y",0),u.attr("transform","translate("+b.padding.left+","+(-b.top||0)+")"),s&&(y.orient("left").tickFormat(w.y.format).innerTickSize(-(b.innerWidth+N+T)).outerTickSize(0).tickPadding(L+N+T).scale(x.y.scale),w.y.tick.interval&&y.ticks(w.y.tick.interval,w.y.tick.step),h.attr("transform","translate("+(b.padding.left-N-T)+","+(-b.top||0)+")").call(y),h.select(".domain").attr("transform","translate("+(N+T)+",0)"),M&&(t=E.selectAll("g.axis-cap").data(x.y.scale.domain()),t.enter().append("g").attr("class",function(t,e){return"axis-cap "+(e?"axis-max":"axis-min")}).append("text"),t.exit().remove(),t.attr("transform",function(t){return"translate(0,"+(x.y.scale(t)-b.margin.top)+")"}).select("text").text(function(t){var e=w.y.format(t);return(""+e).match("NaN")?"":e}).attr("dy",".25em").attr("x",b.padding.left-y.tickPadding()).attr("text-anchor","end")))}}x.register({build:function(){void 0===s&&r(),o()},process:function(){s.length=0,N&&(h.selectAll(".tick text").each(function(t){s.push({el:this,val:t,position:this.getBoundingClientRect()})}),s.sort(function(t,e){var i=t.position.top-e.position.top;return i?i:t.position.left-e.position.left})),P&&(l=E.select(".axis-min text").node(),l&&(l=l.getBoundingClientRect()),c=E.select(".axis-max text").node(),c&&(c=c.getBoundingClientRect()))},loading:function(){E.attr("visibility","hidden")},finalize:function(e,i){var n,a,r,o,h,d,f={};if(!i.length)return void E.attr("visibility","hidden");for(E.attr("visibility",""),u.selectAll("line").remove(),o=0,h=s.length;h>o;o++)n=!0,a=s[o],r=a.position,P&&l&&(t(r,l)||t(r,c))?(a.el.setAttribute("class","collided"),n=!1):void 0===f.left?(f.left=r.left,f.right=r.right,f.width=r.width,f.top=r.top,f.bottom=r.bottom,f.height=r.height,a.el.setAttribute("class","")):P&&t(r,f)?(a.el.setAttribute("class","collided"),n=!1):(d=!1,r.left<f.left&&(f.left=r.left,d=!0),r.right>f.right&&(f.right=r.right,d=!0),d&&(f.width=f.right-f.left,d=!1),r.top<f.top&&(f.top=r.top,d=!0),r.bottom>f.bottom&&(f.bottom=r.bottom,d=!0),d&&(f.height=f.bottom-f.top),a.el.setAttribute("class",""))}},"axis-"+e.orient)}}}]),angular.module("vgraph").directive("vgraphBar",["$compile","ComponentGenerator",function(t,e){"use strict";return{require:["^vgraphChart"],scope:{data:"=?vgraphBar",config:"=config"},link:function(i,n,a,r){function o(n){var a,r,o,s;if(n){for(d3.select(f).selectAll("path").remove(),l=e.compileConfig(i,n,"line");d.length;)d.pop().$destroy();for(r=0,o=l.length;o>r;r++)s=l[r],s.$valueField="$"+s.name,r?(f.insertBefore(s.element,l[r-1].element),s.$bottom=l[r-1].$valueField,s.calc=e.makeLineCalc(u,s.$valueField,s.$bottom)):(f.appendChild(s.element),s.calc=e.makeLineCalc(u,s.$valueField)),a=i.$new(),d.push(a),t(s.element)(a)}}function s(t,e,i,n){var a,r,o,s,c,d,f,v,x,y,$,b,w,k,C,P;for(c=e;i>c;c++)x=t[c],
x&&(x.$els=[]);for(o=0,s=l.length;s>o;o++){for(f=l[o],P=l[o].$valueField,d=0,v=0,c=e,r=[];i>c;)x=t[c],x&&void 0!==x[P]&&(d+=x[P],v++,y=x),c++;if(d){for(b=u.y.scale(d/v),void 0===w&&(t[e]===y?(w=y._$interval-p/2,k=w+p):(w=t[e]._$interval+g,k=y._$interval-g),w<h.box.innerLeft?w=h.box.innerLeft:t[e-1]&&t[e-1]._$interval>w&&(w=t[e-1]._$interval+g),k>h.box.innerRight?k=h.box.innerRight:t[c]&&t[c]._$interval<k&&(k=t[c]._$interval-g),w>k&&(C=w,w=k,k=C),C=k-w),void 0===$?a=m.append("rect").attr("height",u.y.scale(n.y.minimum)-b):(a=m.append("rect"),$>b&&a.attr("height",$-b)),a.attr("class","bar "+f.className).attr("y",b).attr("x",w).attr("width",C),a=a[0][0],c=e;i>c;c++)x=t[c],x&&(x.$els.push(a),x.$bar={center:(w+k)/2,top:d/v});$=b}}}var l,c=a.control||"default",h=r[0].graph,u=h.views[c],d=[],f=n[0],p=parseInt(a.minWidth||1),g=parseInt(a.padding||1),m=d3.select(f).append("g").attr("class","mount");i.$watchCollection("config",o),u.register({parse:function(t){return e.parseStackedLimits(t,l)},build:function(t,e){var i,n,a=0,r=u.x.scale(t.x.min.$interval),o=u.x.scale(t.x.max.$interval),l=o-r,c=g+p,h=l/c,d=e.length/h;for(m.selectAll("rect").remove(),1>d&&(d=1),i=0,n=e.length;n>i;i=Math.floor(a))a+=d,s(e,i,a,t)},finalize:function(t,e){var i,n,a;for(i=0,n=l.length;n>i;i++)a=l[i],a.$d3.attr("d",a.calc(e))}})}}}]),angular.module("vgraph").directive("vgraphChart",[function(){"use strict";function t(t,e){e&&(t.$mat=d3.select(e).insert("rect",":first-child"),t.$frame=d3.select(e).insert("rect",":first-child")),t.$mat&&t.innerWidth&&(t.$mat.attr("class","mat").attr("width",t.innerWidth).attr("height",t.innerHeight).attr("transform","translate("+t.innerLeft+","+t.innerTop+")"),t.$frame.attr("class","frame").attr("width",t.width).attr("height",t.height).attr("transform","translate("+t.left+","+t.top+")"))}return{scope:{graph:"=vgraphChart",model:"=model"},controller:["$scope",function(e){var i=e.model,n=e.graph;this.graph=n,n.addDataCollection(i),n.box.register(function(){t(n.box),n.rerender()})}],require:["vgraphChart"],link:function(e,i,n,a){var r=a[0].graph;r.box.targetSvg(i),t(r.box,i[0]),e.$watch("model.loading",function(t){t?i.addClass("loading"):i.removeClass("loading")}),e.$watch("model.error",function(t){t?i.addClass("hasError"):i.removeClass("hasError")})},restrict:"A"}}]),angular.module("vgraph").directive("vgraphClassifier",["ComponentGenerator",function(t){"use strict";function e(t,e,i){var n,a;for(n=i.length-1;n>=0;n--)a=i[n],a.$els.length&&(e(a)?$(a.$els).addClass(t):$(a.$els).removeClass(t))}return t.generate("vgraphClassifier",{scope:{classes:"=classes"},preLink:function(t){t.loadPoint=function(t){var e=this.intervalParse(t),i=this.model.getPoint(e);i&&this.valueParse(t,i)}},link:function(t,i,n,a){var r=n.control||"default",o=a[0].graph.views[r];o.register({finalize:function(i,n){var a,r,o,s,l=t.classes,c=Object.keys(l);for(a=0,r=c.length;r>a;a++)o=c[a],s=l[o],e(o,s,n)}})}})}]),angular.module("vgraph").directive("vgraphCompare",["$compile","ComponentGenerator",function(t,e){"use strict";return{require:["^vgraphChart"],scope:{config:"=config"},link:function(t,i,n,a){function r(t){function i(){o.$d3.attr("d",o.calc(s.unified)),a=!1,r=!1}var a=!1,r=!1,c=Object.keys(t),h=c[0],u=s.views[t[h]],d=c[1],f=s.views[t[d]],p=n.reference||"$compare";t&&2===c.length&&(o&&o.$d3.remove(),o={$d3:d3.select(l).append("path").attr("class","fill"),calc:e.makeMyFillCalc(u,h,f,d,function(t,e,i,n,a){t[p]={value:{dif1:e-i,dif2:i-e,middle:(e+i)/2,difference:Math.abs(e-i)},position:{middle:(n+a)/2,top:n,bottom:a}}})},u.register({finalize:function(){a=!0,i()}}),f.register({finalize:function(){r=!0,i()}}))}var o,s=a[0].graph,l=i[0];t.$watchCollection("config",r)}}}]),angular.module("vgraph").directive("vgraphFeed",["ComponentGenerator",function(t){"use strict";return t.generate("vgraphFeed",{restrict:"A"})}]),angular.module("vgraph").directive("vgraphFill",["$compile","ComponentGenerator",function(t,e){"use strict";return e.generate("vgraphFill",{scope:{data:"=vgraphFill",fillTo:"=fillTo",value:"=value",interval:"=interval",filter:"=filter"},link:function(i,n,a,r){var o,s=a.control||"default",l=r[0].graph.views[s],c=a.name,h=d3.select(n[0]).append("path").attr("class","fill plot-"+c),u=d3.svg.area().defined(function(t){var e=t[c];return!(isNaN(e)||null===e)}).x(function(t){return l.x.scale(t.$interval)}).y(function(t){return l.y.scale(t[c])}).y1(function(t){var e,n=i.fillTo;return e=l.y.scale(void 0===n?l.pane.y.minimum:"object"==typeof n?i.fillTo.$min:"string"==typeof n?t[n]:n)});"string"==typeof i.fillTo&&(o=e.svgCompile('<g vgraph-feed="data" name="'+i.fillTo+'" value="fillTo" interval="interval" control="'+s+'"></g>')[0],n[0].appendChild(o),t(o)(i)),l.register({parse:function(t,i){return e.parseLimits(i,c)},finalize:function(t,e){h.attr("d",u(e))}})}})}]),angular.module("vgraph").directive("vgraphFocus",[function(){"use strict";return{require:["^vgraphChart"],link:function(t,e,i,n){var a=n[0].graph,r=a.box,o=d3.select(e[0]),s=o.append("rect").attr("class","focus").attr("visibility","hidden");r.register(function(){s.attr("height",r.innerHeight).attr("y",r.innerTop)}),t.$watch("follow",function(t){var e,i,n;t&&void 0!==t.xDiff&&(e=Math.abs(t.xDiff),i=t.x0-e,n=t.x0+e,s.attr("visibility","visible"),i>r.innerLeft?s.attr("x",i):(i=r.innerLeft,s.attr("x",r.innerLeft)),n>r.innerRight?s.attr("width",r.innerRight-i):s.attr("width",n-i))}),t.$watch("stop",function(t){var e,i,n,o,l;t&&(s.attr("visibility","hidden"),e=Math.abs(t.xDiff),e>3&&(i=t.x0-e,n=t.x0+e,i<r.innerLeft?i=0:i-=r.innerLeft,n>r.innerRight?n=r.innerWidth:n-=r.innerLeft,o=a.getPrimaryView().pane.offset,l=r.innerWidth*o.right-r.innerWidth*o.left,a.setPane({start:"%"+(r.innerWidth*o.left+i/r.innerWidth*l)/r.innerWidth,stop:"%"+(r.innerWidth*o.right-(r.innerWidth-n)/r.innerWidth*l)/r.innerWidth},{start:null,stop:null}),a.rerender()))})},scope:{follow:"=vgraphFocus",stop:"=loseFocus"}}}]),angular.module("vgraph").directive("vgraphIcon",["ComponentGenerator",function(t){"use strict";return t.generate("vgraphIcon",{scope:{getValue:"=trueValue"},link:function(e,i,n,a){var r,o,s,l=n.control||"default",c=a[0].graph.views[l],h=i[0],u=n.name,d=[],f=d3.select(h),p=f.node().getBBox();for(void 0===n.value&&(e.value=u),r=0,o=h.childNodes.length;o>r;r++)1===h.childNodes[r].nodeType&&d.push(h.childNodes[r]);i.html(""),c.register({parse:function(e,i){return s=[],t.parseLimits(i,u,function(t,e){e&&s.push(t)})},build:function(){function t(){return this.appendChild(d[o].cloneNode(!0))}var a,r,o,l;i.html(""),angular.forEach(s,function(i){var s;for(a=i.$sampled._$interval,r=c.y.scale(e.getValue(i.$sampled)),s=f.append("g"),o=0,l=d.length;l>o;o++)s.select(t);n.showUnder?s.attr("transform","translate("+(a-p.width/2)+","+r+")"):s.attr("transform","translate("+(a-p.width/2)+","+(r-p.height)+")")})}})}})}]),angular.module("vgraph").directive("vgraphIndicator",[function(){"use strict";return{require:["^vgraphChart"],scope:{model:"=model"},link:function(t,e,i,n){var a,r=i.control||"default",o=n[0].graph.views[r],s=i.vgraphIndicator,l=o.model,c=t.$eval(i.pointRadius)||3,h=t.$eval(i.outerRadius),u=d3.select(e[0]).attr("transform","translate(1000,1000)"),d=u.append("circle").attr("class","point inner").attr("r",c).attr("visibility","hidden"),f=u.append("circle").attr("class","point outer").attr("r",c).attr("visibility","hidden");h&&(a=function(){f.transition().duration(1e3).attr("r",h).transition().duration(1e3).attr("r",c).ease("sine").each("end",function(){setTimeout(function(){a()},3e3)})})(),o.register({finalize:function(t){var e,i,n;l.plots[s]?(e=l.plots[s].x.max,t.isValid(e)&&e[s]?(i=o.x.scale(e.$interval),n=o.y.scale(e["$"+s]||e[s]),d.attr("visibility","visible"),f&&f.attr("visibility","visible"),u.transition().duration(l.transitionDuration).ease("linear").attr("transform","translate("+i+","+n+")")):(d.attr("visibility","hidden"),f&&f.attr("visibility","hidden"))):(d.attr("visibility","hidden"),f&&f.attr("visibility","hidden"))}})}}}]),angular.module("vgraph").directive("vgraphInteract",[function(){"use strict";return{require:["^vgraphChart"],scope:{highlight:"=vgraphInteract",dragStart:"=?dBegin",dragPos:"=?dChange",dragStop:"=?dEnd"},link:function(t,e,i,n){function a(e,i,n,a){clearTimeout(s),t.$apply(function(){var r=d3.mouse(e);angular.forEach(t.highlight.point,function(t){$(t.$els).removeClass("active")}),t.highlight.offset=i,t.highlight.point=n,t.highlight.closest=a,t.highlight.position={x:r[0],y:r[1]},angular.forEach(t.highlight.point,function(t){$(t.$els).addClass("active")})})}function r(){s=setTimeout(function(){t.$apply(function(){angular.forEach(t.highlight.point,function(t){$(t.$els).removeClass("active")}),t.highlight.point=null,t.highlight.closest=null,t.highlight.offset=null})},100)}var o,s,l=n[0].graph,c=!1,h=l.box,u=d3.select(e[0]),d=u.append("rect").style("opacity","0").attr("class","focal").on("mousemove",function(){var t,e={},i=d3.mouse(this)[0];c||(t=Object.keys(l.views),t.forEach(function(t){var n=l.views[t],a=n.x.scale.invert(i);e[t]=n.getSampledClosest(a)}),a(this,i,l.unified.getClosest(i),e))}).on("mouseout",function(t){c||r(this,t)});u.attr("class","interactive"),u.call(d3.behavior.drag().on("dragstart",function(){o=d3.mouse(e[0]),c=!0,r(),t.dragStart={x:o[0],y:o[1]},t.$apply()}).on("dragend",function(){var i=d3.mouse(e[0]);c=!1,t.dragStop={x0:o[0],y0:o[1],x1:i[0],x2:i[1],xDiff:i[0]-o[0],yDiff:i[1]-o[1]},t.$apply()}).on("drag",function(){var i=d3.mouse(e[0]);t.dragPos={x0:o[0],y0:o[1],x1:i[0],x2:i[1],xDiff:i[0]-o[0],yDiff:i[1]-o[1]},t.$apply()})),u.on("dblclick",function(){l.setPane({start:null,stop:null},{start:null,stop:null}),l.rerender()}),angular.forEach(l.views,function(t){t.register({finalize:function(){d.attr({x:h.innerLeft,y:h.innerTop,width:h.innerWidth,height:h.innerHeight})}})}),t.highlight||(t.highlight={}),t.dragStart||(t.dragStart={}),t.dragPos||(t.dragPos={}),t.dragStop||(t.dragStop={})}}}]),angular.module("vgraph").directive("vgraphLeading",[function(){"use strict";return{require:["^vgraphChart"],scope:{config:"=config"},link:function(t,e,i,n){function a(t){var e,i,n;if(r={},c.selectAll("line").remove(),t)for(i=0,n=t.length;n>i;i++)e=t[i],r[e.name]=c.append("line").attr("class",e.className)}var r,o=i.control||"default",s=n[0].graph,l=s.views[o],c=d3.select(e[0]);t.$watchCollection("config",a),l.register({finalize:function(t){var e,i,n=l.model,a=[];angular.forEach(r,function(i,r){n.plots[r]&&(e=n.plots[r].x.max,t.isValid(e)&&e[r]&&a.push({el:i,x:l.x.scale(e.$interval),y:l.y.scale(e["$"+r]||e[r])}))}),a.sort(function(t,e){return t.y-e.y}),angular.forEach(a,function(t){i&&i.el.attr("x1",i.x).attr("x2",t.x).attr("y1",i.y).attr("y2",t.y),i=t}),i?(c.style("visibility","visible"),i.el.attr("x1",i.x).attr("x2",i.x).attr("y1",i.y).attr("y2",s.box.innerBottom)):c.style("visibility","hidden")}})}}}]),angular.module("vgraph").directive("vgraphLine",["ComponentGenerator",function(t){"use strict";return t.generate("vgraphLine",{link:function(e,i,n,a){var r=n.control||"default",o=a[0].graph.views[r],s=n.name,l=d3.select(i[0]).append("path").attr("class","line plot-"+s),c=t.makeLineCalc(o,s);o.register({parse:function(e){return t.parseLimits(e,s)},finalize:function(t,e){var i;l.attr("d",c(e.filter(function(t,n){var a,r=i;return i=t[s],r!==i?!0:(a=e[n+1],!a||a[s]!==i)})))},publish:function(e,i,n,a){i.push(s),t.publish(e,s,n,a)}})}})}]),angular.module("vgraph").directive("vgraphLoading",["$interval",function(t){"use strict";return{require:["^vgraphChart"],link:function(e,i,n,a){function r(){!f&&d.loading&&(m.attr("visibility","visible"),f=!0,t.cancel(l),s(),l=t(s,4005))}function o(){m.attr("visibility","hidden"),f=!1,t.cancel(l)}function s(){x.attr("x",function(){return c}).attr("width",function(){return 0}).transition().duration(1e3).attr("x",function(){return c}).attr("width",function(){return h}).ease("sine").transition().duration(1e3).attr("width",0).attr("x",function(){return u}).ease("sine").transition().duration(1e3).attr("width",function(){return h}).attr("x",function(){return c}).ease("sine").transition().duration(1e3).attr("x",function(){return c}).attr("width",0).ease("sine")}var l,c,h,u,d=a[0].graph,f=!1,p=d.box,g=n.vgraphLoading||"Loading Data",m=d3.select(i[0]).attr("class","loading-view"),v=m.append("rect").attr("height",20).attr("class","outline"),x=m.append("rect").attr("width",0).attr("height",20).attr("class","filling"),y=m.append("text").text(g);p.register(function(){if(c=p.innerLeft+p.innerWidth/5,h=3*p.innerWidth/5,u=c+h,h){x.attr("x",c).attr("y",p.middle-10),v.attr("x",c).attr("y",p.middle-10).attr("width",h);try{y.attr("text-anchor","middle").attr("x",p.center).attr("y",p.middle+y.node().getBBox().height/2-2)}catch(t){y.attr("text-anchor","middle").attr("x",p.center).attr("y",p.middle)}r()}else o()}),e.$on("$destroy",function(){o()}),e.$watch(function(){return d.loading},function(t){o(),t&&p.ratio&&r()})}}}]),angular.module("vgraph").directive("vgraphMessage",[function(){"use strict";return{require:["^vgraphChart"],link:function(t,e,i,n){var a=n[0].graph,r=a.box,o=d3.select(e[0]).attr("class","error-view"),s=o.append("rect").attr("class","outline"),l=o.append("text");r.register(function(){if(r.innerHeight){s.attr("transform","translate("+r.innerLeft+","+r.innerTop+")").attr("width",r.innerWidth).attr("height",r.innerHeight);try{l.attr("text-anchor","middle").attr("x",r.center).attr("y",r.middle+l.node().getBBox().height/2)}catch(t){l.attr("text-anchor","middle").attr("x",r.center).attr("y",r.middle)}}}),t.$watch(function(){return a.message},function(t){t&&!a.loading?(o.attr("visibility","visible"),l.text(t)):o.attr("visibility","hidden")})}}}]),angular.module("vgraph").directive("vgraphMultiIndicator",["$compile",function(t){"use strict";return{scope:{config:"=config"},link:function(e,i,n){function a(i){var a,s,l,c,h,u,d,f,p=e.$eval(n.pointRadius)||3,g=e.$eval(n.outerRadius),m="";if(i){for(d3.select(o).selectAll("g").remove();r.length;)r.pop().$destroy();for(l=0,c=i.length;c>l;l++)f=i[l],d=f.name,h=f.className?f.className:"plot-"+d,m+='<g class="'+h+'" vgraph-indicator="'+d+'"'+(g?' outer-radius="'+g+'"':"")+' point-radius="'+p+'"></g>';for(u=(new DOMParser).parseFromString('<g xmlns="http://www.w3.org/2000/svg">'+m+"</g>","image/svg+xml").childNodes[0].childNodes;u.length;)s=u[0],o.appendChild(s),a=e.$new(),r.push(a),t(s)(a)}}var r=[],o=i[0];e.$watchCollection("config",a)}}}]),angular.module("vgraph").directive("vgraphMultiLine",["$compile","ComponentGenerator",function(t,e){"use strict";var i=0;return{require:["^vgraphChart"],scope:{data:"=vgraphMultiLine",config:"=config"},link:function(n,a,r,o){function s(i){var a,r,o,s,h,f;if(c=[],i){for(d3.select(m).selectAll("path").remove();g.length;)g.pop().$destroy();for(h=e.compileConfig(n,i,"line"),p={},r=0,o=h.length;o>r;r++)f=h[r],s=d.views[f.$conf.control||u],p[s.name]||(p[s.name]=[],l(s)),p[s.name].push(f),m.appendChild(f.element),f.calc=e.makeLineCalc(s,f.name),a=n.$new(),g.push(a),t(f.element)(a)}}function l(t){f[t.name]||(f[t.name]=t,t.register({parse:function(i){var n,a,r=[],o=p[t.name];if(o)for(n=0,a=o.length;a>n;n++)r.push(o[n].name);return e.parseLimits(i,r)},finalize:function(e,i){var n,a,r,o=p[t.name];if(o)for(n=0,a=o.length;a>n;n++)r=o[n],r.$d3.attr("d",r.calc(i))}}))}var c,h,u=r.control||"default",d=o[0].graph,f={},p={},g=[],m=a[0],v=i++;m.$id=v,h=n.$watchCollection("config",s),n.$on("$destroy",function(){for(;g.length;)g.pop().$destroy();h()})}}}]),angular.module("vgraph").directive("vgraphMultiTooltip",["$compile",function(t){"use strict";return{scope:{config:"=config",formatter:"=textFormatter",data:"=vgraphMultiTooltip"},link:function(e,i,n){function a(i){var a,s,l,c,h,u,d,f,p="";if(i){for(d3.select(o).selectAll("g").remove();r.length;)r.pop().$destroy();for(l=0,c=i.length;c>l;l++)f=i[l],d=f.name,h=f.className?f.className:"plot-"+d,p+='<g class="'+h+'" vgraph-tooltip="data" name="'+d+'" text-formatter="formatter"'+(n.offseX?' offset-x="'+n.offsetX+'"':"")+(n.offseY?' offset-y="'+n.offsetY+'"':"")+"></g>";for(u=(new DOMParser).parseFromString('<g xmlns="http://www.w3.org/2000/svg">'+p+"</g>","image/svg+xml").childNodes[0].childNodes;u.length;)s=u[0],o.appendChild(s),a=e.$new(),r.push(a),t(s)(a)}}var r=[],o=i[0];e.$watchCollection("config",a)}}}]),angular.module("vgraph").directive("vgraphStack",["$compile","ComponentGenerator",function(t,e){"use strict";return{require:["^vgraphChart"],scope:{config:"=config"},link:function(i,n,a,r){function o(n){var a,r,o,l;if(n){for(d3.select(d).selectAll("path").remove(),s=e.compileConfig(i,n,"fill");u.length;)u.pop().$destroy();for(r=0,o=s.length;o>r;r++)l=s[r],l.$valueField="$"+l.name,r?(d.insertBefore(l.element,s[r-1].element),l.$bottom=s[r-1].$valueField,l.calc=e.makeMyFillCalc(h,l.$valueField,h,l.$bottom)):(d.appendChild(l.element),l.calc=e.makeMyFillCalc(h,l.$valueField)),a=i.$new(),u.push(a),t(l.element)(a)}}var s,l=a.control||"default",c=r[0].graph,h=c.views[l],u=[],d=n[0];i.$watchCollection("config",o),h.register({parse:function(t){return e.parseStackedLimits(t,s)},finalize:function(){var t,e,i;for(t=0,e=s.length;e>t;t++)i=s[t],i.$d3.attr("d",i.calc(c.unified))}})}}}]),angular.module("vgraph").directive("vgraphTarget",[function(){"use strict";return{require:["^vgraphChart"],scope:{pointRadius:"=pointRadius",target:"=vgraphTarget",config:"=?config"},link:function(t,e,i,n){function a(t){var e,i,n={};if(t)for(e=0,i=t.length;i>e;e++)t[e]&&(n[t[e].name]=t[e].className);return n}function r(t){o=t,t?(h.style("visibility","visible").attr("transform","translate("+t+",0)"),angular.forEach(p,function(t){t&&t()})):h.style("visibility","hidden")}var o,s,l=n[0].graph,c=l.box,h=d3.select(e[0]).attr("class","target"),u=h.append("line").attr("class","focus").attr("x1",0).attr("x2",0),d=h.append("g"),f=i.type||"point",p={};i.offset?t.$watch("target.offset",r):t.$watch("target.point.$index",function(t){r(t)}),t.$watchCollection(function(){var e=i.control;try{e=t.$eval(i.control),angular.isString(e)&&(e=[e])}catch(n){}return e||(e=i.control?[i.control]:Object.keys(l.views)),e},function(e){angular.forEach(s,function(t){t()}),s=[],angular.forEach(e,function(e){var n,r=l.views[e],c=r.model;n=t.$watch('config["'+e+'"]',function(n){var s=a(n);p[e]=function(){var n,a,l=t.target[f][e];if(s&&l&&void 0===i.noDots){d.selectAll("circle.point."+e).remove();for(n in c.plots)l[n]&&(a=s[n]||"plot-"+n,d.append("circle").attr("class","point "+a+" "+e).attr("cx",i.offset?l._$interval-o:0).attr("cy",r.y.scale(l[n])).attr("r",t.$eval(i.pointRadius)||3))}else d.selectAll("circle.point."+e).remove()}}),s.push(function(){n(),p[e]=null})})}),c.register(function(){u.attr("y1",c.innerTop).attr("y2",c.innerBottom)})}}}]),angular.module("vgraph").directive("vgraphTooltip",[function(){"use strict";return{require:["^vgraphChart"],scope:{formatter:"=textFormatter",data:"=vgraphTooltip",value:"=?value",position:"=?yValue"},link:function(t,e,i,n){var a=i.control||"default",r=n[0].graph,o=r.views[a],s=i.name,l=t.formatter||function(t){var e=o.model;return e.y.format(e.y.parse(t))},c=parseInt(i.offsetX)||0,h=parseInt(i.offsetY)||0,u=d3.select(e[0]).attr("class","tooltip"),d=u.append("polygon").attr("class","outline").attr("transform","translate(0,-15)"),f=u.append("text").style("line-height","20").style("font-size","16").attr("class","label");t.$watch("data.point",function(e){var i,n,p,g,m;e&&(i=e[a],n=t.value?t.value(e):i[s],void 0!==n&&(p=t.position?t.position(e):o.y.scale(n),g=e.$index+c,f.text(l(n,i,e)),m=f.node().getComputedTextLength()+5,u.style("visibility","visible"),g+m+16<r.box.innerRight?(u.attr("transform","translate("+g+","+(p+h)+")"),f.attr("transform","translate(10,5)"),d.attr("points","0,15 10,0 "+(m+10)+",0 "+(m+10)+",30 10,30 0,15")):(u.attr("transform","translate("+(g-2*c-m-10)+","+(p+h)+")"),f.attr("transform","translate(5,5)"),d.attr("points","0,0 "+m+",0 "+(m+10)+",15 "+m+",30 0,30 0,0")))),void 0===n&&u.style("visibility","hidden")})}}}]),angular.module("vgraph").directive("vgraphZone",["ComponentGenerator",function(t){"use strict";return t.generate("vgraphZone",{link:function(t,e,i,n){var a=i.control||"default",r=n[0].graph,o=r.views[a],s=r.box,l=i.name,c=d3.select(e[0]).append("path").attr("class","line plot-"+l),h=d3.svg.area().defined(function(t){return t[l]===!0}).x(function(t){return o.x.scale(t.$interval)}).y(function(){return s.innerTop}).y1(function(){return s.innerBottom});o.register({finalize:function(t,e){c.attr("d",h(e))}})}})}]),angular.module("vgraph").directive("vgraphZoom",[function(){"use strict";return{scope:{target:"=vgraphZoom",min:"=zoomMin",max:"=zoomMax"},require:["^vgraphChart"],link:function(t,e,i,n){function a(e){0===o&&s===f.innerWidth?(m=!1,b.attr("class","focus")):(m=!0,b.attr("class","focus zoomed")),0>o&&(o=0),s>f.innerWidth&&(s=f.innerWidth),o>s?o=s:o>s&&(s=o),x.attr("transform","translate("+o+",0)"),y.attr("transform","translate(-"+o+",0 )").attr("width",o),w.attr("transform","translate("+s+",0)"),k.attr("width",f.innerWidth-s),b.attr("transform","translate("+o+",0)").attr("width",s-o),e||t.$apply(function(){p.setPane({start:"%"+o/f.innerWidth,stop:"%"+s/f.innerWidth},{start:null,stop:null}),p.rerender()})}var r,o,s,l,c,h,u,d=n[0].graph,f=d.box,p=t.target,g=!1,m=!1,v=d3.select(e[0]),x=v.append("g").attr("class","left-control min-control"),y=x.append("rect").attr("class","shade"),$=x.append("g").attr("class","control"),b=v.append("rect").attr("class","focus"),w=v.append("g").attr("class","right-control max-control"),k=w.append("rect").attr("class","shade"),C=w.append("g").attr("class","control");c=$.append("path").attr("d","M-0.5,23.33A6,6 0 0 0 -6.5,29.33V40.66A6,6 0 0 0 -0.5,46.66ZM-2.5,31.33V38.66M-4.5,31.33V38.66").attr("transform","translate(0,-9)").attr("class","nub"),l=$.append("rect").attr("width","10").attr("transform","translate(-10,0)"),u=C.append("path").attr("d","M0.5,23.33A6,6 0 0 1 6.5,29.33V40.66A6,6 0 0 1 0.5,46.66ZM2.5,31.33V38.66M4.5,31.33V38.66").attr("transform","translate(0,-9)").attr("class","nub"),h=C.append("rect").attr("width","10"),t.box=f,l.call(d3.behavior.drag().on("dragstart",function(){g=!0}).on("dragend",function(){g=!1}).on("drag",function(){o=d3.mouse(e[0])[0],a()})),h.call(d3.behavior.drag().on("dragstart",function(){g=!0}).on("dragend",function(){g=!1}).on("drag",function(){s=d3.mouse(e[0])[0],a()})),b.call(d3.behavior.drag().on("dragstart",function(){r={mouse:d3.mouse(e[0])[0],minPos:o,maxPos:s},g=!0}).on("dragend",function(){g=!1,m=!0}).on("drag",function(){var t=d3.mouse(e[0]),i=t[0]-r.mouse;m?(s=r.maxPos+i,o=r.minPos+i,a()):i>1&&(s=r.mouse+Math.abs(i),o=r.mouse-Math.abs(i),a(),m=!1)})),v.on("dblclick",function(){s=f.innerWidth,o=0,a()}),f.register(function(){v.attr("width",f.innerWidth).attr("height",f.innerHeight).attr("transform","translate("+f.innerLeft+","+f.innerTop+")"),u.attr("transform","translate(0,"+(f.innerHeight/2-30)+")"),c.attr("transform","translate(0,"+(f.innerHeight/2-30)+")"),y.attr("height",f.innerHeight),k.attr("height",f.innerHeight),l.attr("height",f.innerHeight),h.attr("height",f.innerHeight),b.attr("height",f.innerHeight)}),p.register(function(t){g||(t.offset?(o=t.offset.left*f.innerWidth,s=t.offset.right*f.innerWidth):(o=0,s=f.innerWidth),a(!0))})}}}]),function(t){"use strict";var e=/\S+/g,i=/[\t\r\n\f]/g;t&&(t.fn.addClass=function(n){var a,r,o,s,l,c,h,u="string"==typeof n&&n,d=0,f=this.length;if(t.isFunction(n))return this.each(function(e){t(this).addClass(n.call(this,e,this.className))});if(u)for(a=(n||"").match(e)||[];f>d;d++)if(r=this[d],h="string"!=typeof r.className,o=1===r.nodeType&&(r.className?(" "+(h?r.getAttribute("class")||"":r.className)+" ").replace(i," "):" ")){for(l=0;s=a[l++];)o.indexOf(" "+s+" ")<0&&(o+=s+" ");c=t.trim(o),r.className!==c&&(h?r.setAttribute("class",c):r.className=c)}return this},t.fn.removeClass=function(n){var a,r,o,s,l,c,h,u=0===arguments.length||"string"==typeof n&&n,d=0,f=this.length;if(t.isFunction(n))return this.each(function(e){t(this).removeClass(n.call(this,e,this.className))});if(u)for(a=(n||"").match(e)||[];f>d;d++)if(r=this[d],h="string"!=typeof r.className,o=1===r.nodeType&&(r.className?(" "+(h?r.getAttribute("class")||"":r.className)+" ").replace(i," "):"")){for(l=0;s=a[l++];)for(;o.indexOf(" "+s+" ")>=0;)o=o.replace(" "+s+" "," ");c=n?t.trim(o):"",r.className!==c&&(h?r.setAttribute("class",c):r.className=c)}return this})}(jQuery);
//# sourceMappingURL=vgraph.min.js.map