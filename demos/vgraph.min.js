angular.module("vgraph",[]),angular.module("vgraph").factory("Scheduler",[function(){"use strict";function a(){this.$scripts={},this.$master=this.schedule=[]}function b(){return+new Date}return a.prototype.startScript=function(a){a?this.$scripts[a]?(this.schedule=this.$scripts[a],this.schedule.length=0):this.schedule=this.$scripts[a]=[]:this.schedule=[]},a.prototype.endScript=function(a,b,c){this.schedule.push({$end:!0,always:a,success:b,failure:c}),this.$master.push(this.schedule),this.schedule=this.$master},a.prototype.loop=function(a,b,c){this.schedule.push({start:0,stop:a.length,data:a,op:b,ctx:c})},a.prototype.func=function(a,b){this.schedule.push({op:a,ctx:b})},a.prototype.run=function(){var a=this;this.$lock||(this.$lock=!0,setTimeout(function(){a.$eval()},5))},a.prototype.$eval=function(){function a(){f.$eval()}var c,d,e,f=this,g=!0,h=b(),i=h+500;try{for(;(e=this.schedule.shift())&&g;){if(e.length)for(;e.length;)this.schedule.unshift(e.pop());else if("start"in e)for(c=e.start,d=e.stop;d>c;c++)e.op.call(e.ctx,e.data[c],c);else e.$end?(e.success&&e.success(),e.always&&e.always()):e.op.call(e.ctx);b()>i&&(g=!1,setTimeout(a,5))}}catch(j){for(console.log(j),g=!0;(e=this.schedule.shift())&&g;)e.$end&&(e.failure&&e.failure(),e.always&&e.always(),a())}this.schedule.length||(this.$lock=!1)},a}]),angular.module("vgraph").factory("ComponentBox",[function(){"use strict";function a(a,b){var d=b.padding,e=a.padding,f=b.margin,g=a.margin;g||(a.margin=g={top:0,right:0,bottom:0,left:0}),f&&(g.top=c(f.top,g.top),g.right=c(f.right,g.right),g.bottom=c(f.bottom,g.bottom),g.left=c(f.left,g.left)),e||(a.padding=e={top:0,right:0,bottom:0,left:0}),d&&(e.top=c(d.top,e.top),e.right=c(d.right,e.right),e.bottom=c(d.bottom,e.bottom),e.left=c(d.left,e.left)),a.outerWidth=c(b.outerWidth,a.outerWidth)||0,a.outerHeight=c(b.outerHeight,a.outerHeight)||0,a.top=g.top,a.bottom=a.outerHeight-g.bottom,a.left=g.left,a.right=a.outerWidth-g.right,a.center=(a.left+a.right)/2,a.middle=(a.top+a.bottom)/2,a.width=a.right-a.left,a.height=a.bottom-a.top,a.innerTop=a.top+e.top,a.innerBottom=a.bottom-e.bottom,a.innerLeft=a.left+e.left,a.innerRight=a.right-e.right,a.innerWidth=a.innerRight-a.innerLeft,a.innerHeight=a.innerBottom-a.innerTop,a.ratio=a.outerWidth+" x "+a.outerHeight}function b(b){this.registrations=[],a(this,b||{})}function c(a,b){return void 0!==a?parseInt(a):b}return b.prototype.register=function(a){this.registrations.push(a)},b.prototype.targetSvg=function(a){this.$element=jQuery(a),this.resize()},b.prototype.resize=function(){var b,c,d=this.$element;if(d.attr("width",null).attr("height",null),d[0].style.cssText=null,a(this,{outerWidth:d.outerWidth(!0),outerHeight:d.outerHeight(!0),margin:{top:d.css("margin-top"),right:d.css("margin-right"),bottom:d.css("margin-bottom"),left:d.css("margin-left")},padding:{top:d.css("padding-top"),right:d.css("padding-right"),bottom:d.css("padding-bottom"),left:d.css("padding-left")}}),d.css("margin","0").css("padding","0").attr("width",this.outerWidth).attr("height",this.outerHeight).css({width:this.outerWidth+"px",height:this.outerHeight+"px"}),this.innerWidth&&this.innerHeight)for(b=0,c=this.registrations.length;c>b;b++)this.registrations[b]()},b}]),angular.module("vgraph").factory("ComponentChart",["$timeout","ComponentView","ComponentBox","DataCollection","LinearSamplerModel","makeEventing","Scheduler",function(a,b,c,d,e,f,g){"use strict";function h(){var a=this.$trigger.bind(this),b={};this.$vguid=++l,this.box=new c,this.views=b,this.models=[],this.waiting={},this.references={},this.loading=!0,this.message=null,this.$on("focus",function(c){var d=0,e=0,f={};c?(angular.forEach(b,function(a,b){var g;f[b]=a.getPoint(c.x),g=f[b].$pos,void 0!==g&&(e++,d+=g)}),f.$pos=d/e,f.pos=c,a("focus-point",f),a("highlight",f)):a("highlight",null)})}function i(a){var b,c;a.forEach(function(a){var d=a.viewport;(void 0===b||b>d.minValue)&&(b=d.minValue),(void 0===c||c<d.maxValue)&&(c=d.maxValue)}),a.forEach(function(a){a.setViewportValues(b,c)})}function j(a){var b,c;a.forEach(function(a){var d=a.viewport;(void 0===b||b>d.minInterval)&&(b=d.minInterval),(void 0===c||c<d.maxInterval)&&(c=d.maxInterval)}),a.forEach(function(a){a.setViewportIntervals(b,c)})}var k=new g,l=1;return f(h.prototype),h.defaultView="default",h.defaultModel="linear",h.prototype.setPage=function(a){this.page=a},h.prototype.configure=function(a,c){var d,f,g,i=Object.keys(this.views),j=this.addView.bind(this);for(c||(c={}),c.x||(c.x={}),c.y||(c.y={}),this.page=a,this.settings=c,this.normalizeY=c.normalizeY,this.normalizeX=c.normalizeX,d=0,f=i.length;f>d;d++)delete this.keys[i[d]];g=c.views,g?angular.isFunction(g)&&(g=g()):(g={},g[h.defaultView]=(new b).addModel(h.defaultModel,new e(function(a){return Math.round(a._$interval)}))),angular.forEach(g,j)},h.prototype.setInputReference=function(a,b){this.references[a]=b},h.prototype.render=function(){var a,b=this,c=[],d=!1,e=0;try{angular.forEach(this.views,function(b,c){a=c,b.parse()}),a=null,angular.forEach(this.views,function(b,e){a=e,b.hasData()?(c.push(b),d=!0):b.isReady()&&(d=!0)}),a=null,this.normalizeY&&i(c),this.normalizeX&&j(c)}catch(f){console.log("parsing error",a,f.stack)}e=c.length,this.loading=!d,k.startScript(this.$vguid),this.loading?(b.$trigger("loading"),k.func(function(){b.loading=!0,b.pristine=!1})):e?(k.func(function(){b.message=null}),k.loop(c,function(a){a.build()}),k.loop(c,function(a){a.process()}),k.loop(c,function(a){a.finalize()}),k.func(function(){b.loading=!1,b.pristine=!0})):(b.$trigger("error"),k.func(function(){b.message="No Data Available",b.pristine=!1})),k.endScript(function(){b.$trigger("done")},function(){b.$trigger("success")},function(){b.pristine=!1,b.message="Unable to Render",b.$trigger("error")}),k.run()},h.prototype.scheduleRender=function(b){var c=this;this.nrTimeout||(this.nrTimeout=a(function(){c.render(c.waiting,b),c.waiting={},c.nrTimeout=null},30))},h.prototype.rerender=function(a){this.scheduleRender(a),this.waiting=this.views},h.prototype.needsRender=function(a,b){this.scheduleRender(b),this.waiting[a.name]||(this.waiting[a.name]=a)},h.prototype.addView=function(a,b){var c=this,d=this.settings;this.views[b]=a,a.configure(d,this.box),a.setPage(this.page),void 0!==d.x.min&&(a.pane.setBounds({min:d.x.min,max:d.x.max}),d.x.interval&&d.x.max&&d.datumFactory&&a.manager.data.$fillPoints(d.x.min,d.x.max,d.x.interval,d.datumFactory)),void 0!==this.settings.x.minPane&&a.pane.setPane(this.settings.x.minPane,this.settings.x.maxPane),a.pane.rawContainer.register(function(){c.needsRender(a)}),a.pane.rawContainer.onError(function(a){c.error(a)})},h.prototype.error=function(a){a?(this.loading=!1,this.message=a):this.message=null,this.$trigger("error")},h.prototype.setPane=function(a,b){var c=this.views,d=Object.keys(this.views);this.settings.x.minPane=a,this.settings.x.maxPane=b,d.forEach(function(d){c[d].pane.setPane({start:a,stop:b})})},h}]),angular.module("vgraph").factory("ComponentGenerator",["$timeout","DrawLine","DrawArea","DrawBox","DataFeed","DataLoader","ComponentChart",function(a,b,c,d,e,f,g){"use strict";function h(a){var b,c;return"object"!=typeof a?null:(b=a.value,c=a.interval,void 0===a.$uid&&(a.$uid=j++),a.field=a.name,a.view||(a.view=g.defaultView),a.model||(a.model=g.defaultModel),a.className||(a.className="node-"+a.name),a.getValue||(a.getValue=function(b){return b[a.field]}),a)}function i(a){return null===a?!1:Number.isFinite?Number.isFinite(a)&&!Number.isNaN(a):isFinite(a)&&!isNaN(a)}var j=0;return{isNumeric:i,normalizeConfig:h,makeDiffCalc:function(a,b,d,e){var f=new c;return d||(d=a),f.preParse=function(c){var f,g,h=c[a.name],j=c[d.name];return h&&(f=h[b]),j&&(g=j[e]),i(f)&&i(g)?{interval:(h._$interval+j._$interval)/2,y1:a.y.scale(f),y2:d.y.scale(g)}:void 0},f.parseInterval=function(a){return a.interval},f.parseValue1=function(a){return a.y1},f.parseValue2=function(a){return a.y2},function(a){return f.render(a).join("")}},makeAreaCalc:function(a){return d3.svg.area().defined(function(a){return i(a[name])}).x(function(a){return a._$interval}).y(function(b){return a.y.scale(b[name+"$Min"])}).y1(function(b){return a.y.scale(b[name+"$Max"])})},makeLineCalc:function(a,c){var d,e,f=new b;return f.preParse=function(a,b){var c=a[e];return i(c)?a:b&&void 0===c?(a[e]=b[e],a):null},f.parseValue=function(a){return d.y.scale(a[e])},f.parseInterval=function(a){return a._$interval},function(b){return e=c.field,d=a.views[c.view],f.render(b).join("")}},makeFillCalc:function(a,b,d){var e,f,g,h,j=new c;return j.preParse=function(a){var b,c;return b=a[g],c=h?a[h]:f.viewport.minValue,i(b)&&i(c)?{interval:a._$interval,y1:e.y.scale(b),y2:f.y.scale(c)}:void 0},j.parseInterval=function(a){return a.interval},j.parseValue1=function(a){return a.y1},j.parseValue2=function(a){return a.y2},function(c){return e=a.views[b.view],g=b.field,d?(f=a.views[d.view]||e,h=d.field):f=e,j.render(c).join("")}},makeBarCalc:function(a,b,c,e){var f,g,h,j,k=new d;return k.preParse=function(a){var b,c,d,k,l,m;return d=a[h],k=j?a[j]:g.viewport.minValue,m=e?parseInt(e,10)/2:3,i(d)&&i(k)&&d!==k&&(b=a._$interval-m,c=a._$interval+m,l={interval1:b>a._$minInterval?b:a._$minInterval,interval2:c>a._$maxInterval?a._$maxInterval:c,y1:f.y.scale(d),y2:g.y.scale(k)}),l},k.parseInterval1=function(a){return a.interval1},k.parseInterval2=function(a){return a.interval2},k.parseValue1=function(a){return a.y1},k.parseValue2=function(a){return a.y2},function(d){return f=a.views[b.view],h=b.field,c?(g=a.views[c.view]||f,j=c.field):g=f,k.render(d).join("")}},svgCompile:function(a){var b=(new DOMParser).parseFromString('<g xmlns="http://www.w3.org/2000/svg">'+a+"</g>","image/svg+xml"),c=b.childNodes[0],d=c.childNodes;return Array.prototype.slice.call(d,0)},parseStackedLimits:function(a,b){var c,d,e,f,g,h,i,j,k,l;if(b&&b.length)for(c=0,d=a.length;d>c;c++){for(l=0,h=void 0,g=a[c],k=b[0].name,h=g[k]||0,void 0===i?(i=h,j=h):i>h&&(i=h),g["$"+k]=h,l=h,e=1,f=b.length;f>e;e++)k=b[e].name,h=g[k]||0,l+=h,g["$"+k]=l;g.$total=l,l>j&&(j=l)}return{min:i,max:j}},parseSegmentedLimits:function(a,b,c,d){function e(a){a[b+"$Max"]=l,a[b+"$Min"]=k}var f,g,h,j,k,l,m={},n=[];if(d||(d=0),angular.isString(b)){for(c||(c=function(a,b){return b});d<a.length&&!i(c(a[d],a[d][b]));)d++;for(f=d,g=a.length;g>f;f++)h=a[f],j=c(h,h[b]),i(j)?(void 0===k?(k=j,l=j):k>j?k=j:j>l&&(l=j),n.push(h)):(n.forEach(e),m=this.parseSegmentedLimits(a,b,c,f+1),f=a.length);i(m.min)&&m.min<k&&(k=m.min),i(m.max)&&m.max>l&&(l=m.max)}else for(f=0,g=b.length;g>f;f++)j=this.parseSegmentedLimits(a,b[f],c),void 0===k?(k=j.min,l=j.max):(j.min<k&&(k=j.min),j.max>l&&(l=j.max));return{min:k,max:l}}}}]),angular.module("vgraph").factory("ComponentPage",["DataFeed","DataLoader","DataManager",function(a,b,c){"use strict";function d(){this.$$pageUid=e++,this.feeds={},this.loaders={},this.managers={}}var e=1;return d.defaultManager="default",d.prototype.configure=function(a){var b,c;if(angular.isArray(a))for(b=0,c=a.length;c>b;b++)this.addFeed(a[b]);else this.addFeed(a)},d.prototype.addFeed=function(c){var e,f,g,h,i=c.feed||[];return c.manager||(c.manager=d.defaultManager),h=c.manager,i._$feedUid?e=this.feeds[i._$feedUid]:(e=new a(i,c.explode),this.feeds[e.$$feedUid]=e,i._$feedUid=e.$$feedUid),g=this.getManager(h),this.connections[e.$$feedUid]||(this.connections[e.$$feedUid]={}),f=this.connection[e.$$feedUid][g.$$managerUid],f||(f=new b(e,g),this.connection[e.$$feedUid][g.$$managerUid]=f),f.addConfig(c),i},d.prototype.getManager=function(a){var b=a||d.defaultManager,e=this.managers[b];return e||(e=new c,this.managers[b]=e),e},d}]),angular.module("vgraph").factory("ComponentPane",[function(){"use strict";function a(a,b,c){this.x=b,this.y=c,this.fitToPane=!1,this._pane={},this._bounds={},this.setBounds({min:b.min,max:b.max},{min:c.min,max:c.max})}return a.prototype.setBounds=function(a,b){return this._bounds.x=a,this._bounds.y=b,this},a.prototype.setPane=function(a,b){return this._pane.x=a,this._pane.y=b,this},a.prototype.isValid=function(a){var b;return this.filtered?(b=a._$index,this.filtered.$minIndex<=b&&b<=this.filtered.$maxIndex):!1},a.prototype.filter=function(a,b){var c,d,e,f,g,h,i=this.x,j=a.data;return j.length&&(a.clean(),c=this._bounds.x.min||j.$minIndex,d=this._bounds.x.max||j.$maxIndex,i.$min=c,i.$max=d,this._pane.x&&this._pane.x.stop?(e=this._pane.x,g=c+e.start*(d-c),h=c+e.stop*(d-c)):(g=c,h=d),b.$left=g,b.left=(g-c)/(d-c),b.$right=h,b.right=(h-c)/(d-c),f=j.$filter(g,h),this.fitToPane&&(f.$addNode(g,a.$makePoint(g),!0),f.$addNode(a.$makePoint(h))),f.$sort()),f},a}]),angular.module("vgraph").factory("ComponentView",["ComponentPane",function(a){"use strict";function b(b){var d,e,f,g;b||(b={}),d=b.x||{},e=b.y||{},g=this.addModel.bind(this),this.$vgvid=c++,this.x=d,this.y=e,this.pane=new a(this.x,this.y),this.models={},this.components=[],this.managerName=b.manager,this.datumFactory=b.datumFactory,b.models&&(f=angular.isFunction(b.models)?b.models():b.models,Object.keys(f).forEach(function(a){g(a,f[a])}))}var c=1;return b.prototype.addModel=function(a,b){return this.models[a]=b,this},b.prototype.configure=function(a,b){var c=this.x,d=this.y;this.box=b,this.makeInterval=a.makeInterval,this.adjustSettings=a.adjustSettings,this.pane.fitToPane=a.fitToPane,c.tick=a.x.tick||{},c.scale=a.x.scale?a.x.scale():d3.scale.linear(),c.padding=a.x.padding,c.massage=a.x.massage,c.format=a.x.format||function(a){return a},d.tick=a.y.tick||{},d.scale=a.y.scale?a.y.scale():d3.scale.linear(),d.padding=a.y.padding,d.massage=a.y.massage,d.format=a.y.format||function(a){return a}},b.prototype.setPage=function(a){var b=this.x;this.manager=a.getManager(this.managerName),b&&(b.min||0===b.min)&&b.max&&b.interval&&this.datumFactory&&this.manager.data.$fillPoints(b.min,b.max,b.interval,this.datumFactory)},b.prototype.register=function(a){this.components.push(a)},b.prototype.isReady=function(){return this.manager&&this.manager.ready},b.prototype.hasData=function(){return this.isReady()&&this.manager.data.length},b.prototype.sample=function(){var a,b,c,d=this,e=this.box,f=this.pane,g=this.models;this.offset={},this.filtered=f.filter(this.manager,this.offset),c=this.filtered,b=this.offset,c&&(this.x.scale.domain([b.$left,b.$right]).range([e.innerLeft,e.innerRight]),c.forEach(function(a){a._$interval=d.x.scale(a._$index)}),a=Object.keys(g),a.forEach(function(a){g[a].$follow(c,e)}))},b.prototype.setViewportValues=function(a,b){var c,d=this.box;this.y.padding&&(c=b===a?a*this.y.padding:(b-a)*this.y.padding,b+=c,a-=c),this.viewport.minValue=a,this.viewport.maxValue=b,this.y.scale.domain([a,b]).range([d.innerBottom,d.innerTop])},b.prototype.setViewportIntervals=function(a,b){var c=this.box;this.viewport.minInterval=a,this.viewport.maxInterval=b,this.x.scale.domain([a,b]).range([c.innerLeft,c.innerRight])},b.prototype.parse=function(){var a,b,c,d=this.pane,e=d.rawContainer.data;this.sample(),c=this.models,d.filtered&&(this.components.forEach(function(d){var e;d.parse&&(e=d.parse(c),e&&(null!==e.min&&(!a&&0!==a||a>e.min)&&(a=e.min),null!==e.max&&(!b&&0!==b||b<e.max)&&(b=e.max)))}),this.viewport||(this.viewport={}),this.setViewportValues(a,b),this.setViewportIntervals(this.offset.$left,this.offset.$right),this.adjustSettings&&this.adjustSettings(this.pane.filtered.$maxIndex-this.pane.filtered.$minIndex,b-a,e.$maxIndex-e.$minIndex))},b.prototype.build=function(){var a=this.models;this.components.forEach(function(b){b.build&&b.build(a)})},b.prototype.process=function(){var a=this.models;this.components.forEach(function(b){b.process&&b.process(a)})},b.prototype.finalize=function(){var a=this.models;this.components.forEach(function(b){b.finalize&&b.finalize(a)})},b.prototype.getPoint=function(a){var b=0,c=0,d=this.models,e={};return Object.keys(d).forEach(function(f){var g;e[f]=d[f].$getClosest(a,"_$interval"),g=e[f]._$interval,g&&(c++,b+=g)}),e.$pos=b/c,e},b}]),angular.module("vgraph").factory("DataCollection",[function(){"use strict";function a(a,b,c,d){var e,f,g=0,h=a.length-1;if(d||a.sort(function(a,b){return c(a)-c(b)}),c(a[g])>=b)return{left:g,right:g};if(c(a[h])<=b)return{left:h,right:h};if(a.length){for(;h-g>1;)e=Math.floor((h+g)/2),f=c(a[e]),f===b?(h=e,g=e):f>b?h=e:g=e;return h!==e&&c(a[h])===b?{left:h,right:h}:g!==e&&c(a[g])===b?{left:g,right:g}:{left:g,right:h}}}function b(a){return null!==a&&void 0!==a&&"object"!=typeof a}function c(){this._$index={},this.$dirty=!1}return c.prototype=[],c.isNumeric=b,c.prototype.$fillPoints=function(a,b,c,d){var e,f,g;for(e=a,f=b+c;f>e;e+=c)g=d(),g._$index=e,this._$index[e]=g,this.push(g)},c.prototype._register=function(a,b,c){var d,e=+a;return this._$index[e]||(this._$index[e]=b,c?(this.length&&e>this[0]._$index&&(this.$dirty=!0),this.unshift(b)):(this.length&&e<this[this.length-1]._$index&&(this.$dirty=!0),this.push(b)),Object.keys(b).forEach(function(a){var c=b[a];(c||0===c)&&(d=!0)}),d&&(void 0===this.$minIndex?(this.$minIndex=e,this.$maxIndex=e):this.$maxIndex<e?this.$maxIndex=e:this.$minIndex>e&&(this.$minIndex=e)),b._$index=e),b},c.prototype._makeNode=function(a){var b=+a,c=this.$getNode(a);if(isNaN(b))throw new Error("index must be a number, not: "+a+" that becomes "+b);return c||(c={},this._register(b,c)),c},c.prototype.$getNode=function(a){var b=+a;return this._$index[b]},c.prototype._setValue=function(a,b,c){var d=a._$index;a.$setValue?a.$setValue(b,c):a[b]=c,(c||0===c)&&(void 0===this.$minIndex?(this.$minIndex=d,this.$maxIndex=d):this.$maxIndex<d?this.$maxIndex=d:this.$minIndex>d&&(this.$minIndex=d))},c.prototype.$setValue=function(a,b,c){var d=this._makeNode(a);return this._setValue(d,b,c),d},c.prototype.$addNode=function(a,b,c){var d,e,f;if(b?e=+a:(b=a,e=b._$index),f=this.$getNode(e))f.$merge?f.$merge(b):(d=this._setValue.bind(this),Object.keys(b).forEach(function(a){"_$index"!==a&&d(f,a,b[a])}));else{if(this.$makeNode)f=this.$makeNode(b);else{if(b._$index&&b._$index!==e)throw new Error("something wrong with index -> ",b._$index,e);f=b}this._register(e,f,c)}return f},c.prototype.$pos=function(b,c){var d;return c||(c="_$index"),this.$sort(),d=a(this,b,function(a){return a[c]},!0),d.field=c,d},c.prototype.$getClosestPair=function(a,b){var c=this.$pos(a,b);return{left:this[c.left],right:this[c.right],field:c.field}},c.prototype.$getClosest=function(a,b){var c,d,e=this.$getClosestPair(a,b);return c=a-e.left[e.field],d=e.right[e.field]-a,d>c?e.left:e.right},c.prototype.$sort=function(){this.$dirty&&(this.sort(function(a,b){return a._$index-b._$index}),this.$dirty=!1)},c.prototype.$filter=function(a,b){var d,e=-1,f=new c;this.$sort();do e++,d=this[e];while(d&&d._$index<a);for(;d&&d._$index<=b;)f.$addNode(d),e++,d=this[e];return f.$parent=this,f},c}]),angular.module("vgraph").factory("DataFeed",["makeEventing",function(a){"use strict";function b(a,b){this.explode=b,this.setSource(a),this.$$feedUid=c++}var c=1;return b.prototype.setSource=function(a){var b=this,c=a.push;this.data=a,this._readPos=0,a.push=function(){c.apply(this,arguments),b.$push()},a.$ready=function(){b.$trigger("ready")},a.$error=function(a){b.$trigger("error",a)},a.$reset=function(){b.$trigger("reset"),b._readPos=0,b.data.length=0},this.$push()},a(b.prototype),b.prototype.$push=function(){var a=this;this._$push||(this._$push=setTimeout(function(){var b=a._readNext();for(b&&a.$trigger("ready");b;)a.$trigger("data",b),b=a._readNext();a._$push=null},0))},b.prototype._readAll=function(a){for(var b=this._read(0);b;)a(b),b=this._read(b.next)},b.prototype._readNext=function(){var a=this._read(this._readPos);return a&&(this._readPos=a.next),a},b.prototype._read=function(a){var b,c=this.data,d=this.explode;return!c.length||a>=c.length?null:d?(b=c[a],{points:d(b),next:a+1,ref:b}):{points:c.slice(a),next:c.length}},b}]),angular.module("vgraph").factory("DataLoader",[function(){"use strict";function a(a,c){var d=this,e=[],f=this._process.bind(this),g=a.$on("ready",function(){d.ready=!0}),h=a.$on("data",function(a){var b,c,d,g;for(d=0,g=e.length;g>d;d++)for(b=0,c=a.points.length;c>b;b++)f(e[d],a.points[b])}),i=a.$on("error",function(a){c.setError(a)}),j=a.$on("reset",function(){c.reset(),d.ready=!1});this.$$loaderUid=b++,this.feed=a,this.confs=e,this.dataManager=c,c.$follow(this),this.$destroy=function(){c.$ignore(this),i(),j(),g(),h()}}var b=1;return a.unregister=function(){},a.prototype.addConfig=function(a){var b=Object.keys(a.readings),c=this._process.bind(this);b.forEach(function(b){var c=a.readings[b];"string"==typeof c&&(a.readings[b]=function(a){return a[c]})}),a.parseInterval||(a.parseInterval=function(b){return b[a.interval]}),this.feed._readAll(function(b){var d,e,f=b.points;for(d=0,e=f.length;e>d;d++)c(a,f[d])}),this.confs.push(a)},a.prototype.removeConf=function(){},a.prototype._process=function(a,b){var c,d=this.dataManager,e=Object.keys(a.readings);if(!a.isDefined||a.isDefined(b))try{c=a.parseInterval(b),e.forEach(function(e){d.setValue(c,e,a.readings[e](b))})}catch(f){console.log("failed to load",b,c),console.log("conf:",a),console.log(f)}},a}]),angular.module("vgraph").factory("DataManager",["DataCollection",function(a){"use strict";function b(){this.$$managerId=d++,this.$dataProc=c(20,200,function(a){var b=a.registrations;b.forEach(function(a){a()})}),this.construct(),this.reset()}function c(a,b,c,d){function e(){var b=+new Date;b>h||b>g?(h=null,c.apply(d,f)):setTimeout(e,a)}var f,g,h;return function(){var c=+new Date;g=c+a,f=arguments,h||(h=c+b,setTimeout(e,a))}}var d=1;return b.prototype.construct=function(){var a=[];this.registrations=[],this.errorRegistrations=[],this.getLoaders=function(){return a},this.$follow=function(b){a.push(b)},this.$ignore=function(b){var c=a.indexOf(b);-1!==c&&a.splice(c,1)}},b.prototype.reset=function(){this.data=new a,this.ready=!1,this.dataReady(!0)},b.prototype.onError=function(a){this.errorRegistrations.push(a)},b.prototype.setError=function(a){var b,c;for(b=0,c=this.errorRegistrations.length;c>b;b++)this.errorRegistrations[b](a)},b.prototype.getNode=function(a){return this.dataReady(),this.data.$getNode(a)},b.prototype.setValue=function(a,b,c){return this.dataReady(),this.ready||!c&&0!==c||(this.ready=!0),this.data.$setValue(a,b,c)},b.prototype.removePlot=function(){},b.prototype.dataReady=function(a){var b=this.registrations;a?b.forEach(function(a){a()}):this.$dataProc(this)},b.prototype.register=function(a){this.registrations.push(a)},b.prototype.clean=function(){this.data.$sort()},b.prototype.$makePoint=function(a){var b,c,d,e,f=this.data.$pos(a,"_$index");return f.right===f.left?this.data[f.right]:(b=this.data[f.right],c=this.data[f.left],d={},e=(a-c._$index)/(b._$index-c._$index),Object.keys(b).forEach(function(a){var f=c[a],g=b[a];void 0!==f&&null!==f&&void 0!==g&&null!==g&&(d[a]=f+(g-f)*e)}),d.$faux=!0,d._$index=a,d)},b}]),angular.module("vgraph").factory("DrawArea",["DrawBuilder",function(a){"use strict";function b(){}return b.prototype=new a,b.prototype.parseValue1=null,b.prototype.parseValue2=null,b.prototype.parseInterval=null,b.prototype.build=function(a){var b,c,d,e,f=[],g=[];if(a.length){for(b=0,c=a.length;c>b;b++)d=a[b],e=this.parseInterval(d),f.push(e+","+this.parseValue1(d)),g.unshift(e+","+this.parseValue2(d));return"M"+f.join("L")+"L"+g.join("L")+"Z"}return""},b}]),angular.module("vgraph").factory("DrawBox",["DrawBuilder",function(a){"use strict";function b(){}function c(a,b,c,d,e){var f;return c>d&&(f=c,c=d,d=f),a>b&&(f=a,a=b,b=f),e?(e.v1>a&&(e.v1=a),b>e.v2&&(e.v2=b),e.i1>c&&(e.i1=c),d>e.i2&&(e.i2=d),e):{v1:a,v2:b,i1:c,i2:d}}function d(a){return"M"+(a.i1+","+a.v1)+"L"+(a.i2+","+a.v1)+"L"+(a.i2+","+a.v2)+"L"+(a.i1+","+a.v2)+"Z"}return b.prototype=new a,b.prototype.parseValue1=null,b.prototype.parseValue2=null,b.prototype.parseInterval1=null,b.prototype.parseInterval2=null,b.prototype.breakBox=function(){return!0},b.prototype.build=function(a){var b,e,f,g,h,i,j,k,l="";if(a.length){for(b=0,e=a.length;e>b;b++)f=a[b],g=this.parseValue1(f),h=this.parseValue2(f),i=this.parseInterval1(f),j=this.parseInterval2(f),k=c(g,h,i,j,k),this.breakBox(f)&&(l+=d(k),k=null);return k&&(l+=d(k)),l}return""},b}]),angular.module("vgraph").factory("DrawBuilder",[function(){"use strict";function a(){}return a.prototype.preParse=function(a){return a},a.prototype.parse=function(a){var b,c,d,e,f=[],g=[f],h=this.preParse.bind(this);for(b=0,c=a.length;c>b;b++)d=a[b],e=h(d,e),e?f.push(e):0!==f.length&&(f=[],g.push(f));return g},a.prototype.render=function(a){var b,c,d;for(a=this.parse(a),b=0,c=a.length;c>b;b++)d=a[b],a[b]=this.build(d);return a},a.prototype.build=function(){return"M0,0Z"},a}]),angular.module("vgraph").factory("DrawElement",[function(){"use strict";function a(a){return(new DOMParser).parseFromString('<g xmlns="http://www.w3.org/2000/svg">'+a+"</g>","image/svg+xml").childNodes[0].childNodes}function b(b,c,d){var e,f;"object"==typeof b?e=b:(f="<"+this._tag+' class="'+c.className+'"></'+this._tag+">",e=d?a("<g>"+f+"</g>")[0]:a(f)[0]),this.getNode=function(){return e}}return b.svgCompile=a,b.prototype.build=function(a){var b,c,d,e=this.getNode();if("g"===e.tagName){if(d=e.childNodes,d.length>a.length)for(;d.length>a.length;)e.removeChild(d.pop());else if(d.length<a.length)for(;e.childNodes.length<a.length;)e.appendChild(d[0].cloneNode());for(d=e.childNodes,b=0,c=a.length;c>b;b++)d[b].setAttribute("d",a[b])}else e.setAttribute("d",a.join(""))},b}]),angular.module("vgraph").factory("DrawLine",["DrawBuilder",function(a){"use strict";function b(){}return b.prototype=new a,b.prototype.parseValue=null,b.prototype.parseInterval=null,b.prototype.build=function(a){var b,c,d;if(a.length){for(b=0,c=a.length;c>b;b++)d=a[b],a[b]=this.parseInterval(d)+","+this.parseValue(d);return"M"+a.join("L")}return""},b}]),angular.module("vgraph").factory("makeEventing",[function(){"use strict";return function(a){a.$on=function(a,b){var c=this;return this._$listeners||(this._$listeners={}),this._$listeners[a]||(this._$listeners[a]=[]),this._$listeners[a].push(b),function(){c._$listeners[a].splice(c._$listeners[a].indexOf(b),1)}},a.$subscribe=function(a){var b=this,c=[],d=Object.keys(a);return d.forEach(function(d){var e=a[d];c.push(b.$on(d,e))}),function(){c.forEach(function(a){a()})}},a.$trigger=function(a,b){var c,d,e;if(this._$listeners&&(c=this._$listeners[a]))for(d=0,e=c.length;e>d;d++)c[d](b)}}}]),angular.module("vgraph").factory("StatCalculations",[function(){"use strict";function a(a){return null===a?!1:Number.isFinite?Number.isFinite(a)&&!Number.isNaN(a):isFinite(a)&&!isNaN(a)}function b(a,b){var c=[];return a.forEach(function(a){c.push("$"+b+"$"+a.field)}),c}return{$resetCalcs:function(a){var b,c;for(b=0,c=a.length;c>b;b++)a[b].field=a[b].name},$getFields:function(a){var b,c,d=[];for(b=0,c=a.length;c>b;b++)d.push(a[b].field);return d},$setFields:function(a,b){var c,d;for(c=0,d=a.length;d>c;c++)a[c].field=b[c]},sum:function(a,c){var d=b(a,"sum");return a.forEach(function(a,b){var e=a.field,f=d[b],g=0;c.forEach(function(a){var b=a[e];b&&(g+=b)}),c[f]=g,a.field=f}),d},average:function(a,c){var d=b(a,"average");return a.forEach(function(a,b){var e=a.field,f=d[b],g=0,h=0;c.forEach(function(a){var b=a[e];b?(g+=b,h++):0===b&&h++}),c[f]=g/h,a.field=f}),d},stack:function(a,c){var d=b(a,"stack"),e=this.$getFields(a);return c.forEach(function(a){var b=0;e.forEach(function(c,e){var f=a[c]||0;b+=f,a[d[e]]=b})}),a.forEach(function(a,b){a.field=d[b]}),d},limits:function(b,c){var d,e,f,g,h,i,j;if(angular.isArray(b))for(d=0,e=b.length;e>d;d++)g=this.limits(b[d],c),void 0===h?(h=g.min,i=g.max):(g.min<h&&(h=g.min),g.max>i&&(i=g.max));else if(b)for(j=b.field,d=0,e=c.length;e>d;d++)f=c[d],g=f[j],a(g)&&(void 0===h?(h=g,i=g):h>g?h=g:g>i&&(i=g));return{min:h,max:i}}}}]),angular.module("vgraph").factory("LinearSamplerNode",[function(){"use strict";function a(a){var b=[];this._$minInterval=a._$interval,this._$count=0,this._$interval=0,Object.keys(a).forEach(function(a){var c=a.charAt(0);"_"!==c&&b.push(a)}),this._$keys=b,this.$merge(a)}return a.prototype.$merge=function(a){var b=this;this._$maxInterval=a._$interval,this._$interval+=a._$interval,this._$count++,this._$keys.forEach(function(c){b[c]||0===b[c]?b[c]+=a[c]:b[c]=a[c]})},a.prototype.$finalize=function(a){var b=this,c=this._$count,d=this._$index;this._$interval=this._$interval/c,this._$keys.forEach(function(e){var f=b[e];(f||0===f)&&((void 0===a[e]||a[e]<d)&&(a[e]=d),b[e]=f/c)})},a}]),angular.module("vgraph").factory("LinearSamplerModel",["DataCollection","LinearSamplerNode",function(a,b){"use strict";function c(c,d){this.$stats={},this.$indexer=c,this.$makeNode=d||function(a){return new b(a)},a.call(this)}return c.prototype=new a,c.prototype.$follow=function(a){var b,c,d,e,f=this.$indexer;for(this.length=0,this._$index={},a.$sort(),this.$parent=a,b=0,c=a.length;c>b;b++)e=a[b],d=f(e),this.$addNode(d,e);for(b=0,c=this.length;c>b;b++)this[b].$finalize(this.$stats)},c}]),angular.module("vgraph").directive("vgraphChart",["ComponentChart",function(a){"use strict";function b(a){a.$mat&&a.innerWidth&&(a.$mat.attr("class","mat").attr("width",a.innerWidth).attr("height",a.innerHeight).attr("transform","translate("+a.innerLeft+","+a.innerTop+")"),a.$frame.attr("class","frame").attr("width",a.width).attr("height",a.height).attr("transform","translate("+a.left+","+a.top+")"))}return{scope:{settings:"=vgraphChart"},controller:a,require:["vgraphChart","^vgraphPage"],link:function(a,c,d,e){var f,g=e[1],h=e[0],i=h.box;f="svg"===c[0].tagName?c[0]:c.find("svg")[0],i.register(function(){b(i),h.rerender(function(){a.$apply()})}),i.targetSvg(f),i.$mat=d3.select(f).insert("rect",":first-child"),i.$frame=d3.select(f).insert("rect",":first-child"),b(i),a.$watch("settings",function(a){console.log("vgraphChart - settings"),h.configure(g,a)})},restrict:"A"}}]),angular.module("vgraph").directive("vgraphLine",["ComponentGenerator","StatCalculations",function(a,b){"use strict";return{scope:{config:"=vgraphLine",pair:"=?pair"},require:["^vgraphChart"],link:function(c,d,e,f){console.log("vgraphLine");var g,h,i,j,k,l=a.normalizeConfig(c.config),m=f[0];h="path"===d[0].tagName?d3.select(d[0]):d3.select(d[0]).append("path"),e.pair?(g=a.normalizeConfig(c.pair),j="fill ",i=a.makeFillCalc(m,l,g),k=[l,g]):(j="line ",i=a.makeLineCalc(m,l),k=[l]),l.classExtend&&(j+=l.classExtend+" "),j+=e.className||l.className,h.attr("class",j),m.views[l.view].register({parse:function(a){return b.limits(k,a[l.model])},finalize:function(a){h.attr("d",i(a[l.model]))},publish:function(b,c,d,e){c.push(name),a.publish(b,name,d,e)}})}}}]),angular.module("vgraph").directive("vgraphPage",["ComponentPage",function(a){"use strict";return{restrict:"A",scope:{settings:"=vgraphPage"},controller:a,require:["vgraphPage"],link:function(a,b,c,d){var e=d[0];a.$watch("settings",function(a){e.configure(a)})}}}]),function(a){"use strict";var b=/\S+/g,c=/[\t\r\n\f]/g;a&&(a.fn.addClass=function(d){var e,f,g,h,i,j,k,l="string"==typeof d&&d,m=0,n=this.length;if(a.isFunction(d))return this.each(function(b){a(this).addClass(d.call(this,b,this.className))});if(l)for(e=(d||"").match(b)||[];n>m;m++)if(f=this[m],k="string"!=typeof f.className,g=1===f.nodeType&&(f.className?(" "+(k?f.getAttribute("class")||"":f.className)+" ").replace(c," "):" ")){for(i=0;h=e[i++];)g.indexOf(" "+h+" ")<0&&(g+=h+" ");j=a.trim(g),f.className!==j&&(k?f.setAttribute("class",j):f.className=j)}return this},a.fn.removeClass=function(d){var e,f,g,h,i,j,k,l=0===arguments.length||"string"==typeof d&&d,m=0,n=this.length;if(a.isFunction(d))return this.each(function(b){a(this).removeClass(d.call(this,b,this.className))});if(l)for(e=(d||"").match(b)||[];n>m;m++)if(f=this[m],k="string"!=typeof f.className,g=1===f.nodeType&&(f.className?(" "+(k?f.getAttribute("class")||"":f.className)+" ").replace(c," "):"")){for(i=0;h=e[i++];)for(;g.indexOf(" "+h+" ")>=0;)g=g.replace(" "+h+" "," ");j=d?a.trim(g):"",f.className!==j&&(k?f.setAttribute("class",j):f.className=j)}return this})}(jQuery);
//# sourceMappingURL=vgraph.min.js.map